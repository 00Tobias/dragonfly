var shadow$provide = {};
(function(){
shadow$provide[0]=function(Tl,Ul,Vl,q){function $b(){const a=4294967295*Math.random()|0,b=4294967295*Math.random()|0,c=4294967295*Math.random()|0,d=4294967295*Math.random()|0;return(Sb[a&255]+Sb[a>>8&255]+Sb[a>>16&255]+Sb[a>>24&255]+"-"+Sb[b&255]+Sb[b>>8&255]+"-"+Sb[b>>16&15|64]+Sb[b>>24&255]+"-"+Sb[c&63|128]+Sb[c>>8&255]+"-"+Sb[c>>16&255]+Sb[c>>24&255]+Sb[d&255]+Sb[d>>8&255]+Sb[d>>16&255]+Sb[d>>24&255]).toLowerCase()}function yb(a,b,c){return Math.max(b,Math.min(c,a))}function Gf(a,b){return(a%b+
b)%b}function le(a,b,c){return(1-c)*a+c*b}function Hf(a){return 0===(a&a-1)&&0!==a}function lc(a){return Math.pow(2,Math.ceil(Math.log(a)/Math.LN2))}function Ne(a){return Math.pow(2,Math.floor(Math.log(a)/Math.LN2))}function B(a,b){switch(b.constructor){case Float32Array:return a;case Uint32Array:return a/4294967295;case Uint16Array:return a/65535;case Uint8Array:return a/255;case Int32Array:return Math.max(a/2147483647,-1);case Int16Array:return Math.max(a/32767,-1);case Int8Array:return Math.max(a/
127,-1);default:throw Error("Invalid component type.");}}function Xa(a,b){switch(b.constructor){case Float32Array:return a;case Uint32Array:return Math.round(4294967295*a);case Uint16Array:return Math.round(65535*a);case Uint8Array:return Math.round(255*a);case Int32Array:return Math.round(2147483647*a);case Int16Array:return Math.round(32767*a);case Int8Array:return Math.round(127*a);default:throw Error("Invalid component type.");}}function Dg(a){for(let b=a.length-1;0<=b;--b)if(65535<=a[b])return!0;
return!1}function md(a){return document.createElementNS("http://www.w3.org/1999/xhtml",a)}function tb(){const a=md("canvas");a.style.display="block";return a}function Gd(a){a in Eg||(Eg[a]=!0,console.warn(a))}function nd(a){return.04045>a?.0773993808*a:Math.pow(.9478672986*a+.0521327014,2.4)}function me(a){return.0031308>a?12.92*a:1.055*Math.pow(a,.41666)-.055}function ne(a){if("undefined"!==typeof HTMLImageElement&&a instanceof HTMLImageElement||"undefined"!==typeof HTMLCanvasElement&&a instanceof
HTMLCanvasElement||"undefined"!==typeof ImageBitmap&&a instanceof ImageBitmap)return If.getDataURL(a);if(a.data)return{data:Array.from(a.data),width:a.width,height:a.height,type:a.data.constructor.name};console.warn("THREE.Texture: Unable to serialize Texture.");return{}}function xb(a,b,c,d,f){for(let g=0,l=a.length-3;g<=l;g+=3){od.fromArray(a,g);const m=f.x*Math.abs(od.x)+f.y*Math.abs(od.y)+f.z*Math.abs(od.z),n=b.dot(od),t=c.dot(od),u=d.dot(od);if(Math.max(-Math.max(n,t,u),Math.min(n,t,u))>m)return!1}return!0}
function Jf(a,b,c){0>c&&(c+=1);1<c&&--c;return c<1/6?a+6*(b-a)*c:.5>c?b:c<2/3?a+6*(b-a)*(2/3-c):a}function ac(a){65504<Math.abs(a)&&console.warn("THREE.DataUtils.toHalfFloat(): Value out of range.");a=yb(a,-65504,65504);Lc.floatView[0]=a;a=Lc.uint32View[0];const b=a>>23&511;return Lc.baseTable[b]+((a&8388607)>>Lc.shiftTable[b])}function Hd(a){const b=a>>10;Lc.uint32View[0]=Lc.mantissaTable[Lc.offsetTable[b]+(a&1023)]+Lc.exponentTable[b];return Lc.floatView[0]}function Ca(a,b,c,d,f,g,l,m,n,t){a.getVertexPosition(m,
Id);a.getVertexPosition(n,Jd);a.getVertexPosition(t,pd);var u=Id,v=Jd,A=pd,F=Oe;null===(1===b.side?d.intersectTriangle(A,v,u,!0,F):d.intersectTriangle(u,v,A,0===b.side,F))?a=null:(Kd.copy(F),Kd.applyMatrix4(a.matrixWorld),b=c.ray.origin.distanceTo(Kd),a=b<c.near||b>c.far?null:{distance:b,point:Kd.clone(),object:a});a&&(f&&(Pe.fromBufferAttribute(f,m),Qe.fromBufferAttribute(f,n),Re.fromBufferAttribute(f,t),a.uv=Tb.getInterpolation(Oe,Id,Jd,pd,Pe,Qe,Re,new sa)),g&&(Pe.fromBufferAttribute(g,m),Qe.fromBufferAttribute(g,
n),Re.fromBufferAttribute(g,t),a.uv1=Tb.getInterpolation(Oe,Id,Jd,pd,Pe,Qe,Re,new sa),a.uv2=a.uv1),l&&(Fg.fromBufferAttribute(l,m),Kf.fromBufferAttribute(l,n),Gg.fromBufferAttribute(l,t),a.normal=Tb.getInterpolation(Oe,Id,Jd,pd,Fg,Kf,Gg,new O),0<a.normal.dot(d.direction)&&a.normal.multiplyScalar(-1)),d={a:m,b:n,c:t,normal:new O,materialIndex:0},Tb.getNormal(Id,Jd,pd,d.normal),a.face=d);return a}function $a(a){const b={};for(const c in a){b[c]={};for(const d in a[c]){const f=a[c][d];f&&(f.isColor||
f.isMatrix3||f.isMatrix4||f.isVector2||f.isVector3||f.isVector4||f.isTexture||f.isQuaternion)?f.isRenderTargetTexture?(console.warn("UniformsUtils: Textures of render targets cannot be cloned via cloneUniforms() or mergeUniforms()."),b[c][d]=null):b[c][d]=f.clone():Array.isArray(f)?b[c][d]=f.slice():b[c][d]=f}}return b}function Ub(a){const b={};for(let c=0;c<a.length;c++){const d=$a(a[c]);for(const f in d)b[f]=d[f]}return b}function Mc(a){return null===a.getRenderTarget()?a.outputColorSpace:jb.workingColorSpace}
function Se(){function a(g,l){d(g,l);f=b.requestAnimationFrame(a)}let b=null,c=!1,d=null,f=null;return{start:function(){!0!==c&&null!==d&&(f=b.requestAnimationFrame(a),c=!0)},stop:function(){b.cancelAnimationFrame(f);c=!1},setAnimationLoop:function(g){d=g},setContext:function(g){b=g}}}function Lf(a,b){const c=b.isWebGL2,d=new WeakMap;return{get:function(f){f.isInterleavedBufferAttribute&&(f=f.data);return d.get(f)},remove:function(f){f.isInterleavedBufferAttribute&&(f=f.data);const g=d.get(f);g&&
(a.deleteBuffer(g.buffer),d.delete(f))},update:function(f,g){if(f.isGLBufferAttribute)g=d.get(f),(!g||g.version<f.version)&&d.set(f,{buffer:f.buffer,type:f.type,bytesPerElement:f.elementSize,version:f.version});else{f.isInterleavedBufferAttribute&&(f=f.data);var l=d.get(f);if(void 0===l){l=d.set;var m=f,n=f.array;const u=f.usage;var t=a.createBuffer();a.bindBuffer(g,t);a.bufferData(g,n,u);f.onUploadCallback();if(n instanceof Float32Array)g=a.FLOAT;else if(n instanceof Uint16Array)if(f.isFloat16BufferAttribute)if(c)g=
a.HALF_FLOAT;else throw Error("THREE.WebGLAttributes: Usage of Float16BufferAttribute requires WebGL2.");else g=a.UNSIGNED_SHORT;else if(n instanceof Int16Array)g=a.SHORT;else if(n instanceof Uint32Array)g=a.UNSIGNED_INT;else if(n instanceof Int32Array)g=a.INT;else if(n instanceof Int8Array)g=a.BYTE;else if(n instanceof Uint8Array)g=a.UNSIGNED_BYTE;else if(n instanceof Uint8ClampedArray)g=a.UNSIGNED_BYTE;else throw Error("THREE.WebGLAttributes: Unsupported buffer data format: "+n);l.call(d,m,{buffer:t,
type:g,bytesPerElement:n.BYTES_PER_ELEMENT,version:f.version})}else l.version<f.version&&(m=f,n=m.array,t=m.updateRange,a.bindBuffer(g,l.buffer),-1===t.count?a.bufferSubData(g,0,n):(c?a.bufferSubData(g,t.offset*n.BYTES_PER_ELEMENT,n,t.offset,t.count):a.bufferSubData(g,t.offset*n.BYTES_PER_ELEMENT,n.subarray(t.offset,t.offset+t.count)),t.count=-1),m.onUploadCallback(),l.version=f.version)}}}}function bi(a,b,c,d,f,g,l){function m(E,y){E.getRGB(z,Mc(a));d.buffers.color.setClear(z.r,z.g,z.b,y,l)}const n=
new Ia(0);let t=!0===g?0:1,u,v,A=null,F=0,D=null;return{getClearColor:function(){return n},setClearColor:function(E,y=1){n.set(E);t=y;m(n,t)},getClearAlpha:function(){return t},setClearAlpha:function(E){t=E;m(n,t)},render:function(E,y){let J=!1,L=!0===y.isScene?y.background:null;L&&L.isTexture&&(L=(0<y.backgroundBlurriness?c:b).get(L));null===L?m(n,t):L&&L.isColor&&(m(L,1),J=!0);const U=a.xr.getEnvironmentBlendMode();"additive"===U?d.buffers.color.setClear(0,0,0,1,l):"alpha-blend"===U&&d.buffers.color.setClear(0,
0,0,0,l);(a.autoClear||J)&&a.clear(a.autoClearColor,a.autoClearDepth,a.autoClearStencil);if(L&&(L.isCubeTexture||306===L.mapping)){void 0===v&&(v=new cb(new Ld(1,1,1),new bc({name:"BackgroundCubeMaterial",uniforms:$a(x.backgroundCube.uniforms),vertexShader:x.backgroundCube.vertexShader,fragmentShader:x.backgroundCube.fragmentShader,side:1,depthTest:!1,depthWrite:!1,fog:!1})),v.geometry.deleteAttribute("normal"),v.geometry.deleteAttribute("uv"),v.onBeforeRender=function(P,X,ja){this.matrixWorld.copyPosition(ja.matrixWorld)},
Object.defineProperty(v.material,"envMap",{get:function(){return this.uniforms.envMap.value}}),f.update(v));v.material.uniforms.envMap.value=L;v.material.uniforms.flipEnvMap.value=L.isCubeTexture&&!1===L.isRenderTargetTexture?-1:1;v.material.uniforms.backgroundBlurriness.value=y.backgroundBlurriness;v.material.uniforms.backgroundIntensity.value=y.backgroundIntensity;v.material.toneMapped="srgb"!==jb.getTransfer(L.colorSpace);if(A!==L||F!==L.version||D!==a.toneMapping)v.material.needsUpdate=!0,A=L,
F=L.version,D=a.toneMapping;v.layers.enableAll();E.unshift(v,v.geometry,v.material,0,0,null)}else if(L&&L.isTexture){void 0===u&&(u=new cb(new k(2,2),new bc({name:"BackgroundMaterial",uniforms:$a(x.background.uniforms),vertexShader:x.background.vertexShader,fragmentShader:x.background.fragmentShader,side:0,depthTest:!1,depthWrite:!1,fog:!1})),u.geometry.deleteAttribute("normal"),Object.defineProperty(u.material,"map",{get:function(){return this.uniforms.t2D.value}}),f.update(u));u.material.uniforms.t2D.value=
L;u.material.uniforms.backgroundIntensity.value=y.backgroundIntensity;u.material.toneMapped="srgb"!==jb.getTransfer(L.colorSpace);!0===L.matrixAutoUpdate&&L.updateMatrix();u.material.uniforms.uvTransform.value.copy(L.matrix);if(A!==L||F!==L.version||D!==a.toneMapping)u.material.needsUpdate=!0,A=L,F=L.version,D=a.toneMapping;u.layers.enableAll();E.unshift(u,u.geometry,u.material,0,0,null)}}}}function ci(a,b,c,d){function f(P){return d.isWebGL2?a.bindVertexArray(P):D.bindVertexArrayOES(P)}function g(P){return d.isWebGL2?
a.deleteVertexArray(P):D.deleteVertexArrayOES(P)}function l(P){const X=[],ja=[],fa=[];for(let aa=0;aa<F;aa++)X[aa]=0,ja[aa]=0,fa[aa]=0;return{geometry:null,program:null,wireframe:!1,newAttributes:X,enabledAttributes:ja,attributeDivisors:fa,object:P,attributes:{},index:null}}function m(){const P=L.newAttributes;for(let X=0,ja=P.length;X<ja;X++)P[X]=0}function n(P){t(P,0)}function t(P,X){const ja=L.enabledAttributes,fa=L.attributeDivisors;L.newAttributes[P]=1;0===ja[P]&&(a.enableVertexAttribArray(P),
ja[P]=1);fa[P]!==X&&((d.isWebGL2?a:b.get("ANGLE_instanced_arrays"))[d.isWebGL2?"vertexAttribDivisor":"vertexAttribDivisorANGLE"](P,X),fa[P]=X)}function u(){const P=L.newAttributes,X=L.enabledAttributes;for(let ja=0,fa=X.length;ja<fa;ja++)X[ja]!==P[ja]&&(a.disableVertexAttribArray(ja),X[ja]=0)}function v(){A();U=!0;L!==J&&(L=J,f(L.object))}function A(){J.geometry=null;J.program=null;J.wireframe=!1}const F=a.getParameter(a.MAX_VERTEX_ATTRIBS),D=d.isWebGL2?null:b.get("OES_vertex_array_object"),E=d.isWebGL2||
null!==D,y={},J=l(null);let L=J,U=!1;return{setup:function(P,X,ja,fa,aa){var pa=!1;if(E){pa=!0===X.wireframe;var ba=y[fa.id];void 0===ba&&(ba={},y[fa.id]=ba);var xa=ba[ja.id];void 0===xa&&(xa={},ba[ja.id]=xa);ba=xa[pa];void 0===ba&&(ba=l(d.isWebGL2?a.createVertexArray():D.createVertexArrayOES()),xa[pa]=ba);pa=ba;L!==pa&&(L=pa,f(L.object));a:{pa=L.attributes;xa=fa.attributes;ba=0;var qa=ja.getAttributes();for(var ta in qa)if(0<=qa[ta].location){var Ba=pa[ta],va=xa[ta];void 0===va&&("instanceMatrix"===
ta&&P.instanceMatrix&&(va=P.instanceMatrix),"instanceColor"===ta&&P.instanceColor&&(va=P.instanceColor));if(void 0===Ba||Ba.attribute!==va||va&&Ba.data!==va.data){pa=!0;break a}ba++}pa=L.attributesNum!==ba||L.index!==aa?!0:!1}if(pa){ta={};xa=fa.attributes;ba=0;qa=ja.getAttributes();for(var Ga in qa)0<=qa[Ga].location&&(Ba=xa[Ga],void 0===Ba&&("instanceMatrix"===Ga&&P.instanceMatrix&&(Ba=P.instanceMatrix),"instanceColor"===Ga&&P.instanceColor&&(Ba=P.instanceColor)),va={},(va.attribute=Ba)&&Ba.data&&
(va.data=Ba.data),ta[Ga]=va,ba++);L.attributes=ta;L.attributesNum=ba;L.index=aa}}else if(Ga=!0===X.wireframe,L.geometry!==fa.id||L.program!==ja.id||L.wireframe!==Ga)L.geometry=fa.id,L.program=ja.id,L.wireframe=Ga,pa=!0;null!==aa&&c.update(aa,a.ELEMENT_ARRAY_BUFFER);if(pa||U){U=!1;if(!1!==d.isWebGL2||!P.isInstancedMesh&&!fa.isInstancedBufferGeometry||null!==b.get("ANGLE_instanced_arrays")){m();Ga=fa.attributes;ja=ja.getAttributes();X=X.defaultAttributeValues;for(const Ta in ja)if(ta=ja[Ta],0<=ta.location){var ia=
Ga[Ta];void 0===ia&&("instanceMatrix"===Ta&&P.instanceMatrix&&(ia=P.instanceMatrix),"instanceColor"===Ta&&P.instanceColor&&(ia=P.instanceColor));if(void 0!==ia){if(pa=ia.normalized,xa=ia.itemSize,qa=c.get(ia),void 0!==qa){var wa=qa.buffer;ba=qa.type;qa=qa.bytesPerElement;Ba=!0===d.isWebGL2&&(ba===a.INT||ba===a.UNSIGNED_INT||1013===ia.gpuType);if(ia.isInterleavedBufferAttribute){var ra=ia.data;va=ra.stride;ia=ia.offset;if(ra.isInstancedInterleavedBuffer){for(var Sa=0;Sa<ta.locationSize;Sa++)t(ta.location+
Sa,ra.meshPerAttribute);!0!==P.isInstancedMesh&&void 0===fa._maxInstanceCount&&(fa._maxInstanceCount=ra.meshPerAttribute*ra.count)}else for(ra=0;ra<ta.locationSize;ra++)n(ta.location+ra);a.bindBuffer(a.ARRAY_BUFFER,wa);for(let G=0;G<ta.locationSize;G++){wa=ta.location+G;ra=xa/ta.locationSize;Sa=ba;var Da=pa,Na=va*qa,Ea=(ia+xa/ta.locationSize*G)*qa;!0===Ba?a.vertexAttribIPointer(wa,ra,Sa,Na,Ea):a.vertexAttribPointer(wa,ra,Sa,Da,Na,Ea)}}else{if(ia.isInstancedBufferAttribute){for(va=0;va<ta.locationSize;va++)t(ta.location+
va,ia.meshPerAttribute);!0!==P.isInstancedMesh&&void 0===fa._maxInstanceCount&&(fa._maxInstanceCount=ia.meshPerAttribute*ia.count)}else for(va=0;va<ta.locationSize;va++)n(ta.location+va);a.bindBuffer(a.ARRAY_BUFFER,wa);for(Na=0;Na<ta.locationSize;Na++)va=ta.location+Na,ia=xa/ta.locationSize,wa=ba,ra=pa,Sa=xa*qa,Da=xa/ta.locationSize*Na*qa,!0===Ba?a.vertexAttribIPointer(va,ia,wa,Sa,Da):a.vertexAttribPointer(va,ia,wa,ra,Sa,Da)}}}else if(void 0!==X&&(pa=X[Ta],void 0!==pa))switch(pa.length){case 2:a.vertexAttrib2fv(ta.location,
pa);break;case 3:a.vertexAttrib3fv(ta.location,pa);break;case 4:a.vertexAttrib4fv(ta.location,pa);break;default:a.vertexAttrib1fv(ta.location,pa)}}u()}null!==aa&&a.bindBuffer(a.ELEMENT_ARRAY_BUFFER,c.get(aa).buffer)}},reset:v,resetDefaultState:A,dispose:function(){v();for(const P in y){const X=y[P];for(const ja in X){const fa=X[ja];for(const aa in fa)g(fa[aa].object),delete fa[aa];delete X[ja]}delete y[P]}},releaseStatesOfGeometry:function(P){if(void 0!==y[P.id]){var X=y[P.id];for(const ja in X){const fa=
X[ja];for(const aa in fa)g(fa[aa].object),delete fa[aa];delete X[ja]}delete y[P.id]}},releaseStatesOfProgram:function(P){for(const X in y){const ja=y[X];if(void 0===ja[P.id])continue;const fa=ja[P.id];for(const aa in fa)g(fa[aa].object),delete fa[aa];delete ja[P.id]}},initAttributes:m,enableAttribute:n,disableUnusedAttributes:u}}function di(a,b,c,d){const f=d.isWebGL2;let g;this.setMode=function(l){g=l};this.render=function(l,m){a.drawArrays(g,l,m);c.update(m,g,1)};this.renderInstances=function(l,
m,n){if(0!==n){if(f){var t=a;var u="drawArraysInstanced"}else if(t=b.get("ANGLE_instanced_arrays"),u="drawArraysInstancedANGLE",null===t){console.error("THREE.WebGLBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");return}t[u](g,l,m,n);c.update(m,g,n)}}}function Te(a,b,c){function d(P){if("highp"===P){if(0<a.getShaderPrecisionFormat(a.VERTEX_SHADER,a.HIGH_FLOAT).precision&&0<a.getShaderPrecisionFormat(a.FRAGMENT_SHADER,a.HIGH_FLOAT).precision)return"highp";
P="mediump"}return"mediump"===P&&0<a.getShaderPrecisionFormat(a.VERTEX_SHADER,a.MEDIUM_FLOAT).precision&&0<a.getShaderPrecisionFormat(a.FRAGMENT_SHADER,a.MEDIUM_FLOAT).precision?"mediump":"lowp"}let f;const g="undefined"!==typeof WebGL2RenderingContext&&"WebGL2RenderingContext"===a.constructor.name;let l=void 0!==c.precision?c.precision:"highp";var m=d(l);m!==l&&(console.warn("THREE.WebGLRenderer:",l,"not supported, using",m,"instead."),l=m);m=g||b.has("WEBGL_draw_buffers");c=!0===c.logarithmicDepthBuffer;
const n=a.getParameter(a.MAX_TEXTURE_IMAGE_UNITS),t=a.getParameter(a.MAX_VERTEX_TEXTURE_IMAGE_UNITS),u=a.getParameter(a.MAX_TEXTURE_SIZE),v=a.getParameter(a.MAX_CUBE_MAP_TEXTURE_SIZE),A=a.getParameter(a.MAX_VERTEX_ATTRIBS),F=a.getParameter(a.MAX_VERTEX_UNIFORM_VECTORS),D=a.getParameter(a.MAX_VARYING_VECTORS),E=a.getParameter(a.MAX_FRAGMENT_UNIFORM_VECTORS),y=0<t,J=g||b.has("OES_texture_float"),L=y&&J,U=g?a.getParameter(a.MAX_SAMPLES):0;return{isWebGL2:g,drawBuffers:m,getMaxAnisotropy:function(){if(void 0!==
f)return f;if(!0===b.has("EXT_texture_filter_anisotropic")){const P=b.get("EXT_texture_filter_anisotropic");f=a.getParameter(P.MAX_TEXTURE_MAX_ANISOTROPY_EXT)}else f=0;return f},getMaxPrecision:d,precision:l,logarithmicDepthBuffer:c,maxTextures:n,maxVertexTextures:t,maxTextureSize:u,maxCubemapSize:v,maxAttributes:A,maxVertexUniforms:F,maxVaryings:D,maxFragmentUniforms:E,vertexTextures:y,floatFragmentTextures:J,floatVertexTextures:L,maxSamples:U}}function ad(a){function b(u,v,A,F){const D=null!==u?
u.length:0;let E=null;if(0!==D){E=t.value;if(!0!==F||null===E){F=A+4*D;v=v.matrixWorldInverse;n.getNormalMatrix(v);if(null===E||E.length<F)E=new Float32Array(F);for(let y=0,J=A;y!==D;++y,J+=4)m.copy(u[y]).applyMatrix4(v,n),m.normal.toArray(E,J),E[J+3]=m.constant}t.value=E;t.needsUpdate=!0}c.numPlanes=D;c.numIntersection=0;return E}const c=this;let d=null,f=0,g=!1,l=!1;const m=new Vb,n=new Za,t={value:null,needsUpdate:!1};this.uniform=t;this.numIntersection=this.numPlanes=0;this.init=function(u,v){const A=
0!==u.length||v||0!==f||g;g=v;f=u.length;return A};this.beginShadows=function(){l=!0;b(null)};this.endShadows=function(){l=!1};this.setGlobalState=function(u,v){d=b(u,v,0)};this.setState=function(u,v,A){const F=u.clippingPlanes,D=u.clipIntersection;var E=u.clipShadows;u=a.get(u);if(!g||null===F||0===F.length||l&&!E)l?b(null):(t.value!==d&&(t.value=d,t.needsUpdate=0<f),c.numPlanes=f,c.numIntersection=0);else{E=l?0:f;const y=4*E;let J=u.clippingState||null;t.value=J;J=b(F,v,y,A);for(v=0;v!==y;++v)J[v]=
d[v];u.clippingState=J;this.numIntersection=D?this.numPlanes:0;this.numPlanes+=E}}}function Fc(a){function b(f,g){303===g?f.mapping=301:304===g&&(f.mapping=302);return f}function c(f){f=f.target;f.removeEventListener("dispose",c);const g=d.get(f);void 0!==g&&(d.delete(f),g.dispose())}let d=new WeakMap;return{get:function(f){if(f&&f.isTexture&&!1===f.isRenderTargetTexture){var g=f.mapping;if(303===g||304===g)return d.has(f)?(g=d.get(f).texture,b(g,f.mapping)):(g=f.image)&&0<g.height?(g=new Gc(g.height/
2),g.fromEquirectangularTexture(a,f),d.set(f,g),f.addEventListener("dispose",c),b(g.texture,f.mapping)):null}return f},dispose:function(){d=new WeakMap}}}function oe(a,b,c){a=new rc(a,b,c);a.texture.mapping=306;a.texture.name="PMREM.cubeUv";a.scissorTest=!0;return a}function qd(a,b,c,d,f){a.viewport.set(b,c,d,f);a.scissor.set(b,c,d,f)}function Ka(){return new bc({name:"EquirectangularToCubeUV",uniforms:{envMap:{value:null}},vertexShader:Mf(),fragmentShader:"\n\n\t\t\tprecision mediump float;\n\t\t\tprecision mediump int;\n\n\t\t\tvarying vec3 vOutputDirection;\n\n\t\t\tuniform sampler2D envMap;\n\n\t\t\t#include \x3ccommon\x3e\n\n\t\t\tvoid main() {\n\n\t\t\t\tvec3 outputDirection \x3d normalize( vOutputDirection );\n\t\t\t\tvec2 uv \x3d equirectUv( outputDirection );\n\n\t\t\t\tgl_FragColor \x3d vec4( texture2D ( envMap, uv ).rgb, 1.0 );\n\n\t\t\t}\n\t\t",
blending:0,depthTest:!1,depthWrite:!1})}function Hg(){return new bc({name:"CubemapToCubeUV",uniforms:{envMap:{value:null},flipEnvMap:{value:-1}},vertexShader:Mf(),fragmentShader:"\n\n\t\t\tprecision mediump float;\n\t\t\tprecision mediump int;\n\n\t\t\tuniform float flipEnvMap;\n\n\t\t\tvarying vec3 vOutputDirection;\n\n\t\t\tuniform samplerCube envMap;\n\n\t\t\tvoid main() {\n\n\t\t\t\tgl_FragColor \x3d textureCube( envMap, vec3( flipEnvMap * vOutputDirection.x, vOutputDirection.yz ) );\n\n\t\t\t}\n\t\t",
blending:0,depthTest:!1,depthWrite:!1})}function Mf(){return"\n\n\t\tprecision mediump float;\n\t\tprecision mediump int;\n\n\t\tattribute float faceIndex;\n\n\t\tvarying vec3 vOutputDirection;\n\n\t\t// RH coordinate system; PMREM face-indexing convention\n\t\tvec3 getDirection( vec2 uv, float face ) {\n\n\t\t\tuv \x3d 2.0 * uv - 1.0;\n\n\t\t\tvec3 direction \x3d vec3( uv, 1.0 );\n\n\t\t\tif ( face \x3d\x3d 0.0 ) {\n\n\t\t\t\tdirection \x3d direction.zyx; // ( 1, v, u ) pos x\n\n\t\t\t} else if ( face \x3d\x3d 1.0 ) {\n\n\t\t\t\tdirection \x3d direction.xzy;\n\t\t\t\tdirection.xz *\x3d -1.0; // ( -u, 1, -v ) pos y\n\n\t\t\t} else if ( face \x3d\x3d 2.0 ) {\n\n\t\t\t\tdirection.x *\x3d -1.0; // ( -u, v, 1 ) pos z\n\n\t\t\t} else if ( face \x3d\x3d 3.0 ) {\n\n\t\t\t\tdirection \x3d direction.zyx;\n\t\t\t\tdirection.xz *\x3d -1.0; // ( -1, v, -u ) neg x\n\n\t\t\t} else if ( face \x3d\x3d 4.0 ) {\n\n\t\t\t\tdirection \x3d direction.xzy;\n\t\t\t\tdirection.xy *\x3d -1.0; // ( -u, -1, v ) neg y\n\n\t\t\t} else if ( face \x3d\x3d 5.0 ) {\n\n\t\t\t\tdirection.z *\x3d -1.0; // ( u, v, -1 ) neg z\n\n\t\t\t}\n\n\t\t\treturn direction;\n\n\t\t}\n\n\t\tvoid main() {\n\n\t\t\tvOutputDirection \x3d getDirection( uv, faceIndex );\n\t\t\tgl_Position \x3d vec4( position, 1.0 );\n\n\t\t}\n\t"}
function ei(a){function b(f){f=f.target;f.removeEventListener("dispose",b);const g=c.get(f);void 0!==g&&(c.delete(f),g.dispose())}let c=new WeakMap,d=null;return{get:function(f){if(f&&f.isTexture){var g=f.mapping,l=303===g||304===g,m=301===g||302===g;if(l||m){if(f.isRenderTargetTexture&&!0===f.needsPMREMUpdate)return f.needsPMREMUpdate=!1,g=c.get(f),null===d&&(d=new ha(a)),g=l?d.fromEquirectangular(f,g):d.fromCubemap(f,g),c.set(f,g),g.texture;if(c.has(f))return c.get(f).texture;g=f.image;var n;if(!(n=
l&&g&&0<g.height)&&(n=m&&g)){n=0;for(m=0;6>m;m++)void 0!==g[m]&&n++;n=6===n}return n?(null===d&&(d=new ha(a)),l=l?d.fromEquirectangular(f):d.fromCubemap(f),c.set(f,l),f.addEventListener("dispose",b),l.texture):null}}return f},dispose:function(){c=new WeakMap;null!==d&&(d.dispose(),d=null)}}}function fi(a){function b(d){if(void 0!==c[d])return c[d];let f;switch(d){case "WEBGL_depth_texture":f=a.getExtension("WEBGL_depth_texture")||a.getExtension("MOZ_WEBGL_depth_texture")||a.getExtension("WEBKIT_WEBGL_depth_texture");
break;case "EXT_texture_filter_anisotropic":f=a.getExtension("EXT_texture_filter_anisotropic")||a.getExtension("MOZ_EXT_texture_filter_anisotropic")||a.getExtension("WEBKIT_EXT_texture_filter_anisotropic");break;case "WEBGL_compressed_texture_s3tc":f=a.getExtension("WEBGL_compressed_texture_s3tc")||a.getExtension("MOZ_WEBGL_compressed_texture_s3tc")||a.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc");break;case "WEBGL_compressed_texture_pvrtc":f=a.getExtension("WEBGL_compressed_texture_pvrtc")||
a.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc");break;default:f=a.getExtension(d)}return c[d]=f}const c={};return{has:function(d){return null!==b(d)},init:function(d){d.isWebGL2?b("EXT_color_buffer_float"):(b("WEBGL_depth_texture"),b("OES_texture_float"),b("OES_texture_half_float"),b("OES_texture_half_float_linear"),b("OES_standard_derivatives"),b("OES_element_index_uint"),b("OES_vertex_array_object"),b("ANGLE_instanced_arrays"));b("OES_texture_float_linear");b("EXT_color_buffer_half_float");
b("WEBGL_multisampled_render_to_texture")},get:function(d){const f=b(d);null===f&&console.warn("THREE.WebGLRenderer: "+d+" extension not supported.");return f}}}function gi(a,b,c,d){function f(n){n=n.target;null!==n.index&&b.remove(n.index);for(var t in n.attributes)b.remove(n.attributes[t]);for(var u in n.morphAttributes){t=n.morphAttributes[u];for(let v=0,A=t.length;v<A;v++)b.remove(t[v])}n.removeEventListener("dispose",f);delete l[n.id];if(u=m.get(n))b.remove(u),m.delete(n);d.releaseStatesOfGeometry(n);
!0===n.isInstancedBufferGeometry&&delete n._maxInstanceCount;c.memory.geometries--}function g(n){var t=[],u=n.index,v=n.attributes.position;if(null!==u){v=u.array;u=u.version;for(let D=0,E=v.length;D<E;D+=3){var A=v[D+0],F=v[D+1];const y=v[D+2];t.push(A,F,F,y,y,A)}}else if(void 0!==v){A=v.array;u=v.version;for(let D=0,E=A.length/3-1;D<E;D+=3)v=D+0,A=D+1,F=D+2,t.push(v,A,A,F,F,v)}else return;t=new (Dg(t)?Nf:Of)(t,1);t.version=u;(u=m.get(n))&&b.remove(u);m.set(n,t)}const l={},m=new WeakMap;return{get:function(n,
t){if(!0===l[t.id])return t;t.addEventListener("dispose",f);l[t.id]=!0;c.memory.geometries++;return t},update:function(n){var t=n.attributes;for(const u in t)b.update(t[u],a.ARRAY_BUFFER);n=n.morphAttributes;for(const u in n){t=n[u];for(let v=0,A=t.length;v<A;v++)b.update(t[v],a.ARRAY_BUFFER)}},getWireframeAttribute:function(n){const t=m.get(n);if(t){const u=n.index;null!==u&&t.version<u.version&&g(n)}else g(n);return m.get(n)}}}function hi(a,b,c,d){const f=d.isWebGL2;let g,l,m;this.setMode=function(n){g=
n};this.setIndex=function(n){l=n.type;m=n.bytesPerElement};this.render=function(n,t){a.drawElements(g,t,l,n*m);c.update(t,g,1)};this.renderInstances=function(n,t,u){if(0!==u){if(f){var v=a;var A="drawElementsInstanced"}else if(v=b.get("ANGLE_instanced_arrays"),A="drawElementsInstancedANGLE",null===v){console.error("THREE.WebGLIndexedBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");return}v[A](g,t,l,n*m,u);c.update(t,g,u)}}}function ii(a){const b=
{frame:0,calls:0,triangles:0,points:0,lines:0};return{memory:{geometries:0,textures:0},render:b,programs:null,autoReset:!0,reset:function(){b.calls=0;b.triangles=0;b.points=0;b.lines=0},update:function(c,d,f){b.calls++;switch(d){case a.TRIANGLES:b.triangles+=c/3*f;break;case a.LINES:b.lines+=c/2*f;break;case a.LINE_STRIP:b.lines+=f*(c-1);break;case a.LINE_LOOP:b.lines+=f*c;break;case a.POINTS:b.points+=f*c;break;default:console.error("THREE.WebGLInfo: Unknown draw mode:",d)}}}}function ji(a,b){return a[0]-
b[0]}function ki(a,b){return Math.abs(b[1])-Math.abs(a[1])}function li(a,b,c){const d={},f=new Float32Array(8),g=new WeakMap,l=new mb,m=[];for(let n=0;8>n;n++)m[n]=[n,0];return{update:function(n,t,u){n=n.morphTargetInfluences;if(!0===b.isWebGL2){var v=t.morphAttributes.position||t.morphAttributes.normal||t.morphAttributes.color;v=void 0!==v?v.length:0;var A=g.get(t);if(void 0===A||A.count!==v){void 0!==A&&A.texture.dispose();A=void 0!==t.morphAttributes.position;var F=void 0!==t.morphAttributes.normal,
D=void 0!==t.morphAttributes.color,E=t.morphAttributes.position||[];const J=t.morphAttributes.normal||[],L=t.morphAttributes.color||[];var y=0;!0===A&&(y=1);!0===F&&(y=2);!0===D&&(y=3);let U=t.attributes.position.count*y,P=1;U>b.maxTextureSize&&(P=Math.ceil(U/b.maxTextureSize),U=b.maxTextureSize);const X=new Float32Array(U*P*4*v),ja=new Ue(X,U,P,v);ja.type=1015;ja.needsUpdate=!0;y*=4;for(let aa=0;aa<v;aa++){const pa=E[aa],ba=J[aa],xa=L[aa],qa=U*P*4*aa;for(let ta=0;ta<pa.count;ta++){const Ba=ta*y;
!0===A&&(l.fromBufferAttribute(pa,ta),X[qa+Ba+0]=l.x,X[qa+Ba+1]=l.y,X[qa+Ba+2]=l.z,X[qa+Ba+3]=0);!0===F&&(l.fromBufferAttribute(ba,ta),X[qa+Ba+4]=l.x,X[qa+Ba+5]=l.y,X[qa+Ba+6]=l.z,X[qa+Ba+7]=0);!0===D&&(l.fromBufferAttribute(xa,ta),X[qa+Ba+8]=l.x,X[qa+Ba+9]=l.y,X[qa+Ba+10]=l.z,X[qa+Ba+11]=4===xa.itemSize?l.w:1)}}A={count:v,texture:ja,size:new sa(U,P)};g.set(t,A);function fa(){ja.dispose();g.delete(t);t.removeEventListener("dispose",fa)}t.addEventListener("dispose",fa)}v=0;for(F=0;F<n.length;F++)v+=
n[F];v=t.morphTargetsRelative?1:1-v;u.getUniforms().setValue(a,"morphTargetBaseInfluence",v);u.getUniforms().setValue(a,"morphTargetInfluences",n);u.getUniforms().setValue(a,"morphTargetsTexture",A.texture,c);u.getUniforms().setValue(a,"morphTargetsTextureSize",A.size)}else{v=void 0===n?0:n.length;A=d[t.id];if(void 0===A||A.length!==v){A=[];for(F=0;F<v;F++)A[F]=[F,0];d[t.id]=A}for(F=0;F<v;F++)D=A[F],D[0]=F,D[1]=n[F];A.sort(ki);for(n=0;8>n;n++)n<v&&A[n][1]?(m[n][0]=A[n][0],m[n][1]=A[n][1]):(m[n][0]=
Number.MAX_SAFE_INTEGER,m[n][1]=0);m.sort(ji);n=t.morphAttributes.position;v=t.morphAttributes.normal;A=0;for(F=0;8>F;F++)E=m[F],D=E[0],E=E[1],D!==Number.MAX_SAFE_INTEGER&&E?(n&&t.getAttribute("morphTarget"+F)!==n[D]&&t.setAttribute("morphTarget"+F,n[D]),v&&t.getAttribute("morphNormal"+F)!==v[D]&&t.setAttribute("morphNormal"+F,v[D]),f[F]=E,A+=E):(n&&!0===t.hasAttribute("morphTarget"+F)&&t.deleteAttribute("morphTarget"+F),v&&!0===t.hasAttribute("morphNormal"+F)&&t.deleteAttribute("morphNormal"+F),
f[F]=0);n=t.morphTargetsRelative?1:1-A;u.getUniforms().setValue(a,"morphTargetBaseInfluence",n);u.getUniforms().setValue(a,"morphTargetInfluences",f)}}}}function mi(a,b,c,d){function f(l){l=l.target;l.removeEventListener("dispose",f);c.remove(l.instanceMatrix);null!==l.instanceColor&&c.remove(l.instanceColor)}let g=new WeakMap;return{update:function(l){const m=d.render.frame,n=b.get(l,l.geometry);g.get(n)!==m&&(b.update(n),g.set(n,m));l.isInstancedMesh&&(!1===l.hasEventListener("dispose",f)&&l.addEventListener("dispose",
f),g.get(l)!==m&&(c.update(l.instanceMatrix,a.ARRAY_BUFFER),null!==l.instanceColor&&c.update(l.instanceColor,a.ARRAY_BUFFER),g.set(l,m)));l.isSkinnedMesh&&(l=l.skeleton,g.get(l)!==m&&(l.update(),g.set(l,m)));return n},dispose:function(){g=new WeakMap}}}function Md(a,b,c){const d=a[0];if(0>=d||0<d)return a;const f=b*c;let g=pb[f];void 0===g&&(g=new Float32Array(f),pb[f]=g);if(0!==b){d.toArray(g,0);for(let l=1,m=0;l!==b;++l)m+=c,a[l].toArray(g,m)}return g}function Kb(a,b){if(a.length!==b.length)return!1;
for(let c=0,d=a.length;c<d;c++)if(a[c]!==b[c])return!1;return!0}function Lb(a,b){for(let c=0,d=b.length;c<d;c++)a[c]=b[c]}function rd(a,b){let c=db[b];void 0===c&&(c=new Int32Array(b),db[b]=c);for(let d=0;d!==b;++d)c[d]=a.allocateTextureUnit();return c}function ni(a,b){const c=this.cache;c[0]!==b&&(a.uniform1f(this.addr,b),c[0]=b)}function oi(a,b){const c=this.cache;if(void 0!==b.x){if(c[0]!==b.x||c[1]!==b.y)a.uniform2f(this.addr,b.x,b.y),c[0]=b.x,c[1]=b.y}else Kb(c,b)||(a.uniform2fv(this.addr,b),
Lb(c,b))}function pi(a,b){const c=this.cache;if(void 0!==b.x){if(c[0]!==b.x||c[1]!==b.y||c[2]!==b.z)a.uniform3f(this.addr,b.x,b.y,b.z),c[0]=b.x,c[1]=b.y,c[2]=b.z}else if(void 0!==b.r){if(c[0]!==b.r||c[1]!==b.g||c[2]!==b.b)a.uniform3f(this.addr,b.r,b.g,b.b),c[0]=b.r,c[1]=b.g,c[2]=b.b}else Kb(c,b)||(a.uniform3fv(this.addr,b),Lb(c,b))}function qi(a,b){const c=this.cache;if(void 0!==b.x){if(c[0]!==b.x||c[1]!==b.y||c[2]!==b.z||c[3]!==b.w)a.uniform4f(this.addr,b.x,b.y,b.z,b.w),c[0]=b.x,c[1]=b.y,c[2]=b.z,
c[3]=b.w}else Kb(c,b)||(a.uniform4fv(this.addr,b),Lb(c,b))}function ri(a,b){const c=this.cache,d=b.elements;void 0===d?Kb(c,b)||(a.uniformMatrix2fv(this.addr,!1,b),Lb(c,b)):Kb(c,d)||(mc.set(d),a.uniformMatrix2fv(this.addr,!1,mc),Lb(c,d))}function si(a,b){const c=this.cache,d=b.elements;void 0===d?Kb(c,b)||(a.uniformMatrix3fv(this.addr,!1,b),Lb(c,b)):Kb(c,d)||(Cb.set(d),a.uniformMatrix3fv(this.addr,!1,Cb),Lb(c,d))}function Ig(a,b){const c=this.cache,d=b.elements;void 0===d?Kb(c,b)||(a.uniformMatrix4fv(this.addr,
!1,b),Lb(c,b)):Kb(c,d)||(qb.set(d),a.uniformMatrix4fv(this.addr,!1,qb),Lb(c,d))}function Nd(a,b){const c=this.cache;c[0]!==b&&(a.uniform1i(this.addr,b),c[0]=b)}function Jg(a,b){const c=this.cache;if(void 0!==b.x){if(c[0]!==b.x||c[1]!==b.y)a.uniform2i(this.addr,b.x,b.y),c[0]=b.x,c[1]=b.y}else Kb(c,b)||(a.uniform2iv(this.addr,b),Lb(c,b))}function Kg(a,b){const c=this.cache;if(void 0!==b.x){if(c[0]!==b.x||c[1]!==b.y||c[2]!==b.z)a.uniform3i(this.addr,b.x,b.y,b.z),c[0]=b.x,c[1]=b.y,c[2]=b.z}else Kb(c,
b)||(a.uniform3iv(this.addr,b),Lb(c,b))}function Lg(a,b){const c=this.cache;if(void 0!==b.x){if(c[0]!==b.x||c[1]!==b.y||c[2]!==b.z||c[3]!==b.w)a.uniform4i(this.addr,b.x,b.y,b.z,b.w),c[0]=b.x,c[1]=b.y,c[2]=b.z,c[3]=b.w}else Kb(c,b)||(a.uniform4iv(this.addr,b),Lb(c,b))}function Mg(a,b){const c=this.cache;c[0]!==b&&(a.uniform1ui(this.addr,b),c[0]=b)}function Ng(a,b){const c=this.cache;if(void 0!==b.x){if(c[0]!==b.x||c[1]!==b.y)a.uniform2ui(this.addr,b.x,b.y),c[0]=b.x,c[1]=b.y}else Kb(c,b)||(a.uniform2uiv(this.addr,
b),Lb(c,b))}function Og(a,b){const c=this.cache;if(void 0!==b.x){if(c[0]!==b.x||c[1]!==b.y||c[2]!==b.z)a.uniform3ui(this.addr,b.x,b.y,b.z),c[0]=b.x,c[1]=b.y,c[2]=b.z}else Kb(c,b)||(a.uniform3uiv(this.addr,b),Lb(c,b))}function Pg(a,b){const c=this.cache;if(void 0!==b.x){if(c[0]!==b.x||c[1]!==b.y||c[2]!==b.z||c[3]!==b.w)a.uniform4ui(this.addr,b.x,b.y,b.z,b.w),c[0]=b.x,c[1]=b.y,c[2]=b.z,c[3]=b.w}else Kb(c,b)||(a.uniform4uiv(this.addr,b),Lb(c,b))}function Ve(a,b,c){const d=this.cache,f=c.allocateTextureUnit();
d[0]!==f&&(a.uniform1i(this.addr,f),d[0]=f);c.setTexture2D(b||ya,f)}function Fb(a,b,c){const d=this.cache,f=c.allocateTextureUnit();d[0]!==f&&(a.uniform1i(this.addr,f),d[0]=f);c.setTexture3D(b||Ua,f)}function Qg(a,b,c){const d=this.cache,f=c.allocateTextureUnit();d[0]!==f&&(a.uniform1i(this.addr,f),d[0]=f);c.setTextureCube(b||Pa,f)}function Pf(a,b,c){const d=this.cache,f=c.allocateTextureUnit();d[0]!==f&&(a.uniform1i(this.addr,f),d[0]=f);c.setTexture2DArray(b||za,f)}function pe(a){switch(a){case 5126:return ni;
case 35664:return oi;case 35665:return pi;case 35666:return qi;case 35674:return ri;case 35675:return si;case 35676:return Ig;case 5124:case 35670:return Nd;case 35667:case 35671:return Jg;case 35668:case 35672:return Kg;case 35669:case 35673:return Lg;case 5125:return Mg;case 36294:return Ng;case 36295:return Og;case 36296:return Pg;case 35678:case 36198:case 36298:case 36306:case 35682:return Ve;case 35679:case 36299:case 36307:return Fb;case 35680:case 36300:case 36308:case 36293:return Qg;case 36289:case 36303:case 36311:case 36292:return Pf}}
function Qf(a,b){a.uniform1fv(this.addr,b)}function ti(a,b){b=Md(b,this.size,2);a.uniform2fv(this.addr,b)}function ui(a,b){b=Md(b,this.size,3);a.uniform3fv(this.addr,b)}function cc(a,b){b=Md(b,this.size,4);a.uniform4fv(this.addr,b)}function sc(a,b){b=Md(b,this.size,4);a.uniformMatrix2fv(this.addr,!1,b)}function Hc(a,b){b=Md(b,this.size,9);a.uniformMatrix3fv(this.addr,!1,b)}function Ic(a,b){b=Md(b,this.size,16);a.uniformMatrix4fv(this.addr,!1,b)}function Rg(a,b){a.uniform1iv(this.addr,b)}function We(a,
b){a.uniform2iv(this.addr,b)}function vi(a,b){a.uniform3iv(this.addr,b)}function wi(a,b){a.uniform4iv(this.addr,b)}function xi(a,b){a.uniform1uiv(this.addr,b)}function yi(a,b){a.uniform2uiv(this.addr,b)}function zi(a,b){a.uniform3uiv(this.addr,b)}function Ai(a,b){a.uniform4uiv(this.addr,b)}function Bi(a,b,c){const d=this.cache,f=b.length,g=rd(c,f);Kb(d,g)||(a.uniform1iv(this.addr,g),Lb(d,g));for(a=0;a!==f;++a)c.setTexture2D(b[a]||ya,g[a])}function Sg(a,b,c){const d=this.cache,f=b.length,g=rd(c,f);
Kb(d,g)||(a.uniform1iv(this.addr,g),Lb(d,g));for(a=0;a!==f;++a)c.setTexture3D(b[a]||Ua,g[a])}function Ci(a,b,c){const d=this.cache,f=b.length,g=rd(c,f);Kb(d,g)||(a.uniform1iv(this.addr,g),Lb(d,g));for(a=0;a!==f;++a)c.setTextureCube(b[a]||Pa,g[a])}function Di(a,b,c){const d=this.cache,f=b.length,g=rd(c,f);Kb(d,g)||(a.uniform1iv(this.addr,g),Lb(d,g));for(a=0;a!==f;++a)c.setTexture2DArray(b[a]||za,g[a])}function Ei(a){switch(a){case 5126:return Qf;case 35664:return ti;case 35665:return ui;case 35666:return cc;
case 35674:return sc;case 35675:return Hc;case 35676:return Ic;case 5124:case 35670:return Rg;case 35667:case 35671:return We;case 35668:case 35672:return vi;case 35669:case 35673:return wi;case 5125:return xi;case 36294:return yi;case 36295:return zi;case 36296:return Ai;case 35678:case 36198:case 36298:case 36306:case 35682:return Bi;case 35679:case 36299:case 36307:return Sg;case 35680:case 36300:case 36308:case 36293:return Ci;case 36289:case 36303:case 36311:case 36292:return Di}}function Tg(a,
b,c){b=a.createShader(b);a.shaderSource(b,c);a.compileShader(b);return b}function Ug(a,b,c){var d=a.getShaderParameter(b,a.COMPILE_STATUS),f=a.getShaderInfoLog(b).trim();if(d&&""===f)return"";if(d=/ERROR: 0:(\d+)/.exec(f)){d=parseInt(d[1]);c=c.toUpperCase()+"\n\n"+f+"\n\n";b=a.getShaderSource(b);a=d;b=b.split("\n");f=[];var g=Math.max(a-6,0);for(d=Math.min(a+6,b.length);g<d;g++){const l=g+1;f.push(`${l===a?"\x3e":" "} ${l}: ${b[g]}`)}a=f.join("\n");return c+a}return f}function Fi(a,b){a:{const c=
jb.getPrimaries(jb.workingColorSpace),d=jb.getPrimaries(b);let f;c===d?f="":"p3"===c&&"rec709"===d?f="LinearDisplayP3ToLinearSRGB":"rec709"===c&&"p3"===d&&(f="LinearSRGBToLinearDisplayP3");switch(b){case "srgb-linear":case "display-p3-linear":b=[f,"LinearTransferOETF"];break a;case "srgb":case "display-p3":b=[f,"sRGBTransferOETF"];break a;default:console.warn("THREE.WebGLProgram: Unsupported color space:",b),b=[f,"LinearTransferOETF"]}}return`vec4 ${a}( vec4 value ) { return ${b[0]}( ${b[1]}( value ) ); }`}
function Gi(a,b){switch(b){case 1:b="Linear";break;case 2:b="Reinhard";break;case 3:b="OptimizedCineon";break;case 4:b="ACESFilmic";break;case 5:b="Custom";break;default:console.warn("THREE.WebGLProgram: Unsupported toneMapping:",b),b="Linear"}return"vec3 "+a+"( vec3 color ) { return "+b+"ToneMapping( color ); }"}function Hi(a){const b=[];for(const c in a){const d=a[c];!1!==d&&b.push("#define "+c+" "+d)}return b.join("\n")}function tc(a){return""!==a}function qe(a,b){const c=b.numSpotLightShadows+
b.numSpotLightMaps-b.numSpotLightShadowsWithMaps;return a.replace(/NUM_DIR_LIGHTS/g,b.numDirLights).replace(/NUM_SPOT_LIGHTS/g,b.numSpotLights).replace(/NUM_SPOT_LIGHT_MAPS/g,b.numSpotLightMaps).replace(/NUM_SPOT_LIGHT_COORDS/g,c).replace(/NUM_RECT_AREA_LIGHTS/g,b.numRectAreaLights).replace(/NUM_POINT_LIGHTS/g,b.numPointLights).replace(/NUM_HEMI_LIGHTS/g,b.numHemiLights).replace(/NUM_DIR_LIGHT_SHADOWS/g,b.numDirLightShadows).replace(/NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS/g,b.numSpotLightShadowsWithMaps).replace(/NUM_SPOT_LIGHT_SHADOWS/g,
b.numSpotLightShadows).replace(/NUM_POINT_LIGHT_SHADOWS/g,b.numPointLightShadows)}function Od(a,b){return a.replace(/NUM_CLIPPING_PLANES/g,b.numClippingPlanes).replace(/UNION_CLIPPING_PLANES/g,b.numClippingPlanes-b.numClipIntersection)}function Pd(a,b){a=p[b];if(void 0===a){const c=uc.get(b);if(void 0!==c)a=p[c],console.warn('THREE.WebGLRenderer: Shader chunk "%s" has been deprecated. Use "%s" instead.',b,c);else throw Error("Can not resolve #include \x3c"+b+"\x3e");}return a.replace(fc,Pd)}function Qd(a,
b,c,d){a="";for(b=parseInt(b);b<parseInt(c);b++)a+=d.replace(/\[\s*i\s*\]/g,"[ "+b+" ]").replace(/UNROLLED_LOOP_INDEX/g,b);return a}function Xe(a){let b="precision "+a.precision+" float;\nprecision "+a.precision+" int;";"highp"===a.precision?b+="\n#define HIGH_PRECISION":"mediump"===a.precision?b+="\n#define MEDIUM_PRECISION":"lowp"===a.precision&&(b+="\n#define LOW_PRECISION");return b}function bd(a){let b="SHADOWMAP_TYPE_BASIC";1===a.shadowMapType?b="SHADOWMAP_TYPE_PCF":2===a.shadowMapType?b="SHADOWMAP_TYPE_PCF_SOFT":
3===a.shadowMapType&&(b="SHADOWMAP_TYPE_VSM");return b}function Vg(a){let b="ENVMAP_TYPE_CUBE";if(a.envMap)switch(a.envMapMode){case 301:case 302:b="ENVMAP_TYPE_CUBE";break;case 306:b="ENVMAP_TYPE_CUBE_UV"}return b}function Wg(a){let b="ENVMAP_MODE_REFLECTION";if(a.envMap)switch(a.envMapMode){case 302:b="ENVMAP_MODE_REFRACTION"}return b}function Xg(a){let b="ENVMAP_BLENDING_NONE";if(a.envMap)switch(a.combine){case 0:b="ENVMAP_BLENDING_MULTIPLY";break;case 1:b="ENVMAP_BLENDING_MIX";break;case 2:b=
"ENVMAP_BLENDING_ADD"}return b}function Yg(a){a=a.envMapCubeUVHeight;if(null===a)return null;const b=Math.log2(a)-2;return{texelWidth:1/(3*Math.max(Math.pow(2,b),112)),texelHeight:1/a,maxMip:b}}function Ye(a,b,c,d){function f(aa){if(a.debug.checkShaderErrors){var pa=g.getProgramInfoLog(y).trim(),ba=g.getShaderInfoLog(U).trim(),xa=g.getShaderInfoLog(P).trim(),qa=!0,ta=!0;if(!1===g.getProgramParameter(y,g.LINK_STATUS))if(qa=!1,"function"===typeof a.debug.onShaderError)a.debug.onShaderError(g,y,U,P);
else{var Ba=Ug(g,U,"vertex"),va=Ug(g,P,"fragment");console.error("THREE.WebGLProgram: Shader Error "+g.getError()+" - VALIDATE_STATUS "+g.getProgramParameter(y,g.VALIDATE_STATUS)+"\n\nProgram Info Log: "+pa+"\n"+Ba+"\n"+va)}else if(""!==pa)console.warn("THREE.WebGLProgram: Program Info Log:",pa);else if(""===ba||""===xa)ta=!1;ta&&(aa.diagnostics={runnable:qa,programLog:pa,vertexShader:{log:ba,prefix:J},fragmentShader:{log:xa,prefix:L}})}g.deleteShader(U);g.deleteShader(P);X=new bb(g,y);aa=g;pa=y;
ba={};xa=aa.getProgramParameter(pa,aa.ACTIVE_ATTRIBUTES);for(qa=0;qa<xa;qa++)ta=aa.getActiveAttrib(pa,qa),Ba=ta.name,va=1,ta.type===aa.FLOAT_MAT2&&(va=2),ta.type===aa.FLOAT_MAT3&&(va=3),ta.type===aa.FLOAT_MAT4&&(va=4),ba[Ba]={type:ta.type,location:aa.getAttribLocation(pa,Ba),locationSize:va};ja=ba}const g=a.getContext();var l=c.defines;let m=c.vertexShader;var n=c.fragmentShader;const t=bd(c),u=Vg(c),v=Wg(c),A=Xg(c),F=Yg(c),D=c.isWebGL2?"":[c.extensionDerivatives||c.envMapCubeUVHeight||c.bumpMap||
c.normalMapTangentSpace||c.clearcoatNormalMap||c.flatShading||"physical"===c.shaderID?"#extension GL_OES_standard_derivatives : enable":"",(c.extensionFragDepth||c.logarithmicDepthBuffer)&&c.rendererExtensionFragDepth?"#extension GL_EXT_frag_depth : enable":"",c.extensionDrawBuffers&&c.rendererExtensionDrawBuffers?"#extension GL_EXT_draw_buffers : require":"",(c.extensionShaderTextureLOD||c.envMap||c.transmission)&&c.rendererExtensionShaderTextureLod?"#extension GL_EXT_shader_texture_lod : enable":
""].filter(tc).join("\n"),E=Hi(l),y=g.createProgram();let J,L;l=c.glslVersion?"#version "+c.glslVersion+"\n":"";c.isRawShaderMaterial?(J=["#define SHADER_TYPE "+c.shaderType,"#define SHADER_NAME "+c.shaderName,E].filter(tc).join("\n"),0<J.length&&(J+="\n"),L=[D,"#define SHADER_TYPE "+c.shaderType,"#define SHADER_NAME "+c.shaderName,E].filter(tc).join("\n"),0<L.length&&(L+="\n")):(J=[Xe(c),"#define SHADER_TYPE "+c.shaderType,"#define SHADER_NAME "+c.shaderName,E,c.instancing?"#define USE_INSTANCING":
"",c.instancingColor?"#define USE_INSTANCING_COLOR":"",c.useFog&&c.fog?"#define USE_FOG":"",c.useFog&&c.fogExp2?"#define FOG_EXP2":"",c.map?"#define USE_MAP":"",c.envMap?"#define USE_ENVMAP":"",c.envMap?"#define "+v:"",c.lightMap?"#define USE_LIGHTMAP":"",c.aoMap?"#define USE_AOMAP":"",c.bumpMap?"#define USE_BUMPMAP":"",c.normalMap?"#define USE_NORMALMAP":"",c.normalMapObjectSpace?"#define USE_NORMALMAP_OBJECTSPACE":"",c.normalMapTangentSpace?"#define USE_NORMALMAP_TANGENTSPACE":"",c.displacementMap?
"#define USE_DISPLACEMENTMAP":"",c.emissiveMap?"#define USE_EMISSIVEMAP":"",c.anisotropy?"#define USE_ANISOTROPY":"",c.anisotropyMap?"#define USE_ANISOTROPYMAP":"",c.clearcoatMap?"#define USE_CLEARCOATMAP":"",c.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",c.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",c.iridescenceMap?"#define USE_IRIDESCENCEMAP":"",c.iridescenceThicknessMap?"#define USE_IRIDESCENCE_THICKNESSMAP":"",c.specularMap?"#define USE_SPECULARMAP":"",c.specularColorMap?
"#define USE_SPECULAR_COLORMAP":"",c.specularIntensityMap?"#define USE_SPECULAR_INTENSITYMAP":"",c.roughnessMap?"#define USE_ROUGHNESSMAP":"",c.metalnessMap?"#define USE_METALNESSMAP":"",c.alphaMap?"#define USE_ALPHAMAP":"",c.alphaHash?"#define USE_ALPHAHASH":"",c.transmission?"#define USE_TRANSMISSION":"",c.transmissionMap?"#define USE_TRANSMISSIONMAP":"",c.thicknessMap?"#define USE_THICKNESSMAP":"",c.sheenColorMap?"#define USE_SHEEN_COLORMAP":"",c.sheenRoughnessMap?"#define USE_SHEEN_ROUGHNESSMAP":
"",c.mapUv?"#define MAP_UV "+c.mapUv:"",c.alphaMapUv?"#define ALPHAMAP_UV "+c.alphaMapUv:"",c.lightMapUv?"#define LIGHTMAP_UV "+c.lightMapUv:"",c.aoMapUv?"#define AOMAP_UV "+c.aoMapUv:"",c.emissiveMapUv?"#define EMISSIVEMAP_UV "+c.emissiveMapUv:"",c.bumpMapUv?"#define BUMPMAP_UV "+c.bumpMapUv:"",c.normalMapUv?"#define NORMALMAP_UV "+c.normalMapUv:"",c.displacementMapUv?"#define DISPLACEMENTMAP_UV "+c.displacementMapUv:"",c.metalnessMapUv?"#define METALNESSMAP_UV "+c.metalnessMapUv:"",c.roughnessMapUv?
"#define ROUGHNESSMAP_UV "+c.roughnessMapUv:"",c.anisotropyMapUv?"#define ANISOTROPYMAP_UV "+c.anisotropyMapUv:"",c.clearcoatMapUv?"#define CLEARCOATMAP_UV "+c.clearcoatMapUv:"",c.clearcoatNormalMapUv?"#define CLEARCOAT_NORMALMAP_UV "+c.clearcoatNormalMapUv:"",c.clearcoatRoughnessMapUv?"#define CLEARCOAT_ROUGHNESSMAP_UV "+c.clearcoatRoughnessMapUv:"",c.iridescenceMapUv?"#define IRIDESCENCEMAP_UV "+c.iridescenceMapUv:"",c.iridescenceThicknessMapUv?"#define IRIDESCENCE_THICKNESSMAP_UV "+c.iridescenceThicknessMapUv:
"",c.sheenColorMapUv?"#define SHEEN_COLORMAP_UV "+c.sheenColorMapUv:"",c.sheenRoughnessMapUv?"#define SHEEN_ROUGHNESSMAP_UV "+c.sheenRoughnessMapUv:"",c.specularMapUv?"#define SPECULARMAP_UV "+c.specularMapUv:"",c.specularColorMapUv?"#define SPECULAR_COLORMAP_UV "+c.specularColorMapUv:"",c.specularIntensityMapUv?"#define SPECULAR_INTENSITYMAP_UV "+c.specularIntensityMapUv:"",c.transmissionMapUv?"#define TRANSMISSIONMAP_UV "+c.transmissionMapUv:"",c.thicknessMapUv?"#define THICKNESSMAP_UV "+c.thicknessMapUv:
"",c.vertexTangents&&!1===c.flatShading?"#define USE_TANGENT":"",c.vertexColors?"#define USE_COLOR":"",c.vertexAlphas?"#define USE_COLOR_ALPHA":"",c.vertexUv1s?"#define USE_UV1":"",c.vertexUv2s?"#define USE_UV2":"",c.vertexUv3s?"#define USE_UV3":"",c.pointsUvs?"#define USE_POINTS_UV":"",c.flatShading?"#define FLAT_SHADED":"",c.skinning?"#define USE_SKINNING":"",c.morphTargets?"#define USE_MORPHTARGETS":"",c.morphNormals&&!1===c.flatShading?"#define USE_MORPHNORMALS":"",c.morphColors&&c.isWebGL2?"#define USE_MORPHCOLORS":
"",0<c.morphTargetsCount&&c.isWebGL2?"#define MORPHTARGETS_TEXTURE":"",0<c.morphTargetsCount&&c.isWebGL2?"#define MORPHTARGETS_TEXTURE_STRIDE "+c.morphTextureStride:"",0<c.morphTargetsCount&&c.isWebGL2?"#define MORPHTARGETS_COUNT "+c.morphTargetsCount:"",c.doubleSided?"#define DOUBLE_SIDED":"",c.flipSided?"#define FLIP_SIDED":"",c.shadowMapEnabled?"#define USE_SHADOWMAP":"",c.shadowMapEnabled?"#define "+t:"",c.sizeAttenuation?"#define USE_SIZEATTENUATION":"",0<c.numLightProbes?"#define USE_LIGHT_PROBES":
"",c.useLegacyLights?"#define LEGACY_LIGHTS":"",c.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",c.logarithmicDepthBuffer&&c.rendererExtensionFragDepth?"#define USE_LOGDEPTHBUF_EXT":"","uniform mat4 modelMatrix;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 viewMatrix;","uniform mat3 normalMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;","#ifdef USE_INSTANCING","\tattribute mat4 instanceMatrix;","#endif","#ifdef USE_INSTANCING_COLOR","\tattribute vec3 instanceColor;",
"#endif","attribute vec3 position;","attribute vec3 normal;","attribute vec2 uv;","#ifdef USE_UV1","\tattribute vec2 uv1;","#endif","#ifdef USE_UV2","\tattribute vec2 uv2;","#endif","#ifdef USE_UV3","\tattribute vec2 uv3;","#endif","#ifdef USE_TANGENT","\tattribute vec4 tangent;","#endif","#if defined( USE_COLOR_ALPHA )","\tattribute vec4 color;","#elif defined( USE_COLOR )","\tattribute vec3 color;","#endif","#if ( defined( USE_MORPHTARGETS ) \x26\x26 ! defined( MORPHTARGETS_TEXTURE ) )","\tattribute vec3 morphTarget0;",
"\tattribute vec3 morphTarget1;","\tattribute vec3 morphTarget2;","\tattribute vec3 morphTarget3;","\t#ifdef USE_MORPHNORMALS","\t\tattribute vec3 morphNormal0;","\t\tattribute vec3 morphNormal1;","\t\tattribute vec3 morphNormal2;","\t\tattribute vec3 morphNormal3;","\t#else","\t\tattribute vec3 morphTarget4;","\t\tattribute vec3 morphTarget5;","\t\tattribute vec3 morphTarget6;","\t\tattribute vec3 morphTarget7;","\t#endif","#endif","#ifdef USE_SKINNING","\tattribute vec4 skinIndex;","\tattribute vec4 skinWeight;",
"#endif","\n"].filter(tc).join("\n"),L=[D,Xe(c),"#define SHADER_TYPE "+c.shaderType,"#define SHADER_NAME "+c.shaderName,E,c.useFog&&c.fog?"#define USE_FOG":"",c.useFog&&c.fogExp2?"#define FOG_EXP2":"",c.map?"#define USE_MAP":"",c.matcap?"#define USE_MATCAP":"",c.envMap?"#define USE_ENVMAP":"",c.envMap?"#define "+u:"",c.envMap?"#define "+v:"",c.envMap?"#define "+A:"",F?"#define CUBEUV_TEXEL_WIDTH "+F.texelWidth:"",F?"#define CUBEUV_TEXEL_HEIGHT "+F.texelHeight:"",F?"#define CUBEUV_MAX_MIP "+F.maxMip+
".0":"",c.lightMap?"#define USE_LIGHTMAP":"",c.aoMap?"#define USE_AOMAP":"",c.bumpMap?"#define USE_BUMPMAP":"",c.normalMap?"#define USE_NORMALMAP":"",c.normalMapObjectSpace?"#define USE_NORMALMAP_OBJECTSPACE":"",c.normalMapTangentSpace?"#define USE_NORMALMAP_TANGENTSPACE":"",c.emissiveMap?"#define USE_EMISSIVEMAP":"",c.anisotropy?"#define USE_ANISOTROPY":"",c.anisotropyMap?"#define USE_ANISOTROPYMAP":"",c.clearcoat?"#define USE_CLEARCOAT":"",c.clearcoatMap?"#define USE_CLEARCOATMAP":"",c.clearcoatRoughnessMap?
"#define USE_CLEARCOAT_ROUGHNESSMAP":"",c.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",c.iridescence?"#define USE_IRIDESCENCE":"",c.iridescenceMap?"#define USE_IRIDESCENCEMAP":"",c.iridescenceThicknessMap?"#define USE_IRIDESCENCE_THICKNESSMAP":"",c.specularMap?"#define USE_SPECULARMAP":"",c.specularColorMap?"#define USE_SPECULAR_COLORMAP":"",c.specularIntensityMap?"#define USE_SPECULAR_INTENSITYMAP":"",c.roughnessMap?"#define USE_ROUGHNESSMAP":"",c.metalnessMap?"#define USE_METALNESSMAP":
"",c.alphaMap?"#define USE_ALPHAMAP":"",c.alphaTest?"#define USE_ALPHATEST":"",c.alphaHash?"#define USE_ALPHAHASH":"",c.sheen?"#define USE_SHEEN":"",c.sheenColorMap?"#define USE_SHEEN_COLORMAP":"",c.sheenRoughnessMap?"#define USE_SHEEN_ROUGHNESSMAP":"",c.transmission?"#define USE_TRANSMISSION":"",c.transmissionMap?"#define USE_TRANSMISSIONMAP":"",c.thicknessMap?"#define USE_THICKNESSMAP":"",c.vertexTangents&&!1===c.flatShading?"#define USE_TANGENT":"",c.vertexColors||c.instancingColor?"#define USE_COLOR":
"",c.vertexAlphas?"#define USE_COLOR_ALPHA":"",c.vertexUv1s?"#define USE_UV1":"",c.vertexUv2s?"#define USE_UV2":"",c.vertexUv3s?"#define USE_UV3":"",c.pointsUvs?"#define USE_POINTS_UV":"",c.gradientMap?"#define USE_GRADIENTMAP":"",c.flatShading?"#define FLAT_SHADED":"",c.doubleSided?"#define DOUBLE_SIDED":"",c.flipSided?"#define FLIP_SIDED":"",c.shadowMapEnabled?"#define USE_SHADOWMAP":"",c.shadowMapEnabled?"#define "+t:"",c.premultipliedAlpha?"#define PREMULTIPLIED_ALPHA":"",0<c.numLightProbes?"#define USE_LIGHT_PROBES":
"",c.useLegacyLights?"#define LEGACY_LIGHTS":"",c.decodeVideoTexture?"#define DECODE_VIDEO_TEXTURE":"",c.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",c.logarithmicDepthBuffer&&c.rendererExtensionFragDepth?"#define USE_LOGDEPTHBUF_EXT":"","uniform mat4 viewMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;",0!==c.toneMapping?"#define TONE_MAPPING":"",0!==c.toneMapping?p.tonemapping_pars_fragment:"",0!==c.toneMapping?Gi("toneMapping",c.toneMapping):"",c.dithering?"#define DITHERING":
"",c.opaque?"#define OPAQUE":"",p.colorspace_pars_fragment,Fi("linearToOutputTexel",c.outputColorSpace),c.useDepthPacking?"#define DEPTH_PACKING "+c.depthPacking:"","\n"].filter(tc).join("\n"));m=m.replace(fc,Pd);m=qe(m,c);m=Od(m,c);n=n.replace(fc,Pd);n=qe(n,c);n=Od(n,c);m=m.replace(nc,Qd);n=n.replace(nc,Qd);c.isWebGL2&&!0!==c.isRawShaderMaterial&&(l="#version 300 es\n",J="precision mediump sampler2DArray;\n#define attribute in\n#define varying out\n#define texture2D texture\n"+J,L=["precision mediump sampler2DArray;\n#define varying in",
"300 es"===c.glslVersion?"":"layout(location \x3d 0) out highp vec4 pc_fragColor;","300 es"===c.glslVersion?"":"#define gl_FragColor pc_fragColor","#define gl_FragDepthEXT gl_FragDepth\n#define texture2D texture\n#define textureCube texture\n#define texture2DProj textureProj\n#define texture2DLodEXT textureLod\n#define texture2DProjLodEXT textureProjLod\n#define textureCubeLodEXT textureLod\n#define texture2DGradEXT textureGrad\n#define texture2DProjGradEXT textureProjGrad\n#define textureCubeGradEXT textureGrad"].join("\n")+
"\n"+L);n=l+L+n;const U=Tg(g,g.VERTEX_SHADER,l+J+m),P=Tg(g,g.FRAGMENT_SHADER,n);g.attachShader(y,U);g.attachShader(y,P);void 0!==c.index0AttributeName?g.bindAttribLocation(y,0,c.index0AttributeName):!0===c.morphTargets&&g.bindAttribLocation(y,0,"position");g.linkProgram(y);let X;this.getUniforms=function(){void 0===X&&f(this);return X};let ja;this.getAttributes=function(){void 0===ja&&f(this);return ja};let fa=!1===c.rendererExtensionParallelShaderCompile;this.isReady=function(){!1===fa&&(fa=g.getProgramParameter(y,
37297));return fa};this.destroy=function(){d.releaseStatesOfProgram(this);g.deleteProgram(y);this.program=void 0};this.type=c.shaderType;this.name=c.shaderName;this.id=vc++;this.cacheKey=b;this.usedTimes=1;this.program=y;this.vertexShader=U;this.fragmentShader=P;return this}function Ii(a,b,c,d,f,g,l){function m(y){return 0===y?"uv":`uv${y}`}const n=new re,t=new Ze,u=[],v=f.isWebGL2,A=f.logarithmicDepthBuffer,F=f.vertexTextures;let D=f.precision;const E={MeshDepthMaterial:"depth",MeshDistanceMaterial:"distanceRGBA",
MeshNormalMaterial:"normal",MeshBasicMaterial:"basic",MeshLambertMaterial:"lambert",MeshPhongMaterial:"phong",MeshToonMaterial:"toon",MeshStandardMaterial:"physical",MeshPhysicalMaterial:"physical",MeshMatcapMaterial:"matcap",LineBasicMaterial:"basic",LineDashedMaterial:"dashed",PointsMaterial:"points",ShadowMaterial:"shadow",SpriteMaterial:"sprite"};return{getParameters:function(y,J,L,U,P){const X=U.fog,ja=P.geometry;U=y.isMeshStandardMaterial?U.environment:null;const fa=(U=(y.isMeshStandardMaterial?
c:b).get(y.envMap||U))&&306===U.mapping?U.image.height:null,aa=E[y.type];null!==y.precision&&(D=f.getMaxPrecision(y.precision),D!==y.precision&&console.warn("THREE.WebGLProgram.getParameters:",y.precision,"not supported, using",D,"instead."));var pa=ja.morphAttributes.position||ja.morphAttributes.normal||ja.morphAttributes.color;pa=void 0!==pa?pa.length:0;let ba=0;void 0!==ja.morphAttributes.position&&(ba=1);void 0!==ja.morphAttributes.normal&&(ba=2);void 0!==ja.morphAttributes.color&&(ba=3);let xa;
let qa,ta;if(aa){var Ba=x[aa];xa=Ba.vertexShader;Ba=Ba.fragmentShader}else xa=y.vertexShader,Ba=y.fragmentShader,t.update(y),qa=t.getVertexShaderID(y),ta=t.getFragmentShaderID(y);const va=a.getRenderTarget(),Ga=!0===P.isInstancedMesh,ia=!!y.map,wa=!!y.matcap,ra=!!U,Sa=!!y.aoMap,Da=!!y.lightMap,Na=!!y.bumpMap,Ea=!!y.normalMap,Ta=!!y.displacementMap,G=!!y.emissiveMap,I=!!y.metalnessMap,Q=!!y.roughnessMap,Y=0<y.anisotropy,Z=0<y.clearcoat,Fa=0<y.iridescence,Ja=0<y.sheen,N=0<y.transmission,da=Y&&!!y.anisotropyMap,
la=Z&&!!y.clearcoatMap,Aa=Z&&!!y.clearcoatNormalMap,ua=Z&&!!y.clearcoatRoughnessMap,Ha=Fa&&!!y.iridescenceMap,Va=Fa&&!!y.iridescenceThicknessMap,Qa=Ja&&!!y.sheenColorMap,nb=Ja&&!!y.sheenRoughnessMap,ob=!!y.specularMap,Bb=!!y.specularColorMap,gc=!!y.specularIntensityMap,Rd=N&&!!y.transmissionMap,Nc=N&&!!y.thicknessMap,Rf=!!y.gradientMap,na=!!y.alphaMap,Db=0<y.alphaTest,ub=!!y.alphaHash,fb=!!y.extensions,wc=!!ja.attributes.uv1,vb=!!ja.attributes.uv2,zb=!!ja.attributes.uv3;let sd=0;!y.toneMapped||null!==
va&&!0!==va.isXRRenderTarget||(sd=a.toneMapping);return{isWebGL2:v,shaderID:aa,shaderType:y.type,shaderName:y.name,vertexShader:xa,fragmentShader:Ba,defines:y.defines,customVertexShaderID:qa,customFragmentShaderID:ta,isRawShaderMaterial:!0===y.isRawShaderMaterial,glslVersion:y.glslVersion,precision:D,instancing:Ga,instancingColor:Ga&&null!==P.instanceColor,supportsVertexTextures:F,outputColorSpace:null===va?a.outputColorSpace:!0===va.isXRRenderTarget?va.texture.colorSpace:"srgb-linear",map:ia,matcap:wa,
envMap:ra,envMapMode:ra&&U.mapping,envMapCubeUVHeight:fa,aoMap:Sa,lightMap:Da,bumpMap:Na,normalMap:Ea,displacementMap:F&&Ta,emissiveMap:G,normalMapObjectSpace:Ea&&1===y.normalMapType,normalMapTangentSpace:Ea&&0===y.normalMapType,metalnessMap:I,roughnessMap:Q,anisotropy:Y,anisotropyMap:da,clearcoat:Z,clearcoatMap:la,clearcoatNormalMap:Aa,clearcoatRoughnessMap:ua,iridescence:Fa,iridescenceMap:Ha,iridescenceThicknessMap:Va,sheen:Ja,sheenColorMap:Qa,sheenRoughnessMap:nb,specularMap:ob,specularColorMap:Bb,
specularIntensityMap:gc,transmission:N,transmissionMap:Rd,thicknessMap:Nc,gradientMap:Rf,opaque:!1===y.transparent&&1===y.blending,alphaMap:na,alphaTest:Db,alphaHash:ub,combine:y.combine,mapUv:ia&&m(y.map.channel),aoMapUv:Sa&&m(y.aoMap.channel),lightMapUv:Da&&m(y.lightMap.channel),bumpMapUv:Na&&m(y.bumpMap.channel),normalMapUv:Ea&&m(y.normalMap.channel),displacementMapUv:Ta&&m(y.displacementMap.channel),emissiveMapUv:G&&m(y.emissiveMap.channel),metalnessMapUv:I&&m(y.metalnessMap.channel),roughnessMapUv:Q&&
m(y.roughnessMap.channel),anisotropyMapUv:da&&m(y.anisotropyMap.channel),clearcoatMapUv:la&&m(y.clearcoatMap.channel),clearcoatNormalMapUv:Aa&&m(y.clearcoatNormalMap.channel),clearcoatRoughnessMapUv:ua&&m(y.clearcoatRoughnessMap.channel),iridescenceMapUv:Ha&&m(y.iridescenceMap.channel),iridescenceThicknessMapUv:Va&&m(y.iridescenceThicknessMap.channel),sheenColorMapUv:Qa&&m(y.sheenColorMap.channel),sheenRoughnessMapUv:nb&&m(y.sheenRoughnessMap.channel),specularMapUv:ob&&m(y.specularMap.channel),specularColorMapUv:Bb&&
m(y.specularColorMap.channel),specularIntensityMapUv:gc&&m(y.specularIntensityMap.channel),transmissionMapUv:Rd&&m(y.transmissionMap.channel),thicknessMapUv:Nc&&m(y.thicknessMap.channel),alphaMapUv:na&&m(y.alphaMap.channel),vertexTangents:!!ja.attributes.tangent&&(Ea||Y),vertexColors:y.vertexColors,vertexAlphas:!0===y.vertexColors&&!!ja.attributes.color&&4===ja.attributes.color.itemSize,vertexUv1s:wc,vertexUv2s:vb,vertexUv3s:zb,pointsUvs:!0===P.isPoints&&!!ja.attributes.uv&&(ia||na),fog:!!X,useFog:!0===
y.fog,fogExp2:X&&X.isFogExp2,flatShading:!0===y.flatShading,sizeAttenuation:!0===y.sizeAttenuation,logarithmicDepthBuffer:A,skinning:!0===P.isSkinnedMesh,morphTargets:void 0!==ja.morphAttributes.position,morphNormals:void 0!==ja.morphAttributes.normal,morphColors:void 0!==ja.morphAttributes.color,morphTargetsCount:pa,morphTextureStride:ba,numDirLights:J.directional.length,numPointLights:J.point.length,numSpotLights:J.spot.length,numSpotLightMaps:J.spotLightMap.length,numRectAreaLights:J.rectArea.length,
numHemiLights:J.hemi.length,numDirLightShadows:J.directionalShadowMap.length,numPointLightShadows:J.pointShadowMap.length,numSpotLightShadows:J.spotShadowMap.length,numSpotLightShadowsWithMaps:J.numSpotLightShadowsWithMaps,numLightProbes:J.numLightProbes,numClippingPlanes:l.numPlanes,numClipIntersection:l.numIntersection,dithering:y.dithering,shadowMapEnabled:a.shadowMap.enabled&&0<L.length,shadowMapType:a.shadowMap.type,toneMapping:sd,useLegacyLights:a._useLegacyLights,decodeVideoTexture:ia&&!0===
y.map.isVideoTexture&&"srgb"===jb.getTransfer(y.map.colorSpace),premultipliedAlpha:y.premultipliedAlpha,doubleSided:2===y.side,flipSided:1===y.side,useDepthPacking:0<=y.depthPacking,depthPacking:y.depthPacking||0,index0AttributeName:y.index0AttributeName,extensionDerivatives:fb&&!0===y.extensions.derivatives,extensionFragDepth:fb&&!0===y.extensions.fragDepth,extensionDrawBuffers:fb&&!0===y.extensions.drawBuffers,extensionShaderTextureLOD:fb&&!0===y.extensions.shaderTextureLOD,rendererExtensionFragDepth:v||
d.has("EXT_frag_depth"),rendererExtensionDrawBuffers:v||d.has("WEBGL_draw_buffers"),rendererExtensionShaderTextureLod:v||d.has("EXT_shader_texture_lod"),rendererExtensionParallelShaderCompile:d.has("KHR_parallel_shader_compile"),customProgramCacheKey:y.customProgramCacheKey()}},getProgramCacheKey:function(y){const J=[];y.shaderID?J.push(y.shaderID):(J.push(y.customVertexShaderID),J.push(y.customFragmentShaderID));if(void 0!==y.defines)for(const L in y.defines)J.push(L),J.push(y.defines[L]);!1===y.isRawShaderMaterial&&
(J.push(y.precision),J.push(y.outputColorSpace),J.push(y.envMapMode),J.push(y.envMapCubeUVHeight),J.push(y.mapUv),J.push(y.alphaMapUv),J.push(y.lightMapUv),J.push(y.aoMapUv),J.push(y.bumpMapUv),J.push(y.normalMapUv),J.push(y.displacementMapUv),J.push(y.emissiveMapUv),J.push(y.metalnessMapUv),J.push(y.roughnessMapUv),J.push(y.anisotropyMapUv),J.push(y.clearcoatMapUv),J.push(y.clearcoatNormalMapUv),J.push(y.clearcoatRoughnessMapUv),J.push(y.iridescenceMapUv),J.push(y.iridescenceThicknessMapUv),J.push(y.sheenColorMapUv),
J.push(y.sheenRoughnessMapUv),J.push(y.specularMapUv),J.push(y.specularColorMapUv),J.push(y.specularIntensityMapUv),J.push(y.transmissionMapUv),J.push(y.thicknessMapUv),J.push(y.combine),J.push(y.fogExp2),J.push(y.sizeAttenuation),J.push(y.morphTargetsCount),J.push(y.morphAttributeCount),J.push(y.numDirLights),J.push(y.numPointLights),J.push(y.numSpotLights),J.push(y.numSpotLightMaps),J.push(y.numHemiLights),J.push(y.numRectAreaLights),J.push(y.numDirLightShadows),J.push(y.numPointLightShadows),J.push(y.numSpotLightShadows),
J.push(y.numSpotLightShadowsWithMaps),J.push(y.numLightProbes),J.push(y.shadowMapType),J.push(y.toneMapping),J.push(y.numClippingPlanes),J.push(y.numClipIntersection),J.push(y.depthPacking),n.disableAll(),y.isWebGL2&&n.enable(0),y.supportsVertexTextures&&n.enable(1),y.instancing&&n.enable(2),y.instancingColor&&n.enable(3),y.matcap&&n.enable(4),y.envMap&&n.enable(5),y.normalMapObjectSpace&&n.enable(6),y.normalMapTangentSpace&&n.enable(7),y.clearcoat&&n.enable(8),y.iridescence&&n.enable(9),y.alphaTest&&
n.enable(10),y.vertexColors&&n.enable(11),y.vertexAlphas&&n.enable(12),y.vertexUv1s&&n.enable(13),y.vertexUv2s&&n.enable(14),y.vertexUv3s&&n.enable(15),y.vertexTangents&&n.enable(16),y.anisotropy&&n.enable(17),y.alphaHash&&n.enable(18),J.push(n.mask),n.disableAll(),y.fog&&n.enable(0),y.useFog&&n.enable(1),y.flatShading&&n.enable(2),y.logarithmicDepthBuffer&&n.enable(3),y.skinning&&n.enable(4),y.morphTargets&&n.enable(5),y.morphNormals&&n.enable(6),y.morphColors&&n.enable(7),y.premultipliedAlpha&&
n.enable(8),y.shadowMapEnabled&&n.enable(9),y.useLegacyLights&&n.enable(10),y.doubleSided&&n.enable(11),y.flipSided&&n.enable(12),y.useDepthPacking&&n.enable(13),y.dithering&&n.enable(14),y.transmission&&n.enable(15),y.sheen&&n.enable(16),y.opaque&&n.enable(17),y.pointsUvs&&n.enable(18),y.decodeVideoTexture&&n.enable(19),J.push(n.mask),J.push(a.outputColorSpace));J.push(y.customProgramCacheKey);return J.join()},getUniforms:function(y){const J=E[y.type];return J?Zg.clone(x[J].uniforms):y.uniforms},
acquireProgram:function(y,J){let L;for(let U=0,P=u.length;U<P;U++){const X=u[U];if(X.cacheKey===J){L=X;++L.usedTimes;break}}void 0===L&&(L=new Ye(a,J,y,g),u.push(L));return L},releaseProgram:function(y){if(0===--y.usedTimes){const J=u.indexOf(y);u[J]=u[u.length-1];u.pop();y.destroy()}},releaseShaderCache:function(y){t.remove(y)},programs:u,dispose:function(){t.dispose()}}}function Sd(){let a=new WeakMap;return{get:function(b){let c=a.get(b);void 0===c&&(c={},a.set(b,c));return c},remove:function(b){a.delete(b)},
update:function(b,c,d){a.get(b)[c]=d},dispose:function(){a=new WeakMap}}}function Ji(a,b){return a.groupOrder!==b.groupOrder?a.groupOrder-b.groupOrder:a.renderOrder!==b.renderOrder?a.renderOrder-b.renderOrder:a.material.id!==b.material.id?a.material.id-b.material.id:a.z!==b.z?a.z-b.z:a.id-b.id}function $g(a,b){return a.groupOrder!==b.groupOrder?a.groupOrder-b.groupOrder:a.renderOrder!==b.renderOrder?a.renderOrder-b.renderOrder:a.z!==b.z?b.z-a.z:a.id-b.id}function ah(){function a(l,m,n,t,u,v){let A=
b[c];void 0===A?(A={id:l.id,object:l,geometry:m,material:n,groupOrder:t,renderOrder:l.renderOrder,z:u,group:v},b[c]=A):(A.id=l.id,A.object=l,A.geometry=m,A.material=n,A.groupOrder=t,A.renderOrder=l.renderOrder,A.z=u,A.group=v);c++;return A}const b=[];let c=0;const d=[],f=[],g=[];return{opaque:d,transmissive:f,transparent:g,init:function(){c=0;d.length=0;f.length=0;g.length=0},push:function(l,m,n,t,u,v){l=a(l,m,n,t,u,v);0<n.transmission?f.push(l):!0===n.transparent?g.push(l):d.push(l)},unshift:function(l,
m,n,t,u,v){l=a(l,m,n,t,u,v);0<n.transmission?f.unshift(l):!0===n.transparent?g.unshift(l):d.unshift(l)},finish:function(){for(let l=c,m=b.length;l<m;l++){const n=b[l];if(null===n.id)break;n.id=null;n.object=null;n.geometry=null;n.material=null;n.group=null}},sort:function(l,m){1<d.length&&d.sort(l||Ji);1<f.length&&f.sort(m||$g);1<g.length&&g.sort(m||$g)}}}function Ki(){let a=new WeakMap;return{get:function(b,c){const d=a.get(b);void 0===d?(c=new ah,a.set(b,[c])):c>=d.length?(c=new ah,d.push(c)):c=
d[c];return c},dispose:function(){a=new WeakMap}}}function Li(){const a={};return{get:function(b){if(void 0!==a[b.id])return a[b.id];let c;switch(b.type){case "DirectionalLight":c={direction:new O,color:new Ia};break;case "SpotLight":c={position:new O,direction:new O,color:new Ia,distance:0,coneCos:0,penumbraCos:0,decay:0};break;case "PointLight":c={position:new O,color:new Ia,distance:0,decay:0};break;case "HemisphereLight":c={direction:new O,skyColor:new Ia,groundColor:new Ia};break;case "RectAreaLight":c=
{color:new Ia,position:new O,halfWidth:new O,halfHeight:new O}}return a[b.id]=c}}}function Mi(){const a={};return{get:function(b){if(void 0!==a[b.id])return a[b.id];let c;switch(b.type){case "DirectionalLight":c={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new sa};break;case "SpotLight":c={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new sa};break;case "PointLight":c={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new sa,shadowCameraNear:1,shadowCameraFar:1E3}}return a[b.id]=
c}}}function Ni(a,b){return(b.castShadow?2:0)-(a.castShadow?2:0)+(b.map?1:0)-(a.map?1:0)}function Oi(a,b){const c=new Li,d=Mi(),f={version:0,hash:{directionalLength:-1,pointLength:-1,spotLength:-1,rectAreaLength:-1,hemiLength:-1,numDirectionalShadows:-1,numPointShadows:-1,numSpotShadows:-1,numSpotMaps:-1,numLightProbes:-1},ambient:[0,0,0],probe:[],directional:[],directionalShadow:[],directionalShadowMap:[],directionalShadowMatrix:[],spot:[],spotLightMap:[],spotShadow:[],spotShadowMap:[],spotLightMatrix:[],
rectArea:[],rectAreaLTC1:null,rectAreaLTC2:null,point:[],pointShadow:[],pointShadowMap:[],pointShadowMatrix:[],hemi:[],numSpotLightShadowsWithMaps:0,numLightProbes:0};for(let n=0;9>n;n++)f.probe.push(new O);const g=new O,l=new Wa,m=new Wa;return{setup:function(n,t){let u=0,v=0,A=0;for(var F=0;9>F;F++)f.probe[F].set(0,0,0);let D=F=0,E=0,y=0,J=0,L=0,U=0,P=0,X=0,ja=0,fa=0;n.sort(Ni);t=!0===t?Math.PI:1;for(let ta=0,Ba=n.length;ta<Ba;ta++){var aa=n[ta],pa=aa.color,ba=aa.intensity,xa=aa.distance,qa=aa.shadow&&
aa.shadow.map?aa.shadow.map.texture:null;if(aa.isAmbientLight)u+=pa.r*ba*t,v+=pa.g*ba*t,A+=pa.b*ba*t;else if(aa.isLightProbe){for(qa=0;9>qa;qa++)f.probe[qa].addScaledVector(aa.sh.coefficients[qa],ba);fa++}else if(aa.isDirectionalLight)ba=c.get(aa),ba.color.copy(aa.color).multiplyScalar(aa.intensity*t),aa.castShadow&&(pa=aa.shadow,xa=d.get(aa),xa.shadowBias=pa.bias,xa.shadowNormalBias=pa.normalBias,xa.shadowRadius=pa.radius,xa.shadowMapSize=pa.mapSize,f.directionalShadow[F]=xa,f.directionalShadowMap[F]=
qa,f.directionalShadowMatrix[F]=aa.shadow.matrix,L++),f.directional[F]=ba,F++;else if(aa.isSpotLight){const va=c.get(aa);va.position.setFromMatrixPosition(aa.matrixWorld);va.color.copy(pa).multiplyScalar(ba*t);va.distance=xa;va.coneCos=Math.cos(aa.angle);va.penumbraCos=Math.cos(aa.angle*(1-aa.penumbra));va.decay=aa.decay;f.spot[E]=va;ba=aa.shadow;aa.map&&(f.spotLightMap[X]=aa.map,X++,ba.updateMatrices(aa),aa.castShadow&&ja++);f.spotLightMatrix[E]=ba.matrix;aa.castShadow&&(aa=d.get(aa),aa.shadowBias=
ba.bias,aa.shadowNormalBias=ba.normalBias,aa.shadowRadius=ba.radius,aa.shadowMapSize=ba.mapSize,f.spotShadow[E]=aa,f.spotShadowMap[E]=qa,P++);E++}else aa.isRectAreaLight?(qa=c.get(aa),qa.color.copy(pa).multiplyScalar(ba),qa.halfWidth.set(.5*aa.width,0,0),qa.halfHeight.set(0,.5*aa.height,0),f.rectArea[y]=qa,y++):aa.isPointLight?(ba=c.get(aa),ba.color.copy(aa.color).multiplyScalar(aa.intensity*t),ba.distance=aa.distance,ba.decay=aa.decay,aa.castShadow&&(pa=aa.shadow,xa=d.get(aa),xa.shadowBias=pa.bias,
xa.shadowNormalBias=pa.normalBias,xa.shadowRadius=pa.radius,xa.shadowMapSize=pa.mapSize,xa.shadowCameraNear=pa.camera.near,xa.shadowCameraFar=pa.camera.far,f.pointShadow[D]=xa,f.pointShadowMap[D]=qa,f.pointShadowMatrix[D]=aa.shadow.matrix,U++),f.point[D]=ba,D++):aa.isHemisphereLight&&(qa=c.get(aa),qa.skyColor.copy(aa.color).multiplyScalar(ba*t),qa.groundColor.copy(aa.groundColor).multiplyScalar(ba*t),f.hemi[J]=qa,J++)}0<y&&(b.isWebGL2?(f.rectAreaLTC1=r.LTC_FLOAT_1,f.rectAreaLTC2=r.LTC_FLOAT_2):!0===
a.has("OES_texture_float_linear")?(f.rectAreaLTC1=r.LTC_FLOAT_1,f.rectAreaLTC2=r.LTC_FLOAT_2):!0===a.has("OES_texture_half_float_linear")?(f.rectAreaLTC1=r.LTC_HALF_1,f.rectAreaLTC2=r.LTC_HALF_2):console.error("THREE.WebGLRenderer: Unable to use RectAreaLight. Missing WebGL extensions."));f.ambient[0]=u;f.ambient[1]=v;f.ambient[2]=A;n=f.hash;if(n.directionalLength!==F||n.pointLength!==D||n.spotLength!==E||n.rectAreaLength!==y||n.hemiLength!==J||n.numDirectionalShadows!==L||n.numPointShadows!==U||
n.numSpotShadows!==P||n.numSpotMaps!==X||n.numLightProbes!==fa)f.directional.length=F,f.spot.length=E,f.rectArea.length=y,f.point.length=D,f.hemi.length=J,f.directionalShadow.length=L,f.directionalShadowMap.length=L,f.pointShadow.length=U,f.pointShadowMap.length=U,f.spotShadow.length=P,f.spotShadowMap.length=P,f.directionalShadowMatrix.length=L,f.pointShadowMatrix.length=U,f.spotLightMatrix.length=P+X-ja,f.spotLightMap.length=X,f.numSpotLightShadowsWithMaps=ja,f.numLightProbes=fa,n.directionalLength=
F,n.pointLength=D,n.spotLength=E,n.rectAreaLength=y,n.hemiLength=J,n.numDirectionalShadows=L,n.numPointShadows=U,n.numSpotShadows=P,n.numSpotMaps=X,n.numLightProbes=fa,f.version=Sf++},setupView:function(n,t){let u=0,v=0,A=0,F=0,D=0;t=t.matrixWorldInverse;for(let y=0,J=n.length;y<J;y++){const L=n[y];if(L.isDirectionalLight){var E=f.directional[u];E.direction.setFromMatrixPosition(L.matrixWorld);g.setFromMatrixPosition(L.target.matrixWorld);E.direction.sub(g);E.direction.transformDirection(t);u++}else L.isSpotLight?
(E=f.spot[A],E.position.setFromMatrixPosition(L.matrixWorld),E.position.applyMatrix4(t),E.direction.setFromMatrixPosition(L.matrixWorld),g.setFromMatrixPosition(L.target.matrixWorld),E.direction.sub(g),E.direction.transformDirection(t),A++):L.isRectAreaLight?(E=f.rectArea[F],E.position.setFromMatrixPosition(L.matrixWorld),E.position.applyMatrix4(t),m.identity(),l.copy(L.matrixWorld),l.premultiply(t),m.extractRotation(l),E.halfWidth.set(.5*L.width,0,0),E.halfHeight.set(0,.5*L.height,0),E.halfWidth.applyMatrix4(m),
E.halfHeight.applyMatrix4(m),F++):L.isPointLight?(E=f.point[v],E.position.setFromMatrixPosition(L.matrixWorld),E.position.applyMatrix4(t),v++):L.isHemisphereLight&&(E=f.hemi[D],E.direction.setFromMatrixPosition(L.matrixWorld),E.direction.transformDirection(t),D++)}},state:f}}function se(a,b){const c=new Oi(a,b),d=[],f=[];return{init:function(){d.length=0;f.length=0},state:{lightsArray:d,shadowsArray:f,lights:c},setupLights:function(g){c.setup(d,g)},setupLightsView:function(g){c.setupView(d,g)},pushLight:function(g){d.push(g)},
pushShadow:function(g){f.push(g)}}}function Pi(a,b){let c=new WeakMap;return{get:function(d,f=0){const g=c.get(d);void 0===g?(f=new se(a,b),c.set(d,[f])):f>=g.length?(f=new se(a,b),g.push(f)):f=g[f];return f},dispose:function(){c=new WeakMap}}}function Qi(a,b,c){function d(U,P,X,ja){U=!0===X.isPointLight?U.customDistanceMaterial:U.customDepthMaterial;if(void 0===U&&(U=!0===X.isPointLight?u:t,a.localClippingEnabled&&!0===P.clipShadows&&Array.isArray(P.clippingPlanes)&&0!==P.clippingPlanes.length||
P.displacementMap&&0!==P.displacementScale||P.alphaMap&&0<P.alphaTest||P.map&&0<P.alphaTest)){var fa=U.uuid;const aa=P.uuid;let pa=v[fa];void 0===pa&&(pa={},v[fa]=pa);fa=pa[aa];void 0===fa&&(fa=U.clone(),pa[aa]=fa);U=fa}U.visible=P.visible;U.wireframe=P.wireframe;U.side=3===ja?null!==P.shadowSide?P.shadowSide:P.side:null!==P.shadowSide?P.shadowSide:F[P.side];U.alphaMap=P.alphaMap;U.alphaTest=P.alphaTest;U.map=P.map;U.clipShadows=P.clipShadows;U.clippingPlanes=P.clippingPlanes;U.clipIntersection=P.clipIntersection;
U.displacementMap=P.displacementMap;U.displacementScale=P.displacementScale;U.displacementBias=P.displacementBias;U.wireframeLinewidth=P.wireframeLinewidth;U.linewidth=P.linewidth;!0===X.isPointLight&&!0===U.isMeshDistanceMaterial&&(a.properties.get(U).light=X);return U}function f(U,P,X,ja,fa){if(!1!==U.visible){if(U.layers.test(P.layers)&&(U.isMesh||U.isLine||U.isPoints)&&(U.castShadow||U.receiveShadow&&3===fa)&&(!U.frustumCulled||g.intersectsObject(U))){U.modelViewMatrix.multiplyMatrices(X.matrixWorldInverse,
U.matrixWorld);const ba=b.update(U);var aa=U.material;if(Array.isArray(aa)){const xa=ba.groups;for(let qa=0,ta=xa.length;qa<ta;qa++){const Ba=xa[qa];var pa=aa[Ba.materialIndex];pa&&pa.visible&&(pa=d(U,pa,ja,fa),a.renderBufferDirect(X,null,ba,pa,U,Ba))}}else aa.visible&&(aa=d(U,aa,ja,fa),a.renderBufferDirect(X,null,ba,aa,U,null))}U=U.children;for(let ba=0,xa=U.length;ba<xa;ba++)f(U[ba],P,X,ja,fa)}}let g=new h;const l=new sa,m=new sa,n=new mb,t=new $e({depthPacking:3201}),u=new Ri,v={},A=c.maxTextureSize,
F={[0]:1,[1]:0,[2]:2},D=new bc({defines:{VSM_SAMPLES:8},uniforms:{shadow_pass:{value:null},resolution:{value:new sa},radius:{value:4}},vertexShader:"void main() {\n\tgl_Position \x3d vec4( position, 1.0 );\n}",fragmentShader:"uniform sampler2D shadow_pass;\nuniform vec2 resolution;\nuniform float radius;\n#include \x3cpacking\x3e\nvoid main() {\n\tconst float samples \x3d float( VSM_SAMPLES );\n\tfloat mean \x3d 0.0;\n\tfloat squared_mean \x3d 0.0;\n\tfloat uvStride \x3d samples \x3c\x3d 1.0 ? 0.0 : 2.0 / ( samples - 1.0 );\n\tfloat uvStart \x3d samples \x3c\x3d 1.0 ? 0.0 : - 1.0;\n\tfor ( float i \x3d 0.0; i \x3c samples; i ++ ) {\n\t\tfloat uvOffset \x3d uvStart + i * uvStride;\n\t\t#ifdef HORIZONTAL_PASS\n\t\t\tvec2 distribution \x3d unpackRGBATo2Half( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( uvOffset, 0.0 ) * radius ) / resolution ) );\n\t\t\tmean +\x3d distribution.x;\n\t\t\tsquared_mean +\x3d distribution.y * distribution.y + distribution.x * distribution.x;\n\t\t#else\n\t\t\tfloat depth \x3d unpackRGBAToDepth( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( 0.0, uvOffset ) * radius ) / resolution ) );\n\t\t\tmean +\x3d depth;\n\t\t\tsquared_mean +\x3d depth * depth;\n\t\t#endif\n\t}\n\tmean \x3d mean / samples;\n\tsquared_mean \x3d squared_mean / samples;\n\tfloat std_dev \x3d sqrt( squared_mean - mean * mean );\n\tgl_FragColor \x3d pack2HalfToRGBA( vec2( mean, std_dev ) );\n}"}),
E=D.clone();E.defines.HORIZONTAL_PASS=1;c=new ab;c.setAttribute("position",new rb(new Float32Array([-1,-1,.5,3,-1,.5,-1,3,.5]),3));const y=new cb(c,D),J=this;this.enabled=!1;this.autoUpdate=!0;this.needsUpdate=!1;let L=this.type=1;this.render=function(U,P,X){if(!1!==J.enabled&&(!1!==J.autoUpdate||!1!==J.needsUpdate)&&0!==U.length){var ja=a.getRenderTarget(),fa=a.getActiveCubeFace(),aa=a.getActiveMipmapLevel(),pa=a.state;pa.setBlending(0);pa.buffers.color.setClear(1,1,1,1);pa.buffers.depth.setTest(!0);
pa.setScissorTest(!1);var ba=3!==L&&3===this.type,xa=3===L&&3!==this.type;for(let va=0,Ga=U.length;va<Ga;va++){var qa=U[va];const ia=qa.shadow;if(void 0===ia)console.warn("THREE.WebGLShadowMap:",qa,"has no shadow.");else if(!1!==ia.autoUpdate||!1!==ia.needsUpdate){l.copy(ia.mapSize);var ta=ia.getFrameExtents();l.multiply(ta);m.copy(ia.mapSize);if(l.x>A||l.y>A)l.x>A&&(m.x=Math.floor(A/ta.x),l.x=m.x*ta.x,ia.mapSize.x=m.x),l.y>A&&(m.y=Math.floor(A/ta.y),l.y=m.y*ta.y,ia.mapSize.y=m.y);if(null===ia.map||
!0===ba||!0===xa)ta=3!==this.type?{minFilter:1003,magFilter:1003}:{},null!==ia.map&&ia.map.dispose(),ia.map=new rc(l.x,l.y,ta),ia.map.texture.name=qa.name+".shadowMap",ia.camera.updateProjectionMatrix();a.setRenderTarget(ia.map);a.clear();ta=ia.getViewportCount();for(var Ba=0;Ba<ta;Ba++){const wa=ia.getViewport(Ba);n.set(m.x*wa.x,m.y*wa.y,m.x*wa.z,m.y*wa.w);pa.viewport(n);ia.updateMatrices(qa,Ba);g=ia.getFrustum();f(P,X,ia.camera,qa,this.type)}!0!==ia.isPointLightShadow&&3===this.type&&(qa=ia,ta=
X,Ba=b.update(y),D.defines.VSM_SAMPLES!==qa.blurSamples&&(D.defines.VSM_SAMPLES=qa.blurSamples,E.defines.VSM_SAMPLES=qa.blurSamples,D.needsUpdate=!0,E.needsUpdate=!0),null===qa.mapPass&&(qa.mapPass=new rc(l.x,l.y)),D.uniforms.shadow_pass.value=qa.map.texture,D.uniforms.resolution.value=qa.mapSize,D.uniforms.radius.value=qa.radius,a.setRenderTarget(qa.mapPass),a.clear(),a.renderBufferDirect(ta,null,Ba,D,y,null),E.uniforms.shadow_pass.value=qa.mapPass.texture,E.uniforms.resolution.value=qa.mapSize,
E.uniforms.radius.value=qa.radius,a.setRenderTarget(qa.map),a.clear(),a.renderBufferDirect(ta,null,Ba,E,y,null));ia.needsUpdate=!1}}L=this.type;J.needsUpdate=!1;a.setRenderTarget(ja,fa,aa)}}}function Si(a,b,c){function d(N,da,la,Aa){const ua=new Uint8Array(4),Ha=a.createTexture();a.bindTexture(N,Ha);a.texParameteri(N,a.TEXTURE_MIN_FILTER,a.NEAREST);a.texParameteri(N,a.TEXTURE_MAG_FILTER,a.NEAREST);for(let Va=0;Va<la;Va++)!u||N!==a.TEXTURE_3D&&N!==a.TEXTURE_2D_ARRAY?a.texImage2D(da+Va,0,a.RGBA,1,1,
0,a.RGBA,a.UNSIGNED_BYTE,ua):a.texImage3D(da,0,a.RGBA,1,1,Aa,0,a.RGBA,a.UNSIGNED_BYTE,ua);return Ha}function f(N){!0!==y[N]&&(a.enable(N),y[N]=!0)}function g(N){!1!==y[N]&&(a.disable(N),y[N]=!1)}function l(N,da,la,Aa,ua,Ha,Va,Qa,nb,ob){if(0===N)!0===X&&(g(a.BLEND),X=!1);else if(!1===X&&(f(a.BLEND),X=!0),5!==N){if(N!==ja||ob!==va){if(100!==fa||100!==ba)a.blendEquation(a.FUNC_ADD),ba=fa=100;if(ob)switch(N){case 1:a.blendFuncSeparate(a.ONE,a.ONE_MINUS_SRC_ALPHA,a.ONE,a.ONE_MINUS_SRC_ALPHA);break;case 2:a.blendFunc(a.ONE,
a.ONE);break;case 3:a.blendFuncSeparate(a.ZERO,a.ONE_MINUS_SRC_COLOR,a.ZERO,a.ONE);break;case 4:a.blendFuncSeparate(a.ZERO,a.SRC_COLOR,a.ZERO,a.SRC_ALPHA);break;default:console.error("THREE.WebGLState: Invalid blending: ",N)}else switch(N){case 1:a.blendFuncSeparate(a.SRC_ALPHA,a.ONE_MINUS_SRC_ALPHA,a.ONE,a.ONE_MINUS_SRC_ALPHA);break;case 2:a.blendFunc(a.SRC_ALPHA,a.ONE);break;case 3:a.blendFuncSeparate(a.ZERO,a.ONE_MINUS_SRC_COLOR,a.ZERO,a.ONE);break;case 4:a.blendFunc(a.ZERO,a.SRC_COLOR);break;
default:console.error("THREE.WebGLState: Invalid blending: ",N)}qa=xa=pa=aa=null;ta.set(0,0,0);Ba=0;ja=N;va=ob}}else{ua=ua||da;Ha=Ha||la;Va=Va||Aa;if(da!==fa||ua!==ba)a.blendEquationSeparate(Fa[da],Fa[ua]),fa=da,ba=ua;if(la!==aa||Aa!==pa||Ha!==xa||Va!==qa)a.blendFuncSeparate(Ja[la],Ja[Aa],Ja[Ha],Ja[Va]),aa=la,pa=Aa,xa=Ha,qa=Va;if(!1===Qa.equals(ta)||nb!==Ba)a.blendColor(Qa.r,Qa.g,Qa.b,nb),ta.copy(Qa),Ba=nb;ja=N;va=!1}}function m(N){Ga!==N&&(N?a.frontFace(a.CW):a.frontFace(a.CCW),Ga=N)}function n(N){0!==
N?(f(a.CULL_FACE),N!==ia&&(1===N?a.cullFace(a.BACK):2===N?a.cullFace(a.FRONT):a.cullFace(a.FRONT_AND_BACK))):g(a.CULL_FACE);ia=N}function t(N,da,la){if(N){if(f(a.POLYGON_OFFSET_FILL),ra!==da||Sa!==la)a.polygonOffset(da,la),ra=da,Sa=la}else g(a.POLYGON_OFFSET_FILL)}const u=c.isWebGL2,v=new function(){let N=!1;const da=new mb;let la=null;const Aa=new mb(0,0,0,0);return{setMask:function(ua){la===ua||N||(a.colorMask(ua,ua,ua,ua),la=ua)},setLocked:function(ua){N=ua},setClear:function(ua,Ha,Va,Qa,nb){!0===
nb&&(ua*=Qa,Ha*=Qa,Va*=Qa);da.set(ua,Ha,Va,Qa);!1===Aa.equals(da)&&(a.clearColor(ua,Ha,Va,Qa),Aa.copy(da))},reset:function(){N=!1;la=null;Aa.set(-1,0,0,0)}}},A=new function(){let N=!1,da=null,la=null,Aa=null;return{setTest:function(ua){ua?f(a.DEPTH_TEST):g(a.DEPTH_TEST)},setMask:function(ua){da===ua||N||(a.depthMask(ua),da=ua)},setFunc:function(ua){if(la!==ua){switch(ua){case 0:a.depthFunc(a.NEVER);break;case 1:a.depthFunc(a.ALWAYS);break;case 2:a.depthFunc(a.LESS);break;case 3:a.depthFunc(a.LEQUAL);
break;case 4:a.depthFunc(a.EQUAL);break;case 5:a.depthFunc(a.GEQUAL);break;case 6:a.depthFunc(a.GREATER);break;case 7:a.depthFunc(a.NOTEQUAL);break;default:a.depthFunc(a.LEQUAL)}la=ua}},setLocked:function(ua){N=ua},setClear:function(ua){Aa!==ua&&(a.clearDepth(ua),Aa=ua)},reset:function(){N=!1;Aa=la=da=null}}},F=new function(){let N=!1,da=null,la=null,Aa=null,ua=null,Ha=null,Va=null,Qa=null,nb=null;return{setTest:function(ob){N||(ob?f(a.STENCIL_TEST):g(a.STENCIL_TEST))},setMask:function(ob){da===ob||
N||(a.stencilMask(ob),da=ob)},setFunc:function(ob,Bb,gc){if(la!==ob||Aa!==Bb||ua!==gc)a.stencilFunc(ob,Bb,gc),la=ob,Aa=Bb,ua=gc},setOp:function(ob,Bb,gc){if(Ha!==ob||Va!==Bb||Qa!==gc)a.stencilOp(ob,Bb,gc),Ha=ob,Va=Bb,Qa=gc},setLocked:function(ob){N=ob},setClear:function(ob){nb!==ob&&(a.clearStencil(ob),nb=ob)},reset:function(){N=!1;nb=Qa=Va=Ha=ua=Aa=la=da=null}}},D=new WeakMap,E=new WeakMap;let y={},J={},L=new WeakMap,U=[],P=null,X=!1,ja=null,fa=null,aa=null,pa=null,ba=null,xa=null,qa=null,ta=new Ia(0,
0,0),Ba=0,va=!1,Ga=null,ia=null,wa=null,ra=null,Sa=null;const Da=a.getParameter(a.MAX_COMBINED_TEXTURE_IMAGE_UNITS);let Na=!1;var Ea=0;Ea=a.getParameter(a.VERSION);-1!==Ea.indexOf("WebGL")?(Ea=parseFloat(/^WebGL (\d)/.exec(Ea)[1]),Na=1<=Ea):-1!==Ea.indexOf("OpenGL ES")&&(Ea=parseFloat(/^OpenGL ES (\d)/.exec(Ea)[1]),Na=2<=Ea);let Ta=null,G={};Ea=a.getParameter(a.SCISSOR_BOX);const I=a.getParameter(a.VIEWPORT),Q=(new mb).fromArray(Ea),Y=(new mb).fromArray(I),Z={};Z[a.TEXTURE_2D]=d(a.TEXTURE_2D,a.TEXTURE_2D,
1);Z[a.TEXTURE_CUBE_MAP]=d(a.TEXTURE_CUBE_MAP,a.TEXTURE_CUBE_MAP_POSITIVE_X,6);u&&(Z[a.TEXTURE_2D_ARRAY]=d(a.TEXTURE_2D_ARRAY,a.TEXTURE_2D_ARRAY,1,1),Z[a.TEXTURE_3D]=d(a.TEXTURE_3D,a.TEXTURE_3D,1,1));v.setClear(0,0,0,1);A.setClear(1);F.setClear(0);f(a.DEPTH_TEST);A.setFunc(3);m(!1);n(1);f(a.CULL_FACE);l(0);const Fa={[100]:a.FUNC_ADD,[101]:a.FUNC_SUBTRACT,[102]:a.FUNC_REVERSE_SUBTRACT};u?(Fa[103]=a.MIN,Fa[104]=a.MAX):(Ea=b.get("EXT_blend_minmax"),null!==Ea&&(Fa[103]=Ea.MIN_EXT,Fa[104]=Ea.MAX_EXT));
const Ja={[200]:a.ZERO,[201]:a.ONE,[202]:a.SRC_COLOR,[204]:a.SRC_ALPHA,[210]:a.SRC_ALPHA_SATURATE,[208]:a.DST_COLOR,[206]:a.DST_ALPHA,[203]:a.ONE_MINUS_SRC_COLOR,[205]:a.ONE_MINUS_SRC_ALPHA,[209]:a.ONE_MINUS_DST_COLOR,[207]:a.ONE_MINUS_DST_ALPHA,[211]:a.CONSTANT_COLOR,[212]:a.ONE_MINUS_CONSTANT_COLOR,[213]:a.CONSTANT_ALPHA,[214]:a.ONE_MINUS_CONSTANT_ALPHA};return{buffers:{color:v,depth:A,stencil:F},enable:f,disable:g,bindFramebuffer:function(N,da){return J[N]!==da?(a.bindFramebuffer(N,da),J[N]=da,
u&&(N===a.DRAW_FRAMEBUFFER&&(J[a.FRAMEBUFFER]=da),N===a.FRAMEBUFFER&&(J[a.DRAW_FRAMEBUFFER]=da)),!0):!1},drawBuffers:function(N,da){let la=U,Aa=!1;if(N)if(la=L.get(da),void 0===la&&(la=[],L.set(da,la)),N.isWebGLMultipleRenderTargets){if(N=N.texture,la.length!==N.length||la[0]!==a.COLOR_ATTACHMENT0){for(let ua=0,Ha=N.length;ua<Ha;ua++)la[ua]=a.COLOR_ATTACHMENT0+ua;la.length=N.length;Aa=!0}}else la[0]!==a.COLOR_ATTACHMENT0&&(la[0]=a.COLOR_ATTACHMENT0,Aa=!0);else la[0]!==a.BACK&&(la[0]=a.BACK,Aa=!0);
Aa&&(c.isWebGL2?a.drawBuffers(la):b.get("WEBGL_draw_buffers").drawBuffersWEBGL(la))},useProgram:function(N){return P!==N?(a.useProgram(N),P=N,!0):!1},setBlending:l,setMaterial:function(N,da){2===N.side?g(a.CULL_FACE):f(a.CULL_FACE);let la=1===N.side;da&&(la=!la);m(la);1===N.blending&&!1===N.transparent?l(0):l(N.blending,N.blendEquation,N.blendSrc,N.blendDst,N.blendEquationAlpha,N.blendSrcAlpha,N.blendDstAlpha,N.blendColor,N.blendAlpha,N.premultipliedAlpha);A.setFunc(N.depthFunc);A.setTest(N.depthTest);
A.setMask(N.depthWrite);v.setMask(N.colorWrite);da=N.stencilWrite;F.setTest(da);da&&(F.setMask(N.stencilWriteMask),F.setFunc(N.stencilFunc,N.stencilRef,N.stencilFuncMask),F.setOp(N.stencilFail,N.stencilZFail,N.stencilZPass));t(N.polygonOffset,N.polygonOffsetFactor,N.polygonOffsetUnits);!0===N.alphaToCoverage?f(a.SAMPLE_ALPHA_TO_COVERAGE):g(a.SAMPLE_ALPHA_TO_COVERAGE)},setFlipSided:m,setCullFace:n,setLineWidth:function(N){N!==wa&&(Na&&a.lineWidth(N),wa=N)},setPolygonOffset:t,setScissorTest:function(N){N?
f(a.SCISSOR_TEST):g(a.SCISSOR_TEST)},activeTexture:function(N){void 0===N&&(N=a.TEXTURE0+Da-1);Ta!==N&&(a.activeTexture(N),Ta=N)},bindTexture:function(N,da,la){void 0===la&&(la=null===Ta?a.TEXTURE0+Da-1:Ta);let Aa=G[la];void 0===Aa&&(Aa={type:void 0,texture:void 0},G[la]=Aa);if(Aa.type!==N||Aa.texture!==da)Ta!==la&&(a.activeTexture(la),Ta=la),a.bindTexture(N,da||Z[N]),Aa.type=N,Aa.texture=da},unbindTexture:function(){const N=G[Ta];void 0!==N&&void 0!==N.type&&(a.bindTexture(N.type,null),N.type=void 0,
N.texture=void 0)},compressedTexImage2D:function(){try{a.compressedTexImage2D.apply(a,arguments)}catch(N){console.error("THREE.WebGLState:",N)}},compressedTexImage3D:function(){try{a.compressedTexImage3D.apply(a,arguments)}catch(N){console.error("THREE.WebGLState:",N)}},texImage2D:function(){try{a.texImage2D.apply(a,arguments)}catch(N){console.error("THREE.WebGLState:",N)}},texImage3D:function(){try{a.texImage3D.apply(a,arguments)}catch(N){console.error("THREE.WebGLState:",N)}},updateUBOMapping:function(N,
da){let la=E.get(da);void 0===la&&(la=new WeakMap,E.set(da,la));let Aa=la.get(N);void 0===Aa&&(Aa=a.getUniformBlockIndex(da,N.name),la.set(N,Aa))},uniformBlockBinding:function(N,da){const la=E.get(da).get(N);D.get(da)!==la&&(a.uniformBlockBinding(da,la,N.__bindingPointIndex),D.set(da,la))},texStorage2D:function(){try{a.texStorage2D.apply(a,arguments)}catch(N){console.error("THREE.WebGLState:",N)}},texStorage3D:function(){try{a.texStorage3D.apply(a,arguments)}catch(N){console.error("THREE.WebGLState:",
N)}},texSubImage2D:function(){try{a.texSubImage2D.apply(a,arguments)}catch(N){console.error("THREE.WebGLState:",N)}},texSubImage3D:function(){try{a.texSubImage3D.apply(a,arguments)}catch(N){console.error("THREE.WebGLState:",N)}},compressedTexSubImage2D:function(){try{a.compressedTexSubImage2D.apply(a,arguments)}catch(N){console.error("THREE.WebGLState:",N)}},compressedTexSubImage3D:function(){try{a.compressedTexSubImage3D.apply(a,arguments)}catch(N){console.error("THREE.WebGLState:",N)}},scissor:function(N){!1===
Q.equals(N)&&(a.scissor(N.x,N.y,N.z,N.w),Q.copy(N))},viewport:function(N){!1===Y.equals(N)&&(a.viewport(N.x,N.y,N.z,N.w),Y.copy(N))},reset:function(){a.disable(a.BLEND);a.disable(a.CULL_FACE);a.disable(a.DEPTH_TEST);a.disable(a.POLYGON_OFFSET_FILL);a.disable(a.SCISSOR_TEST);a.disable(a.STENCIL_TEST);a.disable(a.SAMPLE_ALPHA_TO_COVERAGE);a.blendEquation(a.FUNC_ADD);a.blendFunc(a.ONE,a.ZERO);a.blendFuncSeparate(a.ONE,a.ZERO,a.ONE,a.ZERO);a.blendColor(0,0,0,0);a.colorMask(!0,!0,!0,!0);a.clearColor(0,
0,0,0);a.depthMask(!0);a.depthFunc(a.LESS);a.clearDepth(1);a.stencilMask(4294967295);a.stencilFunc(a.ALWAYS,0,4294967295);a.stencilOp(a.KEEP,a.KEEP,a.KEEP);a.clearStencil(0);a.cullFace(a.BACK);a.frontFace(a.CCW);a.polygonOffset(0,0);a.activeTexture(a.TEXTURE0);a.bindFramebuffer(a.FRAMEBUFFER,null);!0===u&&(a.bindFramebuffer(a.DRAW_FRAMEBUFFER,null),a.bindFramebuffer(a.READ_FRAMEBUFFER,null));a.useProgram(null);a.lineWidth(1);a.scissor(0,0,a.canvas.width,a.canvas.height);a.viewport(0,0,a.canvas.width,
a.canvas.height);y={};Ta=null;G={};J={};L=new WeakMap;U=[];P=null;X=!1;qa=xa=ba=pa=aa=fa=ja=null;ta=new Ia(0,0,0);Ba=0;va=!1;Sa=ra=wa=ia=Ga=null;Q.set(0,0,a.canvas.width,a.canvas.height);Y.set(0,0,a.canvas.width,a.canvas.height);v.reset();A.reset();F.reset()}}}function td(a,b,c,d,f,g,l){function m(G,I,Q,Y){var Z=1;if(G.width>Y||G.height>Y)Z=Y/Math.max(G.width,G.height);if(1>Z||!0===I){if("undefined"!==typeof HTMLImageElement&&G instanceof HTMLImageElement||"undefined"!==typeof HTMLCanvasElement&&
G instanceof HTMLCanvasElement||"undefined"!==typeof ImageBitmap&&G instanceof ImageBitmap)return Y=I?Ne:Math.floor,I=Y(Z*G.width),Z=Y(Z*G.height),void 0===wa&&(wa=Sa?new OffscreenCanvas(I,Z):md("canvas")),Q=Q?Sa?new OffscreenCanvas(I,Z):md("canvas"):wa,Q.width=I,Q.height=Z,Q.getContext("2d").drawImage(G,0,0,I,Z),console.warn("THREE.WebGLRenderer: Texture has been resized from ("+G.width+"x"+G.height+") to ("+I+"x"+Z+")."),Q;"data"in G&&console.warn("THREE.WebGLRenderer: Image in DataTexture is too big ("+
G.width+"x"+G.height+").")}return G}function n(G){return Hf(G.width)&&Hf(G.height)}function t(G,I){return G.generateMipmaps&&I&&1003!==G.minFilter&&1006!==G.minFilter}function u(G,I,Q,Y,Z=!1){if(!1===ba)return I;if(null!==G){if(void 0!==a[G])return a[G];console.warn("THREE.WebGLRenderer: Attempt to use non-existing WebGL internal format '"+G+"'")}G=I;I===a.RED&&(Q===a.FLOAT&&(G=a.R32F),Q===a.HALF_FLOAT&&(G=a.R16F),Q===a.UNSIGNED_BYTE&&(G=a.R8));I===a.RED_INTEGER&&(Q===a.UNSIGNED_BYTE&&(G=a.R8UI),
Q===a.UNSIGNED_SHORT&&(G=a.R16UI),Q===a.UNSIGNED_INT&&(G=a.R32UI),Q===a.BYTE&&(G=a.R8I),Q===a.SHORT&&(G=a.R16I),Q===a.INT&&(G=a.R32I));I===a.RG&&(Q===a.FLOAT&&(G=a.RG32F),Q===a.HALF_FLOAT&&(G=a.RG16F),Q===a.UNSIGNED_BYTE&&(G=a.RG8));I===a.RGBA&&(I=Z?"linear":jb.getTransfer(Y),Q===a.FLOAT&&(G=a.RGBA32F),Q===a.HALF_FLOAT&&(G=a.RGBA16F),Q===a.UNSIGNED_BYTE&&(G="srgb"===I?a.SRGB8_ALPHA8:a.RGBA8),Q===a.UNSIGNED_SHORT_4_4_4_4&&(G=a.RGBA4),Q===a.UNSIGNED_SHORT_5_5_5_1&&(G=a.RGB5_A1));G!==a.R16F&&G!==a.R32F&&
G!==a.RG16F&&G!==a.RG32F&&G!==a.RGBA16F&&G!==a.RGBA32F||b.get("EXT_color_buffer_float");return G}function v(G,I,Q){return!0===t(G,Q)||G.isFramebufferTexture&&1003!==G.minFilter&&1006!==G.minFilter?Math.log2(Math.max(I.width,I.height))+1:void 0!==G.mipmaps&&0<G.mipmaps.length?G.mipmaps.length:G.isCompressedTexture&&Array.isArray(G.image)?I.mipmaps.length:1}function A(G){return 1003===G||1004===G||1005===G?a.NEAREST:a.LINEAR}function F(G){G=G.target;G.removeEventListener("dispose",F);var I=d.get(G);
if(void 0!==I.__webglInit){var Q=G.source,Y=ra.get(Q);Y&&(I=Y[I.__cacheKey],I.usedTimes--,0===I.usedTimes&&E(G),0===Object.keys(Y).length&&ra.delete(Q));d.remove(G)}G.isVideoTexture&&ia.delete(G)}function D(G){G=G.target;G.removeEventListener("dispose",D);const I=G.texture;var Q=d.get(G),Y=d.get(I);void 0!==Y.__webglTexture&&(a.deleteTexture(Y.__webglTexture),l.memory.textures--);G.depthTexture&&G.depthTexture.dispose();if(G.isWebGLCubeRenderTarget)for(Y=0;6>Y;Y++){if(Array.isArray(Q.__webglFramebuffer[Y]))for(let Z=
0;Z<Q.__webglFramebuffer[Y].length;Z++)a.deleteFramebuffer(Q.__webglFramebuffer[Y][Z]);else a.deleteFramebuffer(Q.__webglFramebuffer[Y]);Q.__webglDepthbuffer&&a.deleteRenderbuffer(Q.__webglDepthbuffer[Y])}else{if(Array.isArray(Q.__webglFramebuffer))for(Y=0;Y<Q.__webglFramebuffer.length;Y++)a.deleteFramebuffer(Q.__webglFramebuffer[Y]);else a.deleteFramebuffer(Q.__webglFramebuffer);Q.__webglDepthbuffer&&a.deleteRenderbuffer(Q.__webglDepthbuffer);Q.__webglMultisampledFramebuffer&&a.deleteFramebuffer(Q.__webglMultisampledFramebuffer);
if(Q.__webglColorRenderbuffer)for(Y=0;Y<Q.__webglColorRenderbuffer.length;Y++)Q.__webglColorRenderbuffer[Y]&&a.deleteRenderbuffer(Q.__webglColorRenderbuffer[Y]);Q.__webglDepthRenderbuffer&&a.deleteRenderbuffer(Q.__webglDepthRenderbuffer)}if(G.isWebGLMultipleRenderTargets)for(let Z=0,Fa=I.length;Z<Fa;Z++)Q=d.get(I[Z]),Q.__webglTexture&&(a.deleteTexture(Q.__webglTexture),l.memory.textures--),d.remove(I[Z]);d.remove(I);d.remove(G)}function E(G){const I=d.get(G);a.deleteTexture(I.__webglTexture);delete ra.get(G.source)[I.__cacheKey];
l.memory.textures--}function y(G,I){const Q=d.get(G);if(G.isVideoTexture){var Y=l.render.frame;ia.get(G)!==Y&&(ia.set(G,Y),G.update())}if(!1===G.isRenderTargetTexture&&0<G.version&&Q.__version!==G.version)if(Y=G.image,null===Y)console.warn("THREE.WebGLRenderer: Texture marked for update but no image data found.");else if(!1===Y.complete)console.warn("THREE.WebGLRenderer: Texture marked for update but image is incomplete");else{U(Q,G,I);return}c.bindTexture(a.TEXTURE_2D,Q.__webglTexture,a.TEXTURE0+
I)}function J(G,I,Q){Q?(a.texParameteri(G,a.TEXTURE_WRAP_S,Na[I.wrapS]),a.texParameteri(G,a.TEXTURE_WRAP_T,Na[I.wrapT]),G!==a.TEXTURE_3D&&G!==a.TEXTURE_2D_ARRAY||a.texParameteri(G,a.TEXTURE_WRAP_R,Na[I.wrapR]),a.texParameteri(G,a.TEXTURE_MAG_FILTER,Ea[I.magFilter]),a.texParameteri(G,a.TEXTURE_MIN_FILTER,Ea[I.minFilter])):(a.texParameteri(G,a.TEXTURE_WRAP_S,a.CLAMP_TO_EDGE),a.texParameteri(G,a.TEXTURE_WRAP_T,a.CLAMP_TO_EDGE),G!==a.TEXTURE_3D&&G!==a.TEXTURE_2D_ARRAY||a.texParameteri(G,a.TEXTURE_WRAP_R,
a.CLAMP_TO_EDGE),1001===I.wrapS&&1001===I.wrapT||console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.wrapS and Texture.wrapT should be set to THREE.ClampToEdgeWrapping."),a.texParameteri(G,a.TEXTURE_MAG_FILTER,A(I.magFilter)),a.texParameteri(G,a.TEXTURE_MIN_FILTER,A(I.minFilter)),1003!==I.minFilter&&1006!==I.minFilter&&console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.minFilter should be set to THREE.NearestFilter or THREE.LinearFilter."));I.compareFunction&&
(a.texParameteri(G,a.TEXTURE_COMPARE_MODE,a.COMPARE_REF_TO_TEXTURE),a.texParameteri(G,a.TEXTURE_COMPARE_FUNC,Ta[I.compareFunction]));!0===b.has("EXT_texture_filter_anisotropic")&&(Q=b.get("EXT_texture_filter_anisotropic"),1003===I.magFilter||1005!==I.minFilter&&1008!==I.minFilter||1015===I.type&&!1===b.has("OES_texture_float_linear")||!1===ba&&1016===I.type&&!1===b.has("OES_texture_half_float_linear")||!(1<I.anisotropy||d.get(I).__currentAnisotropy)||(a.texParameterf(G,Q.TEXTURE_MAX_ANISOTROPY_EXT,
Math.min(I.anisotropy,f.getMaxAnisotropy())),d.get(I).__currentAnisotropy=I.anisotropy))}function L(G,I){let Q=!1;void 0===G.__webglInit&&(G.__webglInit=!0,I.addEventListener("dispose",F));var Y=I.source;let Z=ra.get(Y);void 0===Z&&(Z={},ra.set(Y,Z));Y=[];Y.push(I.wrapS);Y.push(I.wrapT);Y.push(I.wrapR||0);Y.push(I.magFilter);Y.push(I.minFilter);Y.push(I.anisotropy);Y.push(I.internalFormat);Y.push(I.format);Y.push(I.type);Y.push(I.generateMipmaps);Y.push(I.premultiplyAlpha);Y.push(I.flipY);Y.push(I.unpackAlignment);
Y.push(I.colorSpace);Y=Y.join();if(Y!==G.__cacheKey){void 0===Z[Y]&&(Z[Y]={texture:a.createTexture(),usedTimes:0},l.memory.textures++,Q=!0);Z[Y].usedTimes++;const Fa=Z[G.__cacheKey];void 0!==Fa&&(Z[G.__cacheKey].usedTimes--,0===Fa.usedTimes&&E(I));G.__cacheKey=Y;G.__webglTexture=Z[Y].texture}return Q}function U(G,I,Q){let Y=a.TEXTURE_2D;if(I.isDataArrayTexture||I.isCompressedArrayTexture)Y=a.TEXTURE_2D_ARRAY;I.isData3DTexture&&(Y=a.TEXTURE_3D);var Z=L(G,I);const Fa=I.source;c.bindTexture(Y,G.__webglTexture,
a.TEXTURE0+Q);const Ja=d.get(Fa);if(Fa.version!==Ja.__version||!0===Z){c.activeTexture(a.TEXTURE0+Q);Q=jb.getPrimaries(jb.workingColorSpace);var N=""===I.colorSpace?null:jb.getPrimaries(I.colorSpace);Q=""===I.colorSpace||Q===N?a.NONE:a.BROWSER_DEFAULT_WEBGL;a.pixelStorei(a.UNPACK_FLIP_Y_WEBGL,I.flipY);a.pixelStorei(a.UNPACK_PREMULTIPLY_ALPHA_WEBGL,I.premultiplyAlpha);a.pixelStorei(a.UNPACK_ALIGNMENT,I.unpackAlignment);a.pixelStorei(a.UNPACK_COLORSPACE_CONVERSION_WEBGL,Q);Q=ba?!1:1001!==I.wrapS||1001!==
I.wrapT||1003!==I.minFilter&&1006!==I.minFilter;Q=Q&&!1===n(I.image);var da=m(I.image,Q,!1,ta);da=pa(I,da);Q=n(da)||ba;N=g.convert(I.format,I.colorSpace);let ua=g.convert(I.type),Ha=u(I.internalFormat,N,ua,I.colorSpace,I.isVideoTexture);J(Y,I,Q);var la=I.mipmaps,Aa=ba&&!0!==I.isVideoTexture;const Va=void 0===Ja.__version||!0===Z;Z=v(I,da,Q);if(I.isDepthTexture)Ha=a.DEPTH_COMPONENT,ba?Ha=1015===I.type?a.DEPTH_COMPONENT32F:1014===I.type?a.DEPTH_COMPONENT24:1020===I.type?a.DEPTH24_STENCIL8:a.DEPTH_COMPONENT16:
1015===I.type&&console.error("WebGLRenderer: Floating point depth texture requires WebGL2."),1026===I.format&&Ha===a.DEPTH_COMPONENT&&1012!==I.type&&1014!==I.type&&(console.warn("THREE.WebGLRenderer: Use UnsignedShortType or UnsignedIntType for DepthFormat DepthTexture."),I.type=1014,ua=g.convert(I.type)),1027===I.format&&Ha===a.DEPTH_COMPONENT&&(Ha=a.DEPTH_STENCIL,1020!==I.type&&(console.warn("THREE.WebGLRenderer: Use UnsignedInt248Type for DepthStencilFormat DepthTexture."),I.type=1020,ua=g.convert(I.type))),
Va&&(Aa?c.texStorage2D(a.TEXTURE_2D,1,Ha,da.width,da.height):c.texImage2D(a.TEXTURE_2D,0,Ha,da.width,da.height,0,N,ua,null));else if(I.isDataTexture)if(0<la.length&&Q){Aa&&Va&&c.texStorage2D(a.TEXTURE_2D,Z,Ha,la[0].width,la[0].height);for(let Qa=0,nb=la.length;Qa<nb;Qa++)Z=la[Qa],Aa?c.texSubImage2D(a.TEXTURE_2D,Qa,0,0,Z.width,Z.height,N,ua,Z.data):c.texImage2D(a.TEXTURE_2D,Qa,Ha,Z.width,Z.height,0,N,ua,Z.data);I.generateMipmaps=!1}else Aa?(Va&&c.texStorage2D(a.TEXTURE_2D,Z,Ha,da.width,da.height),
c.texSubImage2D(a.TEXTURE_2D,0,0,0,da.width,da.height,N,ua,da.data)):c.texImage2D(a.TEXTURE_2D,0,Ha,da.width,da.height,0,N,ua,da.data);else if(I.isCompressedTexture)if(I.isCompressedArrayTexture){Aa&&Va&&c.texStorage3D(a.TEXTURE_2D_ARRAY,Z,Ha,la[0].width,la[0].height,da.depth);for(let Qa=0,nb=la.length;Qa<nb;Qa++)Z=la[Qa],1023!==I.format?null!==N?Aa?c.compressedTexSubImage3D(a.TEXTURE_2D_ARRAY,Qa,0,0,0,Z.width,Z.height,da.depth,N,Z.data,0,0):c.compressedTexImage3D(a.TEXTURE_2D_ARRAY,Qa,Ha,Z.width,
Z.height,da.depth,0,Z.data,0,0):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):Aa?c.texSubImage3D(a.TEXTURE_2D_ARRAY,Qa,0,0,0,Z.width,Z.height,da.depth,N,ua,Z.data):c.texImage3D(a.TEXTURE_2D_ARRAY,Qa,Ha,Z.width,Z.height,da.depth,0,N,ua,Z.data)}else{Aa&&Va&&c.texStorage2D(a.TEXTURE_2D,Z,Ha,la[0].width,la[0].height);for(let Qa=0,nb=la.length;Qa<nb;Qa++)Z=la[Qa],1023!==I.format?null!==N?Aa?c.compressedTexSubImage2D(a.TEXTURE_2D,Qa,0,0,Z.width,
Z.height,N,Z.data):c.compressedTexImage2D(a.TEXTURE_2D,Qa,Ha,Z.width,Z.height,0,Z.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):Aa?c.texSubImage2D(a.TEXTURE_2D,Qa,0,0,Z.width,Z.height,N,ua,Z.data):c.texImage2D(a.TEXTURE_2D,Qa,Ha,Z.width,Z.height,0,N,ua,Z.data)}else if(I.isDataArrayTexture)Aa?(Va&&c.texStorage3D(a.TEXTURE_2D_ARRAY,Z,Ha,da.width,da.height,da.depth),c.texSubImage3D(a.TEXTURE_2D_ARRAY,0,0,0,0,da.width,da.height,da.depth,
N,ua,da.data)):c.texImage3D(a.TEXTURE_2D_ARRAY,0,Ha,da.width,da.height,da.depth,0,N,ua,da.data);else if(I.isData3DTexture)Aa?(Va&&c.texStorage3D(a.TEXTURE_3D,Z,Ha,da.width,da.height,da.depth),c.texSubImage3D(a.TEXTURE_3D,0,0,0,0,da.width,da.height,da.depth,N,ua,da.data)):c.texImage3D(a.TEXTURE_3D,0,Ha,da.width,da.height,da.depth,0,N,ua,da.data);else if(I.isFramebufferTexture){if(Va)if(Aa)c.texStorage2D(a.TEXTURE_2D,Z,Ha,da.width,da.height);else for(la=da.width,da=da.height,Aa=0;Aa<Z;Aa++)c.texImage2D(a.TEXTURE_2D,
Aa,Ha,la,da,0,N,ua,null),la>>=1,da>>=1}else if(0<la.length&&Q){Aa&&Va&&c.texStorage2D(a.TEXTURE_2D,Z,Ha,la[0].width,la[0].height);for(let Qa=0,nb=la.length;Qa<nb;Qa++)Z=la[Qa],Aa?c.texSubImage2D(a.TEXTURE_2D,Qa,0,0,N,ua,Z):c.texImage2D(a.TEXTURE_2D,Qa,Ha,N,ua,Z);I.generateMipmaps=!1}else Aa?(Va&&c.texStorage2D(a.TEXTURE_2D,Z,Ha,da.width,da.height),c.texSubImage2D(a.TEXTURE_2D,0,0,0,N,ua,da)):c.texImage2D(a.TEXTURE_2D,0,Ha,N,ua,da);t(I,Q)&&a.generateMipmap(Y);Ja.__version=Fa.version;if(I.onUpdate)I.onUpdate(I)}G.__version=
I.version}function P(G,I,Q,Y,Z,Fa){const Ja=g.convert(Q.format,Q.colorSpace),N=g.convert(Q.type),da=u(Q.internalFormat,Ja,N,Q.colorSpace);if(!d.get(I).__hasExternalTextures){const la=Math.max(1,I.width>>Fa),Aa=Math.max(1,I.height>>Fa);Z===a.TEXTURE_3D||Z===a.TEXTURE_2D_ARRAY?c.texImage3D(Z,Fa,da,la,Aa,I.depth,0,Ja,N,null):c.texImage2D(Z,Fa,da,la,Aa,0,Ja,N,null)}c.bindFramebuffer(a.FRAMEBUFFER,G);aa(I)?va.framebufferTexture2DMultisampleEXT(a.FRAMEBUFFER,Y,Z,d.get(Q).__webglTexture,0,fa(I)):(Z===a.TEXTURE_2D||
Z>=a.TEXTURE_CUBE_MAP_POSITIVE_X&&Z<=a.TEXTURE_CUBE_MAP_NEGATIVE_Z)&&a.framebufferTexture2D(a.FRAMEBUFFER,Y,Z,d.get(Q).__webglTexture,Fa);c.bindFramebuffer(a.FRAMEBUFFER,null)}function X(G,I,Q){a.bindRenderbuffer(a.RENDERBUFFER,G);if(I.depthBuffer&&!I.stencilBuffer){var Y=!0===ba?a.DEPTH_COMPONENT24:a.DEPTH_COMPONENT16;Q||aa(I)?((Q=I.depthTexture)&&Q.isDepthTexture&&(1015===Q.type?Y=a.DEPTH_COMPONENT32F:1014===Q.type&&(Y=a.DEPTH_COMPONENT24)),Q=fa(I),aa(I)?va.renderbufferStorageMultisampleEXT(a.RENDERBUFFER,
Q,Y,I.width,I.height):a.renderbufferStorageMultisample(a.RENDERBUFFER,Q,Y,I.width,I.height)):a.renderbufferStorage(a.RENDERBUFFER,Y,I.width,I.height);a.framebufferRenderbuffer(a.FRAMEBUFFER,a.DEPTH_ATTACHMENT,a.RENDERBUFFER,G)}else if(I.depthBuffer&&I.stencilBuffer)Y=fa(I),Q&&!1===aa(I)?a.renderbufferStorageMultisample(a.RENDERBUFFER,Y,a.DEPTH24_STENCIL8,I.width,I.height):aa(I)?va.renderbufferStorageMultisampleEXT(a.RENDERBUFFER,Y,a.DEPTH24_STENCIL8,I.width,I.height):a.renderbufferStorage(a.RENDERBUFFER,
a.DEPTH_STENCIL,I.width,I.height),a.framebufferRenderbuffer(a.FRAMEBUFFER,a.DEPTH_STENCIL_ATTACHMENT,a.RENDERBUFFER,G);else for(G=!0===I.isWebGLMultipleRenderTargets?I.texture:[I.texture],Y=0;Y<G.length;Y++){var Z=G[Y],Fa=g.convert(Z.format,Z.colorSpace);const Ja=g.convert(Z.type);Z=u(Z.internalFormat,Fa,Ja,Z.colorSpace);Fa=fa(I);Q&&!1===aa(I)?a.renderbufferStorageMultisample(a.RENDERBUFFER,Fa,Z,I.width,I.height):aa(I)?va.renderbufferStorageMultisampleEXT(a.RENDERBUFFER,Fa,Z,I.width,I.height):a.renderbufferStorage(a.RENDERBUFFER,
Z,I.width,I.height)}a.bindRenderbuffer(a.RENDERBUFFER,null)}function ja(G){var I=d.get(G),Q=!0===G.isWebGLCubeRenderTarget;if(G.depthTexture&&!I.__autoAllocateDepthBuffer){if(Q)throw Error("target.depthTexture not supported in Cube render targets");if(G&&G.isWebGLCubeRenderTarget)throw Error("Depth Texture with cube render targets is not supported");c.bindFramebuffer(a.FRAMEBUFFER,I.__webglFramebuffer);if(!G.depthTexture||!G.depthTexture.isDepthTexture)throw Error("renderTarget.depthTexture must be an instance of THREE.DepthTexture");
d.get(G.depthTexture).__webglTexture&&G.depthTexture.image.width===G.width&&G.depthTexture.image.height===G.height||(G.depthTexture.image.width=G.width,G.depthTexture.image.height=G.height,G.depthTexture.needsUpdate=!0);y(G.depthTexture,0);I=d.get(G.depthTexture).__webglTexture;Q=fa(G);if(1026===G.depthTexture.format)aa(G)?va.framebufferTexture2DMultisampleEXT(a.FRAMEBUFFER,a.DEPTH_ATTACHMENT,a.TEXTURE_2D,I,0,Q):a.framebufferTexture2D(a.FRAMEBUFFER,a.DEPTH_ATTACHMENT,a.TEXTURE_2D,I,0);else if(1027===
G.depthTexture.format)aa(G)?va.framebufferTexture2DMultisampleEXT(a.FRAMEBUFFER,a.DEPTH_STENCIL_ATTACHMENT,a.TEXTURE_2D,I,0,Q):a.framebufferTexture2D(a.FRAMEBUFFER,a.DEPTH_STENCIL_ATTACHMENT,a.TEXTURE_2D,I,0);else throw Error("Unknown depthTexture format");}else if(Q)for(I.__webglDepthbuffer=[],Q=0;6>Q;Q++)c.bindFramebuffer(a.FRAMEBUFFER,I.__webglFramebuffer[Q]),I.__webglDepthbuffer[Q]=a.createRenderbuffer(),X(I.__webglDepthbuffer[Q],G,!1);else c.bindFramebuffer(a.FRAMEBUFFER,I.__webglFramebuffer),
I.__webglDepthbuffer=a.createRenderbuffer(),X(I.__webglDepthbuffer,G,!1);c.bindFramebuffer(a.FRAMEBUFFER,null)}function fa(G){return Math.min(Ba,G.samples)}function aa(G){const I=d.get(G);return ba&&0<G.samples&&!0===b.has("WEBGL_multisampled_render_to_texture")&&!1!==I.__useRenderToTexture}function pa(G,I){const Q=G.colorSpace,Y=G.format,Z=G.type;if(!0===G.isCompressedTexture||!0===G.isVideoTexture||1035===G.format)return I;"srgb-linear"!==Q&&""!==Q&&("srgb"===jb.getTransfer(Q)?!1===ba?!0===b.has("EXT_sRGB")&&
1023===Y?(G.format=1035,G.minFilter=1006,G.generateMipmaps=!1):I=If.sRGBToLinear(I):1023===Y&&1009===Z||console.warn("THREE.WebGLTextures: sRGB encoded textures have to use RGBAFormat and UnsignedByteType."):console.error("THREE.WebGLTextures: Unsupported texture color space:",Q));return I}const ba=f.isWebGL2,xa=f.maxTextures,qa=f.maxCubemapSize,ta=f.maxTextureSize,Ba=f.maxSamples,va=b.has("WEBGL_multisampled_render_to_texture")?b.get("WEBGL_multisampled_render_to_texture"):null,Ga="undefined"===
typeof navigator?!1:/OculusBrowser/g.test(navigator.userAgent),ia=new WeakMap;let wa;const ra=new WeakMap;let Sa=!1;try{Sa="undefined"!==typeof OffscreenCanvas&&null!==(new OffscreenCanvas(1,1)).getContext("2d")}catch(G){}let Da=0;const Na={[1E3]:a.REPEAT,[1001]:a.CLAMP_TO_EDGE,[1002]:a.MIRRORED_REPEAT},Ea={[1003]:a.NEAREST,[1004]:a.NEAREST_MIPMAP_NEAREST,[1005]:a.NEAREST_MIPMAP_LINEAR,[1006]:a.LINEAR,[1007]:a.LINEAR_MIPMAP_NEAREST,[1008]:a.LINEAR_MIPMAP_LINEAR},Ta={[512]:a.NEVER,[519]:a.ALWAYS,[513]:a.LESS,
[515]:a.LEQUAL,[514]:a.EQUAL,[518]:a.GEQUAL,[516]:a.GREATER,[517]:a.NOTEQUAL};this.allocateTextureUnit=function(){const G=Da;G>=xa&&console.warn("THREE.WebGLTextures: Trying to use "+G+" texture units while this GPU supports only "+xa);Da+=1;return G};this.resetTextureUnits=function(){Da=0};this.setTexture2D=y;this.setTexture2DArray=function(G,I){const Q=d.get(G);0<G.version&&Q.__version!==G.version?U(Q,G,I):c.bindTexture(a.TEXTURE_2D_ARRAY,Q.__webglTexture,a.TEXTURE0+I)};this.setTexture3D=function(G,
I){const Q=d.get(G);0<G.version&&Q.__version!==G.version?U(Q,G,I):c.bindTexture(a.TEXTURE_3D,Q.__webglTexture,a.TEXTURE0+I)};this.setTextureCube=function(G,I){const Q=d.get(G);if(0<G.version&&Q.__version!==G.version){if(6===G.image.length){var Y=L(Q,G),Z=G.source;c.bindTexture(a.TEXTURE_CUBE_MAP,Q.__webglTexture,a.TEXTURE0+I);var Fa=d.get(Z);if(Z.version!==Fa.__version||!0===Y){c.activeTexture(a.TEXTURE0+I);I=jb.getPrimaries(jb.workingColorSpace);var Ja=""===G.colorSpace?null:jb.getPrimaries(G.colorSpace);
I=""===G.colorSpace||I===Ja?a.NONE:a.BROWSER_DEFAULT_WEBGL;a.pixelStorei(a.UNPACK_FLIP_Y_WEBGL,G.flipY);a.pixelStorei(a.UNPACK_PREMULTIPLY_ALPHA_WEBGL,G.premultiplyAlpha);a.pixelStorei(a.UNPACK_ALIGNMENT,G.unpackAlignment);a.pixelStorei(a.UNPACK_COLORSPACE_CONVERSION_WEBGL,I);var N=G.isCompressedTexture||G.image[0].isCompressedTexture,da=G.image[0]&&G.image[0].isDataTexture;I=[];for(Ja=0;6>Ja;Ja++)I[Ja]=N||da?da?G.image[Ja].image:G.image[Ja]:m(G.image[Ja],!1,!0,qa),I[Ja]=pa(G,I[Ja]);var la=I[0];Ja=
n(la)||ba;const ua=g.convert(G.format,G.colorSpace),Ha=g.convert(G.type),Va=u(G.internalFormat,ua,Ha,G.colorSpace),Qa=ba&&!0!==G.isVideoTexture;var Aa=void 0===Fa.__version||!0===Y;let nb=v(G,la,Ja);J(a.TEXTURE_CUBE_MAP,G,Ja);if(N)for(Qa&&Aa&&c.texStorage2D(a.TEXTURE_CUBE_MAP,nb,Va,la.width,la.height),da=0;6>da;da++)for(Y=I[da].mipmaps,N=0;N<Y.length;N++)la=Y[N],1023!==G.format?null!==ua?Qa?c.compressedTexSubImage2D(a.TEXTURE_CUBE_MAP_POSITIVE_X+da,N,0,0,la.width,la.height,ua,la.data):c.compressedTexImage2D(a.TEXTURE_CUBE_MAP_POSITIVE_X+
da,N,Va,la.width,la.height,0,la.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .setTextureCube()"):Qa?c.texSubImage2D(a.TEXTURE_CUBE_MAP_POSITIVE_X+da,N,0,0,la.width,la.height,ua,Ha,la.data):c.texImage2D(a.TEXTURE_CUBE_MAP_POSITIVE_X+da,N,Va,la.width,la.height,0,ua,Ha,la.data);else for(Y=G.mipmaps,Qa&&Aa&&(0<Y.length&&nb++,c.texStorage2D(a.TEXTURE_CUBE_MAP,nb,Va,I[0].width,I[0].height)),N=0;6>N;N++)if(da)for(Qa?c.texSubImage2D(a.TEXTURE_CUBE_MAP_POSITIVE_X+
N,0,0,0,I[N].width,I[N].height,ua,Ha,I[N].data):c.texImage2D(a.TEXTURE_CUBE_MAP_POSITIVE_X+N,0,Va,I[N].width,I[N].height,0,ua,Ha,I[N].data),la=0;la<Y.length;la++)Aa=Y[la].image[N].image,Qa?c.texSubImage2D(a.TEXTURE_CUBE_MAP_POSITIVE_X+N,la+1,0,0,Aa.width,Aa.height,ua,Ha,Aa.data):c.texImage2D(a.TEXTURE_CUBE_MAP_POSITIVE_X+N,la+1,Va,Aa.width,Aa.height,0,ua,Ha,Aa.data);else for(Qa?c.texSubImage2D(a.TEXTURE_CUBE_MAP_POSITIVE_X+N,0,0,0,ua,Ha,I[N]):c.texImage2D(a.TEXTURE_CUBE_MAP_POSITIVE_X+N,0,Va,ua,Ha,
I[N]),la=0;la<Y.length;la++)Aa=Y[la],Qa?c.texSubImage2D(a.TEXTURE_CUBE_MAP_POSITIVE_X+N,la+1,0,0,ua,Ha,Aa.image[N]):c.texImage2D(a.TEXTURE_CUBE_MAP_POSITIVE_X+N,la+1,Va,ua,Ha,Aa.image[N]);t(G,Ja)&&a.generateMipmap(a.TEXTURE_CUBE_MAP);Fa.__version=Z.version;if(G.onUpdate)G.onUpdate(G)}Q.__version=G.version}}else c.bindTexture(a.TEXTURE_CUBE_MAP,Q.__webglTexture,a.TEXTURE0+I)};this.rebindTextures=function(G,I,Q){const Y=d.get(G);void 0!==I&&P(Y.__webglFramebuffer,G,G.texture,a.COLOR_ATTACHMENT0,a.TEXTURE_2D,
0);void 0!==Q&&ja(G)};this.setupRenderTarget=function(G){var I=G.texture;const Q=d.get(G);var Y=d.get(I);G.addEventListener("dispose",D);!0!==G.isWebGLMultipleRenderTargets&&(void 0===Y.__webglTexture&&(Y.__webglTexture=a.createTexture()),Y.__version=I.version,l.memory.textures++);var Z=!0===G.isWebGLCubeRenderTarget;const Fa=!0===G.isWebGLMultipleRenderTargets,Ja=n(G)||ba;if(Z){Q.__webglFramebuffer=[];for(var N=0;6>N;N++)if(ba&&I.mipmaps&&0<I.mipmaps.length){Q.__webglFramebuffer[N]=[];for(var da=
0;da<I.mipmaps.length;da++)Q.__webglFramebuffer[N][da]=a.createFramebuffer()}else Q.__webglFramebuffer[N]=a.createFramebuffer()}else{if(ba&&I.mipmaps&&0<I.mipmaps.length)for(Q.__webglFramebuffer=[],N=0;N<I.mipmaps.length;N++)Q.__webglFramebuffer[N]=a.createFramebuffer();else Q.__webglFramebuffer=a.createFramebuffer();if(Fa)if(f.drawBuffers){N=G.texture;for(let ua=0,Ha=N.length;ua<Ha;ua++)da=d.get(N[ua]),void 0===da.__webglTexture&&(da.__webglTexture=a.createTexture(),l.memory.textures++)}else console.warn("THREE.WebGLRenderer: WebGLMultipleRenderTargets can only be used with WebGL2 or WEBGL_draw_buffers extension.");
if(ba&&0<G.samples&&!1===aa(G)){N=Fa?I:[I];Q.__webglMultisampledFramebuffer=a.createFramebuffer();Q.__webglColorRenderbuffer=[];c.bindFramebuffer(a.FRAMEBUFFER,Q.__webglMultisampledFramebuffer);for(da=0;da<N.length;da++){var la=N[da];Q.__webglColorRenderbuffer[da]=a.createRenderbuffer();a.bindRenderbuffer(a.RENDERBUFFER,Q.__webglColorRenderbuffer[da]);var Aa=g.convert(la.format,la.colorSpace);const ua=g.convert(la.type);la=u(la.internalFormat,Aa,ua,la.colorSpace,!0===G.isXRRenderTarget);Aa=fa(G);
a.renderbufferStorageMultisample(a.RENDERBUFFER,Aa,la,G.width,G.height);a.framebufferRenderbuffer(a.FRAMEBUFFER,a.COLOR_ATTACHMENT0+da,a.RENDERBUFFER,Q.__webglColorRenderbuffer[da])}a.bindRenderbuffer(a.RENDERBUFFER,null);G.depthBuffer&&(Q.__webglDepthRenderbuffer=a.createRenderbuffer(),X(Q.__webglDepthRenderbuffer,G,!0));c.bindFramebuffer(a.FRAMEBUFFER,null)}}if(Z){c.bindTexture(a.TEXTURE_CUBE_MAP,Y.__webglTexture);J(a.TEXTURE_CUBE_MAP,I,Ja);for(Y=0;6>Y;Y++)if(ba&&I.mipmaps&&0<I.mipmaps.length)for(Z=
0;Z<I.mipmaps.length;Z++)P(Q.__webglFramebuffer[Y][Z],G,I,a.COLOR_ATTACHMENT0,a.TEXTURE_CUBE_MAP_POSITIVE_X+Y,Z);else P(Q.__webglFramebuffer[Y],G,I,a.COLOR_ATTACHMENT0,a.TEXTURE_CUBE_MAP_POSITIVE_X+Y,0);t(I,Ja)&&a.generateMipmap(a.TEXTURE_CUBE_MAP)}else if(Fa){I=G.texture;for(let ua=0,Ha=I.length;ua<Ha;ua++)Y=I[ua],Z=d.get(Y),c.bindTexture(a.TEXTURE_2D,Z.__webglTexture),J(a.TEXTURE_2D,Y,Ja),P(Q.__webglFramebuffer,G,Y,a.COLOR_ATTACHMENT0+ua,a.TEXTURE_2D,0),t(Y,Ja)&&a.generateMipmap(a.TEXTURE_2D)}else{Z=
a.TEXTURE_2D;if(G.isWebGL3DRenderTarget||G.isWebGLArrayRenderTarget)ba?Z=G.isWebGL3DRenderTarget?a.TEXTURE_3D:a.TEXTURE_2D_ARRAY:console.error("THREE.WebGLTextures: THREE.Data3DTexture and THREE.DataArrayTexture only supported with WebGL2.");c.bindTexture(Z,Y.__webglTexture);J(Z,I,Ja);if(ba&&I.mipmaps&&0<I.mipmaps.length)for(Y=0;Y<I.mipmaps.length;Y++)P(Q.__webglFramebuffer[Y],G,I,a.COLOR_ATTACHMENT0,Z,Y);else P(Q.__webglFramebuffer,G,I,a.COLOR_ATTACHMENT0,Z,0);t(I,Ja)&&a.generateMipmap(Z)}c.unbindTexture();
G.depthBuffer&&ja(G)};this.updateRenderTargetMipmap=function(G){const I=n(G)||ba,Q=!0===G.isWebGLMultipleRenderTargets?G.texture:[G.texture];for(let Z=0,Fa=Q.length;Z<Fa;Z++){var Y=Q[Z];if(t(Y,I)){const Ja=G.isWebGLCubeRenderTarget?a.TEXTURE_CUBE_MAP:a.TEXTURE_2D;Y=d.get(Y).__webglTexture;c.bindTexture(Ja,Y);a.generateMipmap(Ja);c.unbindTexture()}}};this.updateMultisampleRenderTarget=function(G){if(ba&&0<G.samples&&!1===aa(G)){const Z=G.isWebGLMultipleRenderTargets?G.texture:[G.texture];var I=G.width;
const Fa=G.height;let Ja=a.COLOR_BUFFER_BIT;const N=[],da=G.stencilBuffer?a.DEPTH_STENCIL_ATTACHMENT:a.DEPTH_ATTACHMENT,la=d.get(G),Aa=!0===G.isWebGLMultipleRenderTargets;if(Aa)for(var Q=0;Q<Z.length;Q++)c.bindFramebuffer(a.FRAMEBUFFER,la.__webglMultisampledFramebuffer),a.framebufferRenderbuffer(a.FRAMEBUFFER,a.COLOR_ATTACHMENT0+Q,a.RENDERBUFFER,null),c.bindFramebuffer(a.FRAMEBUFFER,la.__webglFramebuffer),a.framebufferTexture2D(a.DRAW_FRAMEBUFFER,a.COLOR_ATTACHMENT0+Q,a.TEXTURE_2D,null,0);c.bindFramebuffer(a.READ_FRAMEBUFFER,
la.__webglMultisampledFramebuffer);c.bindFramebuffer(a.DRAW_FRAMEBUFFER,la.__webglFramebuffer);for(Q=0;Q<Z.length;Q++){N.push(a.COLOR_ATTACHMENT0+Q);G.depthBuffer&&N.push(da);var Y=void 0!==la.__ignoreDepthValues?la.__ignoreDepthValues:!1;!1===Y&&(G.depthBuffer&&(Ja|=a.DEPTH_BUFFER_BIT),G.stencilBuffer&&(Ja|=a.STENCIL_BUFFER_BIT));Aa&&a.framebufferRenderbuffer(a.READ_FRAMEBUFFER,a.COLOR_ATTACHMENT0,a.RENDERBUFFER,la.__webglColorRenderbuffer[Q]);!0===Y&&(a.invalidateFramebuffer(a.READ_FRAMEBUFFER,
[da]),a.invalidateFramebuffer(a.DRAW_FRAMEBUFFER,[da]));Aa&&(Y=d.get(Z[Q]).__webglTexture,a.framebufferTexture2D(a.DRAW_FRAMEBUFFER,a.COLOR_ATTACHMENT0,a.TEXTURE_2D,Y,0));a.blitFramebuffer(0,0,I,Fa,0,0,I,Fa,Ja,a.NEAREST);Ga&&a.invalidateFramebuffer(a.READ_FRAMEBUFFER,N)}c.bindFramebuffer(a.READ_FRAMEBUFFER,null);c.bindFramebuffer(a.DRAW_FRAMEBUFFER,null);if(Aa)for(G=0;G<Z.length;G++)c.bindFramebuffer(a.FRAMEBUFFER,la.__webglMultisampledFramebuffer),a.framebufferRenderbuffer(a.FRAMEBUFFER,a.COLOR_ATTACHMENT0+
G,a.RENDERBUFFER,la.__webglColorRenderbuffer[G]),I=d.get(Z[G]).__webglTexture,c.bindFramebuffer(a.FRAMEBUFFER,la.__webglFramebuffer),a.framebufferTexture2D(a.DRAW_FRAMEBUFFER,a.COLOR_ATTACHMENT0+G,a.TEXTURE_2D,I,0);c.bindFramebuffer(a.DRAW_FRAMEBUFFER,la.__webglMultisampledFramebuffer)}};this.setupDepthRenderbuffer=ja;this.setupFrameBufferTexture=P;this.useMultisampledRTT=aa}function bh(a,b,c){const d=c.isWebGL2;return{convert:function(f,g=""){const l=jb.getTransfer(g);if(1009===f)return a.UNSIGNED_BYTE;
if(1017===f)return a.UNSIGNED_SHORT_4_4_4_4;if(1018===f)return a.UNSIGNED_SHORT_5_5_5_1;if(1010===f)return a.BYTE;if(1011===f)return a.SHORT;if(1012===f)return a.UNSIGNED_SHORT;if(1013===f)return a.INT;if(1014===f)return a.UNSIGNED_INT;if(1015===f)return a.FLOAT;if(1016===f){if(d)return a.HALF_FLOAT;g=b.get("OES_texture_half_float");return null!==g?g.HALF_FLOAT_OES:null}if(1021===f)return a.ALPHA;if(1023===f)return a.RGBA;if(1024===f)return a.LUMINANCE;if(1025===f)return a.LUMINANCE_ALPHA;if(1026===
f)return a.DEPTH_COMPONENT;if(1027===f)return a.DEPTH_STENCIL;if(1035===f)return g=b.get("EXT_sRGB"),null!==g?g.SRGB_ALPHA_EXT:null;if(1028===f)return a.RED;if(1029===f)return a.RED_INTEGER;if(1030===f)return a.RG;if(1031===f)return a.RG_INTEGER;if(1033===f)return a.RGBA_INTEGER;if(33776===f||33777===f||33778===f||33779===f)if("srgb"===l)if(g=b.get("WEBGL_compressed_texture_s3tc_srgb"),null!==g){if(33776===f)return g.COMPRESSED_SRGB_S3TC_DXT1_EXT;if(33777===f)return g.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT;
if(33778===f)return g.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT;if(33779===f)return g.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT}else return null;else if(g=b.get("WEBGL_compressed_texture_s3tc"),null!==g){if(33776===f)return g.COMPRESSED_RGB_S3TC_DXT1_EXT;if(33777===f)return g.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(33778===f)return g.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(33779===f)return g.COMPRESSED_RGBA_S3TC_DXT5_EXT}else return null;if(35840===f||35841===f||35842===f||35843===f)if(g=b.get("WEBGL_compressed_texture_pvrtc"),
null!==g){if(35840===f)return g.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;if(35841===f)return g.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;if(35842===f)return g.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;if(35843===f)return g.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG}else return null;if(36196===f)return g=b.get("WEBGL_compressed_texture_etc1"),null!==g?g.COMPRESSED_RGB_ETC1_WEBGL:null;if(37492===f||37496===f)if(g=b.get("WEBGL_compressed_texture_etc"),null!==g){if(37492===f)return"srgb"===l?g.COMPRESSED_SRGB8_ETC2:g.COMPRESSED_RGB8_ETC2;
if(37496===f)return"srgb"===l?g.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:g.COMPRESSED_RGBA8_ETC2_EAC}else return null;if(37808===f||37809===f||37810===f||37811===f||37812===f||37813===f||37814===f||37815===f||37816===f||37817===f||37818===f||37819===f||37820===f||37821===f)if(g=b.get("WEBGL_compressed_texture_astc"),null!==g){if(37808===f)return"srgb"===l?g.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR:g.COMPRESSED_RGBA_ASTC_4x4_KHR;if(37809===f)return"srgb"===l?g.COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR:g.COMPRESSED_RGBA_ASTC_5x4_KHR;
if(37810===f)return"srgb"===l?g.COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR:g.COMPRESSED_RGBA_ASTC_5x5_KHR;if(37811===f)return"srgb"===l?g.COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR:g.COMPRESSED_RGBA_ASTC_6x5_KHR;if(37812===f)return"srgb"===l?g.COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR:g.COMPRESSED_RGBA_ASTC_6x6_KHR;if(37813===f)return"srgb"===l?g.COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR:g.COMPRESSED_RGBA_ASTC_8x5_KHR;if(37814===f)return"srgb"===l?g.COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR:g.COMPRESSED_RGBA_ASTC_8x6_KHR;if(37815===
f)return"srgb"===l?g.COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR:g.COMPRESSED_RGBA_ASTC_8x8_KHR;if(37816===f)return"srgb"===l?g.COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR:g.COMPRESSED_RGBA_ASTC_10x5_KHR;if(37817===f)return"srgb"===l?g.COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR:g.COMPRESSED_RGBA_ASTC_10x6_KHR;if(37818===f)return"srgb"===l?g.COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR:g.COMPRESSED_RGBA_ASTC_10x8_KHR;if(37819===f)return"srgb"===l?g.COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR:g.COMPRESSED_RGBA_ASTC_10x10_KHR;if(37820===
f)return"srgb"===l?g.COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR:g.COMPRESSED_RGBA_ASTC_12x10_KHR;if(37821===f)return"srgb"===l?g.COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR:g.COMPRESSED_RGBA_ASTC_12x12_KHR}else return null;if(36492===f||36494===f||36495===f)if(g=b.get("EXT_texture_compression_bptc"),null!==g){if(36492===f)return"srgb"===l?g.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT:g.COMPRESSED_RGBA_BPTC_UNORM_EXT;if(36494===f)return g.COMPRESSED_RGB_BPTC_SIGNED_FLOAT_EXT;if(36495===f)return g.COMPRESSED_RGB_BPTC_UNSIGNED_FLOAT_EXT}else return null;
if(36283===f||36284===f||36285===f||36286===f)if(g=b.get("EXT_texture_compression_rgtc"),null!==g){if(36492===f)return g.COMPRESSED_RED_RGTC1_EXT;if(36284===f)return g.COMPRESSED_SIGNED_RED_RGTC1_EXT;if(36285===f)return g.COMPRESSED_RED_GREEN_RGTC2_EXT;if(36286===f)return g.COMPRESSED_SIGNED_RED_GREEN_RGTC2_EXT}else return null;if(1020===f){if(d)return a.UNSIGNED_INT_24_8;g=b.get("WEBGL_depth_texture");return null!==g?g.UNSIGNED_INT_24_8_WEBGL:null}return void 0!==a[f]?a[f]:null}}}function Ti(a,b){function c(f,
g){!0===f.matrixAutoUpdate&&f.updateMatrix();g.value.copy(f.matrix)}function d(f,g){f.opacity.value=g.opacity;g.color&&f.diffuse.value.copy(g.color);g.emissive&&f.emissive.value.copy(g.emissive).multiplyScalar(g.emissiveIntensity);g.map&&(f.map.value=g.map,c(g.map,f.mapTransform));g.alphaMap&&(f.alphaMap.value=g.alphaMap,c(g.alphaMap,f.alphaMapTransform));g.bumpMap&&(f.bumpMap.value=g.bumpMap,c(g.bumpMap,f.bumpMapTransform),f.bumpScale.value=g.bumpScale,1===g.side&&(f.bumpScale.value*=-1));g.normalMap&&
(f.normalMap.value=g.normalMap,c(g.normalMap,f.normalMapTransform),f.normalScale.value.copy(g.normalScale),1===g.side&&f.normalScale.value.negate());g.displacementMap&&(f.displacementMap.value=g.displacementMap,c(g.displacementMap,f.displacementMapTransform),f.displacementScale.value=g.displacementScale,f.displacementBias.value=g.displacementBias);g.emissiveMap&&(f.emissiveMap.value=g.emissiveMap,c(g.emissiveMap,f.emissiveMapTransform));g.specularMap&&(f.specularMap.value=g.specularMap,c(g.specularMap,
f.specularMapTransform));0<g.alphaTest&&(f.alphaTest.value=g.alphaTest);const l=b.get(g).envMap;l&&(f.envMap.value=l,f.flipEnvMap.value=l.isCubeTexture&&!1===l.isRenderTargetTexture?-1:1,f.reflectivity.value=g.reflectivity,f.ior.value=g.ior,f.refractionRatio.value=g.refractionRatio);g.lightMap&&(f.lightMap.value=g.lightMap,f.lightMapIntensity.value=g.lightMapIntensity*(!0===a._useLegacyLights?Math.PI:1),c(g.lightMap,f.lightMapTransform));g.aoMap&&(f.aoMap.value=g.aoMap,f.aoMapIntensity.value=g.aoMapIntensity,
c(g.aoMap,f.aoMapTransform))}return{refreshFogUniforms:function(f,g){g.color.getRGB(f.fogColor.value,Mc(a));g.isFog?(f.fogNear.value=g.near,f.fogFar.value=g.far):g.isFogExp2&&(f.fogDensity.value=g.density)},refreshMaterialUniforms:function(f,g,l,m,n){g.isMeshBasicMaterial?d(f,g):g.isMeshLambertMaterial?d(f,g):g.isMeshToonMaterial?(d(f,g),g.gradientMap&&(f.gradientMap.value=g.gradientMap)):g.isMeshPhongMaterial?(d(f,g),f.specular.value.copy(g.specular),f.shininess.value=Math.max(g.shininess,1E-4)):
g.isMeshStandardMaterial?(d(f,g),f.metalness.value=g.metalness,g.metalnessMap&&(f.metalnessMap.value=g.metalnessMap,c(g.metalnessMap,f.metalnessMapTransform)),f.roughness.value=g.roughness,g.roughnessMap&&(f.roughnessMap.value=g.roughnessMap,c(g.roughnessMap,f.roughnessMapTransform)),b.get(g).envMap&&(f.envMapIntensity.value=g.envMapIntensity),g.isMeshPhysicalMaterial&&(f.ior.value=g.ior,0<g.sheen&&(f.sheenColor.value.copy(g.sheenColor).multiplyScalar(g.sheen),f.sheenRoughness.value=g.sheenRoughness,
g.sheenColorMap&&(f.sheenColorMap.value=g.sheenColorMap,c(g.sheenColorMap,f.sheenColorMapTransform)),g.sheenRoughnessMap&&(f.sheenRoughnessMap.value=g.sheenRoughnessMap,c(g.sheenRoughnessMap,f.sheenRoughnessMapTransform))),0<g.clearcoat&&(f.clearcoat.value=g.clearcoat,f.clearcoatRoughness.value=g.clearcoatRoughness,g.clearcoatMap&&(f.clearcoatMap.value=g.clearcoatMap,c(g.clearcoatMap,f.clearcoatMapTransform)),g.clearcoatRoughnessMap&&(f.clearcoatRoughnessMap.value=g.clearcoatRoughnessMap,c(g.clearcoatRoughnessMap,
f.clearcoatRoughnessMapTransform)),g.clearcoatNormalMap&&(f.clearcoatNormalMap.value=g.clearcoatNormalMap,c(g.clearcoatNormalMap,f.clearcoatNormalMapTransform),f.clearcoatNormalScale.value.copy(g.clearcoatNormalScale),1===g.side&&f.clearcoatNormalScale.value.negate())),0<g.iridescence&&(f.iridescence.value=g.iridescence,f.iridescenceIOR.value=g.iridescenceIOR,f.iridescenceThicknessMinimum.value=g.iridescenceThicknessRange[0],f.iridescenceThicknessMaximum.value=g.iridescenceThicknessRange[1],g.iridescenceMap&&
(f.iridescenceMap.value=g.iridescenceMap,c(g.iridescenceMap,f.iridescenceMapTransform)),g.iridescenceThicknessMap&&(f.iridescenceThicknessMap.value=g.iridescenceThicknessMap,c(g.iridescenceThicknessMap,f.iridescenceThicknessMapTransform))),0<g.transmission&&(f.transmission.value=g.transmission,f.transmissionSamplerMap.value=n.texture,f.transmissionSamplerSize.value.set(n.width,n.height),g.transmissionMap&&(f.transmissionMap.value=g.transmissionMap,c(g.transmissionMap,f.transmissionMapTransform)),
f.thickness.value=g.thickness,g.thicknessMap&&(f.thicknessMap.value=g.thicknessMap,c(g.thicknessMap,f.thicknessMapTransform)),f.attenuationDistance.value=g.attenuationDistance,f.attenuationColor.value.copy(g.attenuationColor)),0<g.anisotropy&&(f.anisotropyVector.value.set(g.anisotropy*Math.cos(g.anisotropyRotation),g.anisotropy*Math.sin(g.anisotropyRotation)),g.anisotropyMap&&(f.anisotropyMap.value=g.anisotropyMap,c(g.anisotropyMap,f.anisotropyMapTransform))),f.specularIntensity.value=g.specularIntensity,
f.specularColor.value.copy(g.specularColor),g.specularColorMap&&(f.specularColorMap.value=g.specularColorMap,c(g.specularColorMap,f.specularColorMapTransform)),g.specularIntensityMap&&(f.specularIntensityMap.value=g.specularIntensityMap,c(g.specularIntensityMap,f.specularIntensityMapTransform)))):g.isMeshMatcapMaterial?(d(f,g),g.matcap&&(f.matcap.value=g.matcap)):g.isMeshDepthMaterial?d(f,g):g.isMeshDistanceMaterial?(d(f,g),g=b.get(g).light,f.referencePosition.value.setFromMatrixPosition(g.matrixWorld),
f.nearDistance.value=g.shadow.camera.near,f.farDistance.value=g.shadow.camera.far):g.isMeshNormalMaterial?d(f,g):g.isLineBasicMaterial?(f.diffuse.value.copy(g.color),f.opacity.value=g.opacity,g.map&&(f.map.value=g.map,c(g.map,f.mapTransform)),g.isLineDashedMaterial&&(f.dashSize.value=g.dashSize,f.totalSize.value=g.dashSize+g.gapSize,f.scale.value=g.scale)):g.isPointsMaterial?(f.diffuse.value.copy(g.color),f.opacity.value=g.opacity,f.size.value=g.size*l,f.scale.value=.5*m,g.map&&(f.map.value=g.map,
c(g.map,f.uvTransform)),g.alphaMap&&(f.alphaMap.value=g.alphaMap,c(g.alphaMap,f.alphaMapTransform)),0<g.alphaTest&&(f.alphaTest.value=g.alphaTest)):g.isSpriteMaterial?(f.diffuse.value.copy(g.color),f.opacity.value=g.opacity,f.rotation.value=g.rotation,g.map&&(f.map.value=g.map,c(g.map,f.mapTransform)),g.alphaMap&&(f.alphaMap.value=g.alphaMap,c(g.alphaMap,f.alphaMapTransform)),0<g.alphaTest&&(f.alphaTest.value=g.alphaTest)):g.isShadowMaterial?(f.color.value.copy(g.color),f.opacity.value=g.opacity):
g.isShaderMaterial&&(g.uniformsNeedUpdate=!1)}}}function Ui(a,b,c,d){function f(v){const A=v.uniforms;let F=0;for(let L=0,U=A.length;L<U;L++){const P=A[L];var D=0,E=0;var y=Array.isArray(P.value)?P.value:[P.value];for(let X=0,ja=y.length;X<ja;X++){var J=g(y[X]);D+=J.boundary;E+=J.storage}P.__data=new Float32Array(E/Float32Array.BYTES_PER_ELEMENT);P.__offset=F;0<L&&(y=F%16,J=16-y,0!==y&&0>J-D&&(F+=16-y,P.__offset=F));F+=E}y=F%16;0<y&&(F+=16-y);v.__size=F;v.__cache={};return this}function g(v){const A=
{boundary:0,storage:0};"number"===typeof v?(A.boundary=4,A.storage=4):v.isVector2?(A.boundary=8,A.storage=8):v.isVector3||v.isColor?(A.boundary=16,A.storage=12):v.isVector4?(A.boundary=16,A.storage=16):v.isMatrix3?(A.boundary=48,A.storage=48):v.isMatrix4?(A.boundary=64,A.storage=64):v.isTexture?console.warn("THREE.WebGLRenderer: Texture samplers can not be part of an uniforms group."):console.warn("THREE.WebGLRenderer: Unsupported uniform value type.",v);return A}function l(v){v=v.target;v.removeEventListener("dispose",
l);const A=t.indexOf(v.__bindingPointIndex);t.splice(A,1);a.deleteBuffer(m[v.id]);delete m[v.id];delete n[v.id]}let m={},n={},t=[];const u=c.isWebGL2?a.getParameter(a.MAX_UNIFORM_BUFFER_BINDINGS):0;return{bind:function(v,A){d.uniformBlockBinding(v,A.program)},update:function(v,A){var F=m[v.id];if(void 0===F){f(v);a:{for(F=0;F<u;F++)if(-1===t.indexOf(F)){t.push(F);break a}console.error("THREE.WebGLRenderer: Maximum number of simultaneously usable uniforms groups reached.");F=0}v.__bindingPointIndex=
F;var D=a.createBuffer(),E=v.__size,y=v.usage;a.bindBuffer(a.UNIFORM_BUFFER,D);a.bufferData(a.UNIFORM_BUFFER,E,y);a.bindBuffer(a.UNIFORM_BUFFER,null);a.bindBufferBase(a.UNIFORM_BUFFER,F,D);F=D;m[v.id]=F;v.addEventListener("dispose",l)}d.updateUBOMapping(v,A.program);A=b.render.frame;if(n[v.id]!==A){F=v.uniforms;D=v.__cache;a.bindBuffer(a.UNIFORM_BUFFER,m[v.id]);for(let X=0,ja=F.length;X<ja;X++){E=F[X];a:{y=X;var J=D,L=E.value;if(void 0===J[y]){if("number"===typeof L)J[y]=L;else{L=Array.isArray(L)?
L:[L];var U=[];for(var P=0;P<L.length;P++)U.push(L[P].clone());J[y]=U}y=!0}else{if("number"===typeof L){if(J[y]!==L){J[y]=L;y=!0;break a}}else for(y=Array.isArray(J[y])?J[y]:[J[y]],J=Array.isArray(L)?L:[L],L=0;L<y.length;L++)if(U=y[L],!1===U.equals(J[L])){U.copy(J[L]);y=!0;break a}y=!1}}if(!0===y){y=E.__offset;J=Array.isArray(E.value)?E.value:[E.value];L=0;for(U=0;U<J.length;U++){P=J[U];const fa=g(P);"number"===typeof P?(E.__data[0]=P,a.bufferSubData(a.UNIFORM_BUFFER,y+L,E.__data)):P.isMatrix3?(E.__data[0]=
P.elements[0],E.__data[1]=P.elements[1],E.__data[2]=P.elements[2],E.__data[3]=P.elements[0],E.__data[4]=P.elements[3],E.__data[5]=P.elements[4],E.__data[6]=P.elements[5],E.__data[7]=P.elements[0],E.__data[8]=P.elements[6],E.__data[9]=P.elements[7],E.__data[10]=P.elements[8],E.__data[11]=P.elements[0]):(P.toArray(E.__data,L),L+=fa.storage/Float32Array.BYTES_PER_ELEMENT)}a.bufferSubData(a.UNIFORM_BUFFER,y,E.__data)}}a.bindBuffer(a.UNIFORM_BUFFER,null);n[v.id]=A}},dispose:function(){for(const v in m)a.deleteBuffer(m[v]);
t=[];m={};n={}}}}function af(a,b,c,d,f,g){bf.subVectors(a,c).addScalar(.5).multiply(d);void 0!==f?(Tf.x=g*bf.x-f*bf.y,Tf.y=f*bf.x+g*bf.y):Tf.copy(bf);a.copy(b);a.x+=Tf.x;a.y+=Tf.y;a.applyMatrix4(nk)}function ch(a,b,c,d,f,g,l){const m=Vi.distanceSqToPoint(a);m<c&&(c=new O,Vi.closestPointToPoint(a,c),c.applyMatrix4(d),a=f.ray.origin.distanceTo(c),a<f.near||a>f.far||g.push({distance:a,distanceToRay:Math.sqrt(m),point:c,index:b,face:null,object:l}))}function Uf(){let a=0,b=0,c=0,d=0;return{initCatmullRom:function(f,
g,l,m,n){f=n*(l-f);m=n*(m-g);a=g;b=f;c=-3*g+3*l-2*f-m;d=2*g-2*l+f+m},initNonuniformCatmullRom:function(f,g,l,m,n,t,u){f=((g-f)/n-(l-f)/(n+t)+(l-g)/t)*t;m=((l-g)/t-(m-g)/(t+u)+(m-l)/u)*t;a=g;b=f;c=-3*g+3*l-2*f-m;d=2*g-2*l+f+m},calc:function(f){const g=f*f;return a+b*f+c*g+d*g*f}}}function dh(a,b,c,d,f){b=.5*(d-b);f=.5*(f-c);const g=a*a;return(2*c-2*d+b+f)*a*g+(-3*c+3*d-2*b-f)*g+b*a+c}function Td(a,b,c,d){const f=1-a;return f*f*b+2*(1-a)*a*c+a*a*d}function Ud(a,b,c,d,f){const g=1-a,l=1-a;return g*g*
g*b+3*l*l*a*c+3*(1-a)*a*a*d+a*a*a*f}function eh(a,b,c,d,f){let g,l=0;for(let m=b,n=c-d;m<c;m+=d)l+=(a[n]-a[m])*(a[m+1]+a[n+1]),n=m;if(f===0<l)for(f=b;f<c;f+=d)g=fh(f,a[f],a[f+1],g);else for(f=c-d;f>=b;f-=d)g=fh(f,a[f],a[f+1],g);g&&cf(g,g.next)&&(te(g),g=g.next);return g}function ud(a,b){if(!a)return a;b||(b=a);let c;do if(c=!1,a.steiner||!cf(a,a.next)&&0!==Ab(a.prev,a,a.next))a=a.next;else{te(a);a=b=a.prev;if(a===a.next)break;c=!0}while(c||a!==b);return b}function vd(a,b,c,d,f,g,l){if(a){if(!l&&g){var m=
a,n=m;do 0===n.z&&(n.z=Vd(n.x,n.y,d,f,g)),n.prevZ=n.prev,n=n.nextZ=n.next;while(n!==m);n.prevZ.nextZ=null;n.prevZ=null;m=n;var t,u,v,A,F=1;do{n=m;var D=m=null;for(u=0;n;){u++;var E=n;for(t=v=0;t<F&&(v++,E=E.nextZ,E);t++);for(A=F;0<v||0<A&&E;)0!==v&&(0===A||!E||n.z<=E.z)?(t=n,n=n.nextZ,v--):(t=E,E=E.nextZ,A--),D?D.nextZ=t:m=t,t.prevZ=D,D=t;n=E}D.nextZ=null;F*=2}while(1<u)}for(m=a;a.prev!==a.next;){n=a.prev;E=a.next;if(g)D=Wi(a,d,f,g);else a:{D=a.prev;var y=a;A=a.next;if(0<=Ab(D,y,A)){D=!1;break a}u=
D.x;v=y.x;F=A.x;t=D.y;y=y.y;const J=A.y,L=u<v?u<F?u:F:v<F?v:F,U=t<y?t<J?t:J:y<J?y:J,P=u>v?u>F?u:F:v>F?v:F,X=t>y?t>J?t:J:y>J?y:J;for(A=A.next;A!==D;){if(A.x>=L&&A.x<=P&&A.y>=U&&A.y<=X&&Oc(u,t,v,y,F,J,A.x,A.y)&&0<=Ab(A.prev,A,A.next)){D=!1;break a}A=A.next}D=!0}if(D)b.push(n.i/c|0),b.push(a.i/c|0),b.push(E.i/c|0),te(a),m=a=E.next;else if(a=E,a===m){if(!l)vd(ud(a),b,c,d,f,g,1);else if(1===l){a=ud(a);l=b;m=c;n=a;do E=n.prev,D=n.next.next,!cf(E,D)&&gh(E,n,n.next,D)&&ue(E,D)&&ue(D,E)&&(l.push(E.i/m|0),
l.push(n.i/m|0),l.push(D.i/m|0),te(n),te(n.next),n=a=D),n=n.next;while(n!==a);a=ud(n);vd(a,b,c,d,f,g,2)}else if(2===l)a:{l=a;do{for(m=l.next.next;m!==l.prev;){if(n=l.i!==m.i){n=l;E=m;if(D=n.next.i!==E.i&&n.prev.i!==E.i){b:{D=n;do{if(D.i!==n.i&&D.next.i!==n.i&&D.i!==E.i&&D.next.i!==E.i&&gh(D,D.next,n,E)){D=!0;break b}D=D.next}while(D!==n);D=!1}D=!D}if(D){if(D=ue(n,E)&&ue(E,n)){D=n;u=!1;v=(n.x+E.x)/2;F=(n.y+E.y)/2;do D.y>F!==D.next.y>F&&D.next.y!==D.y&&v<(D.next.x-D.x)*(F-D.y)/(D.next.y-D.y)+D.x&&(u=
!u),D=D.next;while(D!==n);D=u}D=D&&(Ab(n.prev,n,E.prev)||Ab(n,E.prev,E))||cf(n,E)&&0<Ab(n.prev,n,n.next)&&0<Ab(E.prev,E,E.next)}n=D}if(n){a=hh(l,m);l=ud(l,l.next);a=ud(a,a.next);vd(l,b,c,d,f,g,0);vd(a,b,c,d,f,g,0);break a}m=m.next}l=l.next}while(l!==a)}break}}}}function Wi(a,b,c,d){const f=a.prev,g=a.next;if(0<=Ab(f,a,g))return!1;const l=f.x,m=a.x,n=g.x,t=f.y,u=a.y,v=g.y,A=l<m?l<n?l:n:m<n?m:n,F=t<u?t<v?t:v:u<v?u:v,D=l>m?l>n?l:n:m>n?m:n,E=t>u?t>v?t:v:u>v?u:v,y=Vd(A,F,b,c,d);b=Vd(D,E,b,c,d);c=a.prevZ;
for(a=a.nextZ;c&&c.z>=y&&a&&a.z<=b;){if(c.x>=A&&c.x<=D&&c.y>=F&&c.y<=E&&c!==f&&c!==g&&Oc(l,t,m,u,n,v,c.x,c.y)&&0<=Ab(c.prev,c,c.next))return!1;c=c.prevZ;if(a.x>=A&&a.x<=D&&a.y>=F&&a.y<=E&&a!==f&&a!==g&&Oc(l,t,m,u,n,v,a.x,a.y)&&0<=Ab(a.prev,a,a.next))return!1;a=a.nextZ}for(;c&&c.z>=y;){if(c.x>=A&&c.x<=D&&c.y>=F&&c.y<=E&&c!==f&&c!==g&&Oc(l,t,m,u,n,v,c.x,c.y)&&0<=Ab(c.prev,c,c.next))return!1;c=c.prevZ}for(;a&&a.z<=b;){if(a.x>=A&&a.x<=D&&a.y>=F&&a.y<=E&&a!==f&&a!==g&&Oc(l,t,m,u,n,v,a.x,a.y)&&0<=Ab(a.prev,
a,a.next))return!1;a=a.nextZ}return!0}function Xi(a,b){return a.x-b.x}function Vd(a,b,c,d,f){a=(a-c)*f|0;b=(b-d)*f|0;a=(a|a<<8)&16711935;a=(a|a<<4)&252645135;a=(a|a<<2)&858993459;b=(b|b<<8)&16711935;b=(b|b<<4)&252645135;b=(b|b<<2)&858993459;return(a|a<<1)&1431655765|((b|b<<1)&1431655765)<<1}function Oc(a,b,c,d,f,g,l,m){return(f-l)*(b-m)>=(a-l)*(g-m)&&(a-l)*(d-m)>=(c-l)*(b-m)&&(c-l)*(g-m)>=(f-l)*(d-m)}function Ab(a,b,c){return(b.y-a.y)*(c.x-b.x)-(b.x-a.x)*(c.y-b.y)}function cf(a,b){return a.x===b.x&&
a.y===b.y}function gh(a,b,c,d){const f=df(Ab(a,b,c)),g=df(Ab(a,b,d)),l=df(Ab(c,d,a)),m=df(Ab(c,d,b));return f!==g&&l!==m||0===f&&ef(a,c,b)||0===g&&ef(a,d,b)||0===l&&ef(c,a,d)||0===m&&ef(c,b,d)?!0:!1}function ef(a,b,c){return b.x<=Math.max(a.x,c.x)&&b.x>=Math.min(a.x,c.x)&&b.y<=Math.max(a.y,c.y)&&b.y>=Math.min(a.y,c.y)}function df(a){return 0<a?1:0>a?-1:0}function ue(a,b){return 0>Ab(a.prev,a,a.next)?0<=Ab(a,b,a.next)&&0<=Ab(a,a.prev,b):0>Ab(a,b,a.prev)||0>Ab(a,a.next,b)}function hh(a,b){const c=new Vf(a.i,
a.x,a.y),d=new Vf(b.i,b.x,b.y),f=a.next,g=b.prev;a.next=b;b.prev=a;c.next=f;f.prev=c;d.next=c;c.prev=d;g.next=d;d.prev=g;return d}function fh(a,b,c,d){a=new Vf(a,b,c);d?(a.next=d.next,a.prev=d,d.next.prev=a,d.next=a):(a.prev=a,a.next=a);return a}function te(a){a.next.prev=a.prev;a.prev.next=a.next;a.prevZ&&(a.prevZ.nextZ=a.nextZ);a.nextZ&&(a.nextZ.prevZ=a.prevZ)}function Vf(a,b,c){this.i=a;this.x=b;this.y=c;this.next=this.prev=null;this.z=0;this.nextZ=this.prevZ=null;this.steiner=!1}function ih(a){const b=
a.length;2<b&&a[b-1].equals(a[0])&&a.pop()}function jh(a,b){for(let c=0;c<b.length;c++)a.push(b[c].x),a.push(b[c].y)}function Wf(a,b,c){const d=`${a.x},${a.y},${a.z}-${b.x},${b.y},${b.z}`;a=`${b.x},${b.y},${b.z}-${a.x},${a.y},${a.z}`;if(!0===c.has(d)||!0===c.has(a))return!1;c.add(d);c.add(a);return!0}function cd(a,b,c){return!a||!c&&a.constructor===b?a:"number"===typeof b.BYTES_PER_ELEMENT?new b(a):Array.prototype.slice.call(a)}function Xf(a){return ArrayBuffer.isView(a)&&!(a instanceof DataView)}
function kh(a){const b=a.length,c=Array(b);for(let d=0;d!==b;++d)c[d]=d;c.sort(function(d,f){return a[d]-a[f]});return c}function Yf(a,b,c){const d=a.length,f=new a.constructor(d);for(let g=0,l=0;l!==d;++g){const m=c[g]*b;for(let n=0;n!==b;++n)f[l++]=a[m+n]}return f}function Zf(a,b,c,d){let f=1,g=a[0];for(;void 0!==g&&void 0===g[d];)g=a[f++];if(void 0!==g){var l=g[d];if(void 0!==l)if(Array.isArray(l)){do l=g[d],void 0!==l&&(b.push(g.time),c.push.apply(c,l)),g=a[f++];while(void 0!==g)}else if(void 0!==
l.toArray){do l=g[d],void 0!==l&&(b.push(g.time),l.toArray(c,c.length)),g=a[f++];while(void 0!==g)}else{do l=g[d],void 0!==l&&(b.push(g.time),c.push(l)),g=a[f++];while(void 0!==g)}}}function Yi(a){switch(a.toLowerCase()){case "scalar":case "double":case "float":case "number":case "integer":return $f;case "vector":case "vector2":case "vector3":case "vector4":return ag;case "color":return Zi;case "quaternion":return ff;case "bool":case "boolean":return ve;case "string":return we}throw Error("THREE.KeyframeTrack: Unsupported typeName: "+
a);}function lh(){return("undefined"===typeof performance?Date:performance).now()}function mh(a,b){return a.distance-b.distance}function bg(a,b,c,d){a.layers.test(b.layers)&&a.raycast(b,c);if(!0===d){a=a.children;for(let f=0,g=a.length;f<g;f++)bg(a[f],b,c,!0)}}function nh(a){const b=[];!0===a.isBone&&b.push(a);for(let c=0;c<a.children.length;c++)b.push.apply(b,nh(a.children[c]));return b}function Eb(a,b,c,d,f,g,l){oh.set(f,g,l).unproject(d);a=b[a];if(void 0!==a){c=c.getAttribute("position");for(let m=
0,n=a.length;m<n;m++)c.setXYZ(a[m],oh.x,oh.y,oh.z)}}Object.defineProperty(q,"__esModule",{value:!0});q.WebGLUtils=bh;q.createCanvasElement=tb;q.DynamicCopyUsage=q.DstColorFactor=q.DstAlphaFactor=q.DoubleSide=q.DodecahedronGeometry=q.DisplayP3ColorSpace=q.DiscreteInterpolant=q.DirectionalLightHelper=q.DirectionalLight=q.DetachedBindMode=q.DepthTexture=q.DepthStencilFormat=q.DepthFormat=q.DefaultLoadingManager=q.DecrementWrapStencilOp=q.DecrementStencilOp=q.DataUtils=q.DataTextureLoader=q.DataTexture=
q.DataArrayTexture=q.Data3DTexture=q.Cylindrical=q.CylinderGeometry=q.CustomToneMapping=q.CustomBlending=q.CurvePath=q.Curve=q.CullFaceNone=q.CullFaceFrontBack=q.CullFaceFront=q.CullFaceBack=q.CubicInterpolant=q.CubicBezierCurve3=q.CubicBezierCurve=q.CubeUVReflectionMapping=q.CubeTextureLoader=q.CubeTexture=q.CubeRefractionMapping=q.CubeReflectionMapping=q.CubeCamera=q.ConstantColorFactor=q.ConstantAlphaFactor=q.ConeGeometry=q.CompressedTextureLoader=q.CompressedTexture=q.CompressedCubeTexture=q.CompressedArrayTexture=
q.ColorManagement=q.ColorKeyframeTrack=q.Color=q.Clock=q.ClampToEdgeWrapping=q.CircleGeometry=q.CineonToneMapping=q.CatmullRomCurve3=q.CapsuleGeometry=q.CanvasTexture=q.CameraHelper=q.Camera=q.Cache=q.ByteType=q.BufferGeometryLoader=q.BufferGeometry=q.BufferAttribute=q.BoxHelper=q.BoxGeometry=q.Box3Helper=q.Box3=q.Box2=q.BooleanKeyframeTrack=q.Bone=q.BasicShadowMap=q.BasicDepthPacking=q.BackSide=q.AxesHelper=q.AudioLoader=q.AudioListener=q.AudioContext=q.AudioAnalyser=q.Audio=q.AttachedBindMode=q.ArrowHelper=
q.ArrayCamera=q.ArcCurve=q.AnimationUtils=q.AnimationObjectGroup=q.AnimationMixer=q.AnimationLoader=q.AnimationClip=q.AnimationAction=q.AmbientLight=q.AlwaysStencilFunc=q.AlwaysDepth=q.AlwaysCompare=q.AlphaFormat=q.AdditiveBlending=q.AdditiveAnimationBlendMode=q.AddOperation=q.AddEquation=q.ACESFilmicToneMapping=void 0;q.MaterialLoader=q.Material=q.MOUSE=q.LuminanceFormat=q.LuminanceAlphaFormat=q.LoopRepeat=q.LoopPingPong=q.LoopOnce=q.LoadingManager=q.LoaderUtils=q.Loader=q.LinearTransfer=q.LinearToneMapping=
q.LinearSRGBColorSpace=q.LinearMipmapNearestFilter=q.LinearMipmapLinearFilter=q.LinearMipMapNearestFilter=q.LinearMipMapLinearFilter=q.LinearInterpolant=q.LinearFilter=q.LinearEncoding=q.LinearDisplayP3ColorSpace=q.LineSegments=q.LineLoop=q.LineDashedMaterial=q.LineCurve3=q.LineCurve=q.LineBasicMaterial=q.Line3=q.Line=q.LightProbe=q.Light=q.LessStencilFunc=q.LessEqualStencilFunc=q.LessEqualDepth=q.LessEqualCompare=q.LessDepth=q.LessCompare=q.Layers=q.LatheGeometry=q.LOD=q.KeyframeTrack=q.KeepStencilOp=
q.InvertStencilOp=q.InterpolateSmooth=q.InterpolateLinear=q.InterpolateDiscrete=q.Interpolant=q.InterleavedBufferAttribute=q.InterleavedBuffer=q.IntType=q.Int8BufferAttribute=q.Int32BufferAttribute=q.Int16BufferAttribute=q.InstancedMesh=q.InstancedInterleavedBuffer=q.InstancedBufferGeometry=q.InstancedBufferAttribute=q.IncrementWrapStencilOp=q.IncrementStencilOp=q.ImageUtils=q.ImageLoader=q.ImageBitmapLoader=q.IcosahedronGeometry=q.HemisphereLightHelper=q.HemisphereLight=q.HalfFloatType=q.Group=q.GridHelper=
q.GreaterStencilFunc=q.GreaterEqualStencilFunc=q.GreaterEqualDepth=q.GreaterEqualCompare=q.GreaterDepth=q.GreaterCompare=q.GLSL3=q.GLSL1=q.GLBufferAttribute=q.Frustum=q.FrontSide=q.FramebufferTexture=q.FogExp2=q.Fog=q.FloatType=q.Float64BufferAttribute=q.Float32BufferAttribute=q.Float16BufferAttribute=q.FileLoader=q.ExtrudeGeometry=q.EventDispatcher=q.Euler=q.EquirectangularRefractionMapping=q.EquirectangularReflectionMapping=q.EqualStencilFunc=q.EqualDepth=q.EqualCompare=q.EllipseCurve=q.EdgesGeometry=
q.DynamicReadUsage=q.DynamicDrawUsage=void 0;q.RGB_BPTC_SIGNED_Format=q.RGBA_S3TC_DXT5_Format=q.RGBA_S3TC_DXT3_Format=q.RGBA_S3TC_DXT1_Format=q.RGBA_PVRTC_4BPPV1_Format=q.RGBA_PVRTC_2BPPV1_Format=q.RGBA_ETC2_EAC_Format=q.RGBA_BPTC_Format=q.RGBA_ASTC_8x8_Format=q.RGBA_ASTC_8x6_Format=q.RGBA_ASTC_8x5_Format=q.RGBA_ASTC_6x6_Format=q.RGBA_ASTC_6x5_Format=q.RGBA_ASTC_5x5_Format=q.RGBA_ASTC_5x4_Format=q.RGBA_ASTC_4x4_Format=q.RGBA_ASTC_12x12_Format=q.RGBA_ASTC_12x10_Format=q.RGBA_ASTC_10x8_Format=q.RGBA_ASTC_10x6_Format=
q.RGBA_ASTC_10x5_Format=q.RGBA_ASTC_10x10_Format=q.RGBAIntegerFormat=q.RGBAFormat=q.RGBADepthPacking=q.REVISION=q.RED_RGTC1_Format=q.RED_GREEN_RGTC2_Format=q.QuaternionLinearInterpolant=q.QuaternionKeyframeTrack=q.Quaternion=q.QuadraticBezierCurve3=q.QuadraticBezierCurve=q.PropertyMixer=q.PropertyBinding=q.PositionalAudio=q.PolyhedronGeometry=q.PolarGridHelper=q.PointsMaterial=q.Points=q.PointLightHelper=q.PointLight=q.PlaneHelper=q.PlaneGeometry=q.Plane=q.PerspectiveCamera=q.Path=q.PMREMGenerator=
q.PCFSoftShadowMap=q.PCFShadowMap=q.P3Primaries=q.OrthographicCamera=q.OneMinusSrcColorFactor=q.OneMinusSrcAlphaFactor=q.OneMinusDstColorFactor=q.OneMinusDstAlphaFactor=q.OneMinusConstantColorFactor=q.OneMinusConstantAlphaFactor=q.OneFactor=q.OctahedronGeometry=q.ObjectSpaceNormalMap=q.ObjectLoader=q.Object3D=q.NumberKeyframeTrack=q.NotEqualStencilFunc=q.NotEqualDepth=q.NotEqualCompare=q.NormalBlending=q.NormalAnimationBlendMode=q.NoToneMapping=q.NoColorSpace=q.NoBlending=q.NeverStencilFunc=q.NeverDepth=
q.NeverCompare=q.NearestMipmapNearestFilter=q.NearestMipmapLinearFilter=q.NearestMipMapNearestFilter=q.NearestMipMapLinearFilter=q.NearestFilter=q.MultiplyOperation=q.MultiplyBlending=q.MixOperation=q.MirroredRepeatWrapping=q.MinEquation=q.MeshToonMaterial=q.MeshStandardMaterial=q.MeshPhysicalMaterial=q.MeshPhongMaterial=q.MeshNormalMaterial=q.MeshMatcapMaterial=q.MeshLambertMaterial=q.MeshDistanceMaterial=q.MeshDepthMaterial=q.MeshBasicMaterial=q.Mesh=q.MaxEquation=q.Matrix4=q.Matrix3=q.MathUtils=
void 0;q.WebGLCubeRenderTarget=q.WebGLCoordinateSystem=q.WebGLArrayRenderTarget=q.WebGL3DRenderTarget=q.WebGL1Renderer=q.VideoTexture=q.VectorKeyframeTrack=q.Vector4=q.Vector3=q.Vector2=q.VSMShadowMap=q.UnsignedShortType=q.UnsignedShort5551Type=q.UnsignedShort4444Type=q.UnsignedIntType=q.UnsignedInt248Type=q.UnsignedByteType=q.UniformsUtils=q.UniformsLib=q.UniformsGroup=q.Uniform=q.Uint8ClampedBufferAttribute=q.Uint8BufferAttribute=q.Uint32BufferAttribute=q.Uint16BufferAttribute=q.UVMapping=q.TwoPassDoubleSide=
q.TubeGeometry=q.TrianglesDrawMode=q.TriangleStripDrawMode=q.TriangleFanDrawMode=q.Triangle=q.TorusKnotGeometry=q.TorusGeometry=q.TextureLoader=q.Texture=q.TetrahedronGeometry=q.TangentSpaceNormalMap=q.TOUCH=q.SubtractiveBlending=q.SubtractEquation=q.StringKeyframeTrack=q.StreamReadUsage=q.StreamDrawUsage=q.StreamCopyUsage=q.StereoCamera=q.StaticReadUsage=q.StaticDrawUsage=q.StaticCopyUsage=q.SrcColorFactor=q.SrcAlphaSaturateFactor=q.SrcAlphaFactor=q.SpriteMaterial=q.Sprite=q.SpotLightHelper=q.SpotLight=
q.SplineCurve=q.SphericalHarmonics3=q.Spherical=q.SphereGeometry=q.Sphere=q.Source=q.SkinnedMesh=q.SkeletonHelper=q.Skeleton=q.ShortType=q.ShapeUtils=q.ShapePath=q.ShapeGeometry=q.Shape=q.ShadowMaterial=q.ShaderMaterial=q.ShaderLib=q.ShaderChunk=q.Scene=q.SRGBTransfer=q.SRGBColorSpace=q.SIGNED_RED_RGTC1_Format=q.SIGNED_RED_GREEN_RGTC2_Format=q.RingGeometry=q.ReverseSubtractEquation=q.ReplaceStencilOp=q.RepeatWrapping=q.RenderTarget=q.ReinhardToneMapping=q.RedIntegerFormat=q.RedFormat=q.RectAreaLight=
q.Rec709Primaries=q.Raycaster=q.Ray=q.RawShaderMaterial=q.RGIntegerFormat=q.RGFormat=q.RGB_S3TC_DXT1_Format=q.RGB_PVRTC_4BPPV1_Format=q.RGB_PVRTC_2BPPV1_Format=q.RGB_ETC2_Format=q.RGB_ETC1_Format=q.RGB_BPTC_UNSIGNED_Format=void 0;q.sRGBEncoding=q._SRGBAFormat=q.ZeroStencilOp=q.ZeroSlopeEnding=q.ZeroFactor=q.ZeroCurvatureEnding=q.WrapAroundEnding=q.WireframeGeometry=q.WebGPUCoordinateSystem=q.WebGLRenderer=q.WebGLRenderTarget=q.WebGLMultipleRenderTargets=void 0;q.REVISION="158";q.MOUSE={LEFT:0,MIDDLE:1,
RIGHT:2,ROTATE:0,DOLLY:1,PAN:2};q.TOUCH={ROTATE:0,PAN:1,DOLLY_PAN:2,DOLLY_ROTATE:3};q.CullFaceNone=0;q.CullFaceBack=1;q.CullFaceFront=2;q.CullFaceFrontBack=3;q.BasicShadowMap=0;q.PCFShadowMap=1;q.PCFSoftShadowMap=2;q.VSMShadowMap=3;q.FrontSide=0;q.BackSide=1;q.DoubleSide=2;q.TwoPassDoubleSide=2;q.NoBlending=0;q.NormalBlending=1;q.AdditiveBlending=2;q.SubtractiveBlending=3;q.MultiplyBlending=4;q.CustomBlending=5;q.AddEquation=100;q.SubtractEquation=101;q.ReverseSubtractEquation=102;q.MinEquation=103;
q.MaxEquation=104;q.ZeroFactor=200;q.OneFactor=201;q.SrcColorFactor=202;q.OneMinusSrcColorFactor=203;q.SrcAlphaFactor=204;q.OneMinusSrcAlphaFactor=205;q.DstAlphaFactor=206;q.OneMinusDstAlphaFactor=207;q.DstColorFactor=208;q.OneMinusDstColorFactor=209;q.SrcAlphaSaturateFactor=210;q.ConstantColorFactor=211;q.OneMinusConstantColorFactor=212;q.ConstantAlphaFactor=213;q.OneMinusConstantAlphaFactor=214;q.NeverDepth=0;q.AlwaysDepth=1;q.LessDepth=2;q.LessEqualDepth=3;q.EqualDepth=4;q.GreaterEqualDepth=5;
q.GreaterDepth=6;q.NotEqualDepth=7;q.MultiplyOperation=0;q.MixOperation=1;q.AddOperation=2;q.NoToneMapping=0;q.LinearToneMapping=1;q.ReinhardToneMapping=2;q.CineonToneMapping=3;q.ACESFilmicToneMapping=4;q.CustomToneMapping=5;q.AttachedBindMode="attached";q.DetachedBindMode="detached";q.UVMapping=300;q.CubeReflectionMapping=301;q.CubeRefractionMapping=302;q.EquirectangularReflectionMapping=303;q.EquirectangularRefractionMapping=304;q.CubeUVReflectionMapping=306;q.RepeatWrapping=1E3;q.ClampToEdgeWrapping=
1001;q.MirroredRepeatWrapping=1002;q.NearestFilter=1003;q.NearestMipmapNearestFilter=1004;q.NearestMipMapNearestFilter=1004;q.NearestMipmapLinearFilter=1005;q.NearestMipMapLinearFilter=1005;q.LinearFilter=1006;q.LinearMipmapNearestFilter=1007;q.LinearMipMapNearestFilter=1007;q.LinearMipmapLinearFilter=1008;q.LinearMipMapLinearFilter=1008;q.UnsignedByteType=1009;q.ByteType=1010;q.ShortType=1011;q.UnsignedShortType=1012;q.IntType=1013;q.UnsignedIntType=1014;q.FloatType=1015;q.HalfFloatType=1016;q.UnsignedShort4444Type=
1017;q.UnsignedShort5551Type=1018;q.UnsignedInt248Type=1020;q.AlphaFormat=1021;q.RGBAFormat=1023;q.LuminanceFormat=1024;q.LuminanceAlphaFormat=1025;q.DepthFormat=1026;q.DepthStencilFormat=1027;q.RedFormat=1028;q.RedIntegerFormat=1029;q.RGFormat=1030;q.RGIntegerFormat=1031;q.RGBAIntegerFormat=1033;q.RGB_S3TC_DXT1_Format=33776;q.RGBA_S3TC_DXT1_Format=33777;q.RGBA_S3TC_DXT3_Format=33778;q.RGBA_S3TC_DXT5_Format=33779;q.RGB_PVRTC_4BPPV1_Format=35840;q.RGB_PVRTC_2BPPV1_Format=35841;q.RGBA_PVRTC_4BPPV1_Format=
35842;q.RGBA_PVRTC_2BPPV1_Format=35843;q.RGB_ETC1_Format=36196;q.RGB_ETC2_Format=37492;q.RGBA_ETC2_EAC_Format=37496;q.RGBA_ASTC_4x4_Format=37808;q.RGBA_ASTC_5x4_Format=37809;q.RGBA_ASTC_5x5_Format=37810;q.RGBA_ASTC_6x5_Format=37811;q.RGBA_ASTC_6x6_Format=37812;q.RGBA_ASTC_8x5_Format=37813;q.RGBA_ASTC_8x6_Format=37814;q.RGBA_ASTC_8x8_Format=37815;q.RGBA_ASTC_10x5_Format=37816;q.RGBA_ASTC_10x6_Format=37817;q.RGBA_ASTC_10x8_Format=37818;q.RGBA_ASTC_10x10_Format=37819;q.RGBA_ASTC_12x10_Format=37820;q.RGBA_ASTC_12x12_Format=
37821;q.RGBA_BPTC_Format=36492;q.RGB_BPTC_SIGNED_Format=36494;q.RGB_BPTC_UNSIGNED_Format=36495;q.RED_RGTC1_Format=36283;q.SIGNED_RED_RGTC1_Format=36284;q.RED_GREEN_RGTC2_Format=36285;q.SIGNED_RED_GREEN_RGTC2_Format=36286;q.LoopOnce=2200;q.LoopRepeat=2201;q.LoopPingPong=2202;q.InterpolateDiscrete=2300;q.InterpolateLinear=2301;q.InterpolateSmooth=2302;q.ZeroCurvatureEnding=2400;q.ZeroSlopeEnding=2401;q.WrapAroundEnding=2402;q.NormalAnimationBlendMode=2500;q.AdditiveAnimationBlendMode=2501;q.TrianglesDrawMode=
0;q.TriangleStripDrawMode=1;q.TriangleFanDrawMode=2;q.LinearEncoding=3E3;q.sRGBEncoding=3001;q.BasicDepthPacking=3200;q.RGBADepthPacking=3201;q.TangentSpaceNormalMap=0;q.ObjectSpaceNormalMap=1;q.NoColorSpace="";q.SRGBColorSpace="srgb";q.LinearSRGBColorSpace="srgb-linear";q.DisplayP3ColorSpace="display-p3";q.LinearDisplayP3ColorSpace="display-p3-linear";q.LinearTransfer="linear";q.SRGBTransfer="srgb";q.Rec709Primaries="rec709";q.P3Primaries="p3";q.ZeroStencilOp=0;q.KeepStencilOp=7680;q.ReplaceStencilOp=
7681;q.IncrementStencilOp=7682;q.DecrementStencilOp=7683;q.IncrementWrapStencilOp=34055;q.DecrementWrapStencilOp=34056;q.InvertStencilOp=5386;q.NeverStencilFunc=512;q.LessStencilFunc=513;q.EqualStencilFunc=514;q.LessEqualStencilFunc=515;q.GreaterStencilFunc=516;q.NotEqualStencilFunc=517;q.GreaterEqualStencilFunc=518;q.AlwaysStencilFunc=519;q.NeverCompare=512;q.LessCompare=513;q.EqualCompare=514;q.LessEqualCompare=515;q.GreaterCompare=516;q.NotEqualCompare=517;q.GreaterEqualCompare=518;q.AlwaysCompare=
519;q.StaticDrawUsage=35044;q.DynamicDrawUsage=35048;q.StreamDrawUsage=35040;q.StaticReadUsage=35045;q.DynamicReadUsage=35049;q.StreamReadUsage=35041;q.StaticCopyUsage=35046;q.DynamicCopyUsage=35050;q.StreamCopyUsage=35042;q.GLSL1="100";q.GLSL3="300 es";q._SRGBAFormat=1035;q.WebGLCoordinateSystem=2E3;q.WebGPUCoordinateSystem=2001;class Pc{addEventListener(a,b){void 0===this._listeners&&(this._listeners={});const c=this._listeners;void 0===c[a]&&(c[a]=[]);-1===c[a].indexOf(b)&&c[a].push(b)}hasEventListener(a,
b){if(void 0===this._listeners)return!1;const c=this._listeners;return void 0!==c[a]&&-1!==c[a].indexOf(b)}removeEventListener(a,b){void 0!==this._listeners&&(a=this._listeners[a],void 0!==a&&(b=a.indexOf(b),-1!==b&&a.splice(b,1)))}dispatchEvent(a){if(void 0!==this._listeners){var b=this._listeners[a.type];if(void 0!==b){a.target=this;b=b.slice(0);for(let c=0,d=b.length;c<d;c++)b[c].call(this,a);a.target=null}}}}q.EventDispatcher=Pc;const Sb="00 01 02 03 04 05 06 07 08 09 0a 0b 0c 0d 0e 0f 10 11 12 13 14 15 16 17 18 19 1a 1b 1c 1d 1e 1f 20 21 22 23 24 25 26 27 28 29 2a 2b 2c 2d 2e 2f 30 31 32 33 34 35 36 37 38 39 3a 3b 3c 3d 3e 3f 40 41 42 43 44 45 46 47 48 49 4a 4b 4c 4d 4e 4f 50 51 52 53 54 55 56 57 58 59 5a 5b 5c 5d 5e 5f 60 61 62 63 64 65 66 67 68 69 6a 6b 6c 6d 6e 6f 70 71 72 73 74 75 76 77 78 79 7a 7b 7c 7d 7e 7f 80 81 82 83 84 85 86 87 88 89 8a 8b 8c 8d 8e 8f 90 91 92 93 94 95 96 97 98 99 9a 9b 9c 9d 9e 9f a0 a1 a2 a3 a4 a5 a6 a7 a8 a9 aa ab ac ad ae af b0 b1 b2 b3 b4 b5 b6 b7 b8 b9 ba bb bc bd be bf c0 c1 c2 c3 c4 c5 c6 c7 c8 c9 ca cb cc cd ce cf d0 d1 d2 d3 d4 d5 d6 d7 d8 d9 da db dc dd de df e0 e1 e2 e3 e4 e5 e6 e7 e8 e9 ea eb ec ed ee ef f0 f1 f2 f3 f4 f5 f6 f7 f8 f9 fa fb fc fd fe ff".split(" ");
let ph=1234567;const wd=Math.PI/180,Wd=180/Math.PI;q.MathUtils={DEG2RAD:wd,RAD2DEG:Wd,generateUUID:$b,clamp:yb,euclideanModulo:Gf,mapLinear:function(a,b,c,d,f){return d+(a-b)*(f-d)/(c-b)},inverseLerp:function(a,b,c){return a!==b?(c-a)/(b-a):0},lerp:le,damp:function(a,b,c,d){return le(a,b,1-Math.exp(-c*d))},pingpong:function(a,b=1){return b-Math.abs(Gf(a,2*b)-b)},smoothstep:function(a,b,c){if(a<=b)return 0;if(a>=c)return 1;a=(a-b)/(c-b);return a*a*(3-2*a)},smootherstep:function(a,b,c){if(a<=b)return 0;
if(a>=c)return 1;a=(a-b)/(c-b);return a*a*a*(a*(6*a-15)+10)},randInt:function(a,b){return a+Math.floor(Math.random()*(b-a+1))},randFloat:function(a,b){return a+Math.random()*(b-a)},randFloatSpread:function(a){return a*(.5-Math.random())},seededRandom:function(a){void 0!==a&&(ph=a);a=ph+=1831565813;a=Math.imul(a^a>>>15,a|1);a^=a+Math.imul(a^a>>>7,a|61);return((a^a>>>14)>>>0)/4294967296},degToRad:function(a){return a*wd},radToDeg:function(a){return a*Wd},isPowerOfTwo:Hf,ceilPowerOfTwo:lc,floorPowerOfTwo:Ne,
setQuaternionFromProperEuler:function(a,b,c,d,f){var g=Math.cos;const l=Math.sin,m=g(c/2);c=l(c/2);const n=g((b+d)/2),t=l((b+d)/2),u=g((b-d)/2),v=l((b-d)/2);g=g((d-b)/2);b=l((d-b)/2);switch(f){case "XYX":a.set(m*t,c*u,c*v,m*n);break;case "YZY":a.set(c*v,m*t,c*u,m*n);break;case "ZXZ":a.set(c*u,c*v,m*t,m*n);break;case "XZX":a.set(m*t,c*b,c*g,m*n);break;case "YXY":a.set(c*g,m*t,c*b,m*n);break;case "ZYZ":a.set(c*b,c*g,m*t,m*n);break;default:console.warn("THREE.MathUtils: .setQuaternionFromProperEuler() encountered an unknown order: "+
f)}},normalize:Xa,denormalize:B};class sa{constructor(a=0,b=0){sa.prototype.isVector2=!0;this.x=a;this.y=b}get width(){return this.x}set width(a){this.x=a}get height(){return this.y}set height(a){this.y=a}set(a,b){this.x=a;this.y=b;return this}setScalar(a){this.y=this.x=a;return this}setX(a){this.x=a;return this}setY(a){this.y=a;return this}setComponent(a,b){switch(a){case 0:this.x=b;break;case 1:this.y=b;break;default:throw Error("index is out of range: "+a);}return this}getComponent(a){switch(a){case 0:return this.x;
case 1:return this.y;default:throw Error("index is out of range: "+a);}}clone(){return new this.constructor(this.x,this.y)}copy(a){this.x=a.x;this.y=a.y;return this}add(a){this.x+=a.x;this.y+=a.y;return this}addScalar(a){this.x+=a;this.y+=a;return this}addVectors(a,b){this.x=a.x+b.x;this.y=a.y+b.y;return this}addScaledVector(a,b){this.x+=a.x*b;this.y+=a.y*b;return this}sub(a){this.x-=a.x;this.y-=a.y;return this}subScalar(a){this.x-=a;this.y-=a;return this}subVectors(a,b){this.x=a.x-b.x;this.y=a.y-
b.y;return this}multiply(a){this.x*=a.x;this.y*=a.y;return this}multiplyScalar(a){this.x*=a;this.y*=a;return this}divide(a){this.x/=a.x;this.y/=a.y;return this}divideScalar(a){return this.multiplyScalar(1/a)}applyMatrix3(a){const b=this.x,c=this.y;a=a.elements;this.x=a[0]*b+a[3]*c+a[6];this.y=a[1]*b+a[4]*c+a[7];return this}min(a){this.x=Math.min(this.x,a.x);this.y=Math.min(this.y,a.y);return this}max(a){this.x=Math.max(this.x,a.x);this.y=Math.max(this.y,a.y);return this}clamp(a,b){this.x=Math.max(a.x,
Math.min(b.x,this.x));this.y=Math.max(a.y,Math.min(b.y,this.y));return this}clampScalar(a,b){this.x=Math.max(a,Math.min(b,this.x));this.y=Math.max(a,Math.min(b,this.y));return this}clampLength(a,b){const c=this.length();return this.divideScalar(c||1).multiplyScalar(Math.max(a,Math.min(b,c)))}floor(){this.x=Math.floor(this.x);this.y=Math.floor(this.y);return this}ceil(){this.x=Math.ceil(this.x);this.y=Math.ceil(this.y);return this}round(){this.x=Math.round(this.x);this.y=Math.round(this.y);return this}roundToZero(){this.x=
Math.trunc(this.x);this.y=Math.trunc(this.y);return this}negate(){this.x=-this.x;this.y=-this.y;return this}dot(a){return this.x*a.x+this.y*a.y}cross(a){return this.x*a.y-this.y*a.x}lengthSq(){return this.x*this.x+this.y*this.y}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)}normalize(){return this.divideScalar(this.length()||1)}angle(){return Math.atan2(-this.y,-this.x)+Math.PI}angleTo(a){const b=Math.sqrt(this.lengthSq()*a.lengthSq());
if(0===b)return Math.PI/2;a=this.dot(a)/b;return Math.acos(yb(a,-1,1))}distanceTo(a){return Math.sqrt(this.distanceToSquared(a))}distanceToSquared(a){const b=this.x-a.x;a=this.y-a.y;return b*b+a*a}manhattanDistanceTo(a){return Math.abs(this.x-a.x)+Math.abs(this.y-a.y)}setLength(a){return this.normalize().multiplyScalar(a)}lerp(a,b){this.x+=(a.x-this.x)*b;this.y+=(a.y-this.y)*b;return this}lerpVectors(a,b,c){this.x=a.x+(b.x-a.x)*c;this.y=a.y+(b.y-a.y)*c;return this}equals(a){return a.x===this.x&&a.y===
this.y}fromArray(a,b=0){this.x=a[b];this.y=a[b+1];return this}toArray(a=[],b=0){a[b]=this.x;a[b+1]=this.y;return a}fromBufferAttribute(a,b){this.x=a.getX(b);this.y=a.getY(b);return this}rotateAround(a,b){const c=Math.cos(b);b=Math.sin(b);const d=this.x-a.x,f=this.y-a.y;this.x=d*c-f*b+a.x;this.y=d*b+f*c+a.y;return this}random(){this.x=Math.random();this.y=Math.random();return this}*[Symbol.iterator](){yield this.x;yield this.y}}q.Vector2=sa;class Za{constructor(a,b,c,d,f,g,l,m,n){Za.prototype.isMatrix3=
!0;this.elements=[1,0,0,0,1,0,0,0,1];void 0!==a&&this.set(a,b,c,d,f,g,l,m,n)}set(a,b,c,d,f,g,l,m,n){const t=this.elements;t[0]=a;t[1]=d;t[2]=l;t[3]=b;t[4]=f;t[5]=m;t[6]=c;t[7]=g;t[8]=n;return this}identity(){this.set(1,0,0,0,1,0,0,0,1);return this}copy(a){const b=this.elements;a=a.elements;b[0]=a[0];b[1]=a[1];b[2]=a[2];b[3]=a[3];b[4]=a[4];b[5]=a[5];b[6]=a[6];b[7]=a[7];b[8]=a[8];return this}extractBasis(a,b,c){a.setFromMatrix3Column(this,0);b.setFromMatrix3Column(this,1);c.setFromMatrix3Column(this,
2);return this}setFromMatrix4(a){a=a.elements;this.set(a[0],a[4],a[8],a[1],a[5],a[9],a[2],a[6],a[10]);return this}multiply(a){return this.multiplyMatrices(this,a)}premultiply(a){return this.multiplyMatrices(a,this)}multiplyMatrices(a,b){var c=a.elements,d=b.elements;b=this.elements;a=c[0];const f=c[3],g=c[6],l=c[1],m=c[4],n=c[7],t=c[2],u=c[5];c=c[8];const v=d[0],A=d[3],F=d[6],D=d[1],E=d[4],y=d[7],J=d[2],L=d[5];d=d[8];b[0]=a*v+f*D+g*J;b[3]=a*A+f*E+g*L;b[6]=a*F+f*y+g*d;b[1]=l*v+m*D+n*J;b[4]=l*A+m*E+
n*L;b[7]=l*F+m*y+n*d;b[2]=t*v+u*D+c*J;b[5]=t*A+u*E+c*L;b[8]=t*F+u*y+c*d;return this}multiplyScalar(a){const b=this.elements;b[0]*=a;b[3]*=a;b[6]*=a;b[1]*=a;b[4]*=a;b[7]*=a;b[2]*=a;b[5]*=a;b[8]*=a;return this}determinant(){var a=this.elements;const b=a[0],c=a[1],d=a[2],f=a[3],g=a[4],l=a[5],m=a[6],n=a[7];a=a[8];return b*g*a-b*l*n-c*f*a+c*l*m+d*f*n-d*g*m}invert(){const a=this.elements,b=a[0],c=a[1],d=a[2],f=a[3],g=a[4],l=a[5],m=a[6],n=a[7],t=a[8],u=t*g-l*n,v=l*m-t*f,A=n*f-g*m;var F=b*u+c*v+d*A;if(0===
F)return this.set(0,0,0,0,0,0,0,0,0);F=1/F;a[0]=u*F;a[1]=(d*n-t*c)*F;a[2]=(l*c-d*g)*F;a[3]=v*F;a[4]=(t*b-d*m)*F;a[5]=(d*f-l*b)*F;a[6]=A*F;a[7]=(c*m-n*b)*F;a[8]=(g*b-c*f)*F;return this}transpose(){let a;const b=this.elements;a=b[1];b[1]=b[3];b[3]=a;a=b[2];b[2]=b[6];b[6]=a;a=b[5];b[5]=b[7];b[7]=a;return this}getNormalMatrix(a){return this.setFromMatrix4(a).invert().transpose()}transposeIntoArray(a){const b=this.elements;a[0]=b[0];a[1]=b[3];a[2]=b[6];a[3]=b[1];a[4]=b[4];a[5]=b[7];a[6]=b[2];a[7]=b[5];
a[8]=b[8];return this}setUvTransform(a,b,c,d,f,g,l){const m=Math.cos(f);f=Math.sin(f);this.set(c*m,c*f,-c*(m*g+f*l)+g+a,-d*f,d*m,-d*(-f*g+m*l)+l+b,0,0,1);return this}scale(a,b){this.premultiply(cg.makeScale(a,b));return this}rotate(a){this.premultiply(cg.makeRotation(-a));return this}translate(a,b){this.premultiply(cg.makeTranslation(a,b));return this}makeTranslation(a,b){a.isVector2?this.set(1,0,a.x,0,1,a.y,0,0,1):this.set(1,0,a,0,1,b,0,0,1);return this}makeRotation(a){const b=Math.cos(a);a=Math.sin(a);
this.set(b,-a,0,a,b,0,0,0,1);return this}makeScale(a,b){this.set(a,0,0,0,b,0,0,0,1);return this}equals(a){const b=this.elements;a=a.elements;for(let c=0;9>c;c++)if(b[c]!==a[c])return!1;return!0}fromArray(a,b=0){for(let c=0;9>c;c++)this.elements[c]=a[c+b];return this}toArray(a=[],b=0){const c=this.elements;a[b]=c[0];a[b+1]=c[1];a[b+2]=c[2];a[b+3]=c[3];a[b+4]=c[4];a[b+5]=c[5];a[b+6]=c[6];a[b+7]=c[7];a[b+8]=c[8];return a}clone(){return(new this.constructor).fromArray(this.elements)}}q.Matrix3=Za;const cg=
new Za,Xd={Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array},Eg={},qh=(new Za).set(.8224621,.177538,0,.0331941,.9668058,0,.0170827,.0723974,.9105199),dg=(new Za).set(1.2249401,-.2249404,0,-.0420569,1.0420571,0,-.0196376,-.0786361,1.0982735),gf={["srgb-linear"]:{transfer:"linear",primaries:"rec709",toReference:a=>a,fromReference:a=>a},srgb:{transfer:"srgb",primaries:"rec709",toReference:a=>a.convertSRGBToLinear(),fromReference:a=>a.convertLinearToSRGB()},
["display-p3-linear"]:{transfer:"linear",primaries:"p3",toReference:a=>a.applyMatrix3(dg),fromReference:a=>a.applyMatrix3(qh)},["display-p3"]:{transfer:"srgb",primaries:"p3",toReference:a=>a.convertSRGBToLinear().applyMatrix3(dg),fromReference:a=>a.applyMatrix3(qh).convertLinearToSRGB()}},hf=new Set(["srgb-linear","display-p3-linear"]),jb={enabled:!0,_workingColorSpace:"srgb-linear",get legacyMode(){console.warn("THREE.ColorManagement: .legacyMode\x3dfalse renamed to .enabled\x3dtrue in r150.");return!this.enabled},
set legacyMode(a){console.warn("THREE.ColorManagement: .legacyMode\x3dfalse renamed to .enabled\x3dtrue in r150.");this.enabled=!a},get workingColorSpace(){return this._workingColorSpace},set workingColorSpace(a){if(!hf.has(a))throw Error(`Unsupported working color space, "${a}".`);this._workingColorSpace=a},convert:function(a,b,c){if(!1===this.enabled||b===c||!b||!c)return a;b=gf[b].toReference;c=gf[c].fromReference;return c(b(a))},fromWorkingColorSpace:function(a,b){return this.convert(a,this._workingColorSpace,
b)},toWorkingColorSpace:function(a,b){return this.convert(a,b,this._workingColorSpace)},getPrimaries:function(a){return gf[a].primaries},getTransfer:function(a){return""===a?"linear":gf[a].transfer}};q.ColorManagement=jb;let Yd;class If{static getDataURL(a){if(/^data:/i.test(a.src)||"undefined"===typeof HTMLCanvasElement)return a.src;if(a instanceof HTMLCanvasElement)var b=a;else void 0===Yd&&(Yd=md("canvas")),Yd.width=a.width,Yd.height=a.height,b=Yd.getContext("2d"),a instanceof ImageData?b.putImageData(a,
0,0):b.drawImage(a,0,0,a.width,a.height),b=Yd;return 2048<b.width||2048<b.height?(console.warn("THREE.ImageUtils.getDataURL: Image converted to jpg for performance reasons",a),b.toDataURL("image/jpeg",.6)):b.toDataURL("image/png")}static sRGBToLinear(a){if("undefined"!==typeof HTMLImageElement&&a instanceof HTMLImageElement||"undefined"!==typeof HTMLCanvasElement&&a instanceof HTMLCanvasElement||"undefined"!==typeof ImageBitmap&&a instanceof ImageBitmap){var b=md("canvas");b.width=a.width;b.height=
a.height;var c=b.getContext("2d");c.drawImage(a,0,0,a.width,a.height);a=c.getImageData(0,0,a.width,a.height);const d=a.data;for(let f=0;f<d.length;f++)d[f]=255*nd(d[f]/255);c.putImageData(a,0,0);return b}if(a.data){b=a.data.slice(0);for(c=0;c<b.length;c++)b[c]=b instanceof Uint8Array||b instanceof Uint8ClampedArray?Math.floor(255*nd(b[c]/255)):nd(b[c]);return{data:b,width:a.width,height:a.height}}console.warn("THREE.ImageUtils.sRGBToLinear(): Unsupported image type. No color space conversion applied.");
return a}}q.ImageUtils=If;let $i=0;class xd{constructor(a=null){this.isSource=!0;Object.defineProperty(this,"id",{value:$i++});this.uuid=$b();this.data=a;this.version=0}set needsUpdate(a){!0===a&&this.version++}toJSON(a){const b=void 0===a||"string"===typeof a;if(!b&&void 0!==a.images[this.uuid])return a.images[this.uuid];const c={uuid:this.uuid,url:""},d=this.data;if(null!==d){let f;if(Array.isArray(d)){f=[];for(let g=0,l=d.length;g<l;g++)d[g].isDataTexture?f.push(ne(d[g].image)):f.push(ne(d[g]))}else f=
ne(d);c.url=f}b||(a.images[this.uuid]=c);return c}}q.Source=xd;let aj=0;class Gb extends Pc{constructor(a=Gb.DEFAULT_IMAGE,b=Gb.DEFAULT_MAPPING,c=1001,d=1001,f=1006,g=1008,l=1023,m=1009,n=Gb.DEFAULT_ANISOTROPY,t=""){super();this.isTexture=!0;Object.defineProperty(this,"id",{value:aj++});this.uuid=$b();this.name="";this.source=new xd(a);this.mipmaps=[];this.mapping=b;this.channel=0;this.wrapS=c;this.wrapT=d;this.magFilter=f;this.minFilter=g;this.anisotropy=n;this.format=l;this.internalFormat=null;
this.type=m;this.offset=new sa(0,0);this.repeat=new sa(1,1);this.center=new sa(0,0);this.rotation=0;this.matrixAutoUpdate=!0;this.matrix=new Za;this.generateMipmaps=!0;this.premultiplyAlpha=!1;this.flipY=!0;this.unpackAlignment=4;"string"===typeof t?this.colorSpace=t:(Gd("THREE.Texture: Property .encoding has been replaced by .colorSpace."),this.colorSpace=3001===t?"srgb":"");this.userData={};this.version=0;this.onUpdate=null;this.needsPMREMUpdate=this.isRenderTargetTexture=!1}get image(){return this.source.data}set image(a=
null){this.source.data=a}updateMatrix(){this.matrix.setUvTransform(this.offset.x,this.offset.y,this.repeat.x,this.repeat.y,this.rotation,this.center.x,this.center.y)}clone(){return(new this.constructor).copy(this)}copy(a){this.name=a.name;this.source=a.source;this.mipmaps=a.mipmaps.slice(0);this.mapping=a.mapping;this.channel=a.channel;this.wrapS=a.wrapS;this.wrapT=a.wrapT;this.magFilter=a.magFilter;this.minFilter=a.minFilter;this.anisotropy=a.anisotropy;this.format=a.format;this.internalFormat=a.internalFormat;
this.type=a.type;this.offset.copy(a.offset);this.repeat.copy(a.repeat);this.center.copy(a.center);this.rotation=a.rotation;this.matrixAutoUpdate=a.matrixAutoUpdate;this.matrix.copy(a.matrix);this.generateMipmaps=a.generateMipmaps;this.premultiplyAlpha=a.premultiplyAlpha;this.flipY=a.flipY;this.unpackAlignment=a.unpackAlignment;this.colorSpace=a.colorSpace;this.userData=JSON.parse(JSON.stringify(a.userData));this.needsUpdate=!0;return this}toJSON(a){const b=void 0===a||"string"===typeof a;if(!b&&void 0!==
a.textures[this.uuid])return a.textures[this.uuid];const c={metadata:{version:4.6,type:"Texture",generator:"Texture.toJSON"},uuid:this.uuid,name:this.name,image:this.source.toJSON(a).uuid,mapping:this.mapping,channel:this.channel,repeat:[this.repeat.x,this.repeat.y],offset:[this.offset.x,this.offset.y],center:[this.center.x,this.center.y],rotation:this.rotation,wrap:[this.wrapS,this.wrapT],format:this.format,internalFormat:this.internalFormat,type:this.type,colorSpace:this.colorSpace,minFilter:this.minFilter,
magFilter:this.magFilter,anisotropy:this.anisotropy,flipY:this.flipY,generateMipmaps:this.generateMipmaps,premultiplyAlpha:this.premultiplyAlpha,unpackAlignment:this.unpackAlignment};0<Object.keys(this.userData).length&&(c.userData=this.userData);b||(a.textures[this.uuid]=c);return c}dispose(){this.dispatchEvent({type:"dispose"})}transformUv(a){if(300!==this.mapping)return a;a.applyMatrix3(this.matrix);if(0>a.x||1<a.x)switch(this.wrapS){case 1E3:a.x-=Math.floor(a.x);break;case 1001:a.x=0>a.x?0:1;
break;case 1002:a.x=1===Math.abs(Math.floor(a.x)%2)?Math.ceil(a.x)-a.x:a.x-Math.floor(a.x)}if(0>a.y||1<a.y)switch(this.wrapT){case 1E3:a.y-=Math.floor(a.y);break;case 1001:a.y=0>a.y?0:1;break;case 1002:a.y=1===Math.abs(Math.floor(a.y)%2)?Math.ceil(a.y)-a.y:a.y-Math.floor(a.y)}this.flipY&&(a.y=1-a.y);return a}set needsUpdate(a){!0===a&&(this.version++,this.source.needsUpdate=!0)}get encoding(){Gd("THREE.Texture: Property .encoding has been replaced by .colorSpace.");return"srgb"===this.colorSpace?
3001:3E3}set encoding(a){Gd("THREE.Texture: Property .encoding has been replaced by .colorSpace.");this.colorSpace=3001===a?"srgb":""}}q.Texture=Gb;Gb.DEFAULT_IMAGE=null;Gb.DEFAULT_MAPPING=300;Gb.DEFAULT_ANISOTROPY=1;class mb{constructor(a=0,b=0,c=0,d=1){mb.prototype.isVector4=!0;this.x=a;this.y=b;this.z=c;this.w=d}get width(){return this.z}set width(a){this.z=a}get height(){return this.w}set height(a){this.w=a}set(a,b,c,d){this.x=a;this.y=b;this.z=c;this.w=d;return this}setScalar(a){this.w=this.z=
this.y=this.x=a;return this}setX(a){this.x=a;return this}setY(a){this.y=a;return this}setZ(a){this.z=a;return this}setW(a){this.w=a;return this}setComponent(a,b){switch(a){case 0:this.x=b;break;case 1:this.y=b;break;case 2:this.z=b;break;case 3:this.w=b;break;default:throw Error("index is out of range: "+a);}return this}getComponent(a){switch(a){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw Error("index is out of range: "+a);}}clone(){return new this.constructor(this.x,
this.y,this.z,this.w)}copy(a){this.x=a.x;this.y=a.y;this.z=a.z;this.w=void 0!==a.w?a.w:1;return this}add(a){this.x+=a.x;this.y+=a.y;this.z+=a.z;this.w+=a.w;return this}addScalar(a){this.x+=a;this.y+=a;this.z+=a;this.w+=a;return this}addVectors(a,b){this.x=a.x+b.x;this.y=a.y+b.y;this.z=a.z+b.z;this.w=a.w+b.w;return this}addScaledVector(a,b){this.x+=a.x*b;this.y+=a.y*b;this.z+=a.z*b;this.w+=a.w*b;return this}sub(a){this.x-=a.x;this.y-=a.y;this.z-=a.z;this.w-=a.w;return this}subScalar(a){this.x-=a;this.y-=
a;this.z-=a;this.w-=a;return this}subVectors(a,b){this.x=a.x-b.x;this.y=a.y-b.y;this.z=a.z-b.z;this.w=a.w-b.w;return this}multiply(a){this.x*=a.x;this.y*=a.y;this.z*=a.z;this.w*=a.w;return this}multiplyScalar(a){this.x*=a;this.y*=a;this.z*=a;this.w*=a;return this}applyMatrix4(a){const b=this.x,c=this.y,d=this.z,f=this.w;a=a.elements;this.x=a[0]*b+a[4]*c+a[8]*d+a[12]*f;this.y=a[1]*b+a[5]*c+a[9]*d+a[13]*f;this.z=a[2]*b+a[6]*c+a[10]*d+a[14]*f;this.w=a[3]*b+a[7]*c+a[11]*d+a[15]*f;return this}divideScalar(a){return this.multiplyScalar(1/
a)}setAxisAngleFromQuaternion(a){this.w=2*Math.acos(a.w);const b=Math.sqrt(1-a.w*a.w);1E-4>b?(this.x=1,this.z=this.y=0):(this.x=a.x/b,this.y=a.y/b,this.z=a.z/b);return this}setAxisAngleFromRotationMatrix(a){a=a.elements;var b=a[0];var c=a[4];var d=a[8];const f=a[1];var g=a[5],l=a[9];var m=a[2];var n=a[6];var t=a[10];if(.01>Math.abs(c-f)&&.01>Math.abs(d-m)&&.01>Math.abs(l-n)){if(.1>Math.abs(c+f)&&.1>Math.abs(d+m)&&.1>Math.abs(l+n)&&.1>Math.abs(b+g+t-3))return this.set(1,0,0,0),this;a=Math.PI;b=(b+
1)/2;g=(g+1)/2;t=(t+1)/2;c=(c+f)/4;d=(d+m)/4;l=(l+n)/4;b>g&&b>t?.01>b?(n=0,c=m=.707106781):(n=Math.sqrt(b),m=c/n,c=d/n):g>t?.01>g?(n=.707106781,m=0,c=.707106781):(m=Math.sqrt(g),n=c/m,c=l/m):.01>t?(m=n=.707106781,c=0):(c=Math.sqrt(t),n=d/c,m=l/c);this.set(n,m,c,a);return this}a=Math.sqrt((n-l)*(n-l)+(d-m)*(d-m)+(f-c)*(f-c));.001>Math.abs(a)&&(a=1);this.x=(n-l)/a;this.y=(d-m)/a;this.z=(f-c)/a;this.w=Math.acos((b+g+t-1)/2);return this}min(a){this.x=Math.min(this.x,a.x);this.y=Math.min(this.y,a.y);this.z=
Math.min(this.z,a.z);this.w=Math.min(this.w,a.w);return this}max(a){this.x=Math.max(this.x,a.x);this.y=Math.max(this.y,a.y);this.z=Math.max(this.z,a.z);this.w=Math.max(this.w,a.w);return this}clamp(a,b){this.x=Math.max(a.x,Math.min(b.x,this.x));this.y=Math.max(a.y,Math.min(b.y,this.y));this.z=Math.max(a.z,Math.min(b.z,this.z));this.w=Math.max(a.w,Math.min(b.w,this.w));return this}clampScalar(a,b){this.x=Math.max(a,Math.min(b,this.x));this.y=Math.max(a,Math.min(b,this.y));this.z=Math.max(a,Math.min(b,
this.z));this.w=Math.max(a,Math.min(b,this.w));return this}clampLength(a,b){const c=this.length();return this.divideScalar(c||1).multiplyScalar(Math.max(a,Math.min(b,c)))}floor(){this.x=Math.floor(this.x);this.y=Math.floor(this.y);this.z=Math.floor(this.z);this.w=Math.floor(this.w);return this}ceil(){this.x=Math.ceil(this.x);this.y=Math.ceil(this.y);this.z=Math.ceil(this.z);this.w=Math.ceil(this.w);return this}round(){this.x=Math.round(this.x);this.y=Math.round(this.y);this.z=Math.round(this.z);this.w=
Math.round(this.w);return this}roundToZero(){this.x=Math.trunc(this.x);this.y=Math.trunc(this.y);this.z=Math.trunc(this.z);this.w=Math.trunc(this.w);return this}negate(){this.x=-this.x;this.y=-this.y;this.z=-this.z;this.w=-this.w;return this}dot(a){return this.x*a.x+this.y*a.y+this.z*a.z+this.w*a.w}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+
Math.abs(this.z)+Math.abs(this.w)}normalize(){return this.divideScalar(this.length()||1)}setLength(a){return this.normalize().multiplyScalar(a)}lerp(a,b){this.x+=(a.x-this.x)*b;this.y+=(a.y-this.y)*b;this.z+=(a.z-this.z)*b;this.w+=(a.w-this.w)*b;return this}lerpVectors(a,b,c){this.x=a.x+(b.x-a.x)*c;this.y=a.y+(b.y-a.y)*c;this.z=a.z+(b.z-a.z)*c;this.w=a.w+(b.w-a.w)*c;return this}equals(a){return a.x===this.x&&a.y===this.y&&a.z===this.z&&a.w===this.w}fromArray(a,b=0){this.x=a[b];this.y=a[b+1];this.z=
a[b+2];this.w=a[b+3];return this}toArray(a=[],b=0){a[b]=this.x;a[b+1]=this.y;a[b+2]=this.z;a[b+3]=this.w;return a}fromBufferAttribute(a,b){this.x=a.getX(b);this.y=a.getY(b);this.z=a.getZ(b);this.w=a.getW(b);return this}random(){this.x=Math.random();this.y=Math.random();this.z=Math.random();this.w=Math.random();return this}*[Symbol.iterator](){yield this.x;yield this.y;yield this.z;yield this.w}}q.Vector4=mb;class rh extends Pc{constructor(a=1,b=1,c={}){super();this.isRenderTarget=!0;this.width=a;
this.height=b;this.depth=1;this.scissor=new mb(0,0,a,b);this.scissorTest=!1;this.viewport=new mb(0,0,a,b);a={width:a,height:b,depth:1};void 0!==c.encoding&&(Gd("THREE.WebGLRenderTarget: option.encoding has been replaced by option.colorSpace."),c.colorSpace=3001===c.encoding?"srgb":"");c=Object.assign({generateMipmaps:!1,internalFormat:null,minFilter:1006,depthBuffer:!0,stencilBuffer:!1,depthTexture:null,samples:0},c);this.texture=new Gb(a,c.mapping,c.wrapS,c.wrapT,c.magFilter,c.minFilter,c.format,
c.type,c.anisotropy,c.colorSpace);this.texture.isRenderTargetTexture=!0;this.texture.flipY=!1;this.texture.generateMipmaps=c.generateMipmaps;this.texture.internalFormat=c.internalFormat;this.depthBuffer=c.depthBuffer;this.stencilBuffer=c.stencilBuffer;this.depthTexture=c.depthTexture;this.samples=c.samples}setSize(a,b,c=1){if(this.width!==a||this.height!==b||this.depth!==c)this.width=a,this.height=b,this.depth=c,this.texture.image.width=a,this.texture.image.height=b,this.texture.image.depth=c,this.dispose();
this.viewport.set(0,0,a,b);this.scissor.set(0,0,a,b)}clone(){return(new this.constructor).copy(this)}copy(a){this.width=a.width;this.height=a.height;this.depth=a.depth;this.scissor.copy(a.scissor);this.scissorTest=a.scissorTest;this.viewport.copy(a.viewport);this.texture=a.texture.clone();this.texture.isRenderTargetTexture=!0;const b=Object.assign({},a.texture.image);this.texture.source=new xd(b);this.depthBuffer=a.depthBuffer;this.stencilBuffer=a.stencilBuffer;null!==a.depthTexture&&(this.depthTexture=
a.depthTexture.clone());this.samples=a.samples;return this}dispose(){this.dispatchEvent({type:"dispose"})}}q.RenderTarget=rh;class rc extends rh{constructor(a=1,b=1,c={}){super(a,b,c);this.isWebGLRenderTarget=!0}}q.WebGLRenderTarget=rc;class Ue extends Gb{constructor(a=null,b=1,c=1,d=1){super(null);this.isDataArrayTexture=!0;this.image={data:a,width:b,height:c,depth:d};this.minFilter=this.magFilter=1003;this.wrapR=1001;this.flipY=this.generateMipmaps=!1;this.unpackAlignment=1}}q.DataArrayTexture=
Ue;class bj extends rc{constructor(a=1,b=1,c=1){super(a,b);this.isWebGLArrayRenderTarget=!0;this.depth=c;this.texture=new Ue(null,a,b,c);this.texture.isRenderTargetTexture=!0}}q.WebGLArrayRenderTarget=bj;class xc extends Gb{constructor(a=null,b=1,c=1,d=1){super(null);this.isData3DTexture=!0;this.image={data:a,width:b,height:c,depth:d};this.minFilter=this.magFilter=1003;this.wrapR=1001;this.flipY=this.generateMipmaps=!1;this.unpackAlignment=1}}q.Data3DTexture=xc;class cj extends rc{constructor(a=1,
b=1,c=1){super(a,b);this.isWebGL3DRenderTarget=!0;this.depth=c;this.texture=new xc(null,a,b,c);this.texture.isRenderTargetTexture=!0}}q.WebGL3DRenderTarget=cj;class sh extends rc{constructor(a=1,b=1,c=1,d={}){super(a,b,d);this.isWebGLMultipleRenderTargets=!0;a=this.texture;this.texture=[];for(b=0;b<c;b++)this.texture[b]=a.clone(),this.texture[b].isRenderTargetTexture=!0}setSize(a,b,c=1){if(this.width!==a||this.height!==b||this.depth!==c){this.width=a;this.height=b;this.depth=c;for(let d=0,f=this.texture.length;d<
f;d++)this.texture[d].image.width=a,this.texture[d].image.height=b,this.texture[d].image.depth=c;this.dispose()}this.viewport.set(0,0,a,b);this.scissor.set(0,0,a,b)}copy(a){this.dispose();this.width=a.width;this.height=a.height;this.depth=a.depth;this.scissor.copy(a.scissor);this.scissorTest=a.scissorTest;this.viewport.copy(a.viewport);this.depthBuffer=a.depthBuffer;this.stencilBuffer=a.stencilBuffer;null!==a.depthTexture&&(this.depthTexture=a.depthTexture.clone());this.texture.length=0;for(let b=
0,c=a.texture.length;b<c;b++)this.texture[b]=a.texture[b].clone(),this.texture[b].isRenderTargetTexture=!0;return this}}q.WebGLMultipleRenderTargets=sh;class Xb{constructor(a=0,b=0,c=0,d=1){this.isQuaternion=!0;this._x=a;this._y=b;this._z=c;this._w=d}static slerpFlat(a,b,c,d,f,g,l){let m=c[d+0],n=c[d+1],t=c[d+2];c=c[d+3];d=f[g+0];const u=f[g+1],v=f[g+2];f=f[g+3];if(0===l)a[b+0]=m,a[b+1]=n,a[b+2]=t,a[b+3]=c;else if(1===l)a[b+0]=d,a[b+1]=u,a[b+2]=v,a[b+3]=f;else{if(c!==f||m!==d||n!==u||t!==v){g=1-l;
var A=m*d+n*u+t*v+c*f,F=0<=A?1:-1,D=1-A*A;D>Number.EPSILON&&(D=Math.sqrt(D),A=Math.atan2(D,A*F),g=Math.sin(g*A)/D,l=Math.sin(l*A)/D);F*=l;m=m*g+d*F;n=n*g+u*F;t=t*g+v*F;c=c*g+f*F;g===1-l&&(l=1/Math.sqrt(m*m+n*n+t*t+c*c),m*=l,n*=l,t*=l,c*=l)}a[b]=m;a[b+1]=n;a[b+2]=t;a[b+3]=c}}static multiplyQuaternionsFlat(a,b,c,d,f,g){const l=c[d],m=c[d+1],n=c[d+2];c=c[d+3];d=f[g];const t=f[g+1],u=f[g+2];f=f[g+3];a[b]=l*f+c*d+m*u-n*t;a[b+1]=m*f+c*t+n*d-l*u;a[b+2]=n*f+c*u+l*t-m*d;a[b+3]=c*f-l*d-m*t-n*u;return a}get x(){return this._x}set x(a){this._x=
a;this._onChangeCallback()}get y(){return this._y}set y(a){this._y=a;this._onChangeCallback()}get z(){return this._z}set z(a){this._z=a;this._onChangeCallback()}get w(){return this._w}set w(a){this._w=a;this._onChangeCallback()}set(a,b,c,d){this._x=a;this._y=b;this._z=c;this._w=d;this._onChangeCallback();return this}clone(){return new this.constructor(this._x,this._y,this._z,this._w)}copy(a){this._x=a.x;this._y=a.y;this._z=a.z;this._w=a.w;this._onChangeCallback();return this}setFromEuler(a,b){var c=
a._x,d=a._y,f=a._z;a=a._order;var g=Math.cos;const l=Math.sin,m=g(c/2),n=g(d/2);g=g(f/2);c=l(c/2);d=l(d/2);f=l(f/2);switch(a){case "XYZ":this._x=c*n*g+m*d*f;this._y=m*d*g-c*n*f;this._z=m*n*f+c*d*g;this._w=m*n*g-c*d*f;break;case "YXZ":this._x=c*n*g+m*d*f;this._y=m*d*g-c*n*f;this._z=m*n*f-c*d*g;this._w=m*n*g+c*d*f;break;case "ZXY":this._x=c*n*g-m*d*f;this._y=m*d*g+c*n*f;this._z=m*n*f+c*d*g;this._w=m*n*g-c*d*f;break;case "ZYX":this._x=c*n*g-m*d*f;this._y=m*d*g+c*n*f;this._z=m*n*f-c*d*g;this._w=m*n*g+
c*d*f;break;case "YZX":this._x=c*n*g+m*d*f;this._y=m*d*g+c*n*f;this._z=m*n*f-c*d*g;this._w=m*n*g-c*d*f;break;case "XZY":this._x=c*n*g-m*d*f;this._y=m*d*g-c*n*f;this._z=m*n*f+c*d*g;this._w=m*n*g+c*d*f;break;default:console.warn("THREE.Quaternion: .setFromEuler() encountered an unknown order: "+a)}!1!==b&&this._onChangeCallback();return this}setFromAxisAngle(a,b){b/=2;const c=Math.sin(b);this._x=a.x*c;this._y=a.y*c;this._z=a.z*c;this._w=Math.cos(b);this._onChangeCallback();return this}setFromRotationMatrix(a){var b=
a.elements,c=b[0];a=b[4];const d=b[8],f=b[1],g=b[5],l=b[9],m=b[2],n=b[6];b=b[10];const t=c+g+b;0<t?(c=.5/Math.sqrt(t+1),this._w=.25/c,this._x=(n-l)*c,this._y=(d-m)*c,this._z=(f-a)*c):c>g&&c>b?(c=2*Math.sqrt(1+c-g-b),this._w=(n-l)/c,this._x=.25*c,this._y=(a+f)/c,this._z=(d+m)/c):g>b?(c=2*Math.sqrt(1+g-c-b),this._w=(d-m)/c,this._x=(a+f)/c,this._y=.25*c,this._z=(l+n)/c):(c=2*Math.sqrt(1+b-c-g),this._w=(f-a)/c,this._x=(d+m)/c,this._y=(l+n)/c,this._z=.25*c);this._onChangeCallback();return this}setFromUnitVectors(a,
b){let c=a.dot(b)+1;c<Number.EPSILON?(c=0,Math.abs(a.x)>Math.abs(a.z)?(this._x=-a.y,this._y=a.x,this._z=0):(this._x=0,this._y=-a.z,this._z=a.y)):(this._x=a.y*b.z-a.z*b.y,this._y=a.z*b.x-a.x*b.z,this._z=a.x*b.y-a.y*b.x);this._w=c;return this.normalize()}angleTo(a){return 2*Math.acos(Math.abs(yb(this.dot(a),-1,1)))}rotateTowards(a,b){const c=this.angleTo(a);if(0===c)return this;this.slerp(a,Math.min(1,b/c));return this}identity(){return this.set(0,0,0,1)}invert(){return this.conjugate()}conjugate(){this._x*=
-1;this._y*=-1;this._z*=-1;this._onChangeCallback();return this}dot(a){return this._x*a._x+this._y*a._y+this._z*a._z+this._w*a._w}lengthSq(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w}length(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)}normalize(){let a=this.length();0===a?(this._z=this._y=this._x=0,this._w=1):(a=1/a,this._x*=a,this._y*=a,this._z*=a,this._w*=a);this._onChangeCallback();return this}multiply(a){return this.multiplyQuaternions(this,
a)}premultiply(a){return this.multiplyQuaternions(a,this)}multiplyQuaternions(a,b){const c=a._x,d=a._y,f=a._z;a=a._w;const g=b._x,l=b._y,m=b._z;b=b._w;this._x=c*b+a*g+d*m-f*l;this._y=d*b+a*l+f*g-c*m;this._z=f*b+a*m+c*l-d*g;this._w=a*b-c*g-d*l-f*m;this._onChangeCallback();return this}slerp(a,b){if(0===b)return this;if(1===b)return this.copy(a);const c=this._x,d=this._y,f=this._z,g=this._w;var l=g*a._w+c*a._x+d*a._y+f*a._z;0>l?(this._w=-a._w,this._x=-a._x,this._y=-a._y,this._z=-a._z,l=-l):this.copy(a);
if(1<=l)return this._w=g,this._x=c,this._y=d,this._z=f,this;a=1-l*l;if(a<=Number.EPSILON)return l=1-b,this._w=l*g+b*this._w,this._x=l*c+b*this._x,this._y=l*d+b*this._y,this._z=l*f+b*this._z,this.normalize(),this._onChangeCallback(),this;a=Math.sqrt(a);const m=Math.atan2(a,l);l=Math.sin((1-b)*m)/a;b=Math.sin(b*m)/a;this._w=g*l+this._w*b;this._x=c*l+this._x*b;this._y=d*l+this._y*b;this._z=f*l+this._z*b;this._onChangeCallback();return this}slerpQuaternions(a,b,c){return this.copy(a).slerp(b,c)}random(){var a=
Math.random();const b=Math.sqrt(1-a);a=Math.sqrt(a);const c=2*Math.PI*Math.random(),d=2*Math.PI*Math.random();return this.set(b*Math.cos(c),a*Math.sin(d),a*Math.cos(d),b*Math.sin(c))}equals(a){return a._x===this._x&&a._y===this._y&&a._z===this._z&&a._w===this._w}fromArray(a,b=0){this._x=a[b];this._y=a[b+1];this._z=a[b+2];this._w=a[b+3];this._onChangeCallback();return this}toArray(a=[],b=0){a[b]=this._x;a[b+1]=this._y;a[b+2]=this._z;a[b+3]=this._w;return a}fromBufferAttribute(a,b){this._x=a.getX(b);
this._y=a.getY(b);this._z=a.getZ(b);this._w=a.getW(b);return this}toJSON(){return this.toArray()}_onChange(a){this._onChangeCallback=a;return this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x;yield this._y;yield this._z;yield this._w}}q.Quaternion=Xb;class O{constructor(a=0,b=0,c=0){O.prototype.isVector3=!0;this.x=a;this.y=b;this.z=c}set(a,b,c){void 0===c&&(c=this.z);this.x=a;this.y=b;this.z=c;return this}setScalar(a){this.z=this.y=this.x=a;return this}setX(a){this.x=a;return this}setY(a){this.y=
a;return this}setZ(a){this.z=a;return this}setComponent(a,b){switch(a){case 0:this.x=b;break;case 1:this.y=b;break;case 2:this.z=b;break;default:throw Error("index is out of range: "+a);}return this}getComponent(a){switch(a){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw Error("index is out of range: "+a);}}clone(){return new this.constructor(this.x,this.y,this.z)}copy(a){this.x=a.x;this.y=a.y;this.z=a.z;return this}add(a){this.x+=a.x;this.y+=a.y;this.z+=a.z;return this}addScalar(a){this.x+=
a;this.y+=a;this.z+=a;return this}addVectors(a,b){this.x=a.x+b.x;this.y=a.y+b.y;this.z=a.z+b.z;return this}addScaledVector(a,b){this.x+=a.x*b;this.y+=a.y*b;this.z+=a.z*b;return this}sub(a){this.x-=a.x;this.y-=a.y;this.z-=a.z;return this}subScalar(a){this.x-=a;this.y-=a;this.z-=a;return this}subVectors(a,b){this.x=a.x-b.x;this.y=a.y-b.y;this.z=a.z-b.z;return this}multiply(a){this.x*=a.x;this.y*=a.y;this.z*=a.z;return this}multiplyScalar(a){this.x*=a;this.y*=a;this.z*=a;return this}multiplyVectors(a,
b){this.x=a.x*b.x;this.y=a.y*b.y;this.z=a.z*b.z;return this}applyEuler(a){return this.applyQuaternion(th.setFromEuler(a))}applyAxisAngle(a,b){return this.applyQuaternion(th.setFromAxisAngle(a,b))}applyMatrix3(a){const b=this.x,c=this.y,d=this.z;a=a.elements;this.x=a[0]*b+a[3]*c+a[6]*d;this.y=a[1]*b+a[4]*c+a[7]*d;this.z=a[2]*b+a[5]*c+a[8]*d;return this}applyNormalMatrix(a){return this.applyMatrix3(a).normalize()}applyMatrix4(a){const b=this.x,c=this.y,d=this.z;a=a.elements;const f=1/(a[3]*b+a[7]*c+
a[11]*d+a[15]);this.x=(a[0]*b+a[4]*c+a[8]*d+a[12])*f;this.y=(a[1]*b+a[5]*c+a[9]*d+a[13])*f;this.z=(a[2]*b+a[6]*c+a[10]*d+a[14])*f;return this}applyQuaternion(a){const b=this.x,c=this.y,d=this.z,f=a.x,g=a.y,l=a.z;a=a.w;const m=2*(g*d-l*c),n=2*(l*b-f*d),t=2*(f*c-g*b);this.x=b+a*m+g*t-l*n;this.y=c+a*n+l*m-f*t;this.z=d+a*t+f*n-g*m;return this}project(a){return this.applyMatrix4(a.matrixWorldInverse).applyMatrix4(a.projectionMatrix)}unproject(a){return this.applyMatrix4(a.projectionMatrixInverse).applyMatrix4(a.matrixWorld)}transformDirection(a){const b=
this.x,c=this.y,d=this.z;a=a.elements;this.x=a[0]*b+a[4]*c+a[8]*d;this.y=a[1]*b+a[5]*c+a[9]*d;this.z=a[2]*b+a[6]*c+a[10]*d;return this.normalize()}divide(a){this.x/=a.x;this.y/=a.y;this.z/=a.z;return this}divideScalar(a){return this.multiplyScalar(1/a)}min(a){this.x=Math.min(this.x,a.x);this.y=Math.min(this.y,a.y);this.z=Math.min(this.z,a.z);return this}max(a){this.x=Math.max(this.x,a.x);this.y=Math.max(this.y,a.y);this.z=Math.max(this.z,a.z);return this}clamp(a,b){this.x=Math.max(a.x,Math.min(b.x,
this.x));this.y=Math.max(a.y,Math.min(b.y,this.y));this.z=Math.max(a.z,Math.min(b.z,this.z));return this}clampScalar(a,b){this.x=Math.max(a,Math.min(b,this.x));this.y=Math.max(a,Math.min(b,this.y));this.z=Math.max(a,Math.min(b,this.z));return this}clampLength(a,b){const c=this.length();return this.divideScalar(c||1).multiplyScalar(Math.max(a,Math.min(b,c)))}floor(){this.x=Math.floor(this.x);this.y=Math.floor(this.y);this.z=Math.floor(this.z);return this}ceil(){this.x=Math.ceil(this.x);this.y=Math.ceil(this.y);
this.z=Math.ceil(this.z);return this}round(){this.x=Math.round(this.x);this.y=Math.round(this.y);this.z=Math.round(this.z);return this}roundToZero(){this.x=Math.trunc(this.x);this.y=Math.trunc(this.y);this.z=Math.trunc(this.z);return this}negate(){this.x=-this.x;this.y=-this.y;this.z=-this.z;return this}dot(a){return this.x*a.x+this.y*a.y+this.z*a.z}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}manhattanLength(){return Math.abs(this.x)+
Math.abs(this.y)+Math.abs(this.z)}normalize(){return this.divideScalar(this.length()||1)}setLength(a){return this.normalize().multiplyScalar(a)}lerp(a,b){this.x+=(a.x-this.x)*b;this.y+=(a.y-this.y)*b;this.z+=(a.z-this.z)*b;return this}lerpVectors(a,b,c){this.x=a.x+(b.x-a.x)*c;this.y=a.y+(b.y-a.y)*c;this.z=a.z+(b.z-a.z)*c;return this}cross(a){return this.crossVectors(this,a)}crossVectors(a,b){const c=a.x,d=a.y;a=a.z;const f=b.x,g=b.y;b=b.z;this.x=d*b-a*g;this.y=a*f-c*b;this.z=c*g-d*f;return this}projectOnVector(a){var b=
a.lengthSq();if(0===b)return this.set(0,0,0);b=a.dot(this)/b;return this.copy(a).multiplyScalar(b)}projectOnPlane(a){eg.copy(this).projectOnVector(a);return this.sub(eg)}reflect(a){return this.sub(eg.copy(a).multiplyScalar(2*this.dot(a)))}angleTo(a){const b=Math.sqrt(this.lengthSq()*a.lengthSq());if(0===b)return Math.PI/2;a=this.dot(a)/b;return Math.acos(yb(a,-1,1))}distanceTo(a){return Math.sqrt(this.distanceToSquared(a))}distanceToSquared(a){const b=this.x-a.x,c=this.y-a.y;a=this.z-a.z;return b*
b+c*c+a*a}manhattanDistanceTo(a){return Math.abs(this.x-a.x)+Math.abs(this.y-a.y)+Math.abs(this.z-a.z)}setFromSpherical(a){return this.setFromSphericalCoords(a.radius,a.phi,a.theta)}setFromSphericalCoords(a,b,c){const d=Math.sin(b)*a;this.x=d*Math.sin(c);this.y=Math.cos(b)*a;this.z=d*Math.cos(c);return this}setFromCylindrical(a){return this.setFromCylindricalCoords(a.radius,a.theta,a.y)}setFromCylindricalCoords(a,b,c){this.x=a*Math.sin(b);this.y=c;this.z=a*Math.cos(b);return this}setFromMatrixPosition(a){a=
a.elements;this.x=a[12];this.y=a[13];this.z=a[14];return this}setFromMatrixScale(a){const b=this.setFromMatrixColumn(a,0).length(),c=this.setFromMatrixColumn(a,1).length();a=this.setFromMatrixColumn(a,2).length();this.x=b;this.y=c;this.z=a;return this}setFromMatrixColumn(a,b){return this.fromArray(a.elements,4*b)}setFromMatrix3Column(a,b){return this.fromArray(a.elements,3*b)}setFromEuler(a){this.x=a._x;this.y=a._y;this.z=a._z;return this}setFromColor(a){this.x=a.r;this.y=a.g;this.z=a.b;return this}equals(a){return a.x===
this.x&&a.y===this.y&&a.z===this.z}fromArray(a,b=0){this.x=a[b];this.y=a[b+1];this.z=a[b+2];return this}toArray(a=[],b=0){a[b]=this.x;a[b+1]=this.y;a[b+2]=this.z;return a}fromBufferAttribute(a,b){this.x=a.getX(b);this.y=a.getY(b);this.z=a.getZ(b);return this}random(){this.x=Math.random();this.y=Math.random();this.z=Math.random();return this}randomDirection(){const a=2*(Math.random()-.5),b=Math.random()*Math.PI*2,c=Math.sqrt(1-a**2);this.x=c*Math.cos(b);this.y=c*Math.sin(b);this.z=a;return this}*[Symbol.iterator](){yield this.x;
yield this.y;yield this.z}}q.Vector3=O;const eg=new O,th=new Xb;class Jc{constructor(a=new O(Infinity,Infinity,Infinity),b=new O(-Infinity,-Infinity,-Infinity)){this.isBox3=!0;this.min=a;this.max=b}set(a,b){this.min.copy(a);this.max.copy(b);return this}setFromArray(a){this.makeEmpty();for(let b=0,c=a.length;b<c;b+=3)this.expandByPoint(yc.fromArray(a,b));return this}setFromBufferAttribute(a){this.makeEmpty();for(let b=0,c=a.count;b<c;b++)this.expandByPoint(yc.fromBufferAttribute(a,b));return this}setFromPoints(a){this.makeEmpty();
for(let b=0,c=a.length;b<c;b++)this.expandByPoint(a[b]);return this}setFromCenterAndSize(a,b){b=yc.copy(b).multiplyScalar(.5);this.min.copy(a).sub(b);this.max.copy(a).add(b);return this}setFromObject(a,b=!1){this.makeEmpty();return this.expandByObject(a,b)}clone(){return(new this.constructor).copy(this)}copy(a){this.min.copy(a.min);this.max.copy(a.max);return this}makeEmpty(){this.min.x=this.min.y=this.min.z=Infinity;this.max.x=this.max.y=this.max.z=-Infinity;return this}isEmpty(){return this.max.x<
this.min.x||this.max.y<this.min.y||this.max.z<this.min.z}getCenter(a){return this.isEmpty()?a.set(0,0,0):a.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(a){return this.isEmpty()?a.set(0,0,0):a.subVectors(this.max,this.min)}expandByPoint(a){this.min.min(a);this.max.max(a);return this}expandByVector(a){this.min.sub(a);this.max.add(a);return this}expandByScalar(a){this.min.addScalar(-a);this.max.addScalar(a);return this}expandByObject(a,b=!1){a.updateWorldMatrix(!1,!1);const c=a.geometry;
if(void 0!==c){const d=c.getAttribute("position");if(!0===b&&void 0!==d&&!0!==a.isInstancedMesh)for(let f=0,g=d.count;f<g;f++)!0===a.isMesh?a.getVertexPosition(f,yc):yc.fromBufferAttribute(d,f),yc.applyMatrix4(a.matrixWorld),this.expandByPoint(yc);else void 0!==a.boundingBox?(null===a.boundingBox&&a.computeBoundingBox(),jf.copy(a.boundingBox)):(null===c.boundingBox&&c.computeBoundingBox(),jf.copy(c.boundingBox)),jf.applyMatrix4(a.matrixWorld),this.union(jf)}a=a.children;for(let d=0,f=a.length;d<f;d++)this.expandByObject(a[d],
b);return this}containsPoint(a){return a.x<this.min.x||a.x>this.max.x||a.y<this.min.y||a.y>this.max.y||a.z<this.min.z||a.z>this.max.z?!1:!0}containsBox(a){return this.min.x<=a.min.x&&a.max.x<=this.max.x&&this.min.y<=a.min.y&&a.max.y<=this.max.y&&this.min.z<=a.min.z&&a.max.z<=this.max.z}getParameter(a,b){return b.set((a.x-this.min.x)/(this.max.x-this.min.x),(a.y-this.min.y)/(this.max.y-this.min.y),(a.z-this.min.z)/(this.max.z-this.min.z))}intersectsBox(a){return a.max.x<this.min.x||a.min.x>this.max.x||
a.max.y<this.min.y||a.min.y>this.max.y||a.max.z<this.min.z||a.min.z>this.max.z?!1:!0}intersectsSphere(a){this.clampPoint(a.center,yc);return yc.distanceToSquared(a.center)<=a.radius*a.radius}intersectsPlane(a){let b,c;0<a.normal.x?(b=a.normal.x*this.min.x,c=a.normal.x*this.max.x):(b=a.normal.x*this.max.x,c=a.normal.x*this.min.x);0<a.normal.y?(b+=a.normal.y*this.min.y,c+=a.normal.y*this.max.y):(b+=a.normal.y*this.max.y,c+=a.normal.y*this.min.y);0<a.normal.z?(b+=a.normal.z*this.min.z,c+=a.normal.z*
this.max.z):(b+=a.normal.z*this.max.z,c+=a.normal.z*this.min.z);return b<=-a.constant&&c>=-a.constant}intersectsTriangle(a){if(this.isEmpty())return!1;this.getCenter(xe);yd.subVectors(this.max,xe);Zd.subVectors(a.a,xe);dc.subVectors(a.b,xe);$d.subVectors(a.c,xe);ec.subVectors(dc,Zd);zc.subVectors($d,dc);Qc.subVectors(Zd,$d);a=[0,-ec.z,ec.y,0,-zc.z,zc.y,0,-Qc.z,Qc.y,ec.z,0,-ec.x,zc.z,0,-zc.x,Qc.z,0,-Qc.x,-ec.y,ec.x,0,-zc.y,zc.x,0,-Qc.y,Qc.x,0];if(!xb(a,Zd,dc,$d,yd))return!1;a=[1,0,0,0,1,0,0,0,1];if(!xb(a,
Zd,dc,$d,yd))return!1;kf.crossVectors(ec,zc);a=[kf.x,kf.y,kf.z];return xb(a,Zd,dc,$d,yd)}clampPoint(a,b){return b.copy(a).clamp(this.min,this.max)}distanceToPoint(a){return this.clampPoint(a,yc).distanceTo(a)}getBoundingSphere(a){this.isEmpty()?a.makeEmpty():(this.getCenter(a.center),a.radius=.5*this.getSize(yc).length());return a}intersect(a){this.min.max(a.min);this.max.min(a.max);this.isEmpty()&&this.makeEmpty();return this}union(a){this.min.min(a.min);this.max.max(a.max);return this}applyMatrix4(a){if(this.isEmpty())return this;
Rc[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(a);Rc[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(a);Rc[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(a);Rc[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(a);Rc[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(a);Rc[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(a);Rc[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(a);Rc[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(a);this.setFromPoints(Rc);
return this}translate(a){this.min.add(a);this.max.add(a);return this}equals(a){return a.min.equals(this.min)&&a.max.equals(this.max)}}q.Box3=Jc;const Rc=[new O,new O,new O,new O,new O,new O,new O,new O],yc=new O,jf=new Jc,Zd=new O,dc=new O,$d=new O,ec=new O,zc=new O,Qc=new O,xe=new O,yd=new O,kf=new O,od=new O,uh=new Jc,ae=new O,lf=new O;class oc{constructor(a=new O,b=-1){this.center=a;this.radius=b}set(a,b){this.center.copy(a);this.radius=b;return this}setFromPoints(a,b){const c=this.center;void 0!==
b?c.copy(b):uh.setFromPoints(a).getCenter(c);b=0;for(let d=0,f=a.length;d<f;d++)b=Math.max(b,c.distanceToSquared(a[d]));this.radius=Math.sqrt(b);return this}copy(a){this.center.copy(a.center);this.radius=a.radius;return this}isEmpty(){return 0>this.radius}makeEmpty(){this.center.set(0,0,0);this.radius=-1;return this}containsPoint(a){return a.distanceToSquared(this.center)<=this.radius*this.radius}distanceToPoint(a){return a.distanceTo(this.center)-this.radius}intersectsSphere(a){const b=this.radius+
a.radius;return a.center.distanceToSquared(this.center)<=b*b}intersectsBox(a){return a.intersectsSphere(this)}intersectsPlane(a){return Math.abs(a.distanceToPoint(this.center))<=this.radius}clampPoint(a,b){const c=this.center.distanceToSquared(a);b.copy(a);c>this.radius*this.radius&&(b.sub(this.center).normalize(),b.multiplyScalar(this.radius).add(this.center));return b}getBoundingBox(a){if(this.isEmpty())return a.makeEmpty(),a;a.set(this.center,this.center);a.expandByScalar(this.radius);return a}applyMatrix4(a){this.center.applyMatrix4(a);
this.radius*=a.getMaxScaleOnAxis();return this}translate(a){this.center.add(a);return this}expandByPoint(a){if(this.isEmpty())return this.center.copy(a),this.radius=0,this;ae.subVectors(a,this.center);a=ae.lengthSq();if(a>this.radius*this.radius){a=Math.sqrt(a);const b=.5*(a-this.radius);this.center.addScaledVector(ae,b/a);this.radius+=b}return this}union(a){if(a.isEmpty())return this;if(this.isEmpty())return this.copy(a),this;!0===this.center.equals(a.center)?this.radius=Math.max(this.radius,a.radius):
(lf.subVectors(a.center,this.center).setLength(a.radius),this.expandByPoint(ae.copy(a.center).add(lf)),this.expandByPoint(ae.copy(a.center).sub(lf)));return this}equals(a){return a.center.equals(this.center)&&a.radius===this.radius}clone(){return(new this.constructor).copy(this)}}q.Sphere=oc;const Kc=new O,Sc=new O,mf=new O,dd=new O,fg=new O,be=new O,nf=new O;class ce{constructor(a=new O,b=new O(0,0,-1)){this.origin=a;this.direction=b}set(a,b){this.origin.copy(a);this.direction.copy(b);return this}copy(a){this.origin.copy(a.origin);
this.direction.copy(a.direction);return this}at(a,b){return b.copy(this.origin).addScaledVector(this.direction,a)}lookAt(a){this.direction.copy(a).sub(this.origin).normalize();return this}recast(a){this.origin.copy(this.at(a,Kc));return this}closestPointToPoint(a,b){b.subVectors(a,this.origin);a=b.dot(this.direction);return 0>a?b.copy(this.origin):b.copy(this.origin).addScaledVector(this.direction,a)}distanceToPoint(a){return Math.sqrt(this.distanceSqToPoint(a))}distanceSqToPoint(a){const b=Kc.subVectors(a,
this.origin).dot(this.direction);if(0>b)return this.origin.distanceToSquared(a);Kc.copy(this.origin).addScaledVector(this.direction,b);return Kc.distanceToSquared(a)}distanceSqToSegment(a,b,c,d){Sc.copy(a).add(b).multiplyScalar(.5);mf.copy(b).sub(a).normalize();dd.copy(this.origin).sub(Sc);var f=.5*a.distanceTo(b),g=-this.direction.dot(mf);const l=dd.dot(this.direction),m=-dd.dot(mf),n=dd.lengthSq(),t=Math.abs(1-g*g);let u;0<t?(a=g*m-l,b=g*l-m,u=f*t,0<=a?b>=-u?b<=u?(f=1/t,a*=f,b*=f,g=a*(a+g*b+2*l)+
b*(g*a+b+2*m)+n):(b=f,a=Math.max(0,-(g*b+l)),g=-a*a+b*(b+2*m)+n):(b=-f,a=Math.max(0,-(g*b+l)),g=-a*a+b*(b+2*m)+n):b<=-u?(a=Math.max(0,-(-g*f+l)),b=0<a?-f:Math.min(Math.max(-f,-m),f),g=-a*a+b*(b+2*m)+n):b<=u?(a=0,b=Math.min(Math.max(-f,-m),f),g=b*(b+2*m)+n):(a=Math.max(0,-(g*f+l)),b=0<a?f:Math.min(Math.max(-f,-m),f),g=-a*a+b*(b+2*m)+n)):(b=0<g?-f:f,a=Math.max(0,-(g*b+l)),g=-a*a+b*(b+2*m)+n);c&&c.copy(this.origin).addScaledVector(this.direction,a);d&&d.copy(Sc).addScaledVector(mf,b);return g}intersectSphere(a,
b){Kc.subVectors(a.center,this.origin);var c=Kc.dot(this.direction),d=Kc.dot(Kc)-c*c;a=a.radius*a.radius;if(d>a)return null;a=Math.sqrt(a-d);d=c-a;c+=a;return 0>c?null:0>d?this.at(c,b):this.at(d,b)}intersectsSphere(a){return this.distanceSqToPoint(a.center)<=a.radius*a.radius}distanceToPlane(a){const b=a.normal.dot(this.direction);if(0===b)return 0===a.distanceToPoint(this.origin)?0:null;a=-(this.origin.dot(a.normal)+a.constant)/b;return 0<=a?a:null}intersectPlane(a,b){a=this.distanceToPlane(a);return null===
a?null:this.at(a,b)}intersectsPlane(a){const b=a.distanceToPoint(this.origin);return 0===b||0>a.normal.dot(this.direction)*b?!0:!1}intersectBox(a,b){let c;var d=1/this.direction.x;var f=1/this.direction.y;const g=1/this.direction.z,l=this.origin;0<=d?(c=(a.min.x-l.x)*d,d*=a.max.x-l.x):(c=(a.max.x-l.x)*d,d*=a.min.x-l.x);if(0<=f){var m=(a.min.y-l.y)*f;f*=a.max.y-l.y}else m=(a.max.y-l.y)*f,f*=a.min.y-l.y;if(c>f||m>d)return null;if(m>c||isNaN(c))c=m;if(f<d||isNaN(d))d=f;0<=g?(m=(a.min.z-l.z)*g,a=(a.max.z-
l.z)*g):(m=(a.max.z-l.z)*g,a=(a.min.z-l.z)*g);if(c>a||m>d)return null;if(m>c||c!==c)c=m;if(a<d||d!==d)d=a;return 0>d?null:this.at(0<=c?c:d,b)}intersectsBox(a){return null!==this.intersectBox(a,Kc)}intersectTriangle(a,b,c,d,f){fg.subVectors(b,a);be.subVectors(c,a);nf.crossVectors(fg,be);b=this.direction.dot(nf);if(0<b){if(d)return null;d=1}else if(0>b)d=-1,b=-b;else return null;dd.subVectors(this.origin,a);a=d*this.direction.dot(be.crossVectors(dd,be));if(0>a)return null;c=d*this.direction.dot(fg.cross(dd));
if(0>c||a+c>b)return null;a=-d*dd.dot(nf);return 0>a?null:this.at(a/b,f)}applyMatrix4(a){this.origin.applyMatrix4(a);this.direction.transformDirection(a);return this}equals(a){return a.origin.equals(this.origin)&&a.direction.equals(this.direction)}clone(){return(new this.constructor).copy(this)}}q.Ray=ce;class Wa{constructor(a,b,c,d,f,g,l,m,n,t,u,v,A,F,D,E){Wa.prototype.isMatrix4=!0;this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1];void 0!==a&&this.set(a,b,c,d,f,g,l,m,n,t,u,v,A,F,D,E)}set(a,b,c,d,f,
g,l,m,n,t,u,v,A,F,D,E){const y=this.elements;y[0]=a;y[4]=b;y[8]=c;y[12]=d;y[1]=f;y[5]=g;y[9]=l;y[13]=m;y[2]=n;y[6]=t;y[10]=u;y[14]=v;y[3]=A;y[7]=F;y[11]=D;y[15]=E;return this}identity(){this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1);return this}clone(){return(new Wa).fromArray(this.elements)}copy(a){const b=this.elements;a=a.elements;b[0]=a[0];b[1]=a[1];b[2]=a[2];b[3]=a[3];b[4]=a[4];b[5]=a[5];b[6]=a[6];b[7]=a[7];b[8]=a[8];b[9]=a[9];b[10]=a[10];b[11]=a[11];b[12]=a[12];b[13]=a[13];b[14]=a[14];b[15]=a[15];
return this}copyPosition(a){const b=this.elements;a=a.elements;b[12]=a[12];b[13]=a[13];b[14]=a[14];return this}setFromMatrix3(a){a=a.elements;this.set(a[0],a[3],a[6],0,a[1],a[4],a[7],0,a[2],a[5],a[8],0,0,0,0,1);return this}extractBasis(a,b,c){a.setFromMatrixColumn(this,0);b.setFromMatrixColumn(this,1);c.setFromMatrixColumn(this,2);return this}makeBasis(a,b,c){this.set(a.x,b.x,c.x,0,a.y,b.y,c.y,0,a.z,b.z,c.z,0,0,0,0,1);return this}extractRotation(a){const b=this.elements,c=a.elements,d=1/de.setFromMatrixColumn(a,
0).length(),f=1/de.setFromMatrixColumn(a,1).length();a=1/de.setFromMatrixColumn(a,2).length();b[0]=c[0]*d;b[1]=c[1]*d;b[2]=c[2]*d;b[3]=0;b[4]=c[4]*f;b[5]=c[5]*f;b[6]=c[6]*f;b[7]=0;b[8]=c[8]*a;b[9]=c[9]*a;b[10]=c[10]*a;b[11]=0;b[12]=0;b[13]=0;b[14]=0;b[15]=1;return this}makeRotationFromEuler(a){const b=this.elements;var c=a.x,d=a.y,f=a.z;const g=Math.cos(c);c=Math.sin(c);const l=Math.cos(d);d=Math.sin(d);const m=Math.cos(f);f=Math.sin(f);if("XYZ"===a.order){a=g*m;var n=g*f,t=c*m,u=c*f;b[0]=l*m;b[4]=
-l*f;b[8]=d;b[1]=n+t*d;b[5]=a-u*d;b[9]=-c*l;b[2]=u-a*d;b[6]=t+n*d;b[10]=g*l}else"YXZ"===a.order?(a=l*m,n=l*f,t=d*m,u=d*f,b[0]=a+u*c,b[4]=t*c-n,b[8]=g*d,b[1]=g*f,b[5]=g*m,b[9]=-c,b[2]=n*c-t,b[6]=u+a*c,b[10]=g*l):"ZXY"===a.order?(a=l*m,n=l*f,t=d*m,u=d*f,b[0]=a-u*c,b[4]=-g*f,b[8]=t+n*c,b[1]=n+t*c,b[5]=g*m,b[9]=u-a*c,b[2]=-g*d,b[6]=c,b[10]=g*l):"ZYX"===a.order?(a=g*m,n=g*f,t=c*m,u=c*f,b[0]=l*m,b[4]=t*d-n,b[8]=a*d+u,b[1]=l*f,b[5]=u*d+a,b[9]=n*d-t,b[2]=-d,b[6]=c*l,b[10]=g*l):"YZX"===a.order?(a=g*l,n=g*
d,t=c*l,u=c*d,b[0]=l*m,b[4]=u-a*f,b[8]=t*f+n,b[1]=f,b[5]=g*m,b[9]=-c*m,b[2]=-d*m,b[6]=n*f+t,b[10]=a-u*f):"XZY"===a.order&&(a=g*l,n=g*d,t=c*l,u=c*d,b[0]=l*m,b[4]=-f,b[8]=d*m,b[1]=a*f+u,b[5]=g*m,b[9]=n*f-t,b[2]=t*f-n,b[6]=c*m,b[10]=u*f+a);b[3]=0;b[7]=0;b[11]=0;b[12]=0;b[13]=0;b[14]=0;b[15]=1;return this}makeRotationFromQuaternion(a){return this.compose(dj,a,ej)}lookAt(a,b,c){const d=this.elements;Ob.subVectors(a,b);0===Ob.lengthSq()&&(Ob.z=1);Ob.normalize();ed.crossVectors(c,Ob);0===ed.lengthSq()&&
(1===Math.abs(c.z)?Ob.x+=1E-4:Ob.z+=1E-4,Ob.normalize(),ed.crossVectors(c,Ob));ed.normalize();of.crossVectors(Ob,ed);d[0]=ed.x;d[4]=of.x;d[8]=Ob.x;d[1]=ed.y;d[5]=of.y;d[9]=Ob.y;d[2]=ed.z;d[6]=of.z;d[10]=Ob.z;return this}multiply(a){return this.multiplyMatrices(this,a)}premultiply(a){return this.multiplyMatrices(a,this)}multiplyMatrices(a,b){var c=a.elements,d=b.elements;b=this.elements;a=c[0];const f=c[4],g=c[8],l=c[12],m=c[1],n=c[5],t=c[9],u=c[13],v=c[2],A=c[6],F=c[10],D=c[14],E=c[3],y=c[7],J=c[11];
c=c[15];const L=d[0],U=d[4],P=d[8],X=d[12],ja=d[1],fa=d[5],aa=d[9],pa=d[13],ba=d[2],xa=d[6],qa=d[10],ta=d[14],Ba=d[3],va=d[7],Ga=d[11];d=d[15];b[0]=a*L+f*ja+g*ba+l*Ba;b[4]=a*U+f*fa+g*xa+l*va;b[8]=a*P+f*aa+g*qa+l*Ga;b[12]=a*X+f*pa+g*ta+l*d;b[1]=m*L+n*ja+t*ba+u*Ba;b[5]=m*U+n*fa+t*xa+u*va;b[9]=m*P+n*aa+t*qa+u*Ga;b[13]=m*X+n*pa+t*ta+u*d;b[2]=v*L+A*ja+F*ba+D*Ba;b[6]=v*U+A*fa+F*xa+D*va;b[10]=v*P+A*aa+F*qa+D*Ga;b[14]=v*X+A*pa+F*ta+D*d;b[3]=E*L+y*ja+J*ba+c*Ba;b[7]=E*U+y*fa+J*xa+c*va;b[11]=E*P+y*aa+J*qa+c*
Ga;b[15]=E*X+y*pa+J*ta+c*d;return this}multiplyScalar(a){const b=this.elements;b[0]*=a;b[4]*=a;b[8]*=a;b[12]*=a;b[1]*=a;b[5]*=a;b[9]*=a;b[13]*=a;b[2]*=a;b[6]*=a;b[10]*=a;b[14]*=a;b[3]*=a;b[7]*=a;b[11]*=a;b[15]*=a;return this}determinant(){const a=this.elements,b=a[0],c=a[4],d=a[8],f=a[12],g=a[1],l=a[5],m=a[9],n=a[13],t=a[2],u=a[6],v=a[10],A=a[14];return a[3]*(+f*m*u-d*n*u-f*l*v+c*n*v+d*l*A-c*m*A)+a[7]*(+b*m*A-b*n*v+f*g*v-d*g*A+d*n*t-f*m*t)+a[11]*(+b*n*u-b*l*A-f*g*u+c*g*A+f*l*t-c*n*t)+a[15]*(-d*l*
t-b*m*u+b*l*v+d*g*u-c*g*v+c*m*t)}transpose(){const a=this.elements;let b;b=a[1];a[1]=a[4];a[4]=b;b=a[2];a[2]=a[8];a[8]=b;b=a[6];a[6]=a[9];a[9]=b;b=a[3];a[3]=a[12];a[12]=b;b=a[7];a[7]=a[13];a[13]=b;b=a[11];a[11]=a[14];a[14]=b;return this}setPosition(a,b,c){const d=this.elements;a.isVector3?(d[12]=a.x,d[13]=a.y,d[14]=a.z):(d[12]=a,d[13]=b,d[14]=c);return this}invert(){const a=this.elements,b=a[0],c=a[1],d=a[2],f=a[3],g=a[4],l=a[5],m=a[6],n=a[7],t=a[8],u=a[9],v=a[10],A=a[11],F=a[12],D=a[13],E=a[14],
y=a[15],J=u*E*n-D*v*n+D*m*A-l*E*A-u*m*y+l*v*y,L=F*v*n-t*E*n-F*m*A+g*E*A+t*m*y-g*v*y,U=t*D*n-F*u*n+F*l*A-g*D*A-t*l*y+g*u*y,P=F*u*m-t*D*m-F*l*v+g*D*v+t*l*E-g*u*E;var X=b*J+c*L+d*U+f*P;if(0===X)return this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);X=1/X;a[0]=J*X;a[1]=(D*v*f-u*E*f-D*d*A+c*E*A+u*d*y-c*v*y)*X;a[2]=(l*E*f-D*m*f+D*d*n-c*E*n-l*d*y+c*m*y)*X;a[3]=(u*m*f-l*v*f-u*d*n+c*v*n+l*d*A-c*m*A)*X;a[4]=L*X;a[5]=(t*E*f-F*v*f+F*d*A-b*E*A-t*d*y+b*v*y)*X;a[6]=(F*m*f-g*E*f-F*d*n+b*E*n+g*d*y-b*m*y)*X;a[7]=(g*v*f-
t*m*f+t*d*n-b*v*n-g*d*A+b*m*A)*X;a[8]=U*X;a[9]=(F*u*f-t*D*f-F*c*A+b*D*A+t*c*y-b*u*y)*X;a[10]=(g*D*f-F*l*f+F*c*n-b*D*n-g*c*y+b*l*y)*X;a[11]=(t*l*f-g*u*f-t*c*n+b*u*n+g*c*A-b*l*A)*X;a[12]=P*X;a[13]=(t*D*d-F*u*d+F*c*v-b*D*v-t*c*E+b*u*E)*X;a[14]=(F*l*d-g*D*d-F*c*m+b*D*m+g*c*E-b*l*E)*X;a[15]=(g*u*d-t*l*d+t*c*m-b*u*m-g*c*v+b*l*v)*X;return this}scale(a){const b=this.elements,c=a.x,d=a.y;a=a.z;b[0]*=c;b[4]*=d;b[8]*=a;b[1]*=c;b[5]*=d;b[9]*=a;b[2]*=c;b[6]*=d;b[10]*=a;b[3]*=c;b[7]*=d;b[11]*=a;return this}getMaxScaleOnAxis(){const a=
this.elements;return Math.sqrt(Math.max(a[0]*a[0]+a[1]*a[1]+a[2]*a[2],a[4]*a[4]+a[5]*a[5]+a[6]*a[6],a[8]*a[8]+a[9]*a[9]+a[10]*a[10]))}makeTranslation(a,b,c){a.isVector3?this.set(1,0,0,a.x,0,1,0,a.y,0,0,1,a.z,0,0,0,1):this.set(1,0,0,a,0,1,0,b,0,0,1,c,0,0,0,1);return this}makeRotationX(a){const b=Math.cos(a);a=Math.sin(a);this.set(1,0,0,0,0,b,-a,0,0,a,b,0,0,0,0,1);return this}makeRotationY(a){const b=Math.cos(a);a=Math.sin(a);this.set(b,0,a,0,0,1,0,0,-a,0,b,0,0,0,0,1);return this}makeRotationZ(a){const b=
Math.cos(a);a=Math.sin(a);this.set(b,-a,0,0,a,b,0,0,0,0,1,0,0,0,0,1);return this}makeRotationAxis(a,b){const c=Math.cos(b);b=Math.sin(b);const d=1-c,f=a.x,g=a.y;a=a.z;const l=d*f,m=d*g;this.set(l*f+c,l*g-b*a,l*a+b*g,0,l*g+b*a,m*g+c,m*a-b*f,0,l*a-b*g,m*a+b*f,d*a*a+c,0,0,0,0,1);return this}makeScale(a,b,c){this.set(a,0,0,0,0,b,0,0,0,0,c,0,0,0,0,1);return this}makeShear(a,b,c,d,f,g){this.set(1,c,f,0,a,1,g,0,b,d,1,0,0,0,0,1);return this}compose(a,b,c){const d=this.elements;var f=b._x,g=b._y,l=b._z,m=
b._w,n=f+f,t=g+g,u=l+l;b=f*n;const v=f*t;f*=u;const A=g*t;g*=u;l*=u;n*=m;t*=m;m*=u;u=c.x;const F=c.y;c=c.z;d[0]=(1-(A+l))*u;d[1]=(v+m)*u;d[2]=(f-t)*u;d[3]=0;d[4]=(v-m)*F;d[5]=(1-(b+l))*F;d[6]=(g+n)*F;d[7]=0;d[8]=(f+t)*c;d[9]=(g-n)*c;d[10]=(1-(b+A))*c;d[11]=0;d[12]=a.x;d[13]=a.y;d[14]=a.z;d[15]=1;return this}decompose(a,b,c){var d=this.elements;let f=de.set(d[0],d[1],d[2]).length();const g=de.set(d[4],d[5],d[6]).length(),l=de.set(d[8],d[9],d[10]).length();0>this.determinant()&&(f=-f);a.x=d[12];a.y=
d[13];a.z=d[14];Hb.copy(this);a=1/f;d=1/g;const m=1/l;Hb.elements[0]*=a;Hb.elements[1]*=a;Hb.elements[2]*=a;Hb.elements[4]*=d;Hb.elements[5]*=d;Hb.elements[6]*=d;Hb.elements[8]*=m;Hb.elements[9]*=m;Hb.elements[10]*=m;b.setFromRotationMatrix(Hb);c.x=f;c.y=g;c.z=l;return this}makePerspective(a,b,c,d,f,g,l=2E3){const m=this.elements;if(2E3===l)l=-(g+f)/(g-f),g=-2*g*f/(g-f);else if(2001===l)l=-g/(g-f),g=-g*f/(g-f);else throw Error("THREE.Matrix4.makePerspective(): Invalid coordinate system: "+l);m[0]=
2*f/(b-a);m[4]=0;m[8]=(b+a)/(b-a);m[12]=0;m[1]=0;m[5]=2*f/(c-d);m[9]=(c+d)/(c-d);m[13]=0;m[2]=0;m[6]=0;m[10]=l;m[14]=g;m[3]=0;m[7]=0;m[11]=-1;m[15]=0;return this}makeOrthographic(a,b,c,d,f,g,l=2E3){const m=this.elements,n=1/(b-a),t=1/(c-d);var u=1/(g-f);if(2E3===l)f=(g+f)*u,u*=-2;else if(2001===l)f*=u,u*=-1;else throw Error("THREE.Matrix4.makeOrthographic(): Invalid coordinate system: "+l);m[0]=2*n;m[4]=0;m[8]=0;m[12]=-((b+a)*n);m[1]=0;m[5]=2*t;m[9]=0;m[13]=-((c+d)*t);m[2]=0;m[6]=0;m[10]=u;m[14]=
-f;m[3]=0;m[7]=0;m[11]=0;m[15]=1;return this}equals(a){const b=this.elements;a=a.elements;for(let c=0;16>c;c++)if(b[c]!==a[c])return!1;return!0}fromArray(a,b=0){for(let c=0;16>c;c++)this.elements[c]=a[c+b];return this}toArray(a=[],b=0){const c=this.elements;a[b]=c[0];a[b+1]=c[1];a[b+2]=c[2];a[b+3]=c[3];a[b+4]=c[4];a[b+5]=c[5];a[b+6]=c[6];a[b+7]=c[7];a[b+8]=c[8];a[b+9]=c[9];a[b+10]=c[10];a[b+11]=c[11];a[b+12]=c[12];a[b+13]=c[13];a[b+14]=c[14];a[b+15]=c[15];return a}}q.Matrix4=Wa;const de=new O,Hb=
new Wa,dj=new O(0,0,0),ej=new O(1,1,1),ed=new O,of=new O,Ob=new O,gg=new Wa,hg=new Xb;class lb{constructor(a=0,b=0,c=0,d=lb.DEFAULT_ORDER){this.isEuler=!0;this._x=a;this._y=b;this._z=c;this._order=d}get x(){return this._x}set x(a){this._x=a;this._onChangeCallback()}get y(){return this._y}set y(a){this._y=a;this._onChangeCallback()}get z(){return this._z}set z(a){this._z=a;this._onChangeCallback()}get order(){return this._order}set order(a){this._order=a;this._onChangeCallback()}set(a,b,c,d=this._order){this._x=
a;this._y=b;this._z=c;this._order=d;this._onChangeCallback();return this}clone(){return new this.constructor(this._x,this._y,this._z,this._order)}copy(a){this._x=a._x;this._y=a._y;this._z=a._z;this._order=a._order;this._onChangeCallback();return this}setFromRotationMatrix(a,b=this._order,c=!0){var d=a.elements;a=d[0];const f=d[4],g=d[8],l=d[1],m=d[5],n=d[9],t=d[2],u=d[6];d=d[10];switch(b){case "XYZ":this._y=Math.asin(yb(g,-1,1));.9999999>Math.abs(g)?(this._x=Math.atan2(-n,d),this._z=Math.atan2(-f,
a)):(this._x=Math.atan2(u,m),this._z=0);break;case "YXZ":this._x=Math.asin(-yb(n,-1,1));.9999999>Math.abs(n)?(this._y=Math.atan2(g,d),this._z=Math.atan2(l,m)):(this._y=Math.atan2(-t,a),this._z=0);break;case "ZXY":this._x=Math.asin(yb(u,-1,1));.9999999>Math.abs(u)?(this._y=Math.atan2(-t,d),this._z=Math.atan2(-f,m)):(this._y=0,this._z=Math.atan2(l,a));break;case "ZYX":this._y=Math.asin(-yb(t,-1,1));.9999999>Math.abs(t)?(this._x=Math.atan2(u,d),this._z=Math.atan2(l,a)):(this._x=0,this._z=Math.atan2(-f,
m));break;case "YZX":this._z=Math.asin(yb(l,-1,1));.9999999>Math.abs(l)?(this._x=Math.atan2(-n,m),this._y=Math.atan2(-t,a)):(this._x=0,this._y=Math.atan2(g,d));break;case "XZY":this._z=Math.asin(-yb(f,-1,1));.9999999>Math.abs(f)?(this._x=Math.atan2(u,m),this._y=Math.atan2(g,a)):(this._x=Math.atan2(-n,d),this._y=0);break;default:console.warn("THREE.Euler: .setFromRotationMatrix() encountered an unknown order: "+b)}this._order=b;!0===c&&this._onChangeCallback();return this}setFromQuaternion(a,b,c){gg.makeRotationFromQuaternion(a);
return this.setFromRotationMatrix(gg,b,c)}setFromVector3(a,b=this._order){return this.set(a.x,a.y,a.z,b)}reorder(a){hg.setFromEuler(this);return this.setFromQuaternion(hg,a)}equals(a){return a._x===this._x&&a._y===this._y&&a._z===this._z&&a._order===this._order}fromArray(a){this._x=a[0];this._y=a[1];this._z=a[2];void 0!==a[3]&&(this._order=a[3]);this._onChangeCallback();return this}toArray(a=[],b=0){a[b]=this._x;a[b+1]=this._y;a[b+2]=this._z;a[b+3]=this._order;return a}_onChange(a){this._onChangeCallback=
a;return this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x;yield this._y;yield this._z;yield this._order}}q.Euler=lb;lb.DEFAULT_ORDER="XYZ";class re{constructor(){this.mask=1}set(a){this.mask=(1<<a|0)>>>0}enable(a){this.mask=this.mask|1<<a|0}enableAll(){this.mask=-1}toggle(a){this.mask^=1<<a|0}disable(a){this.mask&=~(1<<a|0)}disableAll(){this.mask=0}test(a){return 0!==(this.mask&a.mask)}isEnabled(a){return 0!==(this.mask&(1<<a|0))}}q.Layers=re;let zd=0;const Ad=new O,Ac=new Xb,Tc=new Wa,
pf=new O,ye=new O,fj=new O,gj=new Xb,vh=new O(1,0,0),wh=new O(0,1,0),xh=new O(0,0,1),hj={type:"added"},ij={type:"removed"};class hb extends Pc{constructor(){super();this.isObject3D=!0;Object.defineProperty(this,"id",{value:zd++});this.uuid=$b();this.name="";this.type="Object3D";this.parent=null;this.children=[];this.up=hb.DEFAULT_UP.clone();const a=new O,b=new lb,c=new Xb,d=new O(1,1,1);b._onChange(function(){c.setFromEuler(b,!1)});c._onChange(function(){b.setFromQuaternion(c,void 0,!1)});Object.defineProperties(this,
{position:{configurable:!0,enumerable:!0,value:a},rotation:{configurable:!0,enumerable:!0,value:b},quaternion:{configurable:!0,enumerable:!0,value:c},scale:{configurable:!0,enumerable:!0,value:d},modelViewMatrix:{value:new Wa},normalMatrix:{value:new Za}});this.matrix=new Wa;this.matrixWorld=new Wa;this.matrixAutoUpdate=hb.DEFAULT_MATRIX_AUTO_UPDATE;this.matrixWorldNeedsUpdate=!1;this.matrixWorldAutoUpdate=hb.DEFAULT_MATRIX_WORLD_AUTO_UPDATE;this.layers=new re;this.visible=!0;this.receiveShadow=this.castShadow=
!1;this.frustumCulled=!0;this.renderOrder=0;this.animations=[];this.userData={}}onBeforeRender(){}onAfterRender(){}applyMatrix4(a){this.matrixAutoUpdate&&this.updateMatrix();this.matrix.premultiply(a);this.matrix.decompose(this.position,this.quaternion,this.scale)}applyQuaternion(a){this.quaternion.premultiply(a);return this}setRotationFromAxisAngle(a,b){this.quaternion.setFromAxisAngle(a,b)}setRotationFromEuler(a){this.quaternion.setFromEuler(a,!0)}setRotationFromMatrix(a){this.quaternion.setFromRotationMatrix(a)}setRotationFromQuaternion(a){this.quaternion.copy(a)}rotateOnAxis(a,
b){Ac.setFromAxisAngle(a,b);this.quaternion.multiply(Ac);return this}rotateOnWorldAxis(a,b){Ac.setFromAxisAngle(a,b);this.quaternion.premultiply(Ac);return this}rotateX(a){return this.rotateOnAxis(vh,a)}rotateY(a){return this.rotateOnAxis(wh,a)}rotateZ(a){return this.rotateOnAxis(xh,a)}translateOnAxis(a,b){Ad.copy(a).applyQuaternion(this.quaternion);this.position.add(Ad.multiplyScalar(b));return this}translateX(a){return this.translateOnAxis(vh,a)}translateY(a){return this.translateOnAxis(wh,a)}translateZ(a){return this.translateOnAxis(xh,
a)}localToWorld(a){this.updateWorldMatrix(!0,!1);return a.applyMatrix4(this.matrixWorld)}worldToLocal(a){this.updateWorldMatrix(!0,!1);return a.applyMatrix4(Tc.copy(this.matrixWorld).invert())}lookAt(a,b,c){a.isVector3?pf.copy(a):pf.set(a,b,c);a=this.parent;this.updateWorldMatrix(!0,!1);ye.setFromMatrixPosition(this.matrixWorld);this.isCamera||this.isLight?Tc.lookAt(ye,pf,this.up):Tc.lookAt(pf,ye,this.up);this.quaternion.setFromRotationMatrix(Tc);a&&(Tc.extractRotation(a.matrixWorld),Ac.setFromRotationMatrix(Tc),
this.quaternion.premultiply(Ac.invert()))}add(a){if(1<arguments.length){for(let b=0;b<arguments.length;b++)this.add(arguments[b]);return this}if(a===this)return console.error("THREE.Object3D.add: object can't be added as a child of itself.",a),this;a&&a.isObject3D?(null!==a.parent&&a.parent.remove(a),a.parent=this,this.children.push(a),a.dispatchEvent(hj)):console.error("THREE.Object3D.add: object not an instance of THREE.Object3D.",a);return this}remove(a){if(1<arguments.length){for(var b=0;b<arguments.length;b++)this.remove(arguments[b]);
return this}b=this.children.indexOf(a);-1!==b&&(a.parent=null,this.children.splice(b,1),a.dispatchEvent(ij));return this}removeFromParent(){const a=this.parent;null!==a&&a.remove(this);return this}clear(){return this.remove(...this.children)}attach(a){this.updateWorldMatrix(!0,!1);Tc.copy(this.matrixWorld).invert();null!==a.parent&&(a.parent.updateWorldMatrix(!0,!1),Tc.multiply(a.parent.matrixWorld));a.applyMatrix4(Tc);this.add(a);a.updateWorldMatrix(!1,!0);return this}getObjectById(a){return this.getObjectByProperty("id",
a)}getObjectByName(a){return this.getObjectByProperty("name",a)}getObjectByProperty(a,b){if(this[a]===b)return this;for(let c=0,d=this.children.length;c<d;c++){const f=this.children[c].getObjectByProperty(a,b);if(void 0!==f)return f}}getObjectsByProperty(a,b){let c=[];this[a]===b&&c.push(this);for(let d=0,f=this.children.length;d<f;d++){const g=this.children[d].getObjectsByProperty(a,b);0<g.length&&(c=c.concat(g))}return c}getWorldPosition(a){this.updateWorldMatrix(!0,!1);return a.setFromMatrixPosition(this.matrixWorld)}getWorldQuaternion(a){this.updateWorldMatrix(!0,
!1);this.matrixWorld.decompose(ye,a,fj);return a}getWorldScale(a){this.updateWorldMatrix(!0,!1);this.matrixWorld.decompose(ye,gj,a);return a}getWorldDirection(a){this.updateWorldMatrix(!0,!1);const b=this.matrixWorld.elements;return a.set(b[8],b[9],b[10]).normalize()}raycast(){}traverse(a){a(this);const b=this.children;for(let c=0,d=b.length;c<d;c++)b[c].traverse(a)}traverseVisible(a){if(!1!==this.visible){a(this);var b=this.children;for(let c=0,d=b.length;c<d;c++)b[c].traverseVisible(a)}}traverseAncestors(a){const b=
this.parent;null!==b&&(a(b),b.traverseAncestors(a))}updateMatrix(){this.matrix.compose(this.position,this.quaternion,this.scale);this.matrixWorldNeedsUpdate=!0}updateMatrixWorld(a){this.matrixAutoUpdate&&this.updateMatrix();if(this.matrixWorldNeedsUpdate||a)null===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),this.matrixWorldNeedsUpdate=!1,a=!0;const b=this.children;for(let c=0,d=b.length;c<d;c++){const f=b[c];!0!==f.matrixWorldAutoUpdate&&
!0!==a||f.updateMatrixWorld(a)}}updateWorldMatrix(a,b){const c=this.parent;!0===a&&null!==c&&!0===c.matrixWorldAutoUpdate&&c.updateWorldMatrix(!0,!1);this.matrixAutoUpdate&&this.updateMatrix();null===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix);if(!0===b){a=this.children;for(let d=0,f=a.length;d<f;d++)b=a[d],!0===b.matrixWorldAutoUpdate&&b.updateWorldMatrix(!1,!0)}}toJSON(a){function b(m,n){void 0===m[n.uuid]&&(m[n.uuid]=n.toJSON(a));
return n.uuid}function c(m){const n=[];for(const t in m){const u=m[t];delete u.metadata;n.push(u)}return n}var d=void 0===a||"string"===typeof a;const f={};d&&(a={geometries:{},materials:{},textures:{},images:{},shapes:{},skeletons:{},animations:{},nodes:{}},f.metadata={version:4.6,type:"Object",generator:"Object3D.toJSON"});const g={};g.uuid=this.uuid;g.type=this.type;""!==this.name&&(g.name=this.name);!0===this.castShadow&&(g.castShadow=!0);!0===this.receiveShadow&&(g.receiveShadow=!0);!1===this.visible&&
(g.visible=!1);!1===this.frustumCulled&&(g.frustumCulled=!1);0!==this.renderOrder&&(g.renderOrder=this.renderOrder);0<Object.keys(this.userData).length&&(g.userData=this.userData);g.layers=this.layers.mask;g.matrix=this.matrix.toArray();g.up=this.up.toArray();!1===this.matrixAutoUpdate&&(g.matrixAutoUpdate=!1);this.isInstancedMesh&&(g.type="InstancedMesh",g.count=this.count,g.instanceMatrix=this.instanceMatrix.toJSON(),null!==this.instanceColor&&(g.instanceColor=this.instanceColor.toJSON()));if(this.isScene)this.background&&
(this.background.isColor?g.background=this.background.toJSON():this.background.isTexture&&(g.background=this.background.toJSON(a).uuid)),this.environment&&this.environment.isTexture&&!0!==this.environment.isRenderTargetTexture&&(g.environment=this.environment.toJSON(a).uuid);else if(this.isMesh||this.isLine||this.isPoints){g.geometry=b(a.geometries,this.geometry);var l=this.geometry.parameters;if(void 0!==l&&void 0!==l.shapes)if(l=l.shapes,Array.isArray(l))for(let m=0,n=l.length;m<n;m++)b(a.shapes,
l[m]);else b(a.shapes,l)}this.isSkinnedMesh&&(g.bindMode=this.bindMode,g.bindMatrix=this.bindMatrix.toArray(),void 0!==this.skeleton&&(b(a.skeletons,this.skeleton),g.skeleton=this.skeleton.uuid));if(void 0!==this.material)if(Array.isArray(this.material)){l=[];for(let m=0,n=this.material.length;m<n;m++)l.push(b(a.materials,this.material[m]));g.material=l}else g.material=b(a.materials,this.material);if(0<this.children.length)for(g.children=[],l=0;l<this.children.length;l++)g.children.push(this.children[l].toJSON(a).object);
if(0<this.animations.length)for(g.animations=[],l=0;l<this.animations.length;l++)g.animations.push(b(a.animations,this.animations[l]));if(d){d=c(a.geometries);l=c(a.materials);const m=c(a.textures),n=c(a.images),t=c(a.shapes),u=c(a.skeletons),v=c(a.animations),A=c(a.nodes);0<d.length&&(f.geometries=d);0<l.length&&(f.materials=l);0<m.length&&(f.textures=m);0<n.length&&(f.images=n);0<t.length&&(f.shapes=t);0<u.length&&(f.skeletons=u);0<v.length&&(f.animations=v);0<A.length&&(f.nodes=A)}f.object=g;return f}clone(a){return(new this.constructor).copy(this,
a)}copy(a,b=!0){this.name=a.name;this.up.copy(a.up);this.position.copy(a.position);this.rotation.order=a.rotation.order;this.quaternion.copy(a.quaternion);this.scale.copy(a.scale);this.matrix.copy(a.matrix);this.matrixWorld.copy(a.matrixWorld);this.matrixAutoUpdate=a.matrixAutoUpdate;this.matrixWorldNeedsUpdate=a.matrixWorldNeedsUpdate;this.matrixWorldAutoUpdate=a.matrixWorldAutoUpdate;this.layers.mask=a.layers.mask;this.visible=a.visible;this.castShadow=a.castShadow;this.receiveShadow=a.receiveShadow;
this.frustumCulled=a.frustumCulled;this.renderOrder=a.renderOrder;this.animations=a.animations.slice();this.userData=JSON.parse(JSON.stringify(a.userData));if(!0===b)for(b=0;b<a.children.length;b++)this.add(a.children[b].clone());return this}}q.Object3D=hb;hb.DEFAULT_UP=new O(0,1,0);hb.DEFAULT_MATRIX_AUTO_UPDATE=!0;hb.DEFAULT_MATRIX_WORLD_AUTO_UPDATE=!0;const Bc=new O,Uc=new O,ig=new O,Vc=new O,ee=new O,fe=new O,yh=new O,jg=new O,kg=new O,lg=new O;let qf=!1;class Tb{constructor(a=new O,b=new O,c=
new O){this.a=a;this.b=b;this.c=c}static getNormal(a,b,c,d){d.subVectors(c,b);Bc.subVectors(a,b);d.cross(Bc);a=d.lengthSq();return 0<a?d.multiplyScalar(1/Math.sqrt(a)):d.set(0,0,0)}static getBarycoord(a,b,c,d,f){Bc.subVectors(d,b);Uc.subVectors(c,b);ig.subVectors(a,b);a=Bc.dot(Bc);b=Bc.dot(Uc);c=Bc.dot(ig);var g=Uc.dot(Uc);d=Uc.dot(ig);var l=a*g-b*b;if(0===l)return f.set(-2,-1,-1);l=1/l;g=(g*c-b*d)*l;a=(a*d-b*c)*l;return f.set(1-g-a,a,g)}static containsPoint(a,b,c,d){this.getBarycoord(a,b,c,d,Vc);
return 0<=Vc.x&&0<=Vc.y&&1>=Vc.x+Vc.y}static getUV(a,b,c,d,f,g,l,m){!1===qf&&(console.warn("THREE.Triangle.getUV() has been renamed to THREE.Triangle.getInterpolation()."),qf=!0);return this.getInterpolation(a,b,c,d,f,g,l,m)}static getInterpolation(a,b,c,d,f,g,l,m){this.getBarycoord(a,b,c,d,Vc);m.setScalar(0);m.addScaledVector(f,Vc.x);m.addScaledVector(g,Vc.y);m.addScaledVector(l,Vc.z);return m}static isFrontFacing(a,b,c,d){Bc.subVectors(c,b);Uc.subVectors(a,b);return 0>Bc.cross(Uc).dot(d)?!0:!1}set(a,
b,c){this.a.copy(a);this.b.copy(b);this.c.copy(c);return this}setFromPointsAndIndices(a,b,c,d){this.a.copy(a[b]);this.b.copy(a[c]);this.c.copy(a[d]);return this}setFromAttributeAndIndices(a,b,c,d){this.a.fromBufferAttribute(a,b);this.b.fromBufferAttribute(a,c);this.c.fromBufferAttribute(a,d);return this}clone(){return(new this.constructor).copy(this)}copy(a){this.a.copy(a.a);this.b.copy(a.b);this.c.copy(a.c);return this}getArea(){Bc.subVectors(this.c,this.b);Uc.subVectors(this.a,this.b);return.5*
Bc.cross(Uc).length()}getMidpoint(a){return a.addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)}getNormal(a){return Tb.getNormal(this.a,this.b,this.c,a)}getPlane(a){return a.setFromCoplanarPoints(this.a,this.b,this.c)}getBarycoord(a,b){return Tb.getBarycoord(a,this.a,this.b,this.c,b)}getUV(a,b,c,d,f){!1===qf&&(console.warn("THREE.Triangle.getUV() has been renamed to THREE.Triangle.getInterpolation()."),qf=!0);return Tb.getInterpolation(a,this.a,this.b,this.c,b,c,d,f)}getInterpolation(a,b,
c,d,f){return Tb.getInterpolation(a,this.a,this.b,this.c,b,c,d,f)}containsPoint(a){return Tb.containsPoint(a,this.a,this.b,this.c)}isFrontFacing(a){return Tb.isFrontFacing(this.a,this.b,this.c,a)}intersectsBox(a){return a.intersectsTriangle(this)}closestPointToPoint(a,b){const c=this.a;var d=this.b,f=this.c;ee.subVectors(d,c);fe.subVectors(f,c);jg.subVectors(a,c);var g=ee.dot(jg),l=fe.dot(jg);if(0>=g&&0>=l)return b.copy(c);kg.subVectors(a,d);const m=ee.dot(kg),n=fe.dot(kg);if(0<=m&&n<=m)return b.copy(d);
var t=g*n-m*l;if(0>=t&&0<=g&&0>=m)return d=g/(g-m),b.copy(c).addScaledVector(ee,d);lg.subVectors(a,f);a=ee.dot(lg);const u=fe.dot(lg);if(0<=u&&a<=u)return b.copy(f);g=a*l-g*u;if(0>=g&&0<=l&&0>=u)return t=l/(l-u),b.copy(c).addScaledVector(fe,t);l=m*u-a*n;if(0>=l&&0<=n-m&&0<=a-u)return yh.subVectors(f,d),t=(n-m)/(n-m+(a-u)),b.copy(d).addScaledVector(yh,t);f=1/(l+g+t);d=g*f;t*=f;return b.copy(c).addScaledVector(ee,d).addScaledVector(fe,t)}equals(a){return a.a.equals(this.a)&&a.b.equals(this.b)&&a.c.equals(this.c)}}
q.Triangle=Tb;const mg={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,
darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,
grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,
lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,
palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,
teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},fd={h:0,s:0,l:0},rf={h:0,s:0,l:0};class Ia{constructor(a,b,c){this.isColor=!0;this.b=this.g=this.r=1;return this.set(a,b,c)}set(a,b,c){void 0===b&&void 0===c?a&&a.isColor?this.copy(a):"number"===typeof a?this.setHex(a):"string"===typeof a&&this.setStyle(a):this.setRGB(a,b,c);return this}setScalar(a){this.b=this.g=this.r=a;return this}setHex(a,
b="srgb"){a=Math.floor(a);this.r=(a>>16&255)/255;this.g=(a>>8&255)/255;this.b=(a&255)/255;jb.toWorkingColorSpace(this,b);return this}setRGB(a,b,c,d=jb.workingColorSpace){this.r=a;this.g=b;this.b=c;jb.toWorkingColorSpace(this,d);return this}setHSL(a,b,c,d=jb.workingColorSpace){a=Gf(a,1);b=yb(b,0,1);c=yb(c,0,1);0===b?this.r=this.g=this.b=c:(b=.5>=c?c*(1+b):c+b-c*b,c=2*c-b,this.r=Jf(c,b,a+1/3),this.g=Jf(c,b,a),this.b=Jf(c,b,a-1/3));jb.toWorkingColorSpace(this,d);return this}setStyle(a,b="srgb"){function c(g){void 0!==
g&&1>parseFloat(g)&&console.warn("THREE.Color: Alpha component of "+a+" will be ignored.")}var d;if(d=/^(\w+)\(([^\)]*)\)/.exec(a)){var f=d[2];switch(d[1]){case "rgb":case "rgba":if(d=/^\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(f))return c(d[4]),this.setRGB(Math.min(255,parseInt(d[1],10))/255,Math.min(255,parseInt(d[2],10))/255,Math.min(255,parseInt(d[3],10))/255,b);if(d=/^\s*(\d+)%\s*,\s*(\d+)%\s*,\s*(\d+)%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(f))return c(d[4]),this.setRGB(Math.min(100,
parseInt(d[1],10))/100,Math.min(100,parseInt(d[2],10))/100,Math.min(100,parseInt(d[3],10))/100,b);break;case "hsl":case "hsla":if(d=/^\s*(\d*\.?\d+)\s*,\s*(\d*\.?\d+)%\s*,\s*(\d*\.?\d+)%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(f))return c(d[4]),this.setHSL(parseFloat(d[1])/360,parseFloat(d[2])/100,parseFloat(d[3])/100,b);break;default:console.warn("THREE.Color: Unknown color model "+a)}}else if(d=/^#([A-Fa-f\d]+)$/.exec(a)){f=d[1];d=f.length;if(3===d)return this.setRGB(parseInt(f.charAt(0),16)/15,parseInt(f.charAt(1),
16)/15,parseInt(f.charAt(2),16)/15,b);if(6===d)return this.setHex(parseInt(f,16),b);console.warn("THREE.Color: Invalid hex color "+a)}else if(a&&0<a.length)return this.setColorName(a,b);return this}setColorName(a,b="srgb"){const c=mg[a.toLowerCase()];void 0!==c?this.setHex(c,b):console.warn("THREE.Color: Unknown color "+a);return this}clone(){return new this.constructor(this.r,this.g,this.b)}copy(a){this.r=a.r;this.g=a.g;this.b=a.b;return this}copySRGBToLinear(a){this.r=nd(a.r);this.g=nd(a.g);this.b=
nd(a.b);return this}copyLinearToSRGB(a){this.r=me(a.r);this.g=me(a.g);this.b=me(a.b);return this}convertSRGBToLinear(){this.copySRGBToLinear(this);return this}convertLinearToSRGB(){this.copyLinearToSRGB(this);return this}getHex(a="srgb"){jb.fromWorkingColorSpace(Mb.copy(this),a);return 65536*Math.round(yb(255*Mb.r,0,255))+256*Math.round(yb(255*Mb.g,0,255))+Math.round(yb(255*Mb.b,0,255))}getHexString(a="srgb"){return("000000"+this.getHex(a).toString(16)).slice(-6)}getHSL(a,b=jb.workingColorSpace){jb.fromWorkingColorSpace(Mb.copy(this),
b);b=Mb.r;const c=Mb.g,d=Mb.b,f=Math.max(b,c,d);var g=Math.min(b,c,d);let l;const m=(g+f)/2;if(g===f)g=l=0;else{const n=f-g;g=.5>=m?n/(f+g):n/(2-f-g);switch(f){case b:l=(c-d)/n+(c<d?6:0);break;case c:l=(d-b)/n+2;break;case d:l=(b-c)/n+4}l/=6}a.h=l;a.s=g;a.l=m;return a}getRGB(a,b=jb.workingColorSpace){jb.fromWorkingColorSpace(Mb.copy(this),b);a.r=Mb.r;a.g=Mb.g;a.b=Mb.b;return a}getStyle(a="srgb"){jb.fromWorkingColorSpace(Mb.copy(this),a);const b=Mb.r,c=Mb.g,d=Mb.b;return"srgb"!==a?`color(${a} ${b.toFixed(3)} ${c.toFixed(3)} ${d.toFixed(3)})`:
`rgb(${Math.round(255*b)},${Math.round(255*c)},${Math.round(255*d)})`}offsetHSL(a,b,c){this.getHSL(fd);return this.setHSL(fd.h+a,fd.s+b,fd.l+c)}add(a){this.r+=a.r;this.g+=a.g;this.b+=a.b;return this}addColors(a,b){this.r=a.r+b.r;this.g=a.g+b.g;this.b=a.b+b.b;return this}addScalar(a){this.r+=a;this.g+=a;this.b+=a;return this}sub(a){this.r=Math.max(0,this.r-a.r);this.g=Math.max(0,this.g-a.g);this.b=Math.max(0,this.b-a.b);return this}multiply(a){this.r*=a.r;this.g*=a.g;this.b*=a.b;return this}multiplyScalar(a){this.r*=
a;this.g*=a;this.b*=a;return this}lerp(a,b){this.r+=(a.r-this.r)*b;this.g+=(a.g-this.g)*b;this.b+=(a.b-this.b)*b;return this}lerpColors(a,b,c){this.r=a.r+(b.r-a.r)*c;this.g=a.g+(b.g-a.g)*c;this.b=a.b+(b.b-a.b)*c;return this}lerpHSL(a,b){this.getHSL(fd);a.getHSL(rf);a=le(fd.h,rf.h,b);const c=le(fd.s,rf.s,b);b=le(fd.l,rf.l,b);this.setHSL(a,c,b);return this}setFromVector3(a){this.r=a.x;this.g=a.y;this.b=a.z;return this}applyMatrix3(a){const b=this.r,c=this.g,d=this.b;a=a.elements;this.r=a[0]*b+a[3]*
c+a[6]*d;this.g=a[1]*b+a[4]*c+a[7]*d;this.b=a[2]*b+a[5]*c+a[8]*d;return this}equals(a){return a.r===this.r&&a.g===this.g&&a.b===this.b}fromArray(a,b=0){this.r=a[b];this.g=a[b+1];this.b=a[b+2];return this}toArray(a=[],b=0){a[b]=this.r;a[b+1]=this.g;a[b+2]=this.b;return a}fromBufferAttribute(a,b){this.r=a.getX(b);this.g=a.getY(b);this.b=a.getZ(b);return this}toJSON(){return this.getHex()}*[Symbol.iterator](){yield this.r;yield this.g;yield this.b}}q.Color=Ia;const Mb=new Ia;Ia.NAMES=mg;let jj=0;class Wb extends Pc{constructor(){super();
this.isMaterial=!0;Object.defineProperty(this,"id",{value:jj++});this.uuid=$b();this.name="";this.type="Material";this.blending=1;this.side=0;this.vertexColors=!1;this.opacity=1;this.alphaHash=this.transparent=!1;this.blendSrc=204;this.blendDst=205;this.blendEquation=100;this.blendEquationAlpha=this.blendDstAlpha=this.blendSrcAlpha=null;this.blendColor=new Ia(0,0,0);this.blendAlpha=0;this.depthFunc=3;this.depthWrite=this.depthTest=!0;this.stencilWriteMask=255;this.stencilFunc=519;this.stencilRef=
0;this.stencilFuncMask=255;this.stencilZPass=this.stencilZFail=this.stencilFail=7680;this.stencilWrite=!1;this.clippingPlanes=null;this.clipShadows=this.clipIntersection=!1;this.shadowSide=null;this.colorWrite=!0;this.precision=null;this.polygonOffset=!1;this.polygonOffsetUnits=this.polygonOffsetFactor=0;this.forceSinglePass=this.premultipliedAlpha=this.alphaToCoverage=this.dithering=!1;this.toneMapped=this.visible=!0;this.userData={};this._alphaTest=this.version=0}get alphaTest(){return this._alphaTest}set alphaTest(a){0<
this._alphaTest!==0<a&&this.version++;this._alphaTest=a}onBuild(){}onBeforeRender(){}onBeforeCompile(){}customProgramCacheKey(){return this.onBeforeCompile.toString()}setValues(a){if(void 0!==a)for(const b in a){const c=a[b];if(void 0===c){console.warn(`THREE.Material: parameter '${b}' has value of undefined.`);continue}const d=this[b];void 0===d?console.warn(`THREE.Material: '${b}' is not a property of THREE.${this.type}.`):d&&d.isColor?d.set(c):d&&d.isVector3&&c&&c.isVector3?d.copy(c):this[b]=c}}toJSON(a){function b(f){const g=
[];for(const l in f){const m=f[l];delete m.metadata;g.push(m)}return g}var c=void 0===a||"string"===typeof a;c&&(a={textures:{},images:{}});const d={metadata:{version:4.6,type:"Material",generator:"Material.toJSON"}};d.uuid=this.uuid;d.type=this.type;""!==this.name&&(d.name=this.name);this.color&&this.color.isColor&&(d.color=this.color.getHex());void 0!==this.roughness&&(d.roughness=this.roughness);void 0!==this.metalness&&(d.metalness=this.metalness);void 0!==this.sheen&&(d.sheen=this.sheen);this.sheenColor&&
this.sheenColor.isColor&&(d.sheenColor=this.sheenColor.getHex());void 0!==this.sheenRoughness&&(d.sheenRoughness=this.sheenRoughness);this.emissive&&this.emissive.isColor&&(d.emissive=this.emissive.getHex());this.emissiveIntensity&&1!==this.emissiveIntensity&&(d.emissiveIntensity=this.emissiveIntensity);this.specular&&this.specular.isColor&&(d.specular=this.specular.getHex());void 0!==this.specularIntensity&&(d.specularIntensity=this.specularIntensity);this.specularColor&&this.specularColor.isColor&&
(d.specularColor=this.specularColor.getHex());void 0!==this.shininess&&(d.shininess=this.shininess);void 0!==this.clearcoat&&(d.clearcoat=this.clearcoat);void 0!==this.clearcoatRoughness&&(d.clearcoatRoughness=this.clearcoatRoughness);this.clearcoatMap&&this.clearcoatMap.isTexture&&(d.clearcoatMap=this.clearcoatMap.toJSON(a).uuid);this.clearcoatRoughnessMap&&this.clearcoatRoughnessMap.isTexture&&(d.clearcoatRoughnessMap=this.clearcoatRoughnessMap.toJSON(a).uuid);this.clearcoatNormalMap&&this.clearcoatNormalMap.isTexture&&
(d.clearcoatNormalMap=this.clearcoatNormalMap.toJSON(a).uuid,d.clearcoatNormalScale=this.clearcoatNormalScale.toArray());void 0!==this.iridescence&&(d.iridescence=this.iridescence);void 0!==this.iridescenceIOR&&(d.iridescenceIOR=this.iridescenceIOR);void 0!==this.iridescenceThicknessRange&&(d.iridescenceThicknessRange=this.iridescenceThicknessRange);this.iridescenceMap&&this.iridescenceMap.isTexture&&(d.iridescenceMap=this.iridescenceMap.toJSON(a).uuid);this.iridescenceThicknessMap&&this.iridescenceThicknessMap.isTexture&&
(d.iridescenceThicknessMap=this.iridescenceThicknessMap.toJSON(a).uuid);void 0!==this.anisotropy&&(d.anisotropy=this.anisotropy);void 0!==this.anisotropyRotation&&(d.anisotropyRotation=this.anisotropyRotation);this.anisotropyMap&&this.anisotropyMap.isTexture&&(d.anisotropyMap=this.anisotropyMap.toJSON(a).uuid);this.map&&this.map.isTexture&&(d.map=this.map.toJSON(a).uuid);this.matcap&&this.matcap.isTexture&&(d.matcap=this.matcap.toJSON(a).uuid);this.alphaMap&&this.alphaMap.isTexture&&(d.alphaMap=this.alphaMap.toJSON(a).uuid);
this.lightMap&&this.lightMap.isTexture&&(d.lightMap=this.lightMap.toJSON(a).uuid,d.lightMapIntensity=this.lightMapIntensity);this.aoMap&&this.aoMap.isTexture&&(d.aoMap=this.aoMap.toJSON(a).uuid,d.aoMapIntensity=this.aoMapIntensity);this.bumpMap&&this.bumpMap.isTexture&&(d.bumpMap=this.bumpMap.toJSON(a).uuid,d.bumpScale=this.bumpScale);this.normalMap&&this.normalMap.isTexture&&(d.normalMap=this.normalMap.toJSON(a).uuid,d.normalMapType=this.normalMapType,d.normalScale=this.normalScale.toArray());this.displacementMap&&
this.displacementMap.isTexture&&(d.displacementMap=this.displacementMap.toJSON(a).uuid,d.displacementScale=this.displacementScale,d.displacementBias=this.displacementBias);this.roughnessMap&&this.roughnessMap.isTexture&&(d.roughnessMap=this.roughnessMap.toJSON(a).uuid);this.metalnessMap&&this.metalnessMap.isTexture&&(d.metalnessMap=this.metalnessMap.toJSON(a).uuid);this.emissiveMap&&this.emissiveMap.isTexture&&(d.emissiveMap=this.emissiveMap.toJSON(a).uuid);this.specularMap&&this.specularMap.isTexture&&
(d.specularMap=this.specularMap.toJSON(a).uuid);this.specularIntensityMap&&this.specularIntensityMap.isTexture&&(d.specularIntensityMap=this.specularIntensityMap.toJSON(a).uuid);this.specularColorMap&&this.specularColorMap.isTexture&&(d.specularColorMap=this.specularColorMap.toJSON(a).uuid);this.envMap&&this.envMap.isTexture&&(d.envMap=this.envMap.toJSON(a).uuid,void 0!==this.combine&&(d.combine=this.combine));void 0!==this.envMapIntensity&&(d.envMapIntensity=this.envMapIntensity);void 0!==this.reflectivity&&
(d.reflectivity=this.reflectivity);void 0!==this.refractionRatio&&(d.refractionRatio=this.refractionRatio);this.gradientMap&&this.gradientMap.isTexture&&(d.gradientMap=this.gradientMap.toJSON(a).uuid);void 0!==this.transmission&&(d.transmission=this.transmission);this.transmissionMap&&this.transmissionMap.isTexture&&(d.transmissionMap=this.transmissionMap.toJSON(a).uuid);void 0!==this.thickness&&(d.thickness=this.thickness);this.thicknessMap&&this.thicknessMap.isTexture&&(d.thicknessMap=this.thicknessMap.toJSON(a).uuid);
void 0!==this.attenuationDistance&&Infinity!==this.attenuationDistance&&(d.attenuationDistance=this.attenuationDistance);void 0!==this.attenuationColor&&(d.attenuationColor=this.attenuationColor.getHex());void 0!==this.size&&(d.size=this.size);null!==this.shadowSide&&(d.shadowSide=this.shadowSide);void 0!==this.sizeAttenuation&&(d.sizeAttenuation=this.sizeAttenuation);1!==this.blending&&(d.blending=this.blending);0!==this.side&&(d.side=this.side);!0===this.vertexColors&&(d.vertexColors=!0);1>this.opacity&&
(d.opacity=this.opacity);!0===this.transparent&&(d.transparent=!0);204!==this.blendSrc&&(d.blendSrc=this.blendSrc);205!==this.blendDst&&(d.blendDst=this.blendDst);100!==this.blendEquation&&(d.blendEquation=this.blendEquation);null!==this.blendSrcAlpha&&(d.blendSrcAlpha=this.blendSrcAlpha);null!==this.blendDstAlpha&&(d.blendDstAlpha=this.blendDstAlpha);null!==this.blendEquationAlpha&&(d.blendEquationAlpha=this.blendEquationAlpha);this.blendColor&&this.blendColor.isColor&&(d.blendColor=this.blendColor.getHex());
0!==this.blendAlpha&&(d.blendAlpha=this.blendAlpha);3!==this.depthFunc&&(d.depthFunc=this.depthFunc);!1===this.depthTest&&(d.depthTest=this.depthTest);!1===this.depthWrite&&(d.depthWrite=this.depthWrite);!1===this.colorWrite&&(d.colorWrite=this.colorWrite);255!==this.stencilWriteMask&&(d.stencilWriteMask=this.stencilWriteMask);519!==this.stencilFunc&&(d.stencilFunc=this.stencilFunc);0!==this.stencilRef&&(d.stencilRef=this.stencilRef);255!==this.stencilFuncMask&&(d.stencilFuncMask=this.stencilFuncMask);
7680!==this.stencilFail&&(d.stencilFail=this.stencilFail);7680!==this.stencilZFail&&(d.stencilZFail=this.stencilZFail);7680!==this.stencilZPass&&(d.stencilZPass=this.stencilZPass);!0===this.stencilWrite&&(d.stencilWrite=this.stencilWrite);void 0!==this.rotation&&0!==this.rotation&&(d.rotation=this.rotation);!0===this.polygonOffset&&(d.polygonOffset=!0);0!==this.polygonOffsetFactor&&(d.polygonOffsetFactor=this.polygonOffsetFactor);0!==this.polygonOffsetUnits&&(d.polygonOffsetUnits=this.polygonOffsetUnits);
void 0!==this.linewidth&&1!==this.linewidth&&(d.linewidth=this.linewidth);void 0!==this.dashSize&&(d.dashSize=this.dashSize);void 0!==this.gapSize&&(d.gapSize=this.gapSize);void 0!==this.scale&&(d.scale=this.scale);!0===this.dithering&&(d.dithering=!0);0<this.alphaTest&&(d.alphaTest=this.alphaTest);!0===this.alphaHash&&(d.alphaHash=!0);!0===this.alphaToCoverage&&(d.alphaToCoverage=!0);!0===this.premultipliedAlpha&&(d.premultipliedAlpha=!0);!0===this.forceSinglePass&&(d.forceSinglePass=!0);!0===this.wireframe&&
(d.wireframe=!0);1<this.wireframeLinewidth&&(d.wireframeLinewidth=this.wireframeLinewidth);"round"!==this.wireframeLinecap&&(d.wireframeLinecap=this.wireframeLinecap);"round"!==this.wireframeLinejoin&&(d.wireframeLinejoin=this.wireframeLinejoin);!0===this.flatShading&&(d.flatShading=!0);!1===this.visible&&(d.visible=!1);!1===this.toneMapped&&(d.toneMapped=!1);!1===this.fog&&(d.fog=!1);0<Object.keys(this.userData).length&&(d.userData=this.userData);c&&(c=b(a.textures),a=b(a.images),0<c.length&&(d.textures=
c),0<a.length&&(d.images=a));return d}clone(){return(new this.constructor).copy(this)}copy(a){this.name=a.name;this.blending=a.blending;this.side=a.side;this.vertexColors=a.vertexColors;this.opacity=a.opacity;this.transparent=a.transparent;this.blendSrc=a.blendSrc;this.blendDst=a.blendDst;this.blendEquation=a.blendEquation;this.blendSrcAlpha=a.blendSrcAlpha;this.blendDstAlpha=a.blendDstAlpha;this.blendEquationAlpha=a.blendEquationAlpha;this.blendColor.copy(a.blendColor);this.blendAlpha=a.blendAlpha;
this.depthFunc=a.depthFunc;this.depthTest=a.depthTest;this.depthWrite=a.depthWrite;this.stencilWriteMask=a.stencilWriteMask;this.stencilFunc=a.stencilFunc;this.stencilRef=a.stencilRef;this.stencilFuncMask=a.stencilFuncMask;this.stencilFail=a.stencilFail;this.stencilZFail=a.stencilZFail;this.stencilZPass=a.stencilZPass;this.stencilWrite=a.stencilWrite;const b=a.clippingPlanes;let c=null;if(null!==b){const d=b.length;c=Array(d);for(let f=0;f!==d;++f)c[f]=b[f].clone()}this.clippingPlanes=c;this.clipIntersection=
a.clipIntersection;this.clipShadows=a.clipShadows;this.shadowSide=a.shadowSide;this.colorWrite=a.colorWrite;this.precision=a.precision;this.polygonOffset=a.polygonOffset;this.polygonOffsetFactor=a.polygonOffsetFactor;this.polygonOffsetUnits=a.polygonOffsetUnits;this.dithering=a.dithering;this.alphaTest=a.alphaTest;this.alphaHash=a.alphaHash;this.alphaToCoverage=a.alphaToCoverage;this.premultipliedAlpha=a.premultipliedAlpha;this.forceSinglePass=a.forceSinglePass;this.visible=a.visible;this.toneMapped=
a.toneMapped;this.userData=JSON.parse(JSON.stringify(a.userData));return this}dispose(){this.dispatchEvent({type:"dispose"})}set needsUpdate(a){!0===a&&this.version++}}q.Material=Wb;class gd extends Wb{constructor(a){super();this.isMeshBasicMaterial=!0;this.type="MeshBasicMaterial";this.color=new Ia(16777215);this.lightMap=this.map=null;this.lightMapIntensity=1;this.aoMap=null;this.aoMapIntensity=1;this.envMap=this.alphaMap=this.specularMap=null;this.combine=0;this.reflectivity=1;this.refractionRatio=
.98;this.wireframe=!1;this.wireframeLinewidth=1;this.wireframeLinejoin=this.wireframeLinecap="round";this.fog=!0;this.setValues(a)}copy(a){super.copy(a);this.color.copy(a.color);this.map=a.map;this.lightMap=a.lightMap;this.lightMapIntensity=a.lightMapIntensity;this.aoMap=a.aoMap;this.aoMapIntensity=a.aoMapIntensity;this.specularMap=a.specularMap;this.alphaMap=a.alphaMap;this.envMap=a.envMap;this.combine=a.combine;this.reflectivity=a.reflectivity;this.refractionRatio=a.refractionRatio;this.wireframe=
a.wireframe;this.wireframeLinewidth=a.wireframeLinewidth;this.wireframeLinecap=a.wireframeLinecap;this.wireframeLinejoin=a.wireframeLinejoin;this.fog=a.fog;return this}}q.MeshBasicMaterial=gd;const Lc=function(){var a=new ArrayBuffer(4);const b=new Float32Array(a);a=new Uint32Array(a);const c=new Uint32Array(512),d=new Uint32Array(512);for(var f=0;256>f;++f){var g=f-127;-27>g?(c[f]=0,c[f|256]=32768,d[f]=24,d[f|256]=24):-14>g?(c[f]=1024>>-g-14,c[f|256]=1024>>-g-14|32768,d[f]=-g-1,d[f|256]=-g-1):15>=
g?(c[f]=g+15<<10,c[f|256]=g+15<<10|32768,d[f]=13,d[f|256]=13):128>g?(c[f]=31744,c[f|256]=64512,d[f]=24,d[f|256]=24):(c[f]=31744,c[f|256]=64512,d[f]=13,d[f|256]=13)}f=new Uint32Array(2048);g=new Uint32Array(64);const l=new Uint32Array(64);for(var m=1;1024>m;++m){let n=m<<13,t=0;for(;0===(n&8388608);)n<<=1,t-=8388608;n&=-8388609;t+=947912704;f[m]=n|t}for(m=1024;2048>m;++m)f[m]=939524096+(m-1024<<13);for(m=1;31>m;++m)g[m]=m<<23;g[31]=1199570944;g[32]=2147483648;for(m=33;63>m;++m)g[m]=2147483648+(m-32<<
23);g[63]=3347054592;for(m=1;64>m;++m)32!==m&&(l[m]=1024);return{floatView:b,uint32View:a,baseTable:c,shiftTable:d,mantissaTable:f,exponentTable:g,offsetTable:l}}();q.DataUtils={toHalfFloat:ac,fromHalfFloat:Hd};const Ib=new O,sf=new sa;class rb{constructor(a,b,c=!1){if(Array.isArray(a))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");this.isBufferAttribute=!0;this.name="";this.array=a;this.itemSize=b;this.count=void 0!==a?a.length/b:0;this.normalized=c;this.usage=35044;
this.updateRange={offset:0,count:-1};this.gpuType=1015;this.version=0}onUploadCallback(){}set needsUpdate(a){!0===a&&this.version++}setUsage(a){this.usage=a;return this}copy(a){this.name=a.name;this.array=new a.array.constructor(a.array);this.itemSize=a.itemSize;this.count=a.count;this.normalized=a.normalized;this.usage=a.usage;this.gpuType=a.gpuType;return this}copyAt(a,b,c){a*=this.itemSize;c*=b.itemSize;for(let d=0,f=this.itemSize;d<f;d++)this.array[a+d]=b.array[c+d];return this}copyArray(a){this.array.set(a);
return this}applyMatrix3(a){if(2===this.itemSize)for(let b=0,c=this.count;b<c;b++)sf.fromBufferAttribute(this,b),sf.applyMatrix3(a),this.setXY(b,sf.x,sf.y);else if(3===this.itemSize)for(let b=0,c=this.count;b<c;b++)Ib.fromBufferAttribute(this,b),Ib.applyMatrix3(a),this.setXYZ(b,Ib.x,Ib.y,Ib.z);return this}applyMatrix4(a){for(let b=0,c=this.count;b<c;b++)Ib.fromBufferAttribute(this,b),Ib.applyMatrix4(a),this.setXYZ(b,Ib.x,Ib.y,Ib.z);return this}applyNormalMatrix(a){for(let b=0,c=this.count;b<c;b++)Ib.fromBufferAttribute(this,
b),Ib.applyNormalMatrix(a),this.setXYZ(b,Ib.x,Ib.y,Ib.z);return this}transformDirection(a){for(let b=0,c=this.count;b<c;b++)Ib.fromBufferAttribute(this,b),Ib.transformDirection(a),this.setXYZ(b,Ib.x,Ib.y,Ib.z);return this}set(a,b=0){this.array.set(a,b);return this}getComponent(a,b){a=this.array[a*this.itemSize+b];this.normalized&&(a=B(a,this.array));return a}setComponent(a,b,c){this.normalized&&(c=Xa(c,this.array));this.array[a*this.itemSize+b]=c;return this}getX(a){a=this.array[a*this.itemSize];
this.normalized&&(a=B(a,this.array));return a}setX(a,b){this.normalized&&(b=Xa(b,this.array));this.array[a*this.itemSize]=b;return this}getY(a){a=this.array[a*this.itemSize+1];this.normalized&&(a=B(a,this.array));return a}setY(a,b){this.normalized&&(b=Xa(b,this.array));this.array[a*this.itemSize+1]=b;return this}getZ(a){a=this.array[a*this.itemSize+2];this.normalized&&(a=B(a,this.array));return a}setZ(a,b){this.normalized&&(b=Xa(b,this.array));this.array[a*this.itemSize+2]=b;return this}getW(a){a=
this.array[a*this.itemSize+3];this.normalized&&(a=B(a,this.array));return a}setW(a,b){this.normalized&&(b=Xa(b,this.array));this.array[a*this.itemSize+3]=b;return this}setXY(a,b,c){a*=this.itemSize;this.normalized&&(b=Xa(b,this.array),c=Xa(c,this.array));this.array[a+0]=b;this.array[a+1]=c;return this}setXYZ(a,b,c,d){a*=this.itemSize;this.normalized&&(b=Xa(b,this.array),c=Xa(c,this.array),d=Xa(d,this.array));this.array[a+0]=b;this.array[a+1]=c;this.array[a+2]=d;return this}setXYZW(a,b,c,d,f){a*=this.itemSize;
this.normalized&&(b=Xa(b,this.array),c=Xa(c,this.array),d=Xa(d,this.array),f=Xa(f,this.array));this.array[a+0]=b;this.array[a+1]=c;this.array[a+2]=d;this.array[a+3]=f;return this}onUpload(a){this.onUploadCallback=a;return this}clone(){return(new this.constructor(this.array,this.itemSize)).copy(this)}toJSON(){const a={itemSize:this.itemSize,type:this.array.constructor.name,array:Array.from(this.array),normalized:this.normalized};""!==this.name&&(a.name=this.name);35044!==this.usage&&(a.usage=this.usage);
if(0!==this.updateRange.offset||-1!==this.updateRange.count)a.updateRange=this.updateRange;return a}}q.BufferAttribute=rb;class kj extends rb{constructor(a,b,c){super(new Int8Array(a),b,c)}}q.Int8BufferAttribute=kj;class lj extends rb{constructor(a,b,c){super(new Uint8Array(a),b,c)}}q.Uint8BufferAttribute=lj;class mj extends rb{constructor(a,b,c){super(new Uint8ClampedArray(a),b,c)}}q.Uint8ClampedBufferAttribute=mj;class nj extends rb{constructor(a,b,c){super(new Int16Array(a),b,c)}}q.Int16BufferAttribute=
nj;class Of extends rb{constructor(a,b,c){super(new Uint16Array(a),b,c)}}q.Uint16BufferAttribute=Of;class oj extends rb{constructor(a,b,c){super(new Int32Array(a),b,c)}}q.Int32BufferAttribute=oj;class Nf extends rb{constructor(a,b,c){super(new Uint32Array(a),b,c)}}q.Uint32BufferAttribute=Nf;class pj extends rb{constructor(a,b,c){super(new Uint16Array(a),b,c);this.isFloat16BufferAttribute=!0}getX(a){a=Hd(this.array[a*this.itemSize]);this.normalized&&(a=B(a,this.array));return a}setX(a,b){this.normalized&&
(b=Xa(b,this.array));this.array[a*this.itemSize]=ac(b);return this}getY(a){a=Hd(this.array[a*this.itemSize+1]);this.normalized&&(a=B(a,this.array));return a}setY(a,b){this.normalized&&(b=Xa(b,this.array));this.array[a*this.itemSize+1]=ac(b);return this}getZ(a){a=Hd(this.array[a*this.itemSize+2]);this.normalized&&(a=B(a,this.array));return a}setZ(a,b){this.normalized&&(b=Xa(b,this.array));this.array[a*this.itemSize+2]=ac(b);return this}getW(a){a=Hd(this.array[a*this.itemSize+3]);this.normalized&&(a=
B(a,this.array));return a}setW(a,b){this.normalized&&(b=Xa(b,this.array));this.array[a*this.itemSize+3]=ac(b);return this}setXY(a,b,c){a*=this.itemSize;this.normalized&&(b=Xa(b,this.array),c=Xa(c,this.array));this.array[a+0]=ac(b);this.array[a+1]=ac(c);return this}setXYZ(a,b,c,d){a*=this.itemSize;this.normalized&&(b=Xa(b,this.array),c=Xa(c,this.array),d=Xa(d,this.array));this.array[a+0]=ac(b);this.array[a+1]=ac(c);this.array[a+2]=ac(d);return this}setXYZW(a,b,c,d,f){a*=this.itemSize;this.normalized&&
(b=Xa(b,this.array),c=Xa(c,this.array),d=Xa(d,this.array),f=Xa(f,this.array));this.array[a+0]=ac(b);this.array[a+1]=ac(c);this.array[a+2]=ac(d);this.array[a+3]=ac(f);return this}}q.Float16BufferAttribute=pj;class Oa extends rb{constructor(a,b,c){super(new Float32Array(a),b,c)}}q.Float32BufferAttribute=Oa;class qj extends rb{constructor(a,b,c){super(new Float64Array(a),b,c)}}q.Float64BufferAttribute=qj;let rj=0;const pc=new Wa,ng=new hb,ge=new O,hc=new Jc,ze=new Jc,Pb=new O;class ab extends Pc{constructor(){super();
this.isBufferGeometry=!0;Object.defineProperty(this,"id",{value:rj++});this.uuid=$b();this.name="";this.type="BufferGeometry";this.index=null;this.attributes={};this.morphAttributes={};this.morphTargetsRelative=!1;this.groups=[];this.boundingSphere=this.boundingBox=null;this.drawRange={start:0,count:Infinity};this.userData={}}getIndex(){return this.index}setIndex(a){Array.isArray(a)?this.index=new (Dg(a)?Nf:Of)(a,1):this.index=a;return this}getAttribute(a){return this.attributes[a]}setAttribute(a,
b){this.attributes[a]=b;return this}deleteAttribute(a){delete this.attributes[a];return this}hasAttribute(a){return void 0!==this.attributes[a]}addGroup(a,b,c=0){this.groups.push({start:a,count:b,materialIndex:c})}clearGroups(){this.groups=[]}setDrawRange(a,b){this.drawRange.start=a;this.drawRange.count=b}applyMatrix4(a){var b=this.attributes.position;void 0!==b&&(b.applyMatrix4(a),b.needsUpdate=!0);b=this.attributes.normal;if(void 0!==b){const c=(new Za).getNormalMatrix(a);b.applyNormalMatrix(c);
b.needsUpdate=!0}b=this.attributes.tangent;void 0!==b&&(b.transformDirection(a),b.needsUpdate=!0);null!==this.boundingBox&&this.computeBoundingBox();null!==this.boundingSphere&&this.computeBoundingSphere();return this}applyQuaternion(a){pc.makeRotationFromQuaternion(a);this.applyMatrix4(pc);return this}rotateX(a){pc.makeRotationX(a);this.applyMatrix4(pc);return this}rotateY(a){pc.makeRotationY(a);this.applyMatrix4(pc);return this}rotateZ(a){pc.makeRotationZ(a);this.applyMatrix4(pc);return this}translate(a,
b,c){pc.makeTranslation(a,b,c);this.applyMatrix4(pc);return this}scale(a,b,c){pc.makeScale(a,b,c);this.applyMatrix4(pc);return this}lookAt(a){ng.lookAt(a);ng.updateMatrix();this.applyMatrix4(ng.matrix);return this}center(){this.computeBoundingBox();this.boundingBox.getCenter(ge).negate();this.translate(ge.x,ge.y,ge.z);return this}setFromPoints(a){const b=[];for(let c=0,d=a.length;c<d;c++){const f=a[c];b.push(f.x,f.y,f.z||0)}this.setAttribute("position",new Oa(b,3));return this}computeBoundingBox(){null===
this.boundingBox&&(this.boundingBox=new Jc);const a=this.attributes.position,b=this.morphAttributes.position;if(a&&a.isGLBufferAttribute)console.error('THREE.BufferGeometry.computeBoundingBox(): GLBufferAttribute requires a manual bounding box. Alternatively set "mesh.frustumCulled" to "false".',this),this.boundingBox.set(new O(-Infinity,-Infinity,-Infinity),new O(Infinity,Infinity,Infinity));else{if(void 0!==a){if(this.boundingBox.setFromBufferAttribute(a),b)for(let c=0,d=b.length;c<d;c++)hc.setFromBufferAttribute(b[c]),
this.morphTargetsRelative?(Pb.addVectors(this.boundingBox.min,hc.min),this.boundingBox.expandByPoint(Pb),Pb.addVectors(this.boundingBox.max,hc.max),this.boundingBox.expandByPoint(Pb)):(this.boundingBox.expandByPoint(hc.min),this.boundingBox.expandByPoint(hc.max))}else this.boundingBox.makeEmpty();(isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z))&&console.error('THREE.BufferGeometry.computeBoundingBox(): Computed min/max have NaN values. The "position" attribute is likely to have NaN values.',
this)}}computeBoundingSphere(){null===this.boundingSphere&&(this.boundingSphere=new oc);const a=this.attributes.position,b=this.morphAttributes.position;if(a&&a.isGLBufferAttribute)console.error('THREE.BufferGeometry.computeBoundingSphere(): GLBufferAttribute requires a manual bounding sphere. Alternatively set "mesh.frustumCulled" to "false".',this),this.boundingSphere.set(new O,Infinity);else if(a){const c=this.boundingSphere.center;hc.setFromBufferAttribute(a);if(b)for(let f=0,g=b.length;f<g;f++)ze.setFromBufferAttribute(b[f]),
this.morphTargetsRelative?(Pb.addVectors(hc.min,ze.min),hc.expandByPoint(Pb),Pb.addVectors(hc.max,ze.max),hc.expandByPoint(Pb)):(hc.expandByPoint(ze.min),hc.expandByPoint(ze.max));hc.getCenter(c);let d=0;for(let f=0,g=a.count;f<g;f++)Pb.fromBufferAttribute(a,f),d=Math.max(d,c.distanceToSquared(Pb));if(b)for(let f=0,g=b.length;f<g;f++){const l=b[f],m=this.morphTargetsRelative;for(let n=0,t=l.count;n<t;n++)Pb.fromBufferAttribute(l,n),m&&(ge.fromBufferAttribute(a,n),Pb.add(ge)),d=Math.max(d,c.distanceToSquared(Pb))}this.boundingSphere.radius=
Math.sqrt(d);isNaN(this.boundingSphere.radius)&&console.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.',this)}}computeTangents(){function a(aa,pa,ba){v.fromArray(f,3*aa);A.fromArray(f,3*pa);F.fromArray(f,3*ba);D.fromArray(l,2*aa);E.fromArray(l,2*pa);y.fromArray(l,2*ba);A.sub(v);F.sub(v);E.sub(D);y.sub(D);const xa=1/(E.x*y.y-y.x*E.y);isFinite(xa)&&(J.copy(A).multiplyScalar(y.y).addScaledVector(F,-E.y).multiplyScalar(xa),
L.copy(F).multiplyScalar(E.x).addScaledVector(A,-y.x).multiplyScalar(xa),n[aa].add(J),n[pa].add(J),n[ba].add(J),t[aa].add(L),t[pa].add(L),t[ba].add(L))}function b(aa){ja.fromArray(g,3*aa);fa.copy(ja);var pa=n[aa];P.copy(pa);P.sub(ja.multiplyScalar(ja.dot(pa))).normalize();X.crossVectors(fa,pa);pa=X.dot(t[aa]);m[4*aa]=P.x;m[4*aa+1]=P.y;m[4*aa+2]=P.z;m[4*aa+3]=0>pa?-1:1}var c=this.index,d=this.attributes;if(null===c||void 0===d.position||void 0===d.normal||void 0===d.uv)console.error("THREE.BufferGeometry: .computeTangents() failed. Missing required attributes (index, position, normal or uv)");
else{c=c.array;var f=d.position.array,g=d.normal.array,l=d.uv.array;d=f.length/3;!1===this.hasAttribute("tangent")&&this.setAttribute("tangent",new rb(new Float32Array(4*d),4));var m=this.getAttribute("tangent").array,n=[],t=[];for(var u=0;u<d;u++)n[u]=new O,t[u]=new O;var v=new O,A=new O,F=new O,D=new sa,E=new sa,y=new sa,J=new O,L=new O;d=this.groups;0===d.length&&(d=[{start:0,count:c.length}]);for(let aa=0,pa=d.length;aa<pa;++aa){var U=d[aa];u=U.start;U=U.count;for(let ba=u,xa=u+U;ba<xa;ba+=3)a(c[ba+
0],c[ba+1],c[ba+2])}var P=new O,X=new O,ja=new O,fa=new O;for(let aa=0,pa=d.length;aa<pa;++aa){U=d[aa];u=U.start;U=U.count;for(let ba=u,xa=u+U;ba<xa;ba+=3)b(c[ba+0]),b(c[ba+1]),b(c[ba+2])}}}computeVertexNormals(){const a=this.index,b=this.getAttribute("position");if(void 0!==b){let c=this.getAttribute("normal");if(void 0===c)c=new rb(new Float32Array(3*b.count),3),this.setAttribute("normal",c);else for(let v=0,A=c.count;v<A;v++)c.setXYZ(v,0,0,0);const d=new O,f=new O,g=new O,l=new O,m=new O,n=new O,
t=new O,u=new O;if(a)for(let v=0,A=a.count;v<A;v+=3){const F=a.getX(v+0),D=a.getX(v+1),E=a.getX(v+2);d.fromBufferAttribute(b,F);f.fromBufferAttribute(b,D);g.fromBufferAttribute(b,E);t.subVectors(g,f);u.subVectors(d,f);t.cross(u);l.fromBufferAttribute(c,F);m.fromBufferAttribute(c,D);n.fromBufferAttribute(c,E);l.add(t);m.add(t);n.add(t);c.setXYZ(F,l.x,l.y,l.z);c.setXYZ(D,m.x,m.y,m.z);c.setXYZ(E,n.x,n.y,n.z)}else for(let v=0,A=b.count;v<A;v+=3)d.fromBufferAttribute(b,v+0),f.fromBufferAttribute(b,v+1),
g.fromBufferAttribute(b,v+2),t.subVectors(g,f),u.subVectors(d,f),t.cross(u),c.setXYZ(v+0,t.x,t.y,t.z),c.setXYZ(v+1,t.x,t.y,t.z),c.setXYZ(v+2,t.x,t.y,t.z);this.normalizeNormals();c.needsUpdate=!0}}normalizeNormals(){const a=this.attributes.normal;for(let b=0,c=a.count;b<c;b++)Pb.fromBufferAttribute(a,b),Pb.normalize(),a.setXYZ(b,Pb.x,Pb.y,Pb.z)}toNonIndexed(){function a(m,n){const t=m.array,u=m.itemSize,v=m.normalized,A=new t.constructor(n.length*u);let F,D=0;for(let E=0,y=n.length;E<y;E++){F=m.isInterleavedBufferAttribute?
n[E]*m.data.stride+m.offset:n[E]*u;for(let J=0;J<u;J++)A[D++]=t[F++]}return new rb(A,u,v)}if(null===this.index)return console.warn("THREE.BufferGeometry.toNonIndexed(): BufferGeometry is already non-indexed."),this;const b=new ab;var c=this.index.array,d=this.attributes;for(var f in d){var g=a(d[f],c);b.setAttribute(f,g)}d=this.morphAttributes;for(var l in d){f=[];g=d[l];for(let m=0,n=g.length;m<n;m++){const t=a(g[m],c);f.push(t)}b.morphAttributes[l]=f}b.morphTargetsRelative=this.morphTargetsRelative;
c=this.groups;for(let m=0,n=c.length;m<n;m++)l=c[m],b.addGroup(l.start,l.count,l.materialIndex);return b}toJSON(){const a={metadata:{version:4.6,type:"BufferGeometry",generator:"BufferGeometry.toJSON"}};a.uuid=this.uuid;a.type=this.type;""!==this.name&&(a.name=this.name);0<Object.keys(this.userData).length&&(a.userData=this.userData);if(void 0!==this.parameters){var b=this.parameters;for(var c in b)void 0!==b[c]&&(a[c]=b[c]);return a}a.data={attributes:{}};c=this.index;null!==c&&(a.data.index={type:c.array.constructor.name,
array:Array.prototype.slice.call(c.array)});c=this.attributes;for(var d in c)a.data.attributes[d]=c[d].toJSON(a.data);d={};c=!1;for(b in this.morphAttributes){const f=this.morphAttributes[b],g=[];for(let l=0,m=f.length;l<m;l++)g.push(f[l].toJSON(a.data));0<g.length&&(d[b]=g,c=!0)}c&&(a.data.morphAttributes=d,a.data.morphTargetsRelative=this.morphTargetsRelative);b=this.groups;0<b.length&&(a.data.groups=JSON.parse(JSON.stringify(b)));b=this.boundingSphere;null!==b&&(a.data.boundingSphere={center:b.center.toArray(),
radius:b.radius});return a}clone(){return(new this.constructor).copy(this)}copy(a){this.index=null;this.attributes={};this.morphAttributes={};this.groups=[];this.boundingSphere=this.boundingBox=null;var b={};this.name=a.name;var c=a.index;null!==c&&this.setIndex(c.clone(b));c=a.attributes;for(var d in c)this.setAttribute(d,c[d].clone(b));d=a.morphAttributes;for(var f in d){c=[];const g=d[f];for(let l=0,m=g.length;l<m;l++)c.push(g[l].clone(b));this.morphAttributes[f]=c}this.morphTargetsRelative=a.morphTargetsRelative;
b=a.groups;for(let g=0,l=b.length;g<l;g++)f=b[g],this.addGroup(f.start,f.count,f.materialIndex);b=a.boundingBox;null!==b&&(this.boundingBox=b.clone());b=a.boundingSphere;null!==b&&(this.boundingSphere=b.clone());this.drawRange.start=a.drawRange.start;this.drawRange.count=a.drawRange.count;this.userData=a.userData;return this}dispose(){this.dispatchEvent({type:"dispose"})}}q.BufferGeometry=ab;const zh=new Wa,Bd=new ce,tf=new oc,og=new O,Id=new O,Jd=new O,pd=new O,pg=new O,uf=new O,Pe=new sa,Qe=new sa,
Re=new sa,Fg=new O,Kf=new O,Gg=new O,Oe=new O,Kd=new O;class cb extends hb{constructor(a=new ab,b=new gd){super();this.isMesh=!0;this.type="Mesh";this.geometry=a;this.material=b;this.updateMorphTargets()}copy(a,b){super.copy(a,b);void 0!==a.morphTargetInfluences&&(this.morphTargetInfluences=a.morphTargetInfluences.slice());void 0!==a.morphTargetDictionary&&(this.morphTargetDictionary=Object.assign({},a.morphTargetDictionary));this.material=Array.isArray(a.material)?a.material.slice():a.material;this.geometry=
a.geometry;return this}updateMorphTargets(){var a=this.geometry.morphAttributes,b=Object.keys(a);if(0<b.length&&(a=a[b[0]],void 0!==a)){this.morphTargetInfluences=[];this.morphTargetDictionary={};for(let c=0,d=a.length;c<d;c++)b=a[c].name||String(c),this.morphTargetInfluences.push(0),this.morphTargetDictionary[b]=c}}getVertexPosition(a,b){var c=this.geometry;const d=c.morphAttributes.position,f=c.morphTargetsRelative;b.fromBufferAttribute(c.attributes.position,a);c=this.morphTargetInfluences;if(d&&
c){uf.set(0,0,0);for(let g=0,l=d.length;g<l;g++){const m=c[g];0!==m&&(pg.fromBufferAttribute(d[g],a),f?uf.addScaledVector(pg,m):uf.addScaledVector(pg.sub(b),m))}b.add(uf)}return b}raycast(a,b){const c=this.geometry,d=this.matrixWorld;void 0!==this.material&&(null===c.boundingSphere&&c.computeBoundingSphere(),tf.copy(c.boundingSphere),tf.applyMatrix4(d),Bd.copy(a.ray).recast(a.near),!1===tf.containsPoint(Bd.origin)&&(null===Bd.intersectSphere(tf,og)||Bd.origin.distanceToSquared(og)>(a.far-a.near)**
2)||(zh.copy(d).invert(),Bd.copy(a.ray).applyMatrix4(zh),null!==c.boundingBox&&!1===Bd.intersectsBox(c.boundingBox)||this._computeIntersections(a,b,Bd)))}_computeIntersections(a,b,c){var d=this.geometry;const f=this.material;var g=d.index,l=d.attributes.position;const m=d.attributes.uv,n=d.attributes.uv1,t=d.attributes.normal;var u=d.groups;d=d.drawRange;if(null!==g)if(Array.isArray(f))for(let D=0,E=u.length;D<E;D++){l=u[D];var v=f[l.materialIndex];var A=Math.max(l.start,d.start);var F=Math.min(g.count,
Math.min(l.start+l.count,d.start+d.count));for(let y=A,J=F;y<J;y+=3){A=g.getX(y);F=g.getX(y+1);const L=g.getX(y+2);if(A=Ca(this,v,a,c,m,n,t,A,F,L))A.faceIndex=Math.floor(y/3),A.face.materialIndex=l.materialIndex,b.push(A)}}else{u=Math.max(0,d.start);d=Math.min(g.count,d.start+d.count);for(let D=u,E=d;D<E;D+=3)if(d=g.getX(D),u=g.getX(D+1),l=g.getX(D+2),A=Ca(this,f,a,c,m,n,t,d,u,l))A.faceIndex=Math.floor(D/3),b.push(A)}else if(void 0!==l)if(Array.isArray(f))for(let D=0,E=u.length;D<E;D++){g=u[D];v=
f[g.materialIndex];A=Math.max(g.start,d.start);F=Math.min(l.count,Math.min(g.start+g.count,d.start+d.count));for(let y=A,J=F;y<J;y+=3)if(A=Ca(this,v,a,c,m,n,t,y,y+1,y+2))A.faceIndex=Math.floor(y/3),A.face.materialIndex=g.materialIndex,b.push(A)}else{g=Math.max(0,d.start);d=Math.min(l.count,d.start+d.count);for(let D=g,E=d;D<E;D+=3)if(A=Ca(this,f,a,c,m,n,t,D,D+1,D+2))A.faceIndex=Math.floor(D/3),b.push(A)}}}q.Mesh=cb;class Ld extends ab{constructor(a=1,b=1,c=1,d=1,f=1,g=1){function l(D,E,y,J,L,U,P,
X,ja,fa,aa){const pa=U/ja,ba=P/fa,xa=U/2,qa=P/2,ta=X/2;P=ja+1;const Ba=fa+1;let va=U=0;const Ga=new O;for(let ia=0;ia<Ba;ia++){const wa=ia*ba-qa;for(let ra=0;ra<P;ra++)Ga[D]=(ra*pa-xa)*J,Ga[E]=wa*L,Ga[y]=ta,t.push(Ga.x,Ga.y,Ga.z),Ga[D]=0,Ga[E]=0,Ga[y]=0<X?1:-1,u.push(Ga.x,Ga.y,Ga.z),v.push(ra/ja),v.push(1-ia/fa),U+=1}for(D=0;D<fa;D++)for(E=0;E<ja;E++)y=A+E+P*(D+1),J=A+(E+1)+P*(D+1),L=A+(E+1)+P*D,n.push(A+E+P*D,y,L),n.push(y,J,L),va+=6;m.addGroup(F,va,aa);F+=va;A+=U}super();this.type="BoxGeometry";
this.parameters={width:a,height:b,depth:c,widthSegments:d,heightSegments:f,depthSegments:g};const m=this;d=Math.floor(d);f=Math.floor(f);g=Math.floor(g);const n=[],t=[],u=[],v=[];let A=0,F=0;l("z","y","x",-1,-1,c,b,a,g,f,0);l("z","y","x",1,-1,c,b,-a,g,f,1);l("x","z","y",1,1,a,c,b,d,g,2);l("x","z","y",1,-1,a,c,-b,d,g,3);l("x","y","z",1,-1,a,b,c,d,f,4);l("x","y","z",-1,-1,a,b,-c,d,f,5);this.setIndex(n);this.setAttribute("position",new Oa(t,3));this.setAttribute("normal",new Oa(u,3));this.setAttribute("uv",
new Oa(v,2))}copy(a){super.copy(a);this.parameters=Object.assign({},a.parameters);return this}static fromJSON(a){return new Ld(a.width,a.height,a.depth,a.widthSegments,a.heightSegments,a.depthSegments)}}q.BoxGeometry=Ld;const Zg={clone:$a,merge:Ub};q.UniformsUtils=Zg;class bc extends Wb{constructor(a){super();this.isShaderMaterial=!0;this.type="ShaderMaterial";this.defines={};this.uniforms={};this.uniformsGroups=[];this.vertexShader="void main() {\n\tgl_Position \x3d projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}";
this.fragmentShader="void main() {\n\tgl_FragColor \x3d vec4( 1.0, 0.0, 0.0, 1.0 );\n}";this.linewidth=1;this.wireframe=!1;this.wireframeLinewidth=1;this.clipping=this.lights=this.fog=!1;this.forceSinglePass=!0;this.extensions={derivatives:!1,fragDepth:!1,drawBuffers:!1,shaderTextureLOD:!1};this.defaultAttributeValues={color:[1,1,1],uv:[0,0],uv1:[0,0]};this.index0AttributeName=void 0;this.uniformsNeedUpdate=!1;this.glslVersion=null;void 0!==a&&this.setValues(a)}copy(a){super.copy(a);this.fragmentShader=
a.fragmentShader;this.vertexShader=a.vertexShader;this.uniforms=$a(a.uniforms);var b=a.uniformsGroups;const c=[];for(let d=0;d<b.length;d++)c.push(b[d].clone());this.uniformsGroups=c;this.defines=Object.assign({},a.defines);this.wireframe=a.wireframe;this.wireframeLinewidth=a.wireframeLinewidth;this.fog=a.fog;this.lights=a.lights;this.clipping=a.clipping;this.extensions=Object.assign({},a.extensions);this.glslVersion=a.glslVersion;return this}toJSON(a){const b=super.toJSON(a);b.glslVersion=this.glslVersion;
b.uniforms={};for(const c in this.uniforms){const d=this.uniforms[c].value;b.uniforms[c]=d&&d.isTexture?{type:"t",value:d.toJSON(a).uuid}:d&&d.isColor?{type:"c",value:d.getHex()}:d&&d.isVector2?{type:"v2",value:d.toArray()}:d&&d.isVector3?{type:"v3",value:d.toArray()}:d&&d.isVector4?{type:"v4",value:d.toArray()}:d&&d.isMatrix3?{type:"m3",value:d.toArray()}:d&&d.isMatrix4?{type:"m4",value:d.toArray()}:{value:d}}0<Object.keys(this.defines).length&&(b.defines=this.defines);b.vertexShader=this.vertexShader;
b.fragmentShader=this.fragmentShader;b.lights=this.lights;b.clipping=this.clipping;a={};for(const c in this.extensions)!0===this.extensions[c]&&(a[c]=!0);0<Object.keys(a).length&&(b.extensions=a);return b}}q.ShaderMaterial=bc;class vf extends hb{constructor(){super();this.isCamera=!0;this.type="Camera";this.matrixWorldInverse=new Wa;this.projectionMatrix=new Wa;this.projectionMatrixInverse=new Wa;this.coordinateSystem=2E3}copy(a,b){super.copy(a,b);this.matrixWorldInverse.copy(a.matrixWorldInverse);
this.projectionMatrix.copy(a.projectionMatrix);this.projectionMatrixInverse.copy(a.projectionMatrixInverse);this.coordinateSystem=a.coordinateSystem;return this}getWorldDirection(a){return super.getWorldDirection(a).negate()}updateMatrixWorld(a){super.updateMatrixWorld(a);this.matrixWorldInverse.copy(this.matrixWorld).invert()}updateWorldMatrix(a,b){super.updateWorldMatrix(a,b);this.matrixWorldInverse.copy(this.matrixWorld).invert()}clone(){return(new this.constructor).copy(this)}}q.Camera=vf;class Rb extends vf{constructor(a=
50,b=1,c=.1,d=2E3){super();this.isPerspectiveCamera=!0;this.type="PerspectiveCamera";this.fov=a;this.zoom=1;this.near=c;this.far=d;this.focus=10;this.aspect=b;this.view=null;this.filmGauge=35;this.filmOffset=0;this.updateProjectionMatrix()}copy(a,b){super.copy(a,b);this.fov=a.fov;this.zoom=a.zoom;this.near=a.near;this.far=a.far;this.focus=a.focus;this.aspect=a.aspect;this.view=null===a.view?null:Object.assign({},a.view);this.filmGauge=a.filmGauge;this.filmOffset=a.filmOffset;return this}setFocalLength(a){a=
.5*this.getFilmHeight()/a;this.fov=2*Wd*Math.atan(a);this.updateProjectionMatrix()}getFocalLength(){const a=Math.tan(.5*wd*this.fov);return.5*this.getFilmHeight()/a}getEffectiveFOV(){return 2*Wd*Math.atan(Math.tan(.5*wd*this.fov)/this.zoom)}getFilmWidth(){return this.filmGauge*Math.min(this.aspect,1)}getFilmHeight(){return this.filmGauge/Math.max(this.aspect,1)}setViewOffset(a,b,c,d,f,g){this.aspect=a/b;null===this.view&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,
height:1});this.view.enabled=!0;this.view.fullWidth=a;this.view.fullHeight=b;this.view.offsetX=c;this.view.offsetY=d;this.view.width=f;this.view.height=g;this.updateProjectionMatrix()}clearViewOffset(){null!==this.view&&(this.view.enabled=!1);this.updateProjectionMatrix()}updateProjectionMatrix(){const a=this.near;let b=a*Math.tan(.5*wd*this.fov)/this.zoom,c=2*b,d=this.aspect*c,f=-.5*d;var g=this.view;if(null!==this.view&&this.view.enabled){const l=g.fullWidth,m=g.fullHeight;f+=g.offsetX*d/l;b-=g.offsetY*
c/m;d*=g.width/l;c*=g.height/m}g=this.filmOffset;0!==g&&(f+=a*g/this.getFilmWidth());this.projectionMatrix.makePerspective(f,f+d,b,b-c,a,this.far,this.coordinateSystem);this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(a){a=super.toJSON(a);a.object.fov=this.fov;a.object.zoom=this.zoom;a.object.near=this.near;a.object.far=this.far;a.object.focus=this.focus;a.object.aspect=this.aspect;null!==this.view&&(a.object.view=Object.assign({},this.view));a.object.filmGauge=this.filmGauge;
a.object.filmOffset=this.filmOffset;return a}}q.PerspectiveCamera=Rb;class Ah extends hb{constructor(a,b,c){super();this.type="CubeCamera";this.renderTarget=c;this.coordinateSystem=null;this.activeMipmapLevel=0;c=new Rb(-90,1,a,b);c.layers=this.layers;this.add(c);c=new Rb(-90,1,a,b);c.layers=this.layers;this.add(c);c=new Rb(-90,1,a,b);c.layers=this.layers;this.add(c);c=new Rb(-90,1,a,b);c.layers=this.layers;this.add(c);c=new Rb(-90,1,a,b);c.layers=this.layers;this.add(c);a=new Rb(-90,1,a,b);a.layers=
this.layers;this.add(a)}updateCoordinateSystem(){const a=this.coordinateSystem,b=this.children.concat(),[c,d,f,g,l,m]=b;for(const n of b)this.remove(n);if(2E3===a)c.up.set(0,1,0),c.lookAt(1,0,0),d.up.set(0,1,0),d.lookAt(-1,0,0),f.up.set(0,0,-1),f.lookAt(0,1,0),g.up.set(0,0,1),g.lookAt(0,-1,0),l.up.set(0,1,0),l.lookAt(0,0,1),m.up.set(0,1,0),m.lookAt(0,0,-1);else if(2001===a)c.up.set(0,-1,0),c.lookAt(-1,0,0),d.up.set(0,-1,0),d.lookAt(1,0,0),f.up.set(0,0,1),f.lookAt(0,1,0),g.up.set(0,0,-1),g.lookAt(0,
-1,0),l.up.set(0,-1,0),l.lookAt(0,0,1),m.up.set(0,-1,0),m.lookAt(0,0,-1);else throw Error("THREE.CubeCamera.updateCoordinateSystem(): Invalid coordinate system: "+a);for(const n of b)this.add(n),n.updateMatrixWorld()}update(a,b){null===this.parent&&this.updateMatrixWorld();const {renderTarget:c,activeMipmapLevel:d}=this;this.coordinateSystem!==a.coordinateSystem&&(this.coordinateSystem=a.coordinateSystem,this.updateCoordinateSystem());const [f,g,l,m,n,t]=this.children,u=a.getRenderTarget(),v=a.getActiveCubeFace(),
A=a.getActiveMipmapLevel(),F=a.xr.enabled;a.xr.enabled=!1;const D=c.texture.generateMipmaps;c.texture.generateMipmaps=!1;a.setRenderTarget(c,0,d);a.render(b,f);a.setRenderTarget(c,1,d);a.render(b,g);a.setRenderTarget(c,2,d);a.render(b,l);a.setRenderTarget(c,3,d);a.render(b,m);a.setRenderTarget(c,4,d);a.render(b,n);c.texture.generateMipmaps=D;a.setRenderTarget(c,5,d);a.render(b,t);a.setRenderTarget(u,v,A);a.xr.enabled=F;c.texture.needsPMREMUpdate=!0}}q.CubeCamera=Ah;class Ae extends Gb{constructor(a,
b,c,d,f,g,l,m,n,t){a=void 0!==a?a:[];super(a,void 0!==b?b:301,c,d,f,g,l,m,n,t);this.isCubeTexture=!0;this.flipY=!1}get images(){return this.image}set images(a){this.image=a}}q.CubeTexture=Ae;class Gc extends rc{constructor(a=1,b={}){super(a,a,b);this.isWebGLCubeRenderTarget=!0;a={width:a,height:a,depth:1};a=[a,a,a,a,a,a];void 0!==b.encoding&&(Gd("THREE.WebGLCubeRenderTarget: option.encoding has been replaced by option.colorSpace."),b.colorSpace=3001===b.encoding?"srgb":"");this.texture=new Ae(a,b.mapping,
b.wrapS,b.wrapT,b.magFilter,b.minFilter,b.format,b.type,b.anisotropy,b.colorSpace);this.texture.isRenderTargetTexture=!0;this.texture.generateMipmaps=void 0!==b.generateMipmaps?b.generateMipmaps:!1;this.texture.minFilter=void 0!==b.minFilter?b.minFilter:1006}fromEquirectangularTexture(a,b){this.texture.type=b.type;this.texture.colorSpace=b.colorSpace;this.texture.generateMipmaps=b.generateMipmaps;this.texture.minFilter=b.minFilter;this.texture.magFilter=b.magFilter;var c=new Ld(5,5,5),d=new bc({name:"CubemapFromEquirect",
uniforms:$a({tEquirect:{value:null}}),vertexShader:"\n\n\t\t\t\tvarying vec3 vWorldDirection;\n\n\t\t\t\tvec3 transformDirection( in vec3 dir, in mat4 matrix ) {\n\n\t\t\t\t\treturn normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );\n\n\t\t\t\t}\n\n\t\t\t\tvoid main() {\n\n\t\t\t\t\tvWorldDirection \x3d transformDirection( position, modelMatrix );\n\n\t\t\t\t\t#include \x3cbegin_vertex\x3e\n\t\t\t\t\t#include \x3cproject_vertex\x3e\n\n\t\t\t\t}\n\t\t\t",fragmentShader:"\n\n\t\t\t\tuniform sampler2D tEquirect;\n\n\t\t\t\tvarying vec3 vWorldDirection;\n\n\t\t\t\t#include \x3ccommon\x3e\n\n\t\t\t\tvoid main() {\n\n\t\t\t\t\tvec3 direction \x3d normalize( vWorldDirection );\n\n\t\t\t\t\tvec2 sampleUV \x3d equirectUv( direction );\n\n\t\t\t\t\tgl_FragColor \x3d texture2D( tEquirect, sampleUV );\n\n\t\t\t\t}\n\t\t\t",
side:1,blending:0});d.uniforms.tEquirect.value=b;c=new cb(c,d);d=b.minFilter;1008===b.minFilter&&(b.minFilter=1006);(new Ah(1,10,this)).update(a,c);b.minFilter=d;c.geometry.dispose();c.material.dispose();return this}clear(a,b,c,d){const f=a.getRenderTarget();for(let g=0;6>g;g++)a.setRenderTarget(this,g),a.clear(b,c,d);a.setRenderTarget(f)}}q.WebGLCubeRenderTarget=Gc;const Cc=new O,Be=new O,Ce=new Za;class Vb{constructor(a=new O(1,0,0),b=0){this.isPlane=!0;this.normal=a;this.constant=b}set(a,b){this.normal.copy(a);
this.constant=b;return this}setComponents(a,b,c,d){this.normal.set(a,b,c);this.constant=d;return this}setFromNormalAndCoplanarPoint(a,b){this.normal.copy(a);this.constant=-b.dot(this.normal);return this}setFromCoplanarPoints(a,b,c){b=Cc.subVectors(c,b).cross(Be.subVectors(a,b)).normalize();this.setFromNormalAndCoplanarPoint(b,a);return this}copy(a){this.normal.copy(a.normal);this.constant=a.constant;return this}normalize(){const a=1/this.normal.length();this.normal.multiplyScalar(a);this.constant*=
a;return this}negate(){this.constant*=-1;this.normal.negate();return this}distanceToPoint(a){return this.normal.dot(a)+this.constant}distanceToSphere(a){return this.distanceToPoint(a.center)-a.radius}projectPoint(a,b){return b.copy(a).addScaledVector(this.normal,-this.distanceToPoint(a))}intersectLine(a,b){const c=a.delta(Cc);var d=this.normal.dot(c);if(0===d)return 0===this.distanceToPoint(a.start)?b.copy(a.start):null;d=-(a.start.dot(this.normal)+this.constant)/d;return 0>d||1<d?null:b.copy(a.start).addScaledVector(c,
d)}intersectsLine(a){const b=this.distanceToPoint(a.start);a=this.distanceToPoint(a.end);return 0>b&&0<a||0>a&&0<b}intersectsBox(a){return a.intersectsPlane(this)}intersectsSphere(a){return a.intersectsPlane(this)}coplanarPoint(a){return a.copy(this.normal).multiplyScalar(-this.constant)}applyMatrix4(a,b){b=b||Ce.getNormalMatrix(a);a=this.coplanarPoint(Cc).applyMatrix4(a);b=this.normal.applyMatrix3(b).normalize();this.constant=-a.dot(b);return this}translate(a){this.constant-=a.dot(this.normal);return this}equals(a){return a.normal.equals(this.normal)&&
a.constant===this.constant}clone(){return(new this.constructor).copy(this)}}q.Plane=Vb;const Yb=new oc,e=new O;class h{constructor(a=new Vb,b=new Vb,c=new Vb,d=new Vb,f=new Vb,g=new Vb){this.planes=[a,b,c,d,f,g]}set(a,b,c,d,f,g){const l=this.planes;l[0].copy(a);l[1].copy(b);l[2].copy(c);l[3].copy(d);l[4].copy(f);l[5].copy(g);return this}copy(a){const b=this.planes;for(let c=0;6>c;c++)b[c].copy(a.planes[c]);return this}setFromProjectionMatrix(a,b=2E3){const c=this.planes;var d=a.elements;a=d[0];const f=
d[1],g=d[2],l=d[3],m=d[4],n=d[5],t=d[6],u=d[7],v=d[8],A=d[9],F=d[10],D=d[11],E=d[12],y=d[13],J=d[14];d=d[15];c[0].setComponents(l-a,u-m,D-v,d-E).normalize();c[1].setComponents(l+a,u+m,D+v,d+E).normalize();c[2].setComponents(l+f,u+n,D+A,d+y).normalize();c[3].setComponents(l-f,u-n,D-A,d-y).normalize();c[4].setComponents(l-g,u-t,D-F,d-J).normalize();if(2E3===b)c[5].setComponents(l+g,u+t,D+F,d+J).normalize();else if(2001===b)c[5].setComponents(g,t,F,J).normalize();else throw Error("THREE.Frustum.setFromProjectionMatrix(): Invalid coordinate system: "+
b);return this}intersectsObject(a){if(void 0!==a.boundingSphere)null===a.boundingSphere&&a.computeBoundingSphere(),Yb.copy(a.boundingSphere).applyMatrix4(a.matrixWorld);else{const b=a.geometry;null===b.boundingSphere&&b.computeBoundingSphere();Yb.copy(b.boundingSphere).applyMatrix4(a.matrixWorld)}return this.intersectsSphere(Yb)}intersectsSprite(a){Yb.center.set(0,0,0);Yb.radius=.7071067811865476;Yb.applyMatrix4(a.matrixWorld);return this.intersectsSphere(Yb)}intersectsSphere(a){const b=this.planes,
c=a.center;a=-a.radius;for(let d=0;6>d;d++)if(b[d].distanceToPoint(c)<a)return!1;return!0}intersectsBox(a){const b=this.planes;for(let c=0;6>c;c++){const d=b[c];e.x=0<d.normal.x?a.max.x:a.min.x;e.y=0<d.normal.y?a.max.y:a.min.y;e.z=0<d.normal.z?a.max.z:a.min.z;if(0>d.distanceToPoint(e))return!1}return!0}containsPoint(a){const b=this.planes;for(let c=0;6>c;c++)if(0>b[c].distanceToPoint(a))return!1;return!0}clone(){return(new this.constructor).copy(this)}}q.Frustum=h;class k extends ab{constructor(a=
1,b=1,c=1,d=1){super();this.type="PlaneGeometry";this.parameters={width:a,height:b,widthSegments:c,heightSegments:d};var f=a/2,g=b/2;c=Math.floor(c);d=Math.floor(d);const l=c+1;var m=d+1,n=a/c,t=b/d;b=[];a=[];const u=[],v=[];for(let A=0;A<m;A++){const F=A*t-g;for(let D=0;D<l;D++)a.push(D*n-f,-F,0),u.push(0,0,1),v.push(D/c),v.push(1-A/d)}for(f=0;f<d;f++)for(g=0;g<c;g++)m=g+l*(f+1),n=g+1+l*(f+1),t=g+1+l*f,b.push(g+l*f,m,t),b.push(m,n,t);this.setIndex(b);this.setAttribute("position",new Oa(a,3));this.setAttribute("normal",
new Oa(u,3));this.setAttribute("uv",new Oa(v,2))}copy(a){super.copy(a);this.parameters=Object.assign({},a.parameters);return this}static fromJSON(a){return new k(a.width,a.height,a.widthSegments,a.heightSegments)}}q.PlaneGeometry=k;const p={alphahash_fragment:"#ifdef USE_ALPHAHASH\n\tif ( diffuseColor.a \x3c getAlphaHashThreshold( vPosition ) ) discard;\n#endif",alphahash_pars_fragment:"#ifdef USE_ALPHAHASH\n\tconst float ALPHA_HASH_SCALE \x3d 0.05;\n\tfloat hash2D( vec2 value ) {\n\t\treturn fract( 1.0e4 * sin( 17.0 * value.x + 0.1 * value.y ) * ( 0.1 + abs( sin( 13.0 * value.y + value.x ) ) ) );\n\t}\n\tfloat hash3D( vec3 value ) {\n\t\treturn hash2D( vec2( hash2D( value.xy ), value.z ) );\n\t}\n\tfloat getAlphaHashThreshold( vec3 position ) {\n\t\tfloat maxDeriv \x3d max(\n\t\t\tlength( dFdx( position.xyz ) ),\n\t\t\tlength( dFdy( position.xyz ) )\n\t\t);\n\t\tfloat pixScale \x3d 1.0 / ( ALPHA_HASH_SCALE * maxDeriv );\n\t\tvec2 pixScales \x3d vec2(\n\t\t\texp2( floor( log2( pixScale ) ) ),\n\t\t\texp2( ceil( log2( pixScale ) ) )\n\t\t);\n\t\tvec2 alpha \x3d vec2(\n\t\t\thash3D( floor( pixScales.x * position.xyz ) ),\n\t\t\thash3D( floor( pixScales.y * position.xyz ) )\n\t\t);\n\t\tfloat lerpFactor \x3d fract( log2( pixScale ) );\n\t\tfloat x \x3d ( 1.0 - lerpFactor ) * alpha.x + lerpFactor * alpha.y;\n\t\tfloat a \x3d min( lerpFactor, 1.0 - lerpFactor );\n\t\tvec3 cases \x3d vec3(\n\t\t\tx * x / ( 2.0 * a * ( 1.0 - a ) ),\n\t\t\t( x - 0.5 * a ) / ( 1.0 - a ),\n\t\t\t1.0 - ( ( 1.0 - x ) * ( 1.0 - x ) / ( 2.0 * a * ( 1.0 - a ) ) )\n\t\t);\n\t\tfloat threshold \x3d ( x \x3c ( 1.0 - a ) )\n\t\t\t? ( ( x \x3c a ) ? cases.x : cases.y )\n\t\t\t: cases.z;\n\t\treturn clamp( threshold , 1.0e-6, 1.0 );\n\t}\n#endif",
alphamap_fragment:"#ifdef USE_ALPHAMAP\n\tdiffuseColor.a *\x3d texture2D( alphaMap, vAlphaMapUv ).g;\n#endif",alphamap_pars_fragment:"#ifdef USE_ALPHAMAP\n\tuniform sampler2D alphaMap;\n#endif",alphatest_fragment:"#ifdef USE_ALPHATEST\n\tif ( diffuseColor.a \x3c alphaTest ) discard;\n#endif",alphatest_pars_fragment:"#ifdef USE_ALPHATEST\n\tuniform float alphaTest;\n#endif",aomap_fragment:"#ifdef USE_AOMAP\n\tfloat ambientOcclusion \x3d ( texture2D( aoMap, vAoMapUv ).r - 1.0 ) * aoMapIntensity + 1.0;\n\treflectedLight.indirectDiffuse *\x3d ambientOcclusion;\n\t#if defined( USE_CLEARCOAT ) \n\t\tclearcoatSpecularIndirect *\x3d ambientOcclusion;\n\t#endif\n\t#if defined( USE_SHEEN ) \n\t\tsheenSpecularIndirect *\x3d ambientOcclusion;\n\t#endif\n\t#if defined( USE_ENVMAP ) \x26\x26 defined( STANDARD )\n\t\tfloat dotNV \x3d saturate( dot( geometryNormal, geometryViewDir ) );\n\t\treflectedLight.indirectSpecular *\x3d computeSpecularOcclusion( dotNV, ambientOcclusion, material.roughness );\n\t#endif\n#endif",
aomap_pars_fragment:"#ifdef USE_AOMAP\n\tuniform sampler2D aoMap;\n\tuniform float aoMapIntensity;\n#endif",begin_vertex:"vec3 transformed \x3d vec3( position );\n#ifdef USE_ALPHAHASH\n\tvPosition \x3d vec3( position );\n#endif",beginnormal_vertex:"vec3 objectNormal \x3d vec3( normal );\n#ifdef USE_TANGENT\n\tvec3 objectTangent \x3d vec3( tangent.xyz );\n#endif",bsdfs:"float G_BlinnPhong_Implicit( ) {\n\treturn 0.25;\n}\nfloat D_BlinnPhong( const in float shininess, const in float dotNH ) {\n\treturn RECIPROCAL_PI * ( shininess * 0.5 + 1.0 ) * pow( dotNH, shininess );\n}\nvec3 BRDF_BlinnPhong( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in vec3 specularColor, const in float shininess ) {\n\tvec3 halfDir \x3d normalize( lightDir + viewDir );\n\tfloat dotNH \x3d saturate( dot( normal, halfDir ) );\n\tfloat dotVH \x3d saturate( dot( viewDir, halfDir ) );\n\tvec3 F \x3d F_Schlick( specularColor, 1.0, dotVH );\n\tfloat G \x3d G_BlinnPhong_Implicit( );\n\tfloat D \x3d D_BlinnPhong( shininess, dotNH );\n\treturn F * ( G * D );\n} // validated",
iridescence_fragment:"#ifdef USE_IRIDESCENCE\n\tconst mat3 XYZ_TO_REC709 \x3d mat3(\n\t\t 3.2404542, -0.9692660,  0.0556434,\n\t\t-1.5371385,  1.8760108, -0.2040259,\n\t\t-0.4985314,  0.0415560,  1.0572252\n\t);\n\tvec3 Fresnel0ToIor( vec3 fresnel0 ) {\n\t\tvec3 sqrtF0 \x3d sqrt( fresnel0 );\n\t\treturn ( vec3( 1.0 ) + sqrtF0 ) / ( vec3( 1.0 ) - sqrtF0 );\n\t}\n\tvec3 IorToFresnel0( vec3 transmittedIor, float incidentIor ) {\n\t\treturn pow2( ( transmittedIor - vec3( incidentIor ) ) / ( transmittedIor + vec3( incidentIor ) ) );\n\t}\n\tfloat IorToFresnel0( float transmittedIor, float incidentIor ) {\n\t\treturn pow2( ( transmittedIor - incidentIor ) / ( transmittedIor + incidentIor ));\n\t}\n\tvec3 evalSensitivity( float OPD, vec3 shift ) {\n\t\tfloat phase \x3d 2.0 * PI * OPD * 1.0e-9;\n\t\tvec3 val \x3d vec3( 5.4856e-13, 4.4201e-13, 5.2481e-13 );\n\t\tvec3 pos \x3d vec3( 1.6810e+06, 1.7953e+06, 2.2084e+06 );\n\t\tvec3 var \x3d vec3( 4.3278e+09, 9.3046e+09, 6.6121e+09 );\n\t\tvec3 xyz \x3d val * sqrt( 2.0 * PI * var ) * cos( pos * phase + shift ) * exp( - pow2( phase ) * var );\n\t\txyz.x +\x3d 9.7470e-14 * sqrt( 2.0 * PI * 4.5282e+09 ) * cos( 2.2399e+06 * phase + shift[ 0 ] ) * exp( - 4.5282e+09 * pow2( phase ) );\n\t\txyz /\x3d 1.0685e-7;\n\t\tvec3 rgb \x3d XYZ_TO_REC709 * xyz;\n\t\treturn rgb;\n\t}\n\tvec3 evalIridescence( float outsideIOR, float eta2, float cosTheta1, float thinFilmThickness, vec3 baseF0 ) {\n\t\tvec3 I;\n\t\tfloat iridescenceIOR \x3d mix( outsideIOR, eta2, smoothstep( 0.0, 0.03, thinFilmThickness ) );\n\t\tfloat sinTheta2Sq \x3d pow2( outsideIOR / iridescenceIOR ) * ( 1.0 - pow2( cosTheta1 ) );\n\t\tfloat cosTheta2Sq \x3d 1.0 - sinTheta2Sq;\n\t\tif ( cosTheta2Sq \x3c 0.0 ) {\n\t\t\treturn vec3( 1.0 );\n\t\t}\n\t\tfloat cosTheta2 \x3d sqrt( cosTheta2Sq );\n\t\tfloat R0 \x3d IorToFresnel0( iridescenceIOR, outsideIOR );\n\t\tfloat R12 \x3d F_Schlick( R0, 1.0, cosTheta1 );\n\t\tfloat T121 \x3d 1.0 - R12;\n\t\tfloat phi12 \x3d 0.0;\n\t\tif ( iridescenceIOR \x3c outsideIOR ) phi12 \x3d PI;\n\t\tfloat phi21 \x3d PI - phi12;\n\t\tvec3 baseIOR \x3d Fresnel0ToIor( clamp( baseF0, 0.0, 0.9999 ) );\t\tvec3 R1 \x3d IorToFresnel0( baseIOR, iridescenceIOR );\n\t\tvec3 R23 \x3d F_Schlick( R1, 1.0, cosTheta2 );\n\t\tvec3 phi23 \x3d vec3( 0.0 );\n\t\tif ( baseIOR[ 0 ] \x3c iridescenceIOR ) phi23[ 0 ] \x3d PI;\n\t\tif ( baseIOR[ 1 ] \x3c iridescenceIOR ) phi23[ 1 ] \x3d PI;\n\t\tif ( baseIOR[ 2 ] \x3c iridescenceIOR ) phi23[ 2 ] \x3d PI;\n\t\tfloat OPD \x3d 2.0 * iridescenceIOR * thinFilmThickness * cosTheta2;\n\t\tvec3 phi \x3d vec3( phi21 ) + phi23;\n\t\tvec3 R123 \x3d clamp( R12 * R23, 1e-5, 0.9999 );\n\t\tvec3 r123 \x3d sqrt( R123 );\n\t\tvec3 Rs \x3d pow2( T121 ) * R23 / ( vec3( 1.0 ) - R123 );\n\t\tvec3 C0 \x3d R12 + Rs;\n\t\tI \x3d C0;\n\t\tvec3 Cm \x3d Rs - T121;\n\t\tfor ( int m \x3d 1; m \x3c\x3d 2; ++ m ) {\n\t\t\tCm *\x3d r123;\n\t\t\tvec3 Sm \x3d 2.0 * evalSensitivity( float( m ) * OPD, float( m ) * phi );\n\t\t\tI +\x3d Cm * Sm;\n\t\t}\n\t\treturn max( I, vec3( 0.0 ) );\n\t}\n#endif",
bumpmap_pars_fragment:"#ifdef USE_BUMPMAP\n\tuniform sampler2D bumpMap;\n\tuniform float bumpScale;\n\tvec2 dHdxy_fwd() {\n\t\tvec2 dSTdx \x3d dFdx( vBumpMapUv );\n\t\tvec2 dSTdy \x3d dFdy( vBumpMapUv );\n\t\tfloat Hll \x3d bumpScale * texture2D( bumpMap, vBumpMapUv ).x;\n\t\tfloat dBx \x3d bumpScale * texture2D( bumpMap, vBumpMapUv + dSTdx ).x - Hll;\n\t\tfloat dBy \x3d bumpScale * texture2D( bumpMap, vBumpMapUv + dSTdy ).x - Hll;\n\t\treturn vec2( dBx, dBy );\n\t}\n\tvec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy, float faceDirection ) {\n\t\tvec3 vSigmaX \x3d normalize( dFdx( surf_pos.xyz ) );\n\t\tvec3 vSigmaY \x3d normalize( dFdy( surf_pos.xyz ) );\n\t\tvec3 vN \x3d surf_norm;\n\t\tvec3 R1 \x3d cross( vSigmaY, vN );\n\t\tvec3 R2 \x3d cross( vN, vSigmaX );\n\t\tfloat fDet \x3d dot( vSigmaX, R1 ) * faceDirection;\n\t\tvec3 vGrad \x3d sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );\n\t\treturn normalize( abs( fDet ) * surf_norm - vGrad );\n\t}\n#endif",
clipping_planes_fragment:"#if NUM_CLIPPING_PLANES \x3e 0\n\tvec4 plane;\n\t#pragma unroll_loop_start\n\tfor ( int i \x3d 0; i \x3c UNION_CLIPPING_PLANES; i ++ ) {\n\t\tplane \x3d clippingPlanes[ i ];\n\t\tif ( dot( vClipPosition, plane.xyz ) \x3e plane.w ) discard;\n\t}\n\t#pragma unroll_loop_end\n\t#if UNION_CLIPPING_PLANES \x3c NUM_CLIPPING_PLANES\n\t\tbool clipped \x3d true;\n\t\t#pragma unroll_loop_start\n\t\tfor ( int i \x3d UNION_CLIPPING_PLANES; i \x3c NUM_CLIPPING_PLANES; i ++ ) {\n\t\t\tplane \x3d clippingPlanes[ i ];\n\t\t\tclipped \x3d ( dot( vClipPosition, plane.xyz ) \x3e plane.w ) \x26\x26 clipped;\n\t\t}\n\t\t#pragma unroll_loop_end\n\t\tif ( clipped ) discard;\n\t#endif\n#endif",
clipping_planes_pars_fragment:"#if NUM_CLIPPING_PLANES \x3e 0\n\tvarying vec3 vClipPosition;\n\tuniform vec4 clippingPlanes[ NUM_CLIPPING_PLANES ];\n#endif",clipping_planes_pars_vertex:"#if NUM_CLIPPING_PLANES \x3e 0\n\tvarying vec3 vClipPosition;\n#endif",clipping_planes_vertex:"#if NUM_CLIPPING_PLANES \x3e 0\n\tvClipPosition \x3d - mvPosition.xyz;\n#endif",color_fragment:"#if defined( USE_COLOR_ALPHA )\n\tdiffuseColor *\x3d vColor;\n#elif defined( USE_COLOR )\n\tdiffuseColor.rgb *\x3d vColor;\n#endif",
color_pars_fragment:"#if defined( USE_COLOR_ALPHA )\n\tvarying vec4 vColor;\n#elif defined( USE_COLOR )\n\tvarying vec3 vColor;\n#endif",color_pars_vertex:"#if defined( USE_COLOR_ALPHA )\n\tvarying vec4 vColor;\n#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR )\n\tvarying vec3 vColor;\n#endif",color_vertex:"#if defined( USE_COLOR_ALPHA )\n\tvColor \x3d vec4( 1.0 );\n#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR )\n\tvColor \x3d vec3( 1.0 );\n#endif\n#ifdef USE_COLOR\n\tvColor *\x3d color;\n#endif\n#ifdef USE_INSTANCING_COLOR\n\tvColor.xyz *\x3d instanceColor.xyz;\n#endif",
common:"#define PI 3.141592653589793\n#define PI2 6.283185307179586\n#define PI_HALF 1.5707963267948966\n#define RECIPROCAL_PI 0.3183098861837907\n#define RECIPROCAL_PI2 0.15915494309189535\n#define EPSILON 1e-6\n#ifndef saturate\n#define saturate( a ) clamp( a, 0.0, 1.0 )\n#endif\n#define whiteComplement( a ) ( 1.0 - saturate( a ) )\nfloat pow2( const in float x ) { return x*x; }\nvec3 pow2( const in vec3 x ) { return x*x; }\nfloat pow3( const in float x ) { return x*x*x; }\nfloat pow4( const in float x ) { float x2 \x3d x*x; return x2*x2; }\nfloat max3( const in vec3 v ) { return max( max( v.x, v.y ), v.z ); }\nfloat average( const in vec3 v ) { return dot( v, vec3( 0.3333333 ) ); }\nhighp float rand( const in vec2 uv ) {\n\tconst highp float a \x3d 12.9898, b \x3d 78.233, c \x3d 43758.5453;\n\thighp float dt \x3d dot( uv.xy, vec2( a,b ) ), sn \x3d mod( dt, PI );\n\treturn fract( sin( sn ) * c );\n}\n#ifdef HIGH_PRECISION\n\tfloat precisionSafeLength( vec3 v ) { return length( v ); }\n#else\n\tfloat precisionSafeLength( vec3 v ) {\n\t\tfloat maxComponent \x3d max3( abs( v ) );\n\t\treturn length( v / maxComponent ) * maxComponent;\n\t}\n#endif\nstruct IncidentLight {\n\tvec3 color;\n\tvec3 direction;\n\tbool visible;\n};\nstruct ReflectedLight {\n\tvec3 directDiffuse;\n\tvec3 directSpecular;\n\tvec3 indirectDiffuse;\n\tvec3 indirectSpecular;\n};\n#ifdef USE_ALPHAHASH\n\tvarying vec3 vPosition;\n#endif\nvec3 transformDirection( in vec3 dir, in mat4 matrix ) {\n\treturn normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );\n}\nvec3 inverseTransformDirection( in vec3 dir, in mat4 matrix ) {\n\treturn normalize( ( vec4( dir, 0.0 ) * matrix ).xyz );\n}\nmat3 transposeMat3( const in mat3 m ) {\n\tmat3 tmp;\n\ttmp[ 0 ] \x3d vec3( m[ 0 ].x, m[ 1 ].x, m[ 2 ].x );\n\ttmp[ 1 ] \x3d vec3( m[ 0 ].y, m[ 1 ].y, m[ 2 ].y );\n\ttmp[ 2 ] \x3d vec3( m[ 0 ].z, m[ 1 ].z, m[ 2 ].z );\n\treturn tmp;\n}\nfloat luminance( const in vec3 rgb ) {\n\tconst vec3 weights \x3d vec3( 0.2126729, 0.7151522, 0.0721750 );\n\treturn dot( weights, rgb );\n}\nbool isPerspectiveMatrix( mat4 m ) {\n\treturn m[ 2 ][ 3 ] \x3d\x3d - 1.0;\n}\nvec2 equirectUv( in vec3 dir ) {\n\tfloat u \x3d atan( dir.z, dir.x ) * RECIPROCAL_PI2 + 0.5;\n\tfloat v \x3d asin( clamp( dir.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;\n\treturn vec2( u, v );\n}\nvec3 BRDF_Lambert( const in vec3 diffuseColor ) {\n\treturn RECIPROCAL_PI * diffuseColor;\n}\nvec3 F_Schlick( const in vec3 f0, const in float f90, const in float dotVH ) {\n\tfloat fresnel \x3d exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );\n\treturn f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );\n}\nfloat F_Schlick( const in float f0, const in float f90, const in float dotVH ) {\n\tfloat fresnel \x3d exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );\n\treturn f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );\n} // validated",
cube_uv_reflection_fragment:"#ifdef ENVMAP_TYPE_CUBE_UV\n\t#define cubeUV_minMipLevel 4.0\n\t#define cubeUV_minTileSize 16.0\n\tfloat getFace( vec3 direction ) {\n\t\tvec3 absDirection \x3d abs( direction );\n\t\tfloat face \x3d - 1.0;\n\t\tif ( absDirection.x \x3e absDirection.z ) {\n\t\t\tif ( absDirection.x \x3e absDirection.y )\n\t\t\t\tface \x3d direction.x \x3e 0.0 ? 0.0 : 3.0;\n\t\t\telse\n\t\t\t\tface \x3d direction.y \x3e 0.0 ? 1.0 : 4.0;\n\t\t} else {\n\t\t\tif ( absDirection.z \x3e absDirection.y )\n\t\t\t\tface \x3d direction.z \x3e 0.0 ? 2.0 : 5.0;\n\t\t\telse\n\t\t\t\tface \x3d direction.y \x3e 0.0 ? 1.0 : 4.0;\n\t\t}\n\t\treturn face;\n\t}\n\tvec2 getUV( vec3 direction, float face ) {\n\t\tvec2 uv;\n\t\tif ( face \x3d\x3d 0.0 ) {\n\t\t\tuv \x3d vec2( direction.z, direction.y ) / abs( direction.x );\n\t\t} else if ( face \x3d\x3d 1.0 ) {\n\t\t\tuv \x3d vec2( - direction.x, - direction.z ) / abs( direction.y );\n\t\t} else if ( face \x3d\x3d 2.0 ) {\n\t\t\tuv \x3d vec2( - direction.x, direction.y ) / abs( direction.z );\n\t\t} else if ( face \x3d\x3d 3.0 ) {\n\t\t\tuv \x3d vec2( - direction.z, direction.y ) / abs( direction.x );\n\t\t} else if ( face \x3d\x3d 4.0 ) {\n\t\t\tuv \x3d vec2( - direction.x, direction.z ) / abs( direction.y );\n\t\t} else {\n\t\t\tuv \x3d vec2( direction.x, direction.y ) / abs( direction.z );\n\t\t}\n\t\treturn 0.5 * ( uv + 1.0 );\n\t}\n\tvec3 bilinearCubeUV( sampler2D envMap, vec3 direction, float mipInt ) {\n\t\tfloat face \x3d getFace( direction );\n\t\tfloat filterInt \x3d max( cubeUV_minMipLevel - mipInt, 0.0 );\n\t\tmipInt \x3d max( mipInt, cubeUV_minMipLevel );\n\t\tfloat faceSize \x3d exp2( mipInt );\n\t\thighp vec2 uv \x3d getUV( direction, face ) * ( faceSize - 2.0 ) + 1.0;\n\t\tif ( face \x3e 2.0 ) {\n\t\t\tuv.y +\x3d faceSize;\n\t\t\tface -\x3d 3.0;\n\t\t}\n\t\tuv.x +\x3d face * faceSize;\n\t\tuv.x +\x3d filterInt * 3.0 * cubeUV_minTileSize;\n\t\tuv.y +\x3d 4.0 * ( exp2( CUBEUV_MAX_MIP ) - faceSize );\n\t\tuv.x *\x3d CUBEUV_TEXEL_WIDTH;\n\t\tuv.y *\x3d CUBEUV_TEXEL_HEIGHT;\n\t\t#ifdef texture2DGradEXT\n\t\t\treturn texture2DGradEXT( envMap, uv, vec2( 0.0 ), vec2( 0.0 ) ).rgb;\n\t\t#else\n\t\t\treturn texture2D( envMap, uv ).rgb;\n\t\t#endif\n\t}\n\t#define cubeUV_r0 1.0\n\t#define cubeUV_v0 0.339\n\t#define cubeUV_m0 - 2.0\n\t#define cubeUV_r1 0.8\n\t#define cubeUV_v1 0.276\n\t#define cubeUV_m1 - 1.0\n\t#define cubeUV_r4 0.4\n\t#define cubeUV_v4 0.046\n\t#define cubeUV_m4 2.0\n\t#define cubeUV_r5 0.305\n\t#define cubeUV_v5 0.016\n\t#define cubeUV_m5 3.0\n\t#define cubeUV_r6 0.21\n\t#define cubeUV_v6 0.0038\n\t#define cubeUV_m6 4.0\n\tfloat roughnessToMip( float roughness ) {\n\t\tfloat mip \x3d 0.0;\n\t\tif ( roughness \x3e\x3d cubeUV_r1 ) {\n\t\t\tmip \x3d ( cubeUV_r0 - roughness ) * ( cubeUV_m1 - cubeUV_m0 ) / ( cubeUV_r0 - cubeUV_r1 ) + cubeUV_m0;\n\t\t} else if ( roughness \x3e\x3d cubeUV_r4 ) {\n\t\t\tmip \x3d ( cubeUV_r1 - roughness ) * ( cubeUV_m4 - cubeUV_m1 ) / ( cubeUV_r1 - cubeUV_r4 ) + cubeUV_m1;\n\t\t} else if ( roughness \x3e\x3d cubeUV_r5 ) {\n\t\t\tmip \x3d ( cubeUV_r4 - roughness ) * ( cubeUV_m5 - cubeUV_m4 ) / ( cubeUV_r4 - cubeUV_r5 ) + cubeUV_m4;\n\t\t} else if ( roughness \x3e\x3d cubeUV_r6 ) {\n\t\t\tmip \x3d ( cubeUV_r5 - roughness ) * ( cubeUV_m6 - cubeUV_m5 ) / ( cubeUV_r5 - cubeUV_r6 ) + cubeUV_m5;\n\t\t} else {\n\t\t\tmip \x3d - 2.0 * log2( 1.16 * roughness );\t\t}\n\t\treturn mip;\n\t}\n\tvec4 textureCubeUV( sampler2D envMap, vec3 sampleDir, float roughness ) {\n\t\tfloat mip \x3d clamp( roughnessToMip( roughness ), cubeUV_m0, CUBEUV_MAX_MIP );\n\t\tfloat mipF \x3d fract( mip );\n\t\tfloat mipInt \x3d floor( mip );\n\t\tvec3 color0 \x3d bilinearCubeUV( envMap, sampleDir, mipInt );\n\t\tif ( mipF \x3d\x3d 0.0 ) {\n\t\t\treturn vec4( color0, 1.0 );\n\t\t} else {\n\t\t\tvec3 color1 \x3d bilinearCubeUV( envMap, sampleDir, mipInt + 1.0 );\n\t\t\treturn vec4( mix( color0, color1, mipF ), 1.0 );\n\t\t}\n\t}\n#endif",
defaultnormal_vertex:"vec3 transformedNormal \x3d objectNormal;\n#ifdef USE_INSTANCING\n\tmat3 m \x3d mat3( instanceMatrix );\n\ttransformedNormal /\x3d vec3( dot( m[ 0 ], m[ 0 ] ), dot( m[ 1 ], m[ 1 ] ), dot( m[ 2 ], m[ 2 ] ) );\n\ttransformedNormal \x3d m * transformedNormal;\n#endif\ntransformedNormal \x3d normalMatrix * transformedNormal;\n#ifdef FLIP_SIDED\n\ttransformedNormal \x3d - transformedNormal;\n#endif\n#ifdef USE_TANGENT\n\tvec3 transformedTangent \x3d ( modelViewMatrix * vec4( objectTangent, 0.0 ) ).xyz;\n\t#ifdef FLIP_SIDED\n\t\ttransformedTangent \x3d - transformedTangent;\n\t#endif\n#endif",
displacementmap_pars_vertex:"#ifdef USE_DISPLACEMENTMAP\n\tuniform sampler2D displacementMap;\n\tuniform float displacementScale;\n\tuniform float displacementBias;\n#endif",displacementmap_vertex:"#ifdef USE_DISPLACEMENTMAP\n\ttransformed +\x3d normalize( objectNormal ) * ( texture2D( displacementMap, vDisplacementMapUv ).x * displacementScale + displacementBias );\n#endif",emissivemap_fragment:"#ifdef USE_EMISSIVEMAP\n\tvec4 emissiveColor \x3d texture2D( emissiveMap, vEmissiveMapUv );\n\ttotalEmissiveRadiance *\x3d emissiveColor.rgb;\n#endif",
emissivemap_pars_fragment:"#ifdef USE_EMISSIVEMAP\n\tuniform sampler2D emissiveMap;\n#endif",colorspace_fragment:"gl_FragColor \x3d linearToOutputTexel( gl_FragColor );",colorspace_pars_fragment:"\nconst mat3 LINEAR_SRGB_TO_LINEAR_DISPLAY_P3 \x3d mat3(\n\tvec3( 0.8224621, 0.177538, 0.0 ),\n\tvec3( 0.0331941, 0.9668058, 0.0 ),\n\tvec3( 0.0170827, 0.0723974, 0.9105199 )\n);\nconst mat3 LINEAR_DISPLAY_P3_TO_LINEAR_SRGB \x3d mat3(\n\tvec3( 1.2249401, - 0.2249404, 0.0 ),\n\tvec3( - 0.0420569, 1.0420571, 0.0 ),\n\tvec3( - 0.0196376, - 0.0786361, 1.0982735 )\n);\nvec4 LinearSRGBToLinearDisplayP3( in vec4 value ) {\n\treturn vec4( value.rgb * LINEAR_SRGB_TO_LINEAR_DISPLAY_P3, value.a );\n}\nvec4 LinearDisplayP3ToLinearSRGB( in vec4 value ) {\n\treturn vec4( value.rgb * LINEAR_DISPLAY_P3_TO_LINEAR_SRGB, value.a );\n}\nvec4 LinearTransferOETF( in vec4 value ) {\n\treturn value;\n}\nvec4 sRGBTransferOETF( in vec4 value ) {\n\treturn vec4( mix( pow( value.rgb, vec3( 0.41666 ) ) * 1.055 - vec3( 0.055 ), value.rgb * 12.92, vec3( lessThanEqual( value.rgb, vec3( 0.0031308 ) ) ) ), value.a );\n}\nvec4 LinearToLinear( in vec4 value ) {\n\treturn value;\n}\nvec4 LinearTosRGB( in vec4 value ) {\n\treturn sRGBTransferOETF( value );\n}",
envmap_fragment:"#ifdef USE_ENVMAP\n\t#ifdef ENV_WORLDPOS\n\t\tvec3 cameraToFrag;\n\t\tif ( isOrthographic ) {\n\t\t\tcameraToFrag \x3d normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );\n\t\t} else {\n\t\t\tcameraToFrag \x3d normalize( vWorldPosition - cameraPosition );\n\t\t}\n\t\tvec3 worldNormal \x3d inverseTransformDirection( normal, viewMatrix );\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\tvec3 reflectVec \x3d reflect( cameraToFrag, worldNormal );\n\t\t#else\n\t\t\tvec3 reflectVec \x3d refract( cameraToFrag, worldNormal, refractionRatio );\n\t\t#endif\n\t#else\n\t\tvec3 reflectVec \x3d vReflect;\n\t#endif\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tvec4 envColor \x3d textureCube( envMap, vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );\n\t#else\n\t\tvec4 envColor \x3d vec4( 0.0 );\n\t#endif\n\t#ifdef ENVMAP_BLENDING_MULTIPLY\n\t\toutgoingLight \x3d mix( outgoingLight, outgoingLight * envColor.xyz, specularStrength * reflectivity );\n\t#elif defined( ENVMAP_BLENDING_MIX )\n\t\toutgoingLight \x3d mix( outgoingLight, envColor.xyz, specularStrength * reflectivity );\n\t#elif defined( ENVMAP_BLENDING_ADD )\n\t\toutgoingLight +\x3d envColor.xyz * specularStrength * reflectivity;\n\t#endif\n#endif",
envmap_common_pars_fragment:"#ifdef USE_ENVMAP\n\tuniform float envMapIntensity;\n\tuniform float flipEnvMap;\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tuniform samplerCube envMap;\n\t#else\n\t\tuniform sampler2D envMap;\n\t#endif\n\t\n#endif",envmap_pars_fragment:"#ifdef USE_ENVMAP\n\tuniform float reflectivity;\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( LAMBERT )\n\t\t#define ENV_WORLDPOS\n\t#endif\n\t#ifdef ENV_WORLDPOS\n\t\tvarying vec3 vWorldPosition;\n\t\tuniform float refractionRatio;\n\t#else\n\t\tvarying vec3 vReflect;\n\t#endif\n#endif",
envmap_pars_vertex:"#ifdef USE_ENVMAP\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( LAMBERT )\n\t\t#define ENV_WORLDPOS\n\t#endif\n\t#ifdef ENV_WORLDPOS\n\t\t\n\t\tvarying vec3 vWorldPosition;\n\t#else\n\t\tvarying vec3 vReflect;\n\t\tuniform float refractionRatio;\n\t#endif\n#endif",envmap_physical_pars_fragment:"#ifdef USE_ENVMAP\n\tvec3 getIBLIrradiance( const in vec3 normal ) {\n\t\t#ifdef ENVMAP_TYPE_CUBE_UV\n\t\t\tvec3 worldNormal \x3d inverseTransformDirection( normal, viewMatrix );\n\t\t\tvec4 envMapColor \x3d textureCubeUV( envMap, worldNormal, 1.0 );\n\t\t\treturn PI * envMapColor.rgb * envMapIntensity;\n\t\t#else\n\t\t\treturn vec3( 0.0 );\n\t\t#endif\n\t}\n\tvec3 getIBLRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness ) {\n\t\t#ifdef ENVMAP_TYPE_CUBE_UV\n\t\t\tvec3 reflectVec \x3d reflect( - viewDir, normal );\n\t\t\treflectVec \x3d normalize( mix( reflectVec, normal, roughness * roughness) );\n\t\t\treflectVec \x3d inverseTransformDirection( reflectVec, viewMatrix );\n\t\t\tvec4 envMapColor \x3d textureCubeUV( envMap, reflectVec, roughness );\n\t\t\treturn envMapColor.rgb * envMapIntensity;\n\t\t#else\n\t\t\treturn vec3( 0.0 );\n\t\t#endif\n\t}\n\t#ifdef USE_ANISOTROPY\n\t\tvec3 getIBLAnisotropyRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness, const in vec3 bitangent, const in float anisotropy ) {\n\t\t\t#ifdef ENVMAP_TYPE_CUBE_UV\n\t\t\t\tvec3 bentNormal \x3d cross( bitangent, viewDir );\n\t\t\t\tbentNormal \x3d normalize( cross( bentNormal, bitangent ) );\n\t\t\t\tbentNormal \x3d normalize( mix( bentNormal, normal, pow2( pow2( 1.0 - anisotropy * ( 1.0 - roughness ) ) ) ) );\n\t\t\t\treturn getIBLRadiance( viewDir, bentNormal, roughness );\n\t\t\t#else\n\t\t\t\treturn vec3( 0.0 );\n\t\t\t#endif\n\t\t}\n\t#endif\n#endif",
envmap_vertex:"#ifdef USE_ENVMAP\n\t#ifdef ENV_WORLDPOS\n\t\tvWorldPosition \x3d worldPosition.xyz;\n\t#else\n\t\tvec3 cameraToVertex;\n\t\tif ( isOrthographic ) {\n\t\t\tcameraToVertex \x3d normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );\n\t\t} else {\n\t\t\tcameraToVertex \x3d normalize( worldPosition.xyz - cameraPosition );\n\t\t}\n\t\tvec3 worldNormal \x3d inverseTransformDirection( transformedNormal, viewMatrix );\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\tvReflect \x3d reflect( cameraToVertex, worldNormal );\n\t\t#else\n\t\t\tvReflect \x3d refract( cameraToVertex, worldNormal, refractionRatio );\n\t\t#endif\n\t#endif\n#endif",
fog_vertex:"#ifdef USE_FOG\n\tvFogDepth \x3d - mvPosition.z;\n#endif",fog_pars_vertex:"#ifdef USE_FOG\n\tvarying float vFogDepth;\n#endif",fog_fragment:"#ifdef USE_FOG\n\t#ifdef FOG_EXP2\n\t\tfloat fogFactor \x3d 1.0 - exp( - fogDensity * fogDensity * vFogDepth * vFogDepth );\n\t#else\n\t\tfloat fogFactor \x3d smoothstep( fogNear, fogFar, vFogDepth );\n\t#endif\n\tgl_FragColor.rgb \x3d mix( gl_FragColor.rgb, fogColor, fogFactor );\n#endif",fog_pars_fragment:"#ifdef USE_FOG\n\tuniform vec3 fogColor;\n\tvarying float vFogDepth;\n\t#ifdef FOG_EXP2\n\t\tuniform float fogDensity;\n\t#else\n\t\tuniform float fogNear;\n\t\tuniform float fogFar;\n\t#endif\n#endif",
gradientmap_pars_fragment:"#ifdef USE_GRADIENTMAP\n\tuniform sampler2D gradientMap;\n#endif\nvec3 getGradientIrradiance( vec3 normal, vec3 lightDirection ) {\n\tfloat dotNL \x3d dot( normal, lightDirection );\n\tvec2 coord \x3d vec2( dotNL * 0.5 + 0.5, 0.0 );\n\t#ifdef USE_GRADIENTMAP\n\t\treturn vec3( texture2D( gradientMap, coord ).r );\n\t#else\n\t\tvec2 fw \x3d fwidth( coord ) * 0.5;\n\t\treturn mix( vec3( 0.7 ), vec3( 1.0 ), smoothstep( 0.7 - fw.x, 0.7 + fw.x, coord.x ) );\n\t#endif\n}",lightmap_fragment:"#ifdef USE_LIGHTMAP\n\tvec4 lightMapTexel \x3d texture2D( lightMap, vLightMapUv );\n\tvec3 lightMapIrradiance \x3d lightMapTexel.rgb * lightMapIntensity;\n\treflectedLight.indirectDiffuse +\x3d lightMapIrradiance;\n#endif",
lightmap_pars_fragment:"#ifdef USE_LIGHTMAP\n\tuniform sampler2D lightMap;\n\tuniform float lightMapIntensity;\n#endif",lights_lambert_fragment:"LambertMaterial material;\nmaterial.diffuseColor \x3d diffuseColor.rgb;\nmaterial.specularStrength \x3d specularStrength;",lights_lambert_pars_fragment:"varying vec3 vViewPosition;\nstruct LambertMaterial {\n\tvec3 diffuseColor;\n\tfloat specularStrength;\n};\nvoid RE_Direct_Lambert( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in LambertMaterial material, inout ReflectedLight reflectedLight ) {\n\tfloat dotNL \x3d saturate( dot( geometryNormal, directLight.direction ) );\n\tvec3 irradiance \x3d dotNL * directLight.color;\n\treflectedLight.directDiffuse +\x3d irradiance * BRDF_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectDiffuse_Lambert( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in LambertMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse +\x3d irradiance * BRDF_Lambert( material.diffuseColor );\n}\n#define RE_Direct\t\t\t\tRE_Direct_Lambert\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_Lambert",
lights_pars_begin:"uniform bool receiveShadow;\nuniform vec3 ambientLightColor;\n#if defined( USE_LIGHT_PROBES )\n\tuniform vec3 lightProbe[ 9 ];\n#endif\nvec3 shGetIrradianceAt( in vec3 normal, in vec3 shCoefficients[ 9 ] ) {\n\tfloat x \x3d normal.x, y \x3d normal.y, z \x3d normal.z;\n\tvec3 result \x3d shCoefficients[ 0 ] * 0.886227;\n\tresult +\x3d shCoefficients[ 1 ] * 2.0 * 0.511664 * y;\n\tresult +\x3d shCoefficients[ 2 ] * 2.0 * 0.511664 * z;\n\tresult +\x3d shCoefficients[ 3 ] * 2.0 * 0.511664 * x;\n\tresult +\x3d shCoefficients[ 4 ] * 2.0 * 0.429043 * x * y;\n\tresult +\x3d shCoefficients[ 5 ] * 2.0 * 0.429043 * y * z;\n\tresult +\x3d shCoefficients[ 6 ] * ( 0.743125 * z * z - 0.247708 );\n\tresult +\x3d shCoefficients[ 7 ] * 2.0 * 0.429043 * x * z;\n\tresult +\x3d shCoefficients[ 8 ] * 0.429043 * ( x * x - y * y );\n\treturn result;\n}\nvec3 getLightProbeIrradiance( const in vec3 lightProbe[ 9 ], const in vec3 normal ) {\n\tvec3 worldNormal \x3d inverseTransformDirection( normal, viewMatrix );\n\tvec3 irradiance \x3d shGetIrradianceAt( worldNormal, lightProbe );\n\treturn irradiance;\n}\nvec3 getAmbientLightIrradiance( const in vec3 ambientLightColor ) {\n\tvec3 irradiance \x3d ambientLightColor;\n\treturn irradiance;\n}\nfloat getDistanceAttenuation( const in float lightDistance, const in float cutoffDistance, const in float decayExponent ) {\n\t#if defined ( LEGACY_LIGHTS )\n\t\tif ( cutoffDistance \x3e 0.0 \x26\x26 decayExponent \x3e 0.0 ) {\n\t\t\treturn pow( saturate( - lightDistance / cutoffDistance + 1.0 ), decayExponent );\n\t\t}\n\t\treturn 1.0;\n\t#else\n\t\tfloat distanceFalloff \x3d 1.0 / max( pow( lightDistance, decayExponent ), 0.01 );\n\t\tif ( cutoffDistance \x3e 0.0 ) {\n\t\t\tdistanceFalloff *\x3d pow2( saturate( 1.0 - pow4( lightDistance / cutoffDistance ) ) );\n\t\t}\n\t\treturn distanceFalloff;\n\t#endif\n}\nfloat getSpotAttenuation( const in float coneCosine, const in float penumbraCosine, const in float angleCosine ) {\n\treturn smoothstep( coneCosine, penumbraCosine, angleCosine );\n}\n#if NUM_DIR_LIGHTS \x3e 0\n\tstruct DirectionalLight {\n\t\tvec3 direction;\n\t\tvec3 color;\n\t};\n\tuniform DirectionalLight directionalLights[ NUM_DIR_LIGHTS ];\n\tvoid getDirectionalLightInfo( const in DirectionalLight directionalLight, out IncidentLight light ) {\n\t\tlight.color \x3d directionalLight.color;\n\t\tlight.direction \x3d directionalLight.direction;\n\t\tlight.visible \x3d true;\n\t}\n#endif\n#if NUM_POINT_LIGHTS \x3e 0\n\tstruct PointLight {\n\t\tvec3 position;\n\t\tvec3 color;\n\t\tfloat distance;\n\t\tfloat decay;\n\t};\n\tuniform PointLight pointLights[ NUM_POINT_LIGHTS ];\n\tvoid getPointLightInfo( const in PointLight pointLight, const in vec3 geometryPosition, out IncidentLight light ) {\n\t\tvec3 lVector \x3d pointLight.position - geometryPosition;\n\t\tlight.direction \x3d normalize( lVector );\n\t\tfloat lightDistance \x3d length( lVector );\n\t\tlight.color \x3d pointLight.color;\n\t\tlight.color *\x3d getDistanceAttenuation( lightDistance, pointLight.distance, pointLight.decay );\n\t\tlight.visible \x3d ( light.color !\x3d vec3( 0.0 ) );\n\t}\n#endif\n#if NUM_SPOT_LIGHTS \x3e 0\n\tstruct SpotLight {\n\t\tvec3 position;\n\t\tvec3 direction;\n\t\tvec3 color;\n\t\tfloat distance;\n\t\tfloat decay;\n\t\tfloat coneCos;\n\t\tfloat penumbraCos;\n\t};\n\tuniform SpotLight spotLights[ NUM_SPOT_LIGHTS ];\n\tvoid getSpotLightInfo( const in SpotLight spotLight, const in vec3 geometryPosition, out IncidentLight light ) {\n\t\tvec3 lVector \x3d spotLight.position - geometryPosition;\n\t\tlight.direction \x3d normalize( lVector );\n\t\tfloat angleCos \x3d dot( light.direction, spotLight.direction );\n\t\tfloat spotAttenuation \x3d getSpotAttenuation( spotLight.coneCos, spotLight.penumbraCos, angleCos );\n\t\tif ( spotAttenuation \x3e 0.0 ) {\n\t\t\tfloat lightDistance \x3d length( lVector );\n\t\t\tlight.color \x3d spotLight.color * spotAttenuation;\n\t\t\tlight.color *\x3d getDistanceAttenuation( lightDistance, spotLight.distance, spotLight.decay );\n\t\t\tlight.visible \x3d ( light.color !\x3d vec3( 0.0 ) );\n\t\t} else {\n\t\t\tlight.color \x3d vec3( 0.0 );\n\t\t\tlight.visible \x3d false;\n\t\t}\n\t}\n#endif\n#if NUM_RECT_AREA_LIGHTS \x3e 0\n\tstruct RectAreaLight {\n\t\tvec3 color;\n\t\tvec3 position;\n\t\tvec3 halfWidth;\n\t\tvec3 halfHeight;\n\t};\n\tuniform sampler2D ltc_1;\tuniform sampler2D ltc_2;\n\tuniform RectAreaLight rectAreaLights[ NUM_RECT_AREA_LIGHTS ];\n#endif\n#if NUM_HEMI_LIGHTS \x3e 0\n\tstruct HemisphereLight {\n\t\tvec3 direction;\n\t\tvec3 skyColor;\n\t\tvec3 groundColor;\n\t};\n\tuniform HemisphereLight hemisphereLights[ NUM_HEMI_LIGHTS ];\n\tvec3 getHemisphereLightIrradiance( const in HemisphereLight hemiLight, const in vec3 normal ) {\n\t\tfloat dotNL \x3d dot( normal, hemiLight.direction );\n\t\tfloat hemiDiffuseWeight \x3d 0.5 * dotNL + 0.5;\n\t\tvec3 irradiance \x3d mix( hemiLight.groundColor, hemiLight.skyColor, hemiDiffuseWeight );\n\t\treturn irradiance;\n\t}\n#endif",
lights_toon_fragment:"ToonMaterial material;\nmaterial.diffuseColor \x3d diffuseColor.rgb;",lights_toon_pars_fragment:"varying vec3 vViewPosition;\nstruct ToonMaterial {\n\tvec3 diffuseColor;\n};\nvoid RE_Direct_Toon( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {\n\tvec3 irradiance \x3d getGradientIrradiance( geometryNormal, directLight.direction ) * directLight.color;\n\treflectedLight.directDiffuse +\x3d irradiance * BRDF_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectDiffuse_Toon( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse +\x3d irradiance * BRDF_Lambert( material.diffuseColor );\n}\n#define RE_Direct\t\t\t\tRE_Direct_Toon\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_Toon",
lights_phong_fragment:"BlinnPhongMaterial material;\nmaterial.diffuseColor \x3d diffuseColor.rgb;\nmaterial.specularColor \x3d specular;\nmaterial.specularShininess \x3d shininess;\nmaterial.specularStrength \x3d specularStrength;",lights_phong_pars_fragment:"varying vec3 vViewPosition;\nstruct BlinnPhongMaterial {\n\tvec3 diffuseColor;\n\tvec3 specularColor;\n\tfloat specularShininess;\n\tfloat specularStrength;\n};\nvoid RE_Direct_BlinnPhong( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {\n\tfloat dotNL \x3d saturate( dot( geometryNormal, directLight.direction ) );\n\tvec3 irradiance \x3d dotNL * directLight.color;\n\treflectedLight.directDiffuse +\x3d irradiance * BRDF_Lambert( material.diffuseColor );\n\treflectedLight.directSpecular +\x3d irradiance * BRDF_BlinnPhong( directLight.direction, geometryViewDir, geometryNormal, material.specularColor, material.specularShininess ) * material.specularStrength;\n}\nvoid RE_IndirectDiffuse_BlinnPhong( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse +\x3d irradiance * BRDF_Lambert( material.diffuseColor );\n}\n#define RE_Direct\t\t\t\tRE_Direct_BlinnPhong\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_BlinnPhong",
lights_physical_fragment:"PhysicalMaterial material;\nmaterial.diffuseColor \x3d diffuseColor.rgb * ( 1.0 - metalnessFactor );\nvec3 dxy \x3d max( abs( dFdx( nonPerturbedNormal ) ), abs( dFdy( nonPerturbedNormal ) ) );\nfloat geometryRoughness \x3d max( max( dxy.x, dxy.y ), dxy.z );\nmaterial.roughness \x3d max( roughnessFactor, 0.0525 );material.roughness +\x3d geometryRoughness;\nmaterial.roughness \x3d min( material.roughness, 1.0 );\n#ifdef IOR\n\tmaterial.ior \x3d ior;\n\t#ifdef USE_SPECULAR\n\t\tfloat specularIntensityFactor \x3d specularIntensity;\n\t\tvec3 specularColorFactor \x3d specularColor;\n\t\t#ifdef USE_SPECULAR_COLORMAP\n\t\t\tspecularColorFactor *\x3d texture2D( specularColorMap, vSpecularColorMapUv ).rgb;\n\t\t#endif\n\t\t#ifdef USE_SPECULAR_INTENSITYMAP\n\t\t\tspecularIntensityFactor *\x3d texture2D( specularIntensityMap, vSpecularIntensityMapUv ).a;\n\t\t#endif\n\t\tmaterial.specularF90 \x3d mix( specularIntensityFactor, 1.0, metalnessFactor );\n\t#else\n\t\tfloat specularIntensityFactor \x3d 1.0;\n\t\tvec3 specularColorFactor \x3d vec3( 1.0 );\n\t\tmaterial.specularF90 \x3d 1.0;\n\t#endif\n\tmaterial.specularColor \x3d mix( min( pow2( ( material.ior - 1.0 ) / ( material.ior + 1.0 ) ) * specularColorFactor, vec3( 1.0 ) ) * specularIntensityFactor, diffuseColor.rgb, metalnessFactor );\n#else\n\tmaterial.specularColor \x3d mix( vec3( 0.04 ), diffuseColor.rgb, metalnessFactor );\n\tmaterial.specularF90 \x3d 1.0;\n#endif\n#ifdef USE_CLEARCOAT\n\tmaterial.clearcoat \x3d clearcoat;\n\tmaterial.clearcoatRoughness \x3d clearcoatRoughness;\n\tmaterial.clearcoatF0 \x3d vec3( 0.04 );\n\tmaterial.clearcoatF90 \x3d 1.0;\n\t#ifdef USE_CLEARCOATMAP\n\t\tmaterial.clearcoat *\x3d texture2D( clearcoatMap, vClearcoatMapUv ).x;\n\t#endif\n\t#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n\t\tmaterial.clearcoatRoughness *\x3d texture2D( clearcoatRoughnessMap, vClearcoatRoughnessMapUv ).y;\n\t#endif\n\tmaterial.clearcoat \x3d saturate( material.clearcoat );\tmaterial.clearcoatRoughness \x3d max( material.clearcoatRoughness, 0.0525 );\n\tmaterial.clearcoatRoughness +\x3d geometryRoughness;\n\tmaterial.clearcoatRoughness \x3d min( material.clearcoatRoughness, 1.0 );\n#endif\n#ifdef USE_IRIDESCENCE\n\tmaterial.iridescence \x3d iridescence;\n\tmaterial.iridescenceIOR \x3d iridescenceIOR;\n\t#ifdef USE_IRIDESCENCEMAP\n\t\tmaterial.iridescence *\x3d texture2D( iridescenceMap, vIridescenceMapUv ).r;\n\t#endif\n\t#ifdef USE_IRIDESCENCE_THICKNESSMAP\n\t\tmaterial.iridescenceThickness \x3d (iridescenceThicknessMaximum - iridescenceThicknessMinimum) * texture2D( iridescenceThicknessMap, vIridescenceThicknessMapUv ).g + iridescenceThicknessMinimum;\n\t#else\n\t\tmaterial.iridescenceThickness \x3d iridescenceThicknessMaximum;\n\t#endif\n#endif\n#ifdef USE_SHEEN\n\tmaterial.sheenColor \x3d sheenColor;\n\t#ifdef USE_SHEEN_COLORMAP\n\t\tmaterial.sheenColor *\x3d texture2D( sheenColorMap, vSheenColorMapUv ).rgb;\n\t#endif\n\tmaterial.sheenRoughness \x3d clamp( sheenRoughness, 0.07, 1.0 );\n\t#ifdef USE_SHEEN_ROUGHNESSMAP\n\t\tmaterial.sheenRoughness *\x3d texture2D( sheenRoughnessMap, vSheenRoughnessMapUv ).a;\n\t#endif\n#endif\n#ifdef USE_ANISOTROPY\n\t#ifdef USE_ANISOTROPYMAP\n\t\tmat2 anisotropyMat \x3d mat2( anisotropyVector.x, anisotropyVector.y, - anisotropyVector.y, anisotropyVector.x );\n\t\tvec3 anisotropyPolar \x3d texture2D( anisotropyMap, vAnisotropyMapUv ).rgb;\n\t\tvec2 anisotropyV \x3d anisotropyMat * normalize( 2.0 * anisotropyPolar.rg - vec2( 1.0 ) ) * anisotropyPolar.b;\n\t#else\n\t\tvec2 anisotropyV \x3d anisotropyVector;\n\t#endif\n\tmaterial.anisotropy \x3d length( anisotropyV );\n\tanisotropyV /\x3d material.anisotropy;\n\tmaterial.anisotropy \x3d saturate( material.anisotropy );\n\tmaterial.alphaT \x3d mix( pow2( material.roughness ), 1.0, pow2( material.anisotropy ) );\n\tmaterial.anisotropyT \x3d tbn[ 0 ] * anisotropyV.x - tbn[ 1 ] * anisotropyV.y;\n\tmaterial.anisotropyB \x3d tbn[ 1 ] * anisotropyV.x + tbn[ 0 ] * anisotropyV.y;\n#endif",
lights_physical_pars_fragment:"struct PhysicalMaterial {\n\tvec3 diffuseColor;\n\tfloat roughness;\n\tvec3 specularColor;\n\tfloat specularF90;\n\t#ifdef USE_CLEARCOAT\n\t\tfloat clearcoat;\n\t\tfloat clearcoatRoughness;\n\t\tvec3 clearcoatF0;\n\t\tfloat clearcoatF90;\n\t#endif\n\t#ifdef USE_IRIDESCENCE\n\t\tfloat iridescence;\n\t\tfloat iridescenceIOR;\n\t\tfloat iridescenceThickness;\n\t\tvec3 iridescenceFresnel;\n\t\tvec3 iridescenceF0;\n\t#endif\n\t#ifdef USE_SHEEN\n\t\tvec3 sheenColor;\n\t\tfloat sheenRoughness;\n\t#endif\n\t#ifdef IOR\n\t\tfloat ior;\n\t#endif\n\t#ifdef USE_TRANSMISSION\n\t\tfloat transmission;\n\t\tfloat transmissionAlpha;\n\t\tfloat thickness;\n\t\tfloat attenuationDistance;\n\t\tvec3 attenuationColor;\n\t#endif\n\t#ifdef USE_ANISOTROPY\n\t\tfloat anisotropy;\n\t\tfloat alphaT;\n\t\tvec3 anisotropyT;\n\t\tvec3 anisotropyB;\n\t#endif\n};\nvec3 clearcoatSpecularDirect \x3d vec3( 0.0 );\nvec3 clearcoatSpecularIndirect \x3d vec3( 0.0 );\nvec3 sheenSpecularDirect \x3d vec3( 0.0 );\nvec3 sheenSpecularIndirect \x3d vec3(0.0 );\nvec3 Schlick_to_F0( const in vec3 f, const in float f90, const in float dotVH ) {\n    float x \x3d clamp( 1.0 - dotVH, 0.0, 1.0 );\n    float x2 \x3d x * x;\n    float x5 \x3d clamp( x * x2 * x2, 0.0, 0.9999 );\n    return ( f - vec3( f90 ) * x5 ) / ( 1.0 - x5 );\n}\nfloat V_GGX_SmithCorrelated( const in float alpha, const in float dotNL, const in float dotNV ) {\n\tfloat a2 \x3d pow2( alpha );\n\tfloat gv \x3d dotNL * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );\n\tfloat gl \x3d dotNV * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );\n\treturn 0.5 / max( gv + gl, EPSILON );\n}\nfloat D_GGX( const in float alpha, const in float dotNH ) {\n\tfloat a2 \x3d pow2( alpha );\n\tfloat denom \x3d pow2( dotNH ) * ( a2 - 1.0 ) + 1.0;\n\treturn RECIPROCAL_PI * a2 / pow2( denom );\n}\n#ifdef USE_ANISOTROPY\n\tfloat V_GGX_SmithCorrelated_Anisotropic( const in float alphaT, const in float alphaB, const in float dotTV, const in float dotBV, const in float dotTL, const in float dotBL, const in float dotNV, const in float dotNL ) {\n\t\tfloat gv \x3d dotNL * length( vec3( alphaT * dotTV, alphaB * dotBV, dotNV ) );\n\t\tfloat gl \x3d dotNV * length( vec3( alphaT * dotTL, alphaB * dotBL, dotNL ) );\n\t\tfloat v \x3d 0.5 / ( gv + gl );\n\t\treturn saturate(v);\n\t}\n\tfloat D_GGX_Anisotropic( const in float alphaT, const in float alphaB, const in float dotNH, const in float dotTH, const in float dotBH ) {\n\t\tfloat a2 \x3d alphaT * alphaB;\n\t\thighp vec3 v \x3d vec3( alphaB * dotTH, alphaT * dotBH, a2 * dotNH );\n\t\thighp float v2 \x3d dot( v, v );\n\t\tfloat w2 \x3d a2 / v2;\n\t\treturn RECIPROCAL_PI * a2 * pow2 ( w2 );\n\t}\n#endif\n#ifdef USE_CLEARCOAT\n\tvec3 BRDF_GGX_Clearcoat( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in PhysicalMaterial material) {\n\t\tvec3 f0 \x3d material.clearcoatF0;\n\t\tfloat f90 \x3d material.clearcoatF90;\n\t\tfloat roughness \x3d material.clearcoatRoughness;\n\t\tfloat alpha \x3d pow2( roughness );\n\t\tvec3 halfDir \x3d normalize( lightDir + viewDir );\n\t\tfloat dotNL \x3d saturate( dot( normal, lightDir ) );\n\t\tfloat dotNV \x3d saturate( dot( normal, viewDir ) );\n\t\tfloat dotNH \x3d saturate( dot( normal, halfDir ) );\n\t\tfloat dotVH \x3d saturate( dot( viewDir, halfDir ) );\n\t\tvec3 F \x3d F_Schlick( f0, f90, dotVH );\n\t\tfloat V \x3d V_GGX_SmithCorrelated( alpha, dotNL, dotNV );\n\t\tfloat D \x3d D_GGX( alpha, dotNH );\n\t\treturn F * ( V * D );\n\t}\n#endif\nvec3 BRDF_GGX( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in PhysicalMaterial material ) {\n\tvec3 f0 \x3d material.specularColor;\n\tfloat f90 \x3d material.specularF90;\n\tfloat roughness \x3d material.roughness;\n\tfloat alpha \x3d pow2( roughness );\n\tvec3 halfDir \x3d normalize( lightDir + viewDir );\n\tfloat dotNL \x3d saturate( dot( normal, lightDir ) );\n\tfloat dotNV \x3d saturate( dot( normal, viewDir ) );\n\tfloat dotNH \x3d saturate( dot( normal, halfDir ) );\n\tfloat dotVH \x3d saturate( dot( viewDir, halfDir ) );\n\tvec3 F \x3d F_Schlick( f0, f90, dotVH );\n\t#ifdef USE_IRIDESCENCE\n\t\tF \x3d mix( F, material.iridescenceFresnel, material.iridescence );\n\t#endif\n\t#ifdef USE_ANISOTROPY\n\t\tfloat dotTL \x3d dot( material.anisotropyT, lightDir );\n\t\tfloat dotTV \x3d dot( material.anisotropyT, viewDir );\n\t\tfloat dotTH \x3d dot( material.anisotropyT, halfDir );\n\t\tfloat dotBL \x3d dot( material.anisotropyB, lightDir );\n\t\tfloat dotBV \x3d dot( material.anisotropyB, viewDir );\n\t\tfloat dotBH \x3d dot( material.anisotropyB, halfDir );\n\t\tfloat V \x3d V_GGX_SmithCorrelated_Anisotropic( material.alphaT, alpha, dotTV, dotBV, dotTL, dotBL, dotNV, dotNL );\n\t\tfloat D \x3d D_GGX_Anisotropic( material.alphaT, alpha, dotNH, dotTH, dotBH );\n\t#else\n\t\tfloat V \x3d V_GGX_SmithCorrelated( alpha, dotNL, dotNV );\n\t\tfloat D \x3d D_GGX( alpha, dotNH );\n\t#endif\n\treturn F * ( V * D );\n}\nvec2 LTC_Uv( const in vec3 N, const in vec3 V, const in float roughness ) {\n\tconst float LUT_SIZE \x3d 64.0;\n\tconst float LUT_SCALE \x3d ( LUT_SIZE - 1.0 ) / LUT_SIZE;\n\tconst float LUT_BIAS \x3d 0.5 / LUT_SIZE;\n\tfloat dotNV \x3d saturate( dot( N, V ) );\n\tvec2 uv \x3d vec2( roughness, sqrt( 1.0 - dotNV ) );\n\tuv \x3d uv * LUT_SCALE + LUT_BIAS;\n\treturn uv;\n}\nfloat LTC_ClippedSphereFormFactor( const in vec3 f ) {\n\tfloat l \x3d length( f );\n\treturn max( ( l * l + f.z ) / ( l + 1.0 ), 0.0 );\n}\nvec3 LTC_EdgeVectorFormFactor( const in vec3 v1, const in vec3 v2 ) {\n\tfloat x \x3d dot( v1, v2 );\n\tfloat y \x3d abs( x );\n\tfloat a \x3d 0.8543985 + ( 0.4965155 + 0.0145206 * y ) * y;\n\tfloat b \x3d 3.4175940 + ( 4.1616724 + y ) * y;\n\tfloat v \x3d a / b;\n\tfloat theta_sintheta \x3d ( x \x3e 0.0 ) ? v : 0.5 * inversesqrt( max( 1.0 - x * x, 1e-7 ) ) - v;\n\treturn cross( v1, v2 ) * theta_sintheta;\n}\nvec3 LTC_Evaluate( const in vec3 N, const in vec3 V, const in vec3 P, const in mat3 mInv, const in vec3 rectCoords[ 4 ] ) {\n\tvec3 v1 \x3d rectCoords[ 1 ] - rectCoords[ 0 ];\n\tvec3 v2 \x3d rectCoords[ 3 ] - rectCoords[ 0 ];\n\tvec3 lightNormal \x3d cross( v1, v2 );\n\tif( dot( lightNormal, P - rectCoords[ 0 ] ) \x3c 0.0 ) return vec3( 0.0 );\n\tvec3 T1, T2;\n\tT1 \x3d normalize( V - N * dot( V, N ) );\n\tT2 \x3d - cross( N, T1 );\n\tmat3 mat \x3d mInv * transposeMat3( mat3( T1, T2, N ) );\n\tvec3 coords[ 4 ];\n\tcoords[ 0 ] \x3d mat * ( rectCoords[ 0 ] - P );\n\tcoords[ 1 ] \x3d mat * ( rectCoords[ 1 ] - P );\n\tcoords[ 2 ] \x3d mat * ( rectCoords[ 2 ] - P );\n\tcoords[ 3 ] \x3d mat * ( rectCoords[ 3 ] - P );\n\tcoords[ 0 ] \x3d normalize( coords[ 0 ] );\n\tcoords[ 1 ] \x3d normalize( coords[ 1 ] );\n\tcoords[ 2 ] \x3d normalize( coords[ 2 ] );\n\tcoords[ 3 ] \x3d normalize( coords[ 3 ] );\n\tvec3 vectorFormFactor \x3d vec3( 0.0 );\n\tvectorFormFactor +\x3d LTC_EdgeVectorFormFactor( coords[ 0 ], coords[ 1 ] );\n\tvectorFormFactor +\x3d LTC_EdgeVectorFormFactor( coords[ 1 ], coords[ 2 ] );\n\tvectorFormFactor +\x3d LTC_EdgeVectorFormFactor( coords[ 2 ], coords[ 3 ] );\n\tvectorFormFactor +\x3d LTC_EdgeVectorFormFactor( coords[ 3 ], coords[ 0 ] );\n\tfloat result \x3d LTC_ClippedSphereFormFactor( vectorFormFactor );\n\treturn vec3( result );\n}\n#if defined( USE_SHEEN )\nfloat D_Charlie( float roughness, float dotNH ) {\n\tfloat alpha \x3d pow2( roughness );\n\tfloat invAlpha \x3d 1.0 / alpha;\n\tfloat cos2h \x3d dotNH * dotNH;\n\tfloat sin2h \x3d max( 1.0 - cos2h, 0.0078125 );\n\treturn ( 2.0 + invAlpha ) * pow( sin2h, invAlpha * 0.5 ) / ( 2.0 * PI );\n}\nfloat V_Neubelt( float dotNV, float dotNL ) {\n\treturn saturate( 1.0 / ( 4.0 * ( dotNL + dotNV - dotNL * dotNV ) ) );\n}\nvec3 BRDF_Sheen( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, vec3 sheenColor, const in float sheenRoughness ) {\n\tvec3 halfDir \x3d normalize( lightDir + viewDir );\n\tfloat dotNL \x3d saturate( dot( normal, lightDir ) );\n\tfloat dotNV \x3d saturate( dot( normal, viewDir ) );\n\tfloat dotNH \x3d saturate( dot( normal, halfDir ) );\n\tfloat D \x3d D_Charlie( sheenRoughness, dotNH );\n\tfloat V \x3d V_Neubelt( dotNV, dotNL );\n\treturn sheenColor * ( D * V );\n}\n#endif\nfloat IBLSheenBRDF( const in vec3 normal, const in vec3 viewDir, const in float roughness ) {\n\tfloat dotNV \x3d saturate( dot( normal, viewDir ) );\n\tfloat r2 \x3d roughness * roughness;\n\tfloat a \x3d roughness \x3c 0.25 ? -339.2 * r2 + 161.4 * roughness - 25.9 : -8.48 * r2 + 14.3 * roughness - 9.95;\n\tfloat b \x3d roughness \x3c 0.25 ? 44.0 * r2 - 23.7 * roughness + 3.26 : 1.97 * r2 - 3.27 * roughness + 0.72;\n\tfloat DG \x3d exp( a * dotNV + b ) + ( roughness \x3c 0.25 ? 0.0 : 0.1 * ( roughness - 0.25 ) );\n\treturn saturate( DG * RECIPROCAL_PI );\n}\nvec2 DFGApprox( const in vec3 normal, const in vec3 viewDir, const in float roughness ) {\n\tfloat dotNV \x3d saturate( dot( normal, viewDir ) );\n\tconst vec4 c0 \x3d vec4( - 1, - 0.0275, - 0.572, 0.022 );\n\tconst vec4 c1 \x3d vec4( 1, 0.0425, 1.04, - 0.04 );\n\tvec4 r \x3d roughness * c0 + c1;\n\tfloat a004 \x3d min( r.x * r.x, exp2( - 9.28 * dotNV ) ) * r.x + r.y;\n\tvec2 fab \x3d vec2( - 1.04, 1.04 ) * a004 + r.zw;\n\treturn fab;\n}\nvec3 EnvironmentBRDF( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness ) {\n\tvec2 fab \x3d DFGApprox( normal, viewDir, roughness );\n\treturn specularColor * fab.x + specularF90 * fab.y;\n}\n#ifdef USE_IRIDESCENCE\nvoid computeMultiscatteringIridescence( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float iridescence, const in vec3 iridescenceF0, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {\n#else\nvoid computeMultiscattering( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {\n#endif\n\tvec2 fab \x3d DFGApprox( normal, viewDir, roughness );\n\t#ifdef USE_IRIDESCENCE\n\t\tvec3 Fr \x3d mix( specularColor, iridescenceF0, iridescence );\n\t#else\n\t\tvec3 Fr \x3d specularColor;\n\t#endif\n\tvec3 FssEss \x3d Fr * fab.x + specularF90 * fab.y;\n\tfloat Ess \x3d fab.x + fab.y;\n\tfloat Ems \x3d 1.0 - Ess;\n\tvec3 Favg \x3d Fr + ( 1.0 - Fr ) * 0.047619;\tvec3 Fms \x3d FssEss * Favg / ( 1.0 - Ems * Favg );\n\tsingleScatter +\x3d FssEss;\n\tmultiScatter +\x3d Fms * Ems;\n}\n#if NUM_RECT_AREA_LIGHTS \x3e 0\n\tvoid RE_Direct_RectArea_Physical( const in RectAreaLight rectAreaLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\t\tvec3 normal \x3d geometryNormal;\n\t\tvec3 viewDir \x3d geometryViewDir;\n\t\tvec3 position \x3d geometryPosition;\n\t\tvec3 lightPos \x3d rectAreaLight.position;\n\t\tvec3 halfWidth \x3d rectAreaLight.halfWidth;\n\t\tvec3 halfHeight \x3d rectAreaLight.halfHeight;\n\t\tvec3 lightColor \x3d rectAreaLight.color;\n\t\tfloat roughness \x3d material.roughness;\n\t\tvec3 rectCoords[ 4 ];\n\t\trectCoords[ 0 ] \x3d lightPos + halfWidth - halfHeight;\t\trectCoords[ 1 ] \x3d lightPos - halfWidth - halfHeight;\n\t\trectCoords[ 2 ] \x3d lightPos - halfWidth + halfHeight;\n\t\trectCoords[ 3 ] \x3d lightPos + halfWidth + halfHeight;\n\t\tvec2 uv \x3d LTC_Uv( normal, viewDir, roughness );\n\t\tvec4 t1 \x3d texture2D( ltc_1, uv );\n\t\tvec4 t2 \x3d texture2D( ltc_2, uv );\n\t\tmat3 mInv \x3d mat3(\n\t\t\tvec3( t1.x, 0, t1.y ),\n\t\t\tvec3(    0, 1,    0 ),\n\t\t\tvec3( t1.z, 0, t1.w )\n\t\t);\n\t\tvec3 fresnel \x3d ( material.specularColor * t2.x + ( vec3( 1.0 ) - material.specularColor ) * t2.y );\n\t\treflectedLight.directSpecular +\x3d lightColor * fresnel * LTC_Evaluate( normal, viewDir, position, mInv, rectCoords );\n\t\treflectedLight.directDiffuse +\x3d lightColor * material.diffuseColor * LTC_Evaluate( normal, viewDir, position, mat3( 1.0 ), rectCoords );\n\t}\n#endif\nvoid RE_Direct_Physical( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\tfloat dotNL \x3d saturate( dot( geometryNormal, directLight.direction ) );\n\tvec3 irradiance \x3d dotNL * directLight.color;\n\t#ifdef USE_CLEARCOAT\n\t\tfloat dotNLcc \x3d saturate( dot( geometryClearcoatNormal, directLight.direction ) );\n\t\tvec3 ccIrradiance \x3d dotNLcc * directLight.color;\n\t\tclearcoatSpecularDirect +\x3d ccIrradiance * BRDF_GGX_Clearcoat( directLight.direction, geometryViewDir, geometryClearcoatNormal, material );\n\t#endif\n\t#ifdef USE_SHEEN\n\t\tsheenSpecularDirect +\x3d irradiance * BRDF_Sheen( directLight.direction, geometryViewDir, geometryNormal, material.sheenColor, material.sheenRoughness );\n\t#endif\n\treflectedLight.directSpecular +\x3d irradiance * BRDF_GGX( directLight.direction, geometryViewDir, geometryNormal, material );\n\treflectedLight.directDiffuse +\x3d irradiance * BRDF_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectDiffuse_Physical( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse +\x3d irradiance * BRDF_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectSpecular_Physical( const in vec3 radiance, const in vec3 irradiance, const in vec3 clearcoatRadiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight) {\n\t#ifdef USE_CLEARCOAT\n\t\tclearcoatSpecularIndirect +\x3d clearcoatRadiance * EnvironmentBRDF( geometryClearcoatNormal, geometryViewDir, material.clearcoatF0, material.clearcoatF90, material.clearcoatRoughness );\n\t#endif\n\t#ifdef USE_SHEEN\n\t\tsheenSpecularIndirect +\x3d irradiance * material.sheenColor * IBLSheenBRDF( geometryNormal, geometryViewDir, material.sheenRoughness );\n\t#endif\n\tvec3 singleScattering \x3d vec3( 0.0 );\n\tvec3 multiScattering \x3d vec3( 0.0 );\n\tvec3 cosineWeightedIrradiance \x3d irradiance * RECIPROCAL_PI;\n\t#ifdef USE_IRIDESCENCE\n\t\tcomputeMultiscatteringIridescence( geometryNormal, geometryViewDir, material.specularColor, material.specularF90, material.iridescence, material.iridescenceFresnel, material.roughness, singleScattering, multiScattering );\n\t#else\n\t\tcomputeMultiscattering( geometryNormal, geometryViewDir, material.specularColor, material.specularF90, material.roughness, singleScattering, multiScattering );\n\t#endif\n\tvec3 totalScattering \x3d singleScattering + multiScattering;\n\tvec3 diffuse \x3d material.diffuseColor * ( 1.0 - max( max( totalScattering.r, totalScattering.g ), totalScattering.b ) );\n\treflectedLight.indirectSpecular +\x3d radiance * singleScattering;\n\treflectedLight.indirectSpecular +\x3d multiScattering * cosineWeightedIrradiance;\n\treflectedLight.indirectDiffuse +\x3d diffuse * cosineWeightedIrradiance;\n}\n#define RE_Direct\t\t\t\tRE_Direct_Physical\n#define RE_Direct_RectArea\t\tRE_Direct_RectArea_Physical\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_Physical\n#define RE_IndirectSpecular\t\tRE_IndirectSpecular_Physical\nfloat computeSpecularOcclusion( const in float dotNV, const in float ambientOcclusion, const in float roughness ) {\n\treturn saturate( pow( dotNV + ambientOcclusion, exp2( - 16.0 * roughness - 1.0 ) ) - 1.0 + ambientOcclusion );\n}",
lights_fragment_begin:"\nvec3 geometryPosition \x3d - vViewPosition;\nvec3 geometryNormal \x3d normal;\nvec3 geometryViewDir \x3d ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( vViewPosition );\nvec3 geometryClearcoatNormal \x3d vec3( 0.0 );\n#ifdef USE_CLEARCOAT\n\tgeometryClearcoatNormal \x3d clearcoatNormal;\n#endif\n#ifdef USE_IRIDESCENCE\n\tfloat dotNVi \x3d saturate( dot( normal, geometryViewDir ) );\n\tif ( material.iridescenceThickness \x3d\x3d 0.0 ) {\n\t\tmaterial.iridescence \x3d 0.0;\n\t} else {\n\t\tmaterial.iridescence \x3d saturate( material.iridescence );\n\t}\n\tif ( material.iridescence \x3e 0.0 ) {\n\t\tmaterial.iridescenceFresnel \x3d evalIridescence( 1.0, material.iridescenceIOR, dotNVi, material.iridescenceThickness, material.specularColor );\n\t\tmaterial.iridescenceF0 \x3d Schlick_to_F0( material.iridescenceFresnel, 1.0, dotNVi );\n\t}\n#endif\nIncidentLight directLight;\n#if ( NUM_POINT_LIGHTS \x3e 0 ) \x26\x26 defined( RE_Direct )\n\tPointLight pointLight;\n\t#if defined( USE_SHADOWMAP ) \x26\x26 NUM_POINT_LIGHT_SHADOWS \x3e 0\n\tPointLightShadow pointLightShadow;\n\t#endif\n\t#pragma unroll_loop_start\n\tfor ( int i \x3d 0; i \x3c NUM_POINT_LIGHTS; i ++ ) {\n\t\tpointLight \x3d pointLights[ i ];\n\t\tgetPointLightInfo( pointLight, geometryPosition, directLight );\n\t\t#if defined( USE_SHADOWMAP ) \x26\x26 ( UNROLLED_LOOP_INDEX \x3c NUM_POINT_LIGHT_SHADOWS )\n\t\tpointLightShadow \x3d pointLightShadows[ i ];\n\t\tdirectLight.color *\x3d ( directLight.visible \x26\x26 receiveShadow ) ? getPointShadow( pointShadowMap[ i ], pointLightShadow.shadowMapSize, pointLightShadow.shadowBias, pointLightShadow.shadowRadius, vPointShadowCoord[ i ], pointLightShadow.shadowCameraNear, pointLightShadow.shadowCameraFar ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if ( NUM_SPOT_LIGHTS \x3e 0 ) \x26\x26 defined( RE_Direct )\n\tSpotLight spotLight;\n\tvec4 spotColor;\n\tvec3 spotLightCoord;\n\tbool inSpotLightMap;\n\t#if defined( USE_SHADOWMAP ) \x26\x26 NUM_SPOT_LIGHT_SHADOWS \x3e 0\n\tSpotLightShadow spotLightShadow;\n\t#endif\n\t#pragma unroll_loop_start\n\tfor ( int i \x3d 0; i \x3c NUM_SPOT_LIGHTS; i ++ ) {\n\t\tspotLight \x3d spotLights[ i ];\n\t\tgetSpotLightInfo( spotLight, geometryPosition, directLight );\n\t\t#if ( UNROLLED_LOOP_INDEX \x3c NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS )\n\t\t#define SPOT_LIGHT_MAP_INDEX UNROLLED_LOOP_INDEX\n\t\t#elif ( UNROLLED_LOOP_INDEX \x3c NUM_SPOT_LIGHT_SHADOWS )\n\t\t#define SPOT_LIGHT_MAP_INDEX NUM_SPOT_LIGHT_MAPS\n\t\t#else\n\t\t#define SPOT_LIGHT_MAP_INDEX ( UNROLLED_LOOP_INDEX - NUM_SPOT_LIGHT_SHADOWS + NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS )\n\t\t#endif\n\t\t#if ( SPOT_LIGHT_MAP_INDEX \x3c NUM_SPOT_LIGHT_MAPS )\n\t\t\tspotLightCoord \x3d vSpotLightCoord[ i ].xyz / vSpotLightCoord[ i ].w;\n\t\t\tinSpotLightMap \x3d all( lessThan( abs( spotLightCoord * 2. - 1. ), vec3( 1.0 ) ) );\n\t\t\tspotColor \x3d texture2D( spotLightMap[ SPOT_LIGHT_MAP_INDEX ], spotLightCoord.xy );\n\t\t\tdirectLight.color \x3d inSpotLightMap ? directLight.color * spotColor.rgb : directLight.color;\n\t\t#endif\n\t\t#undef SPOT_LIGHT_MAP_INDEX\n\t\t#if defined( USE_SHADOWMAP ) \x26\x26 ( UNROLLED_LOOP_INDEX \x3c NUM_SPOT_LIGHT_SHADOWS )\n\t\tspotLightShadow \x3d spotLightShadows[ i ];\n\t\tdirectLight.color *\x3d ( directLight.visible \x26\x26 receiveShadow ) ? getShadow( spotShadowMap[ i ], spotLightShadow.shadowMapSize, spotLightShadow.shadowBias, spotLightShadow.shadowRadius, vSpotLightCoord[ i ] ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if ( NUM_DIR_LIGHTS \x3e 0 ) \x26\x26 defined( RE_Direct )\n\tDirectionalLight directionalLight;\n\t#if defined( USE_SHADOWMAP ) \x26\x26 NUM_DIR_LIGHT_SHADOWS \x3e 0\n\tDirectionalLightShadow directionalLightShadow;\n\t#endif\n\t#pragma unroll_loop_start\n\tfor ( int i \x3d 0; i \x3c NUM_DIR_LIGHTS; i ++ ) {\n\t\tdirectionalLight \x3d directionalLights[ i ];\n\t\tgetDirectionalLightInfo( directionalLight, directLight );\n\t\t#if defined( USE_SHADOWMAP ) \x26\x26 ( UNROLLED_LOOP_INDEX \x3c NUM_DIR_LIGHT_SHADOWS )\n\t\tdirectionalLightShadow \x3d directionalLightShadows[ i ];\n\t\tdirectLight.color *\x3d ( directLight.visible \x26\x26 receiveShadow ) ? getShadow( directionalShadowMap[ i ], directionalLightShadow.shadowMapSize, directionalLightShadow.shadowBias, directionalLightShadow.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if ( NUM_RECT_AREA_LIGHTS \x3e 0 ) \x26\x26 defined( RE_Direct_RectArea )\n\tRectAreaLight rectAreaLight;\n\t#pragma unroll_loop_start\n\tfor ( int i \x3d 0; i \x3c NUM_RECT_AREA_LIGHTS; i ++ ) {\n\t\trectAreaLight \x3d rectAreaLights[ i ];\n\t\tRE_Direct_RectArea( rectAreaLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if defined( RE_IndirectDiffuse )\n\tvec3 iblIrradiance \x3d vec3( 0.0 );\n\tvec3 irradiance \x3d getAmbientLightIrradiance( ambientLightColor );\n\t#if defined( USE_LIGHT_PROBES )\n\t\tirradiance +\x3d getLightProbeIrradiance( lightProbe, geometryNormal );\n\t#endif\n\t#if ( NUM_HEMI_LIGHTS \x3e 0 )\n\t\t#pragma unroll_loop_start\n\t\tfor ( int i \x3d 0; i \x3c NUM_HEMI_LIGHTS; i ++ ) {\n\t\t\tirradiance +\x3d getHemisphereLightIrradiance( hemisphereLights[ i ], geometryNormal );\n\t\t}\n\t\t#pragma unroll_loop_end\n\t#endif\n#endif\n#if defined( RE_IndirectSpecular )\n\tvec3 radiance \x3d vec3( 0.0 );\n\tvec3 clearcoatRadiance \x3d vec3( 0.0 );\n#endif",
lights_fragment_maps:"#if defined( RE_IndirectDiffuse )\n\t#ifdef USE_LIGHTMAP\n\t\tvec4 lightMapTexel \x3d texture2D( lightMap, vLightMapUv );\n\t\tvec3 lightMapIrradiance \x3d lightMapTexel.rgb * lightMapIntensity;\n\t\tirradiance +\x3d lightMapIrradiance;\n\t#endif\n\t#if defined( USE_ENVMAP ) \x26\x26 defined( STANDARD ) \x26\x26 defined( ENVMAP_TYPE_CUBE_UV )\n\t\tiblIrradiance +\x3d getIBLIrradiance( geometryNormal );\n\t#endif\n#endif\n#if defined( USE_ENVMAP ) \x26\x26 defined( RE_IndirectSpecular )\n\t#ifdef USE_ANISOTROPY\n\t\tradiance +\x3d getIBLAnisotropyRadiance( geometryViewDir, geometryNormal, material.roughness, material.anisotropyB, material.anisotropy );\n\t#else\n\t\tradiance +\x3d getIBLRadiance( geometryViewDir, geometryNormal, material.roughness );\n\t#endif\n\t#ifdef USE_CLEARCOAT\n\t\tclearcoatRadiance +\x3d getIBLRadiance( geometryViewDir, geometryClearcoatNormal, material.clearcoatRoughness );\n\t#endif\n#endif",
lights_fragment_end:"#if defined( RE_IndirectDiffuse )\n\tRE_IndirectDiffuse( irradiance, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );\n#endif\n#if defined( RE_IndirectSpecular )\n\tRE_IndirectSpecular( radiance, iblIrradiance, clearcoatRadiance, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );\n#endif",logdepthbuf_fragment:"#if defined( USE_LOGDEPTHBUF ) \x26\x26 defined( USE_LOGDEPTHBUF_EXT )\n\tgl_FragDepthEXT \x3d vIsPerspective \x3d\x3d 0.0 ? gl_FragCoord.z : log2( vFragDepth ) * logDepthBufFC * 0.5;\n#endif",
logdepthbuf_pars_fragment:"#if defined( USE_LOGDEPTHBUF ) \x26\x26 defined( USE_LOGDEPTHBUF_EXT )\n\tuniform float logDepthBufFC;\n\tvarying float vFragDepth;\n\tvarying float vIsPerspective;\n#endif",logdepthbuf_pars_vertex:"#ifdef USE_LOGDEPTHBUF\n\t#ifdef USE_LOGDEPTHBUF_EXT\n\t\tvarying float vFragDepth;\n\t\tvarying float vIsPerspective;\n\t#else\n\t\tuniform float logDepthBufFC;\n\t#endif\n#endif",logdepthbuf_vertex:"#ifdef USE_LOGDEPTHBUF\n\t#ifdef USE_LOGDEPTHBUF_EXT\n\t\tvFragDepth \x3d 1.0 + gl_Position.w;\n\t\tvIsPerspective \x3d float( isPerspectiveMatrix( projectionMatrix ) );\n\t#else\n\t\tif ( isPerspectiveMatrix( projectionMatrix ) ) {\n\t\t\tgl_Position.z \x3d log2( max( EPSILON, gl_Position.w + 1.0 ) ) * logDepthBufFC - 1.0;\n\t\t\tgl_Position.z *\x3d gl_Position.w;\n\t\t}\n\t#endif\n#endif",
map_fragment:"#ifdef USE_MAP\n\tvec4 sampledDiffuseColor \x3d texture2D( map, vMapUv );\n\t#ifdef DECODE_VIDEO_TEXTURE\n\t\tsampledDiffuseColor \x3d vec4( mix( pow( sampledDiffuseColor.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), sampledDiffuseColor.rgb * 0.0773993808, vec3( lessThanEqual( sampledDiffuseColor.rgb, vec3( 0.04045 ) ) ) ), sampledDiffuseColor.w );\n\t\n\t#endif\n\tdiffuseColor *\x3d sampledDiffuseColor;\n#endif",map_pars_fragment:"#ifdef USE_MAP\n\tuniform sampler2D map;\n#endif",
map_particle_fragment:"#if defined( USE_MAP ) || defined( USE_ALPHAMAP )\n\t#if defined( USE_POINTS_UV )\n\t\tvec2 uv \x3d vUv;\n\t#else\n\t\tvec2 uv \x3d ( uvTransform * vec3( gl_PointCoord.x, 1.0 - gl_PointCoord.y, 1 ) ).xy;\n\t#endif\n#endif\n#ifdef USE_MAP\n\tdiffuseColor *\x3d texture2D( map, uv );\n#endif\n#ifdef USE_ALPHAMAP\n\tdiffuseColor.a *\x3d texture2D( alphaMap, uv ).g;\n#endif",map_particle_pars_fragment:"#if defined( USE_POINTS_UV )\n\tvarying vec2 vUv;\n#else\n\t#if defined( USE_MAP ) || defined( USE_ALPHAMAP )\n\t\tuniform mat3 uvTransform;\n\t#endif\n#endif\n#ifdef USE_MAP\n\tuniform sampler2D map;\n#endif\n#ifdef USE_ALPHAMAP\n\tuniform sampler2D alphaMap;\n#endif",
metalnessmap_fragment:"float metalnessFactor \x3d metalness;\n#ifdef USE_METALNESSMAP\n\tvec4 texelMetalness \x3d texture2D( metalnessMap, vMetalnessMapUv );\n\tmetalnessFactor *\x3d texelMetalness.b;\n#endif",metalnessmap_pars_fragment:"#ifdef USE_METALNESSMAP\n\tuniform sampler2D metalnessMap;\n#endif",morphcolor_vertex:"#if defined( USE_MORPHCOLORS ) \x26\x26 defined( MORPHTARGETS_TEXTURE )\n\tvColor *\x3d morphTargetBaseInfluence;\n\tfor ( int i \x3d 0; i \x3c MORPHTARGETS_COUNT; i ++ ) {\n\t\t#if defined( USE_COLOR_ALPHA )\n\t\t\tif ( morphTargetInfluences[ i ] !\x3d 0.0 ) vColor +\x3d getMorph( gl_VertexID, i, 2 ) * morphTargetInfluences[ i ];\n\t\t#elif defined( USE_COLOR )\n\t\t\tif ( morphTargetInfluences[ i ] !\x3d 0.0 ) vColor +\x3d getMorph( gl_VertexID, i, 2 ).rgb * morphTargetInfluences[ i ];\n\t\t#endif\n\t}\n#endif",
morphnormal_vertex:"#ifdef USE_MORPHNORMALS\n\tobjectNormal *\x3d morphTargetBaseInfluence;\n\t#ifdef MORPHTARGETS_TEXTURE\n\t\tfor ( int i \x3d 0; i \x3c MORPHTARGETS_COUNT; i ++ ) {\n\t\t\tif ( morphTargetInfluences[ i ] !\x3d 0.0 ) objectNormal +\x3d getMorph( gl_VertexID, i, 1 ).xyz * morphTargetInfluences[ i ];\n\t\t}\n\t#else\n\t\tobjectNormal +\x3d morphNormal0 * morphTargetInfluences[ 0 ];\n\t\tobjectNormal +\x3d morphNormal1 * morphTargetInfluences[ 1 ];\n\t\tobjectNormal +\x3d morphNormal2 * morphTargetInfluences[ 2 ];\n\t\tobjectNormal +\x3d morphNormal3 * morphTargetInfluences[ 3 ];\n\t#endif\n#endif",
morphtarget_pars_vertex:"#ifdef USE_MORPHTARGETS\n\tuniform float morphTargetBaseInfluence;\n\t#ifdef MORPHTARGETS_TEXTURE\n\t\tuniform float morphTargetInfluences[ MORPHTARGETS_COUNT ];\n\t\tuniform sampler2DArray morphTargetsTexture;\n\t\tuniform ivec2 morphTargetsTextureSize;\n\t\tvec4 getMorph( const in int vertexIndex, const in int morphTargetIndex, const in int offset ) {\n\t\t\tint texelIndex \x3d vertexIndex * MORPHTARGETS_TEXTURE_STRIDE + offset;\n\t\t\tint y \x3d texelIndex / morphTargetsTextureSize.x;\n\t\t\tint x \x3d texelIndex - y * morphTargetsTextureSize.x;\n\t\t\tivec3 morphUV \x3d ivec3( x, y, morphTargetIndex );\n\t\t\treturn texelFetch( morphTargetsTexture, morphUV, 0 );\n\t\t}\n\t#else\n\t\t#ifndef USE_MORPHNORMALS\n\t\t\tuniform float morphTargetInfluences[ 8 ];\n\t\t#else\n\t\t\tuniform float morphTargetInfluences[ 4 ];\n\t\t#endif\n\t#endif\n#endif",
morphtarget_vertex:"#ifdef USE_MORPHTARGETS\n\ttransformed *\x3d morphTargetBaseInfluence;\n\t#ifdef MORPHTARGETS_TEXTURE\n\t\tfor ( int i \x3d 0; i \x3c MORPHTARGETS_COUNT; i ++ ) {\n\t\t\tif ( morphTargetInfluences[ i ] !\x3d 0.0 ) transformed +\x3d getMorph( gl_VertexID, i, 0 ).xyz * morphTargetInfluences[ i ];\n\t\t}\n\t#else\n\t\ttransformed +\x3d morphTarget0 * morphTargetInfluences[ 0 ];\n\t\ttransformed +\x3d morphTarget1 * morphTargetInfluences[ 1 ];\n\t\ttransformed +\x3d morphTarget2 * morphTargetInfluences[ 2 ];\n\t\ttransformed +\x3d morphTarget3 * morphTargetInfluences[ 3 ];\n\t\t#ifndef USE_MORPHNORMALS\n\t\t\ttransformed +\x3d morphTarget4 * morphTargetInfluences[ 4 ];\n\t\t\ttransformed +\x3d morphTarget5 * morphTargetInfluences[ 5 ];\n\t\t\ttransformed +\x3d morphTarget6 * morphTargetInfluences[ 6 ];\n\t\t\ttransformed +\x3d morphTarget7 * morphTargetInfluences[ 7 ];\n\t\t#endif\n\t#endif\n#endif",
normal_fragment_begin:"float faceDirection \x3d gl_FrontFacing ? 1.0 : - 1.0;\n#ifdef FLAT_SHADED\n\tvec3 fdx \x3d dFdx( vViewPosition );\n\tvec3 fdy \x3d dFdy( vViewPosition );\n\tvec3 normal \x3d normalize( cross( fdx, fdy ) );\n#else\n\tvec3 normal \x3d normalize( vNormal );\n\t#ifdef DOUBLE_SIDED\n\t\tnormal *\x3d faceDirection;\n\t#endif\n#endif\n#if defined( USE_NORMALMAP_TANGENTSPACE ) || defined( USE_CLEARCOAT_NORMALMAP ) || defined( USE_ANISOTROPY )\n\t#ifdef USE_TANGENT\n\t\tmat3 tbn \x3d mat3( normalize( vTangent ), normalize( vBitangent ), normal );\n\t#else\n\t\tmat3 tbn \x3d getTangentFrame( - vViewPosition, normal,\n\t\t#if defined( USE_NORMALMAP )\n\t\t\tvNormalMapUv\n\t\t#elif defined( USE_CLEARCOAT_NORMALMAP )\n\t\t\tvClearcoatNormalMapUv\n\t\t#else\n\t\t\tvUv\n\t\t#endif\n\t\t);\n\t#endif\n\t#if defined( DOUBLE_SIDED ) \x26\x26 ! defined( FLAT_SHADED )\n\t\ttbn[0] *\x3d faceDirection;\n\t\ttbn[1] *\x3d faceDirection;\n\t#endif\n#endif\n#ifdef USE_CLEARCOAT_NORMALMAP\n\t#ifdef USE_TANGENT\n\t\tmat3 tbn2 \x3d mat3( normalize( vTangent ), normalize( vBitangent ), normal );\n\t#else\n\t\tmat3 tbn2 \x3d getTangentFrame( - vViewPosition, normal, vClearcoatNormalMapUv );\n\t#endif\n\t#if defined( DOUBLE_SIDED ) \x26\x26 ! defined( FLAT_SHADED )\n\t\ttbn2[0] *\x3d faceDirection;\n\t\ttbn2[1] *\x3d faceDirection;\n\t#endif\n#endif\nvec3 nonPerturbedNormal \x3d normal;",
normal_fragment_maps:"#ifdef USE_NORMALMAP_OBJECTSPACE\n\tnormal \x3d texture2D( normalMap, vNormalMapUv ).xyz * 2.0 - 1.0;\n\t#ifdef FLIP_SIDED\n\t\tnormal \x3d - normal;\n\t#endif\n\t#ifdef DOUBLE_SIDED\n\t\tnormal \x3d normal * faceDirection;\n\t#endif\n\tnormal \x3d normalize( normalMatrix * normal );\n#elif defined( USE_NORMALMAP_TANGENTSPACE )\n\tvec3 mapN \x3d texture2D( normalMap, vNormalMapUv ).xyz * 2.0 - 1.0;\n\tmapN.xy *\x3d normalScale;\n\tnormal \x3d normalize( tbn * mapN );\n#elif defined( USE_BUMPMAP )\n\tnormal \x3d perturbNormalArb( - vViewPosition, normal, dHdxy_fwd(), faceDirection );\n#endif",
normal_pars_fragment:"#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n\t#ifdef USE_TANGENT\n\t\tvarying vec3 vTangent;\n\t\tvarying vec3 vBitangent;\n\t#endif\n#endif",normal_pars_vertex:"#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n\t#ifdef USE_TANGENT\n\t\tvarying vec3 vTangent;\n\t\tvarying vec3 vBitangent;\n\t#endif\n#endif",normal_vertex:"#ifndef FLAT_SHADED\n\tvNormal \x3d normalize( transformedNormal );\n\t#ifdef USE_TANGENT\n\t\tvTangent \x3d normalize( transformedTangent );\n\t\tvBitangent \x3d normalize( cross( vNormal, vTangent ) * tangent.w );\n\t#endif\n#endif",
normalmap_pars_fragment:"#ifdef USE_NORMALMAP\n\tuniform sampler2D normalMap;\n\tuniform vec2 normalScale;\n#endif\n#ifdef USE_NORMALMAP_OBJECTSPACE\n\tuniform mat3 normalMatrix;\n#endif\n#if ! defined ( USE_TANGENT ) \x26\x26 ( defined ( USE_NORMALMAP_TANGENTSPACE ) || defined ( USE_CLEARCOAT_NORMALMAP ) || defined( USE_ANISOTROPY ) )\n\tmat3 getTangentFrame( vec3 eye_pos, vec3 surf_norm, vec2 uv ) {\n\t\tvec3 q0 \x3d dFdx( eye_pos.xyz );\n\t\tvec3 q1 \x3d dFdy( eye_pos.xyz );\n\t\tvec2 st0 \x3d dFdx( uv.st );\n\t\tvec2 st1 \x3d dFdy( uv.st );\n\t\tvec3 N \x3d surf_norm;\n\t\tvec3 q1perp \x3d cross( q1, N );\n\t\tvec3 q0perp \x3d cross( N, q0 );\n\t\tvec3 T \x3d q1perp * st0.x + q0perp * st1.x;\n\t\tvec3 B \x3d q1perp * st0.y + q0perp * st1.y;\n\t\tfloat det \x3d max( dot( T, T ), dot( B, B ) );\n\t\tfloat scale \x3d ( det \x3d\x3d 0.0 ) ? 0.0 : inversesqrt( det );\n\t\treturn mat3( T * scale, B * scale, N );\n\t}\n#endif",
clearcoat_normal_fragment_begin:"#ifdef USE_CLEARCOAT\n\tvec3 clearcoatNormal \x3d nonPerturbedNormal;\n#endif",clearcoat_normal_fragment_maps:"#ifdef USE_CLEARCOAT_NORMALMAP\n\tvec3 clearcoatMapN \x3d texture2D( clearcoatNormalMap, vClearcoatNormalMapUv ).xyz * 2.0 - 1.0;\n\tclearcoatMapN.xy *\x3d clearcoatNormalScale;\n\tclearcoatNormal \x3d normalize( tbn2 * clearcoatMapN );\n#endif",clearcoat_pars_fragment:"#ifdef USE_CLEARCOATMAP\n\tuniform sampler2D clearcoatMap;\n#endif\n#ifdef USE_CLEARCOAT_NORMALMAP\n\tuniform sampler2D clearcoatNormalMap;\n\tuniform vec2 clearcoatNormalScale;\n#endif\n#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n\tuniform sampler2D clearcoatRoughnessMap;\n#endif",
iridescence_pars_fragment:"#ifdef USE_IRIDESCENCEMAP\n\tuniform sampler2D iridescenceMap;\n#endif\n#ifdef USE_IRIDESCENCE_THICKNESSMAP\n\tuniform sampler2D iridescenceThicknessMap;\n#endif",opaque_fragment:"#ifdef OPAQUE\ndiffuseColor.a \x3d 1.0;\n#endif\n#ifdef USE_TRANSMISSION\ndiffuseColor.a *\x3d material.transmissionAlpha;\n#endif\ngl_FragColor \x3d vec4( outgoingLight, diffuseColor.a );",packing:"vec3 packNormalToRGB( const in vec3 normal ) {\n\treturn normalize( normal ) * 0.5 + 0.5;\n}\nvec3 unpackRGBToNormal( const in vec3 rgb ) {\n\treturn 2.0 * rgb.xyz - 1.0;\n}\nconst float PackUpscale \x3d 256. / 255.;const float UnpackDownscale \x3d 255. / 256.;\nconst vec3 PackFactors \x3d vec3( 256. * 256. * 256., 256. * 256., 256. );\nconst vec4 UnpackFactors \x3d UnpackDownscale / vec4( PackFactors, 1. );\nconst float ShiftRight8 \x3d 1. / 256.;\nvec4 packDepthToRGBA( const in float v ) {\n\tvec4 r \x3d vec4( fract( v * PackFactors ), v );\n\tr.yzw -\x3d r.xyz * ShiftRight8;\treturn r * PackUpscale;\n}\nfloat unpackRGBAToDepth( const in vec4 v ) {\n\treturn dot( v, UnpackFactors );\n}\nvec2 packDepthToRG( in highp float v ) {\n\treturn packDepthToRGBA( v ).yx;\n}\nfloat unpackRGToDepth( const in highp vec2 v ) {\n\treturn unpackRGBAToDepth( vec4( v.xy, 0.0, 0.0 ) );\n}\nvec4 pack2HalfToRGBA( vec2 v ) {\n\tvec4 r \x3d vec4( v.x, fract( v.x * 255.0 ), v.y, fract( v.y * 255.0 ) );\n\treturn vec4( r.x - r.y / 255.0, r.y, r.z - r.w / 255.0, r.w );\n}\nvec2 unpackRGBATo2Half( vec4 v ) {\n\treturn vec2( v.x + ( v.y / 255.0 ), v.z + ( v.w / 255.0 ) );\n}\nfloat viewZToOrthographicDepth( const in float viewZ, const in float near, const in float far ) {\n\treturn ( viewZ + near ) / ( near - far );\n}\nfloat orthographicDepthToViewZ( const in float depth, const in float near, const in float far ) {\n\treturn depth * ( near - far ) - near;\n}\nfloat viewZToPerspectiveDepth( const in float viewZ, const in float near, const in float far ) {\n\treturn ( ( near + viewZ ) * far ) / ( ( far - near ) * viewZ );\n}\nfloat perspectiveDepthToViewZ( const in float depth, const in float near, const in float far ) {\n\treturn ( near * far ) / ( ( far - near ) * depth - far );\n}",
premultiplied_alpha_fragment:"#ifdef PREMULTIPLIED_ALPHA\n\tgl_FragColor.rgb *\x3d gl_FragColor.a;\n#endif",project_vertex:"vec4 mvPosition \x3d vec4( transformed, 1.0 );\n#ifdef USE_INSTANCING\n\tmvPosition \x3d instanceMatrix * mvPosition;\n#endif\nmvPosition \x3d modelViewMatrix * mvPosition;\ngl_Position \x3d projectionMatrix * mvPosition;",dithering_fragment:"#ifdef DITHERING\n\tgl_FragColor.rgb \x3d dithering( gl_FragColor.rgb );\n#endif",dithering_pars_fragment:"#ifdef DITHERING\n\tvec3 dithering( vec3 color ) {\n\t\tfloat grid_position \x3d rand( gl_FragCoord.xy );\n\t\tvec3 dither_shift_RGB \x3d vec3( 0.25 / 255.0, -0.25 / 255.0, 0.25 / 255.0 );\n\t\tdither_shift_RGB \x3d mix( 2.0 * dither_shift_RGB, -2.0 * dither_shift_RGB, grid_position );\n\t\treturn color + dither_shift_RGB;\n\t}\n#endif",
roughnessmap_fragment:"float roughnessFactor \x3d roughness;\n#ifdef USE_ROUGHNESSMAP\n\tvec4 texelRoughness \x3d texture2D( roughnessMap, vRoughnessMapUv );\n\troughnessFactor *\x3d texelRoughness.g;\n#endif",roughnessmap_pars_fragment:"#ifdef USE_ROUGHNESSMAP\n\tuniform sampler2D roughnessMap;\n#endif",shadowmap_pars_fragment:"#if NUM_SPOT_LIGHT_COORDS \x3e 0\n\tvarying vec4 vSpotLightCoord[ NUM_SPOT_LIGHT_COORDS ];\n#endif\n#if NUM_SPOT_LIGHT_MAPS \x3e 0\n\tuniform sampler2D spotLightMap[ NUM_SPOT_LIGHT_MAPS ];\n#endif\n#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS \x3e 0\n\t\tuniform sampler2D directionalShadowMap[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tvarying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tstruct DirectionalLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS \x3e 0\n\t\tuniform sampler2D spotShadowMap[ NUM_SPOT_LIGHT_SHADOWS ];\n\t\tstruct SpotLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS \x3e 0\n\t\tuniform sampler2D pointShadowMap[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tstruct PointLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t\tfloat shadowCameraNear;\n\t\t\tfloat shadowCameraFar;\n\t\t};\n\t\tuniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];\n\t#endif\n\tfloat texture2DCompare( sampler2D depths, vec2 uv, float compare ) {\n\t\treturn step( compare, unpackRGBAToDepth( texture2D( depths, uv ) ) );\n\t}\n\tvec2 texture2DDistribution( sampler2D shadow, vec2 uv ) {\n\t\treturn unpackRGBATo2Half( texture2D( shadow, uv ) );\n\t}\n\tfloat VSMShadow (sampler2D shadow, vec2 uv, float compare ){\n\t\tfloat occlusion \x3d 1.0;\n\t\tvec2 distribution \x3d texture2DDistribution( shadow, uv );\n\t\tfloat hard_shadow \x3d step( compare , distribution.x );\n\t\tif (hard_shadow !\x3d 1.0 ) {\n\t\t\tfloat distance \x3d compare - distribution.x ;\n\t\t\tfloat variance \x3d max( 0.00000, distribution.y * distribution.y );\n\t\t\tfloat softness_probability \x3d variance / (variance + distance * distance );\t\t\tsoftness_probability \x3d clamp( ( softness_probability - 0.3 ) / ( 0.95 - 0.3 ), 0.0, 1.0 );\t\t\tocclusion \x3d clamp( max( hard_shadow, softness_probability ), 0.0, 1.0 );\n\t\t}\n\t\treturn occlusion;\n\t}\n\tfloat getShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord ) {\n\t\tfloat shadow \x3d 1.0;\n\t\tshadowCoord.xyz /\x3d shadowCoord.w;\n\t\tshadowCoord.z +\x3d shadowBias;\n\t\tbool inFrustum \x3d shadowCoord.x \x3e\x3d 0.0 \x26\x26 shadowCoord.x \x3c\x3d 1.0 \x26\x26 shadowCoord.y \x3e\x3d 0.0 \x26\x26 shadowCoord.y \x3c\x3d 1.0;\n\t\tbool frustumTest \x3d inFrustum \x26\x26 shadowCoord.z \x3c\x3d 1.0;\n\t\tif ( frustumTest ) {\n\t\t#if defined( SHADOWMAP_TYPE_PCF )\n\t\t\tvec2 texelSize \x3d vec2( 1.0 ) / shadowMapSize;\n\t\t\tfloat dx0 \x3d - texelSize.x * shadowRadius;\n\t\t\tfloat dy0 \x3d - texelSize.y * shadowRadius;\n\t\t\tfloat dx1 \x3d + texelSize.x * shadowRadius;\n\t\t\tfloat dy1 \x3d + texelSize.y * shadowRadius;\n\t\t\tfloat dx2 \x3d dx0 / 2.0;\n\t\t\tfloat dy2 \x3d dy0 / 2.0;\n\t\t\tfloat dx3 \x3d dx1 / 2.0;\n\t\t\tfloat dy3 \x3d dy1 / 2.0;\n\t\t\tshadow \x3d (\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy2 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy2 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy2 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy3 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy3 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy3 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy1 ), shadowCoord.z )\n\t\t\t) * ( 1.0 / 17.0 );\n\t\t#elif defined( SHADOWMAP_TYPE_PCF_SOFT )\n\t\t\tvec2 texelSize \x3d vec2( 1.0 ) / shadowMapSize;\n\t\t\tfloat dx \x3d texelSize.x;\n\t\t\tfloat dy \x3d texelSize.y;\n\t\t\tvec2 uv \x3d shadowCoord.xy;\n\t\t\tvec2 f \x3d fract( uv * shadowMapSize + 0.5 );\n\t\t\tuv -\x3d f * texelSize;\n\t\t\tshadow \x3d (\n\t\t\t\ttexture2DCompare( shadowMap, uv, shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, uv + vec2( dx, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, uv + vec2( 0.0, dy ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, uv + texelSize, shadowCoord.z ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( -dx, 0.0 ), shadowCoord.z ),\n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 0.0 ), shadowCoord.z ),\n\t\t\t\t\t f.x ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( -dx, dy ), shadowCoord.z ),\n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, dy ), shadowCoord.z ),\n\t\t\t\t\t f.x ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( 0.0, -dy ), shadowCoord.z ),\n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( 0.0, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t f.y ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( dx, -dy ), shadowCoord.z ),\n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( dx, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t f.y ) +\n\t\t\t\tmix( mix( texture2DCompare( shadowMap, uv + vec2( -dx, -dy ), shadowCoord.z ),\n\t\t\t\t\t\t  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, -dy ), shadowCoord.z ),\n\t\t\t\t\t\t  f.x ),\n\t\t\t\t\t mix( texture2DCompare( shadowMap, uv + vec2( -dx, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t\t  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t\t  f.x ),\n\t\t\t\t\t f.y )\n\t\t\t) * ( 1.0 / 9.0 );\n\t\t#elif defined( SHADOWMAP_TYPE_VSM )\n\t\t\tshadow \x3d VSMShadow( shadowMap, shadowCoord.xy, shadowCoord.z );\n\t\t#else\n\t\t\tshadow \x3d texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z );\n\t\t#endif\n\t\t}\n\t\treturn shadow;\n\t}\n\tvec2 cubeToUV( vec3 v, float texelSizeY ) {\n\t\tvec3 absV \x3d abs( v );\n\t\tfloat scaleToCube \x3d 1.0 / max( absV.x, max( absV.y, absV.z ) );\n\t\tabsV *\x3d scaleToCube;\n\t\tv *\x3d scaleToCube * ( 1.0 - 2.0 * texelSizeY );\n\t\tvec2 planar \x3d v.xy;\n\t\tfloat almostATexel \x3d 1.5 * texelSizeY;\n\t\tfloat almostOne \x3d 1.0 - almostATexel;\n\t\tif ( absV.z \x3e\x3d almostOne ) {\n\t\t\tif ( v.z \x3e 0.0 )\n\t\t\t\tplanar.x \x3d 4.0 - v.x;\n\t\t} else if ( absV.x \x3e\x3d almostOne ) {\n\t\t\tfloat signX \x3d sign( v.x );\n\t\t\tplanar.x \x3d v.z * signX + 2.0 * signX;\n\t\t} else if ( absV.y \x3e\x3d almostOne ) {\n\t\t\tfloat signY \x3d sign( v.y );\n\t\t\tplanar.x \x3d v.x + 2.0 * signY + 2.0;\n\t\t\tplanar.y \x3d v.z * signY - 2.0;\n\t\t}\n\t\treturn vec2( 0.125, 0.25 ) * planar + vec2( 0.375, 0.75 );\n\t}\n\tfloat getPointShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord, float shadowCameraNear, float shadowCameraFar ) {\n\t\tvec2 texelSize \x3d vec2( 1.0 ) / ( shadowMapSize * vec2( 4.0, 2.0 ) );\n\t\tvec3 lightToPosition \x3d shadowCoord.xyz;\n\t\tfloat dp \x3d ( length( lightToPosition ) - shadowCameraNear ) / ( shadowCameraFar - shadowCameraNear );\t\tdp +\x3d shadowBias;\n\t\tvec3 bd3D \x3d normalize( lightToPosition );\n\t\t#if defined( SHADOWMAP_TYPE_PCF ) || defined( SHADOWMAP_TYPE_PCF_SOFT ) || defined( SHADOWMAP_TYPE_VSM )\n\t\t\tvec2 offset \x3d vec2( - 1, 1 ) * shadowRadius * texelSize.y;\n\t\t\treturn (\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxx, texelSize.y ), dp )\n\t\t\t) * ( 1.0 / 9.0 );\n\t\t#else\n\t\t\treturn texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp );\n\t\t#endif\n\t}\n#endif",
shadowmap_pars_vertex:"#if NUM_SPOT_LIGHT_COORDS \x3e 0\n\tuniform mat4 spotLightMatrix[ NUM_SPOT_LIGHT_COORDS ];\n\tvarying vec4 vSpotLightCoord[ NUM_SPOT_LIGHT_COORDS ];\n#endif\n#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS \x3e 0\n\t\tuniform mat4 directionalShadowMatrix[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tvarying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tstruct DirectionalLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS \x3e 0\n\t\tstruct SpotLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS \x3e 0\n\t\tuniform mat4 pointShadowMatrix[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tstruct PointLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t\tfloat shadowCameraNear;\n\t\t\tfloat shadowCameraFar;\n\t\t};\n\t\tuniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];\n\t#endif\n#endif",
shadowmap_vertex:"#if ( defined( USE_SHADOWMAP ) \x26\x26 ( NUM_DIR_LIGHT_SHADOWS \x3e 0 || NUM_POINT_LIGHT_SHADOWS \x3e 0 ) ) || ( NUM_SPOT_LIGHT_COORDS \x3e 0 )\n\tvec3 shadowWorldNormal \x3d inverseTransformDirection( transformedNormal, viewMatrix );\n\tvec4 shadowWorldPosition;\n#endif\n#if defined( USE_SHADOWMAP )\n\t#if NUM_DIR_LIGHT_SHADOWS \x3e 0\n\t\t#pragma unroll_loop_start\n\t\tfor ( int i \x3d 0; i \x3c NUM_DIR_LIGHT_SHADOWS; i ++ ) {\n\t\t\tshadowWorldPosition \x3d worldPosition + vec4( shadowWorldNormal * directionalLightShadows[ i ].shadowNormalBias, 0 );\n\t\t\tvDirectionalShadowCoord[ i ] \x3d directionalShadowMatrix[ i ] * shadowWorldPosition;\n\t\t}\n\t\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS \x3e 0\n\t\t#pragma unroll_loop_start\n\t\tfor ( int i \x3d 0; i \x3c NUM_POINT_LIGHT_SHADOWS; i ++ ) {\n\t\t\tshadowWorldPosition \x3d worldPosition + vec4( shadowWorldNormal * pointLightShadows[ i ].shadowNormalBias, 0 );\n\t\t\tvPointShadowCoord[ i ] \x3d pointShadowMatrix[ i ] * shadowWorldPosition;\n\t\t}\n\t\t#pragma unroll_loop_end\n\t#endif\n#endif\n#if NUM_SPOT_LIGHT_COORDS \x3e 0\n\t#pragma unroll_loop_start\n\tfor ( int i \x3d 0; i \x3c NUM_SPOT_LIGHT_COORDS; i ++ ) {\n\t\tshadowWorldPosition \x3d worldPosition;\n\t\t#if ( defined( USE_SHADOWMAP ) \x26\x26 UNROLLED_LOOP_INDEX \x3c NUM_SPOT_LIGHT_SHADOWS )\n\t\t\tshadowWorldPosition.xyz +\x3d shadowWorldNormal * spotLightShadows[ i ].shadowNormalBias;\n\t\t#endif\n\t\tvSpotLightCoord[ i ] \x3d spotLightMatrix[ i ] * shadowWorldPosition;\n\t}\n\t#pragma unroll_loop_end\n#endif",
shadowmask_pars_fragment:"float getShadowMask() {\n\tfloat shadow \x3d 1.0;\n\t#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS \x3e 0\n\tDirectionalLightShadow directionalLight;\n\t#pragma unroll_loop_start\n\tfor ( int i \x3d 0; i \x3c NUM_DIR_LIGHT_SHADOWS; i ++ ) {\n\t\tdirectionalLight \x3d directionalLightShadows[ i ];\n\t\tshadow *\x3d receiveShadow ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS \x3e 0\n\tSpotLightShadow spotLight;\n\t#pragma unroll_loop_start\n\tfor ( int i \x3d 0; i \x3c NUM_SPOT_LIGHT_SHADOWS; i ++ ) {\n\t\tspotLight \x3d spotLightShadows[ i ];\n\t\tshadow *\x3d receiveShadow ? getShadow( spotShadowMap[ i ], spotLight.shadowMapSize, spotLight.shadowBias, spotLight.shadowRadius, vSpotLightCoord[ i ] ) : 1.0;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS \x3e 0\n\tPointLightShadow pointLight;\n\t#pragma unroll_loop_start\n\tfor ( int i \x3d 0; i \x3c NUM_POINT_LIGHT_SHADOWS; i ++ ) {\n\t\tpointLight \x3d pointLightShadows[ i ];\n\t\tshadow *\x3d receiveShadow ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ], pointLight.shadowCameraNear, pointLight.shadowCameraFar ) : 1.0;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#endif\n\treturn shadow;\n}",
skinbase_vertex:"#ifdef USE_SKINNING\n\tmat4 boneMatX \x3d getBoneMatrix( skinIndex.x );\n\tmat4 boneMatY \x3d getBoneMatrix( skinIndex.y );\n\tmat4 boneMatZ \x3d getBoneMatrix( skinIndex.z );\n\tmat4 boneMatW \x3d getBoneMatrix( skinIndex.w );\n#endif",skinning_pars_vertex:"#ifdef USE_SKINNING\n\tuniform mat4 bindMatrix;\n\tuniform mat4 bindMatrixInverse;\n\tuniform highp sampler2D boneTexture;\n\tuniform int boneTextureSize;\n\tmat4 getBoneMatrix( const in float i ) {\n\t\tfloat j \x3d i * 4.0;\n\t\tfloat x \x3d mod( j, float( boneTextureSize ) );\n\t\tfloat y \x3d floor( j / float( boneTextureSize ) );\n\t\tfloat dx \x3d 1.0 / float( boneTextureSize );\n\t\tfloat dy \x3d 1.0 / float( boneTextureSize );\n\t\ty \x3d dy * ( y + 0.5 );\n\t\tvec4 v1 \x3d texture2D( boneTexture, vec2( dx * ( x + 0.5 ), y ) );\n\t\tvec4 v2 \x3d texture2D( boneTexture, vec2( dx * ( x + 1.5 ), y ) );\n\t\tvec4 v3 \x3d texture2D( boneTexture, vec2( dx * ( x + 2.5 ), y ) );\n\t\tvec4 v4 \x3d texture2D( boneTexture, vec2( dx * ( x + 3.5 ), y ) );\n\t\tmat4 bone \x3d mat4( v1, v2, v3, v4 );\n\t\treturn bone;\n\t}\n#endif",
skinning_vertex:"#ifdef USE_SKINNING\n\tvec4 skinVertex \x3d bindMatrix * vec4( transformed, 1.0 );\n\tvec4 skinned \x3d vec4( 0.0 );\n\tskinned +\x3d boneMatX * skinVertex * skinWeight.x;\n\tskinned +\x3d boneMatY * skinVertex * skinWeight.y;\n\tskinned +\x3d boneMatZ * skinVertex * skinWeight.z;\n\tskinned +\x3d boneMatW * skinVertex * skinWeight.w;\n\ttransformed \x3d ( bindMatrixInverse * skinned ).xyz;\n#endif",skinnormal_vertex:"#ifdef USE_SKINNING\n\tmat4 skinMatrix \x3d mat4( 0.0 );\n\tskinMatrix +\x3d skinWeight.x * boneMatX;\n\tskinMatrix +\x3d skinWeight.y * boneMatY;\n\tskinMatrix +\x3d skinWeight.z * boneMatZ;\n\tskinMatrix +\x3d skinWeight.w * boneMatW;\n\tskinMatrix \x3d bindMatrixInverse * skinMatrix * bindMatrix;\n\tobjectNormal \x3d vec4( skinMatrix * vec4( objectNormal, 0.0 ) ).xyz;\n\t#ifdef USE_TANGENT\n\t\tobjectTangent \x3d vec4( skinMatrix * vec4( objectTangent, 0.0 ) ).xyz;\n\t#endif\n#endif",
specularmap_fragment:"float specularStrength;\n#ifdef USE_SPECULARMAP\n\tvec4 texelSpecular \x3d texture2D( specularMap, vSpecularMapUv );\n\tspecularStrength \x3d texelSpecular.r;\n#else\n\tspecularStrength \x3d 1.0;\n#endif",specularmap_pars_fragment:"#ifdef USE_SPECULARMAP\n\tuniform sampler2D specularMap;\n#endif",tonemapping_fragment:"#if defined( TONE_MAPPING )\n\tgl_FragColor.rgb \x3d toneMapping( gl_FragColor.rgb );\n#endif",tonemapping_pars_fragment:"#ifndef saturate\n#define saturate( a ) clamp( a, 0.0, 1.0 )\n#endif\nuniform float toneMappingExposure;\nvec3 LinearToneMapping( vec3 color ) {\n\treturn saturate( toneMappingExposure * color );\n}\nvec3 ReinhardToneMapping( vec3 color ) {\n\tcolor *\x3d toneMappingExposure;\n\treturn saturate( color / ( vec3( 1.0 ) + color ) );\n}\nvec3 OptimizedCineonToneMapping( vec3 color ) {\n\tcolor *\x3d toneMappingExposure;\n\tcolor \x3d max( vec3( 0.0 ), color - 0.004 );\n\treturn pow( ( color * ( 6.2 * color + 0.5 ) ) / ( color * ( 6.2 * color + 1.7 ) + 0.06 ), vec3( 2.2 ) );\n}\nvec3 RRTAndODTFit( vec3 v ) {\n\tvec3 a \x3d v * ( v + 0.0245786 ) - 0.000090537;\n\tvec3 b \x3d v * ( 0.983729 * v + 0.4329510 ) + 0.238081;\n\treturn a / b;\n}\nvec3 ACESFilmicToneMapping( vec3 color ) {\n\tconst mat3 ACESInputMat \x3d mat3(\n\t\tvec3( 0.59719, 0.07600, 0.02840 ),\t\tvec3( 0.35458, 0.90834, 0.13383 ),\n\t\tvec3( 0.04823, 0.01566, 0.83777 )\n\t);\n\tconst mat3 ACESOutputMat \x3d mat3(\n\t\tvec3(  1.60475, -0.10208, -0.00327 ),\t\tvec3( -0.53108,  1.10813, -0.07276 ),\n\t\tvec3( -0.07367, -0.00605,  1.07602 )\n\t);\n\tcolor *\x3d toneMappingExposure / 0.6;\n\tcolor \x3d ACESInputMat * color;\n\tcolor \x3d RRTAndODTFit( color );\n\tcolor \x3d ACESOutputMat * color;\n\treturn saturate( color );\n}\nvec3 CustomToneMapping( vec3 color ) { return color; }",
transmission_fragment:"#ifdef USE_TRANSMISSION\n\tmaterial.transmission \x3d transmission;\n\tmaterial.transmissionAlpha \x3d 1.0;\n\tmaterial.thickness \x3d thickness;\n\tmaterial.attenuationDistance \x3d attenuationDistance;\n\tmaterial.attenuationColor \x3d attenuationColor;\n\t#ifdef USE_TRANSMISSIONMAP\n\t\tmaterial.transmission *\x3d texture2D( transmissionMap, vTransmissionMapUv ).r;\n\t#endif\n\t#ifdef USE_THICKNESSMAP\n\t\tmaterial.thickness *\x3d texture2D( thicknessMap, vThicknessMapUv ).g;\n\t#endif\n\tvec3 pos \x3d vWorldPosition;\n\tvec3 v \x3d normalize( cameraPosition - pos );\n\tvec3 n \x3d inverseTransformDirection( normal, viewMatrix );\n\tvec4 transmitted \x3d getIBLVolumeRefraction(\n\t\tn, v, material.roughness, material.diffuseColor, material.specularColor, material.specularF90,\n\t\tpos, modelMatrix, viewMatrix, projectionMatrix, material.ior, material.thickness,\n\t\tmaterial.attenuationColor, material.attenuationDistance );\n\tmaterial.transmissionAlpha \x3d mix( material.transmissionAlpha, transmitted.a, material.transmission );\n\ttotalDiffuse \x3d mix( totalDiffuse, transmitted.rgb, material.transmission );\n#endif",
transmission_pars_fragment:"#ifdef USE_TRANSMISSION\n\tuniform float transmission;\n\tuniform float thickness;\n\tuniform float attenuationDistance;\n\tuniform vec3 attenuationColor;\n\t#ifdef USE_TRANSMISSIONMAP\n\t\tuniform sampler2D transmissionMap;\n\t#endif\n\t#ifdef USE_THICKNESSMAP\n\t\tuniform sampler2D thicknessMap;\n\t#endif\n\tuniform vec2 transmissionSamplerSize;\n\tuniform sampler2D transmissionSamplerMap;\n\tuniform mat4 modelMatrix;\n\tuniform mat4 projectionMatrix;\n\tvarying vec3 vWorldPosition;\n\tfloat w0( float a ) {\n\t\treturn ( 1.0 / 6.0 ) * ( a * ( a * ( - a + 3.0 ) - 3.0 ) + 1.0 );\n\t}\n\tfloat w1( float a ) {\n\t\treturn ( 1.0 / 6.0 ) * ( a *  a * ( 3.0 * a - 6.0 ) + 4.0 );\n\t}\n\tfloat w2( float a ){\n\t\treturn ( 1.0 / 6.0 ) * ( a * ( a * ( - 3.0 * a + 3.0 ) + 3.0 ) + 1.0 );\n\t}\n\tfloat w3( float a ) {\n\t\treturn ( 1.0 / 6.0 ) * ( a * a * a );\n\t}\n\tfloat g0( float a ) {\n\t\treturn w0( a ) + w1( a );\n\t}\n\tfloat g1( float a ) {\n\t\treturn w2( a ) + w3( a );\n\t}\n\tfloat h0( float a ) {\n\t\treturn - 1.0 + w1( a ) / ( w0( a ) + w1( a ) );\n\t}\n\tfloat h1( float a ) {\n\t\treturn 1.0 + w3( a ) / ( w2( a ) + w3( a ) );\n\t}\n\tvec4 bicubic( sampler2D tex, vec2 uv, vec4 texelSize, float lod ) {\n\t\tuv \x3d uv * texelSize.zw + 0.5;\n\t\tvec2 iuv \x3d floor( uv );\n\t\tvec2 fuv \x3d fract( uv );\n\t\tfloat g0x \x3d g0( fuv.x );\n\t\tfloat g1x \x3d g1( fuv.x );\n\t\tfloat h0x \x3d h0( fuv.x );\n\t\tfloat h1x \x3d h1( fuv.x );\n\t\tfloat h0y \x3d h0( fuv.y );\n\t\tfloat h1y \x3d h1( fuv.y );\n\t\tvec2 p0 \x3d ( vec2( iuv.x + h0x, iuv.y + h0y ) - 0.5 ) * texelSize.xy;\n\t\tvec2 p1 \x3d ( vec2( iuv.x + h1x, iuv.y + h0y ) - 0.5 ) * texelSize.xy;\n\t\tvec2 p2 \x3d ( vec2( iuv.x + h0x, iuv.y + h1y ) - 0.5 ) * texelSize.xy;\n\t\tvec2 p3 \x3d ( vec2( iuv.x + h1x, iuv.y + h1y ) - 0.5 ) * texelSize.xy;\n\t\treturn g0( fuv.y ) * ( g0x * textureLod( tex, p0, lod ) + g1x * textureLod( tex, p1, lod ) ) +\n\t\t\tg1( fuv.y ) * ( g0x * textureLod( tex, p2, lod ) + g1x * textureLod( tex, p3, lod ) );\n\t}\n\tvec4 textureBicubic( sampler2D sampler, vec2 uv, float lod ) {\n\t\tvec2 fLodSize \x3d vec2( textureSize( sampler, int( lod ) ) );\n\t\tvec2 cLodSize \x3d vec2( textureSize( sampler, int( lod + 1.0 ) ) );\n\t\tvec2 fLodSizeInv \x3d 1.0 / fLodSize;\n\t\tvec2 cLodSizeInv \x3d 1.0 / cLodSize;\n\t\tvec4 fSample \x3d bicubic( sampler, uv, vec4( fLodSizeInv, fLodSize ), floor( lod ) );\n\t\tvec4 cSample \x3d bicubic( sampler, uv, vec4( cLodSizeInv, cLodSize ), ceil( lod ) );\n\t\treturn mix( fSample, cSample, fract( lod ) );\n\t}\n\tvec3 getVolumeTransmissionRay( const in vec3 n, const in vec3 v, const in float thickness, const in float ior, const in mat4 modelMatrix ) {\n\t\tvec3 refractionVector \x3d refract( - v, normalize( n ), 1.0 / ior );\n\t\tvec3 modelScale;\n\t\tmodelScale.x \x3d length( vec3( modelMatrix[ 0 ].xyz ) );\n\t\tmodelScale.y \x3d length( vec3( modelMatrix[ 1 ].xyz ) );\n\t\tmodelScale.z \x3d length( vec3( modelMatrix[ 2 ].xyz ) );\n\t\treturn normalize( refractionVector ) * thickness * modelScale;\n\t}\n\tfloat applyIorToRoughness( const in float roughness, const in float ior ) {\n\t\treturn roughness * clamp( ior * 2.0 - 2.0, 0.0, 1.0 );\n\t}\n\tvec4 getTransmissionSample( const in vec2 fragCoord, const in float roughness, const in float ior ) {\n\t\tfloat lod \x3d log2( transmissionSamplerSize.x ) * applyIorToRoughness( roughness, ior );\n\t\treturn textureBicubic( transmissionSamplerMap, fragCoord.xy, lod );\n\t}\n\tvec3 volumeAttenuation( const in float transmissionDistance, const in vec3 attenuationColor, const in float attenuationDistance ) {\n\t\tif ( isinf( attenuationDistance ) ) {\n\t\t\treturn vec3( 1.0 );\n\t\t} else {\n\t\t\tvec3 attenuationCoefficient \x3d -log( attenuationColor ) / attenuationDistance;\n\t\t\tvec3 transmittance \x3d exp( - attenuationCoefficient * transmissionDistance );\t\t\treturn transmittance;\n\t\t}\n\t}\n\tvec4 getIBLVolumeRefraction( const in vec3 n, const in vec3 v, const in float roughness, const in vec3 diffuseColor,\n\t\tconst in vec3 specularColor, const in float specularF90, const in vec3 position, const in mat4 modelMatrix,\n\t\tconst in mat4 viewMatrix, const in mat4 projMatrix, const in float ior, const in float thickness,\n\t\tconst in vec3 attenuationColor, const in float attenuationDistance ) {\n\t\tvec3 transmissionRay \x3d getVolumeTransmissionRay( n, v, thickness, ior, modelMatrix );\n\t\tvec3 refractedRayExit \x3d position + transmissionRay;\n\t\tvec4 ndcPos \x3d projMatrix * viewMatrix * vec4( refractedRayExit, 1.0 );\n\t\tvec2 refractionCoords \x3d ndcPos.xy / ndcPos.w;\n\t\trefractionCoords +\x3d 1.0;\n\t\trefractionCoords /\x3d 2.0;\n\t\tvec4 transmittedLight \x3d getTransmissionSample( refractionCoords, roughness, ior );\n\t\tvec3 transmittance \x3d diffuseColor * volumeAttenuation( length( transmissionRay ), attenuationColor, attenuationDistance );\n\t\tvec3 attenuatedColor \x3d transmittance * transmittedLight.rgb;\n\t\tvec3 F \x3d EnvironmentBRDF( n, v, specularColor, specularF90, roughness );\n\t\tfloat transmittanceFactor \x3d ( transmittance.r + transmittance.g + transmittance.b ) / 3.0;\n\t\treturn vec4( ( 1.0 - F ) * attenuatedColor, 1.0 - ( 1.0 - transmittedLight.a ) * transmittanceFactor );\n\t}\n#endif",
uv_pars_fragment:"#if defined( USE_UV ) || defined( USE_ANISOTROPY )\n\tvarying vec2 vUv;\n#endif\n#ifdef USE_MAP\n\tvarying vec2 vMapUv;\n#endif\n#ifdef USE_ALPHAMAP\n\tvarying vec2 vAlphaMapUv;\n#endif\n#ifdef USE_LIGHTMAP\n\tvarying vec2 vLightMapUv;\n#endif\n#ifdef USE_AOMAP\n\tvarying vec2 vAoMapUv;\n#endif\n#ifdef USE_BUMPMAP\n\tvarying vec2 vBumpMapUv;\n#endif\n#ifdef USE_NORMALMAP\n\tvarying vec2 vNormalMapUv;\n#endif\n#ifdef USE_EMISSIVEMAP\n\tvarying vec2 vEmissiveMapUv;\n#endif\n#ifdef USE_METALNESSMAP\n\tvarying vec2 vMetalnessMapUv;\n#endif\n#ifdef USE_ROUGHNESSMAP\n\tvarying vec2 vRoughnessMapUv;\n#endif\n#ifdef USE_ANISOTROPYMAP\n\tvarying vec2 vAnisotropyMapUv;\n#endif\n#ifdef USE_CLEARCOATMAP\n\tvarying vec2 vClearcoatMapUv;\n#endif\n#ifdef USE_CLEARCOAT_NORMALMAP\n\tvarying vec2 vClearcoatNormalMapUv;\n#endif\n#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n\tvarying vec2 vClearcoatRoughnessMapUv;\n#endif\n#ifdef USE_IRIDESCENCEMAP\n\tvarying vec2 vIridescenceMapUv;\n#endif\n#ifdef USE_IRIDESCENCE_THICKNESSMAP\n\tvarying vec2 vIridescenceThicknessMapUv;\n#endif\n#ifdef USE_SHEEN_COLORMAP\n\tvarying vec2 vSheenColorMapUv;\n#endif\n#ifdef USE_SHEEN_ROUGHNESSMAP\n\tvarying vec2 vSheenRoughnessMapUv;\n#endif\n#ifdef USE_SPECULARMAP\n\tvarying vec2 vSpecularMapUv;\n#endif\n#ifdef USE_SPECULAR_COLORMAP\n\tvarying vec2 vSpecularColorMapUv;\n#endif\n#ifdef USE_SPECULAR_INTENSITYMAP\n\tvarying vec2 vSpecularIntensityMapUv;\n#endif\n#ifdef USE_TRANSMISSIONMAP\n\tuniform mat3 transmissionMapTransform;\n\tvarying vec2 vTransmissionMapUv;\n#endif\n#ifdef USE_THICKNESSMAP\n\tuniform mat3 thicknessMapTransform;\n\tvarying vec2 vThicknessMapUv;\n#endif",
uv_pars_vertex:"#if defined( USE_UV ) || defined( USE_ANISOTROPY )\n\tvarying vec2 vUv;\n#endif\n#ifdef USE_MAP\n\tuniform mat3 mapTransform;\n\tvarying vec2 vMapUv;\n#endif\n#ifdef USE_ALPHAMAP\n\tuniform mat3 alphaMapTransform;\n\tvarying vec2 vAlphaMapUv;\n#endif\n#ifdef USE_LIGHTMAP\n\tuniform mat3 lightMapTransform;\n\tvarying vec2 vLightMapUv;\n#endif\n#ifdef USE_AOMAP\n\tuniform mat3 aoMapTransform;\n\tvarying vec2 vAoMapUv;\n#endif\n#ifdef USE_BUMPMAP\n\tuniform mat3 bumpMapTransform;\n\tvarying vec2 vBumpMapUv;\n#endif\n#ifdef USE_NORMALMAP\n\tuniform mat3 normalMapTransform;\n\tvarying vec2 vNormalMapUv;\n#endif\n#ifdef USE_DISPLACEMENTMAP\n\tuniform mat3 displacementMapTransform;\n\tvarying vec2 vDisplacementMapUv;\n#endif\n#ifdef USE_EMISSIVEMAP\n\tuniform mat3 emissiveMapTransform;\n\tvarying vec2 vEmissiveMapUv;\n#endif\n#ifdef USE_METALNESSMAP\n\tuniform mat3 metalnessMapTransform;\n\tvarying vec2 vMetalnessMapUv;\n#endif\n#ifdef USE_ROUGHNESSMAP\n\tuniform mat3 roughnessMapTransform;\n\tvarying vec2 vRoughnessMapUv;\n#endif\n#ifdef USE_ANISOTROPYMAP\n\tuniform mat3 anisotropyMapTransform;\n\tvarying vec2 vAnisotropyMapUv;\n#endif\n#ifdef USE_CLEARCOATMAP\n\tuniform mat3 clearcoatMapTransform;\n\tvarying vec2 vClearcoatMapUv;\n#endif\n#ifdef USE_CLEARCOAT_NORMALMAP\n\tuniform mat3 clearcoatNormalMapTransform;\n\tvarying vec2 vClearcoatNormalMapUv;\n#endif\n#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n\tuniform mat3 clearcoatRoughnessMapTransform;\n\tvarying vec2 vClearcoatRoughnessMapUv;\n#endif\n#ifdef USE_SHEEN_COLORMAP\n\tuniform mat3 sheenColorMapTransform;\n\tvarying vec2 vSheenColorMapUv;\n#endif\n#ifdef USE_SHEEN_ROUGHNESSMAP\n\tuniform mat3 sheenRoughnessMapTransform;\n\tvarying vec2 vSheenRoughnessMapUv;\n#endif\n#ifdef USE_IRIDESCENCEMAP\n\tuniform mat3 iridescenceMapTransform;\n\tvarying vec2 vIridescenceMapUv;\n#endif\n#ifdef USE_IRIDESCENCE_THICKNESSMAP\n\tuniform mat3 iridescenceThicknessMapTransform;\n\tvarying vec2 vIridescenceThicknessMapUv;\n#endif\n#ifdef USE_SPECULARMAP\n\tuniform mat3 specularMapTransform;\n\tvarying vec2 vSpecularMapUv;\n#endif\n#ifdef USE_SPECULAR_COLORMAP\n\tuniform mat3 specularColorMapTransform;\n\tvarying vec2 vSpecularColorMapUv;\n#endif\n#ifdef USE_SPECULAR_INTENSITYMAP\n\tuniform mat3 specularIntensityMapTransform;\n\tvarying vec2 vSpecularIntensityMapUv;\n#endif\n#ifdef USE_TRANSMISSIONMAP\n\tuniform mat3 transmissionMapTransform;\n\tvarying vec2 vTransmissionMapUv;\n#endif\n#ifdef USE_THICKNESSMAP\n\tuniform mat3 thicknessMapTransform;\n\tvarying vec2 vThicknessMapUv;\n#endif",
uv_vertex:"#if defined( USE_UV ) || defined( USE_ANISOTROPY )\n\tvUv \x3d vec3( uv, 1 ).xy;\n#endif\n#ifdef USE_MAP\n\tvMapUv \x3d ( mapTransform * vec3( MAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_ALPHAMAP\n\tvAlphaMapUv \x3d ( alphaMapTransform * vec3( ALPHAMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_LIGHTMAP\n\tvLightMapUv \x3d ( lightMapTransform * vec3( LIGHTMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_AOMAP\n\tvAoMapUv \x3d ( aoMapTransform * vec3( AOMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_BUMPMAP\n\tvBumpMapUv \x3d ( bumpMapTransform * vec3( BUMPMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_NORMALMAP\n\tvNormalMapUv \x3d ( normalMapTransform * vec3( NORMALMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_DISPLACEMENTMAP\n\tvDisplacementMapUv \x3d ( displacementMapTransform * vec3( DISPLACEMENTMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_EMISSIVEMAP\n\tvEmissiveMapUv \x3d ( emissiveMapTransform * vec3( EMISSIVEMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_METALNESSMAP\n\tvMetalnessMapUv \x3d ( metalnessMapTransform * vec3( METALNESSMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_ROUGHNESSMAP\n\tvRoughnessMapUv \x3d ( roughnessMapTransform * vec3( ROUGHNESSMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_ANISOTROPYMAP\n\tvAnisotropyMapUv \x3d ( anisotropyMapTransform * vec3( ANISOTROPYMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_CLEARCOATMAP\n\tvClearcoatMapUv \x3d ( clearcoatMapTransform * vec3( CLEARCOATMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_CLEARCOAT_NORMALMAP\n\tvClearcoatNormalMapUv \x3d ( clearcoatNormalMapTransform * vec3( CLEARCOAT_NORMALMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n\tvClearcoatRoughnessMapUv \x3d ( clearcoatRoughnessMapTransform * vec3( CLEARCOAT_ROUGHNESSMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_IRIDESCENCEMAP\n\tvIridescenceMapUv \x3d ( iridescenceMapTransform * vec3( IRIDESCENCEMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_IRIDESCENCE_THICKNESSMAP\n\tvIridescenceThicknessMapUv \x3d ( iridescenceThicknessMapTransform * vec3( IRIDESCENCE_THICKNESSMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_SHEEN_COLORMAP\n\tvSheenColorMapUv \x3d ( sheenColorMapTransform * vec3( SHEEN_COLORMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_SHEEN_ROUGHNESSMAP\n\tvSheenRoughnessMapUv \x3d ( sheenRoughnessMapTransform * vec3( SHEEN_ROUGHNESSMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_SPECULARMAP\n\tvSpecularMapUv \x3d ( specularMapTransform * vec3( SPECULARMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_SPECULAR_COLORMAP\n\tvSpecularColorMapUv \x3d ( specularColorMapTransform * vec3( SPECULAR_COLORMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_SPECULAR_INTENSITYMAP\n\tvSpecularIntensityMapUv \x3d ( specularIntensityMapTransform * vec3( SPECULAR_INTENSITYMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_TRANSMISSIONMAP\n\tvTransmissionMapUv \x3d ( transmissionMapTransform * vec3( TRANSMISSIONMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_THICKNESSMAP\n\tvThicknessMapUv \x3d ( thicknessMapTransform * vec3( THICKNESSMAP_UV, 1 ) ).xy;\n#endif",
worldpos_vertex:"#if defined( USE_ENVMAP ) || defined( DISTANCE ) || defined ( USE_SHADOWMAP ) || defined ( USE_TRANSMISSION ) || NUM_SPOT_LIGHT_COORDS \x3e 0\n\tvec4 worldPosition \x3d vec4( transformed, 1.0 );\n\t#ifdef USE_INSTANCING\n\t\tworldPosition \x3d instanceMatrix * worldPosition;\n\t#endif\n\tworldPosition \x3d modelMatrix * worldPosition;\n#endif",background_vert:"varying vec2 vUv;\nuniform mat3 uvTransform;\nvoid main() {\n\tvUv \x3d ( uvTransform * vec3( uv, 1 ) ).xy;\n\tgl_Position \x3d vec4( position.xy, 1.0, 1.0 );\n}",
background_frag:"uniform sampler2D t2D;\nuniform float backgroundIntensity;\nvarying vec2 vUv;\nvoid main() {\n\tvec4 texColor \x3d texture2D( t2D, vUv );\n\t#ifdef DECODE_VIDEO_TEXTURE\n\t\ttexColor \x3d vec4( mix( pow( texColor.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), texColor.rgb * 0.0773993808, vec3( lessThanEqual( texColor.rgb, vec3( 0.04045 ) ) ) ), texColor.w );\n\t#endif\n\ttexColor.rgb *\x3d backgroundIntensity;\n\tgl_FragColor \x3d texColor;\n\t#include \x3ctonemapping_fragment\x3e\n\t#include \x3ccolorspace_fragment\x3e\n}",
backgroundCube_vert:"varying vec3 vWorldDirection;\n#include \x3ccommon\x3e\nvoid main() {\n\tvWorldDirection \x3d transformDirection( position, modelMatrix );\n\t#include \x3cbegin_vertex\x3e\n\t#include \x3cproject_vertex\x3e\n\tgl_Position.z \x3d gl_Position.w;\n}",backgroundCube_frag:"#ifdef ENVMAP_TYPE_CUBE\n\tuniform samplerCube envMap;\n#elif defined( ENVMAP_TYPE_CUBE_UV )\n\tuniform sampler2D envMap;\n#endif\nuniform float flipEnvMap;\nuniform float backgroundBlurriness;\nuniform float backgroundIntensity;\nvarying vec3 vWorldDirection;\n#include \x3ccube_uv_reflection_fragment\x3e\nvoid main() {\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tvec4 texColor \x3d textureCube( envMap, vec3( flipEnvMap * vWorldDirection.x, vWorldDirection.yz ) );\n\t#elif defined( ENVMAP_TYPE_CUBE_UV )\n\t\tvec4 texColor \x3d textureCubeUV( envMap, vWorldDirection, backgroundBlurriness );\n\t#else\n\t\tvec4 texColor \x3d vec4( 0.0, 0.0, 0.0, 1.0 );\n\t#endif\n\ttexColor.rgb *\x3d backgroundIntensity;\n\tgl_FragColor \x3d texColor;\n\t#include \x3ctonemapping_fragment\x3e\n\t#include \x3ccolorspace_fragment\x3e\n}",
cube_vert:"varying vec3 vWorldDirection;\n#include \x3ccommon\x3e\nvoid main() {\n\tvWorldDirection \x3d transformDirection( position, modelMatrix );\n\t#include \x3cbegin_vertex\x3e\n\t#include \x3cproject_vertex\x3e\n\tgl_Position.z \x3d gl_Position.w;\n}",cube_frag:"uniform samplerCube tCube;\nuniform float tFlip;\nuniform float opacity;\nvarying vec3 vWorldDirection;\nvoid main() {\n\tvec4 texColor \x3d textureCube( tCube, vec3( tFlip * vWorldDirection.x, vWorldDirection.yz ) );\n\tgl_FragColor \x3d texColor;\n\tgl_FragColor.a *\x3d opacity;\n\t#include \x3ctonemapping_fragment\x3e\n\t#include \x3ccolorspace_fragment\x3e\n}",
depth_vert:"#include \x3ccommon\x3e\n#include \x3cuv_pars_vertex\x3e\n#include \x3cdisplacementmap_pars_vertex\x3e\n#include \x3cmorphtarget_pars_vertex\x3e\n#include \x3cskinning_pars_vertex\x3e\n#include \x3clogdepthbuf_pars_vertex\x3e\n#include \x3cclipping_planes_pars_vertex\x3e\nvarying vec2 vHighPrecisionZW;\nvoid main() {\n\t#include \x3cuv_vertex\x3e\n\t#include \x3cskinbase_vertex\x3e\n\t#ifdef USE_DISPLACEMENTMAP\n\t\t#include \x3cbeginnormal_vertex\x3e\n\t\t#include \x3cmorphnormal_vertex\x3e\n\t\t#include \x3cskinnormal_vertex\x3e\n\t#endif\n\t#include \x3cbegin_vertex\x3e\n\t#include \x3cmorphtarget_vertex\x3e\n\t#include \x3cskinning_vertex\x3e\n\t#include \x3cdisplacementmap_vertex\x3e\n\t#include \x3cproject_vertex\x3e\n\t#include \x3clogdepthbuf_vertex\x3e\n\t#include \x3cclipping_planes_vertex\x3e\n\tvHighPrecisionZW \x3d gl_Position.zw;\n}",
depth_frag:"#if DEPTH_PACKING \x3d\x3d 3200\n\tuniform float opacity;\n#endif\n#include \x3ccommon\x3e\n#include \x3cpacking\x3e\n#include \x3cuv_pars_fragment\x3e\n#include \x3cmap_pars_fragment\x3e\n#include \x3calphamap_pars_fragment\x3e\n#include \x3calphatest_pars_fragment\x3e\n#include \x3calphahash_pars_fragment\x3e\n#include \x3clogdepthbuf_pars_fragment\x3e\n#include \x3cclipping_planes_pars_fragment\x3e\nvarying vec2 vHighPrecisionZW;\nvoid main() {\n\t#include \x3cclipping_planes_fragment\x3e\n\tvec4 diffuseColor \x3d vec4( 1.0 );\n\t#if DEPTH_PACKING \x3d\x3d 3200\n\t\tdiffuseColor.a \x3d opacity;\n\t#endif\n\t#include \x3cmap_fragment\x3e\n\t#include \x3calphamap_fragment\x3e\n\t#include \x3calphatest_fragment\x3e\n\t#include \x3calphahash_fragment\x3e\n\t#include \x3clogdepthbuf_fragment\x3e\n\tfloat fragCoordZ \x3d 0.5 * vHighPrecisionZW[0] / vHighPrecisionZW[1] + 0.5;\n\t#if DEPTH_PACKING \x3d\x3d 3200\n\t\tgl_FragColor \x3d vec4( vec3( 1.0 - fragCoordZ ), opacity );\n\t#elif DEPTH_PACKING \x3d\x3d 3201\n\t\tgl_FragColor \x3d packDepthToRGBA( fragCoordZ );\n\t#endif\n}",
distanceRGBA_vert:"#define DISTANCE\nvarying vec3 vWorldPosition;\n#include \x3ccommon\x3e\n#include \x3cuv_pars_vertex\x3e\n#include \x3cdisplacementmap_pars_vertex\x3e\n#include \x3cmorphtarget_pars_vertex\x3e\n#include \x3cskinning_pars_vertex\x3e\n#include \x3cclipping_planes_pars_vertex\x3e\nvoid main() {\n\t#include \x3cuv_vertex\x3e\n\t#include \x3cskinbase_vertex\x3e\n\t#ifdef USE_DISPLACEMENTMAP\n\t\t#include \x3cbeginnormal_vertex\x3e\n\t\t#include \x3cmorphnormal_vertex\x3e\n\t\t#include \x3cskinnormal_vertex\x3e\n\t#endif\n\t#include \x3cbegin_vertex\x3e\n\t#include \x3cmorphtarget_vertex\x3e\n\t#include \x3cskinning_vertex\x3e\n\t#include \x3cdisplacementmap_vertex\x3e\n\t#include \x3cproject_vertex\x3e\n\t#include \x3cworldpos_vertex\x3e\n\t#include \x3cclipping_planes_vertex\x3e\n\tvWorldPosition \x3d worldPosition.xyz;\n}",
distanceRGBA_frag:"#define DISTANCE\nuniform vec3 referencePosition;\nuniform float nearDistance;\nuniform float farDistance;\nvarying vec3 vWorldPosition;\n#include \x3ccommon\x3e\n#include \x3cpacking\x3e\n#include \x3cuv_pars_fragment\x3e\n#include \x3cmap_pars_fragment\x3e\n#include \x3calphamap_pars_fragment\x3e\n#include \x3calphatest_pars_fragment\x3e\n#include \x3calphahash_pars_fragment\x3e\n#include \x3cclipping_planes_pars_fragment\x3e\nvoid main () {\n\t#include \x3cclipping_planes_fragment\x3e\n\tvec4 diffuseColor \x3d vec4( 1.0 );\n\t#include \x3cmap_fragment\x3e\n\t#include \x3calphamap_fragment\x3e\n\t#include \x3calphatest_fragment\x3e\n\t#include \x3calphahash_fragment\x3e\n\tfloat dist \x3d length( vWorldPosition - referencePosition );\n\tdist \x3d ( dist - nearDistance ) / ( farDistance - nearDistance );\n\tdist \x3d saturate( dist );\n\tgl_FragColor \x3d packDepthToRGBA( dist );\n}",
equirect_vert:"varying vec3 vWorldDirection;\n#include \x3ccommon\x3e\nvoid main() {\n\tvWorldDirection \x3d transformDirection( position, modelMatrix );\n\t#include \x3cbegin_vertex\x3e\n\t#include \x3cproject_vertex\x3e\n}",equirect_frag:"uniform sampler2D tEquirect;\nvarying vec3 vWorldDirection;\n#include \x3ccommon\x3e\nvoid main() {\n\tvec3 direction \x3d normalize( vWorldDirection );\n\tvec2 sampleUV \x3d equirectUv( direction );\n\tgl_FragColor \x3d texture2D( tEquirect, sampleUV );\n\t#include \x3ctonemapping_fragment\x3e\n\t#include \x3ccolorspace_fragment\x3e\n}",
linedashed_vert:"uniform float scale;\nattribute float lineDistance;\nvarying float vLineDistance;\n#include \x3ccommon\x3e\n#include \x3cuv_pars_vertex\x3e\n#include \x3ccolor_pars_vertex\x3e\n#include \x3cfog_pars_vertex\x3e\n#include \x3cmorphtarget_pars_vertex\x3e\n#include \x3clogdepthbuf_pars_vertex\x3e\n#include \x3cclipping_planes_pars_vertex\x3e\nvoid main() {\n\tvLineDistance \x3d scale * lineDistance;\n\t#include \x3cuv_vertex\x3e\n\t#include \x3ccolor_vertex\x3e\n\t#include \x3cmorphcolor_vertex\x3e\n\t#include \x3cbegin_vertex\x3e\n\t#include \x3cmorphtarget_vertex\x3e\n\t#include \x3cproject_vertex\x3e\n\t#include \x3clogdepthbuf_vertex\x3e\n\t#include \x3cclipping_planes_vertex\x3e\n\t#include \x3cfog_vertex\x3e\n}",
linedashed_frag:"uniform vec3 diffuse;\nuniform float opacity;\nuniform float dashSize;\nuniform float totalSize;\nvarying float vLineDistance;\n#include \x3ccommon\x3e\n#include \x3ccolor_pars_fragment\x3e\n#include \x3cuv_pars_fragment\x3e\n#include \x3cmap_pars_fragment\x3e\n#include \x3cfog_pars_fragment\x3e\n#include \x3clogdepthbuf_pars_fragment\x3e\n#include \x3cclipping_planes_pars_fragment\x3e\nvoid main() {\n\t#include \x3cclipping_planes_fragment\x3e\n\tif ( mod( vLineDistance, totalSize ) \x3e dashSize ) {\n\t\tdiscard;\n\t}\n\tvec3 outgoingLight \x3d vec3( 0.0 );\n\tvec4 diffuseColor \x3d vec4( diffuse, opacity );\n\t#include \x3clogdepthbuf_fragment\x3e\n\t#include \x3cmap_fragment\x3e\n\t#include \x3ccolor_fragment\x3e\n\toutgoingLight \x3d diffuseColor.rgb;\n\t#include \x3copaque_fragment\x3e\n\t#include \x3ctonemapping_fragment\x3e\n\t#include \x3ccolorspace_fragment\x3e\n\t#include \x3cfog_fragment\x3e\n\t#include \x3cpremultiplied_alpha_fragment\x3e\n}",
meshbasic_vert:"#include \x3ccommon\x3e\n#include \x3cuv_pars_vertex\x3e\n#include \x3cenvmap_pars_vertex\x3e\n#include \x3ccolor_pars_vertex\x3e\n#include \x3cfog_pars_vertex\x3e\n#include \x3cmorphtarget_pars_vertex\x3e\n#include \x3cskinning_pars_vertex\x3e\n#include \x3clogdepthbuf_pars_vertex\x3e\n#include \x3cclipping_planes_pars_vertex\x3e\nvoid main() {\n\t#include \x3cuv_vertex\x3e\n\t#include \x3ccolor_vertex\x3e\n\t#include \x3cmorphcolor_vertex\x3e\n\t#if defined ( USE_ENVMAP ) || defined ( USE_SKINNING )\n\t\t#include \x3cbeginnormal_vertex\x3e\n\t\t#include \x3cmorphnormal_vertex\x3e\n\t\t#include \x3cskinbase_vertex\x3e\n\t\t#include \x3cskinnormal_vertex\x3e\n\t\t#include \x3cdefaultnormal_vertex\x3e\n\t#endif\n\t#include \x3cbegin_vertex\x3e\n\t#include \x3cmorphtarget_vertex\x3e\n\t#include \x3cskinning_vertex\x3e\n\t#include \x3cproject_vertex\x3e\n\t#include \x3clogdepthbuf_vertex\x3e\n\t#include \x3cclipping_planes_vertex\x3e\n\t#include \x3cworldpos_vertex\x3e\n\t#include \x3cenvmap_vertex\x3e\n\t#include \x3cfog_vertex\x3e\n}",
meshbasic_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include \x3ccommon\x3e\n#include \x3cdithering_pars_fragment\x3e\n#include \x3ccolor_pars_fragment\x3e\n#include \x3cuv_pars_fragment\x3e\n#include \x3cmap_pars_fragment\x3e\n#include \x3calphamap_pars_fragment\x3e\n#include \x3calphatest_pars_fragment\x3e\n#include \x3calphahash_pars_fragment\x3e\n#include \x3caomap_pars_fragment\x3e\n#include \x3clightmap_pars_fragment\x3e\n#include \x3cenvmap_common_pars_fragment\x3e\n#include \x3cenvmap_pars_fragment\x3e\n#include \x3cfog_pars_fragment\x3e\n#include \x3cspecularmap_pars_fragment\x3e\n#include \x3clogdepthbuf_pars_fragment\x3e\n#include \x3cclipping_planes_pars_fragment\x3e\nvoid main() {\n\t#include \x3cclipping_planes_fragment\x3e\n\tvec4 diffuseColor \x3d vec4( diffuse, opacity );\n\t#include \x3clogdepthbuf_fragment\x3e\n\t#include \x3cmap_fragment\x3e\n\t#include \x3ccolor_fragment\x3e\n\t#include \x3calphamap_fragment\x3e\n\t#include \x3calphatest_fragment\x3e\n\t#include \x3calphahash_fragment\x3e\n\t#include \x3cspecularmap_fragment\x3e\n\tReflectedLight reflectedLight \x3d ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\t#ifdef USE_LIGHTMAP\n\t\tvec4 lightMapTexel \x3d texture2D( lightMap, vLightMapUv );\n\t\treflectedLight.indirectDiffuse +\x3d lightMapTexel.rgb * lightMapIntensity * RECIPROCAL_PI;\n\t#else\n\t\treflectedLight.indirectDiffuse +\x3d vec3( 1.0 );\n\t#endif\n\t#include \x3caomap_fragment\x3e\n\treflectedLight.indirectDiffuse *\x3d diffuseColor.rgb;\n\tvec3 outgoingLight \x3d reflectedLight.indirectDiffuse;\n\t#include \x3cenvmap_fragment\x3e\n\t#include \x3copaque_fragment\x3e\n\t#include \x3ctonemapping_fragment\x3e\n\t#include \x3ccolorspace_fragment\x3e\n\t#include \x3cfog_fragment\x3e\n\t#include \x3cpremultiplied_alpha_fragment\x3e\n\t#include \x3cdithering_fragment\x3e\n}",
meshlambert_vert:"#define LAMBERT\nvarying vec3 vViewPosition;\n#include \x3ccommon\x3e\n#include \x3cuv_pars_vertex\x3e\n#include \x3cdisplacementmap_pars_vertex\x3e\n#include \x3cenvmap_pars_vertex\x3e\n#include \x3ccolor_pars_vertex\x3e\n#include \x3cfog_pars_vertex\x3e\n#include \x3cnormal_pars_vertex\x3e\n#include \x3cmorphtarget_pars_vertex\x3e\n#include \x3cskinning_pars_vertex\x3e\n#include \x3cshadowmap_pars_vertex\x3e\n#include \x3clogdepthbuf_pars_vertex\x3e\n#include \x3cclipping_planes_pars_vertex\x3e\nvoid main() {\n\t#include \x3cuv_vertex\x3e\n\t#include \x3ccolor_vertex\x3e\n\t#include \x3cmorphcolor_vertex\x3e\n\t#include \x3cbeginnormal_vertex\x3e\n\t#include \x3cmorphnormal_vertex\x3e\n\t#include \x3cskinbase_vertex\x3e\n\t#include \x3cskinnormal_vertex\x3e\n\t#include \x3cdefaultnormal_vertex\x3e\n\t#include \x3cnormal_vertex\x3e\n\t#include \x3cbegin_vertex\x3e\n\t#include \x3cmorphtarget_vertex\x3e\n\t#include \x3cskinning_vertex\x3e\n\t#include \x3cdisplacementmap_vertex\x3e\n\t#include \x3cproject_vertex\x3e\n\t#include \x3clogdepthbuf_vertex\x3e\n\t#include \x3cclipping_planes_vertex\x3e\n\tvViewPosition \x3d - mvPosition.xyz;\n\t#include \x3cworldpos_vertex\x3e\n\t#include \x3cenvmap_vertex\x3e\n\t#include \x3cshadowmap_vertex\x3e\n\t#include \x3cfog_vertex\x3e\n}",
meshlambert_frag:"#define LAMBERT\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float opacity;\n#include \x3ccommon\x3e\n#include \x3cpacking\x3e\n#include \x3cdithering_pars_fragment\x3e\n#include \x3ccolor_pars_fragment\x3e\n#include \x3cuv_pars_fragment\x3e\n#include \x3cmap_pars_fragment\x3e\n#include \x3calphamap_pars_fragment\x3e\n#include \x3calphatest_pars_fragment\x3e\n#include \x3calphahash_pars_fragment\x3e\n#include \x3caomap_pars_fragment\x3e\n#include \x3clightmap_pars_fragment\x3e\n#include \x3cemissivemap_pars_fragment\x3e\n#include \x3cenvmap_common_pars_fragment\x3e\n#include \x3cenvmap_pars_fragment\x3e\n#include \x3cfog_pars_fragment\x3e\n#include \x3cbsdfs\x3e\n#include \x3clights_pars_begin\x3e\n#include \x3cnormal_pars_fragment\x3e\n#include \x3clights_lambert_pars_fragment\x3e\n#include \x3cshadowmap_pars_fragment\x3e\n#include \x3cbumpmap_pars_fragment\x3e\n#include \x3cnormalmap_pars_fragment\x3e\n#include \x3cspecularmap_pars_fragment\x3e\n#include \x3clogdepthbuf_pars_fragment\x3e\n#include \x3cclipping_planes_pars_fragment\x3e\nvoid main() {\n\t#include \x3cclipping_planes_fragment\x3e\n\tvec4 diffuseColor \x3d vec4( diffuse, opacity );\n\tReflectedLight reflectedLight \x3d ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance \x3d emissive;\n\t#include \x3clogdepthbuf_fragment\x3e\n\t#include \x3cmap_fragment\x3e\n\t#include \x3ccolor_fragment\x3e\n\t#include \x3calphamap_fragment\x3e\n\t#include \x3calphatest_fragment\x3e\n\t#include \x3calphahash_fragment\x3e\n\t#include \x3cspecularmap_fragment\x3e\n\t#include \x3cnormal_fragment_begin\x3e\n\t#include \x3cnormal_fragment_maps\x3e\n\t#include \x3cemissivemap_fragment\x3e\n\t#include \x3clights_lambert_fragment\x3e\n\t#include \x3clights_fragment_begin\x3e\n\t#include \x3clights_fragment_maps\x3e\n\t#include \x3clights_fragment_end\x3e\n\t#include \x3caomap_fragment\x3e\n\tvec3 outgoingLight \x3d reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;\n\t#include \x3cenvmap_fragment\x3e\n\t#include \x3copaque_fragment\x3e\n\t#include \x3ctonemapping_fragment\x3e\n\t#include \x3ccolorspace_fragment\x3e\n\t#include \x3cfog_fragment\x3e\n\t#include \x3cpremultiplied_alpha_fragment\x3e\n\t#include \x3cdithering_fragment\x3e\n}",
meshmatcap_vert:"#define MATCAP\nvarying vec3 vViewPosition;\n#include \x3ccommon\x3e\n#include \x3cuv_pars_vertex\x3e\n#include \x3ccolor_pars_vertex\x3e\n#include \x3cdisplacementmap_pars_vertex\x3e\n#include \x3cfog_pars_vertex\x3e\n#include \x3cnormal_pars_vertex\x3e\n#include \x3cmorphtarget_pars_vertex\x3e\n#include \x3cskinning_pars_vertex\x3e\n#include \x3clogdepthbuf_pars_vertex\x3e\n#include \x3cclipping_planes_pars_vertex\x3e\nvoid main() {\n\t#include \x3cuv_vertex\x3e\n\t#include \x3ccolor_vertex\x3e\n\t#include \x3cmorphcolor_vertex\x3e\n\t#include \x3cbeginnormal_vertex\x3e\n\t#include \x3cmorphnormal_vertex\x3e\n\t#include \x3cskinbase_vertex\x3e\n\t#include \x3cskinnormal_vertex\x3e\n\t#include \x3cdefaultnormal_vertex\x3e\n\t#include \x3cnormal_vertex\x3e\n\t#include \x3cbegin_vertex\x3e\n\t#include \x3cmorphtarget_vertex\x3e\n\t#include \x3cskinning_vertex\x3e\n\t#include \x3cdisplacementmap_vertex\x3e\n\t#include \x3cproject_vertex\x3e\n\t#include \x3clogdepthbuf_vertex\x3e\n\t#include \x3cclipping_planes_vertex\x3e\n\t#include \x3cfog_vertex\x3e\n\tvViewPosition \x3d - mvPosition.xyz;\n}",
meshmatcap_frag:"#define MATCAP\nuniform vec3 diffuse;\nuniform float opacity;\nuniform sampler2D matcap;\nvarying vec3 vViewPosition;\n#include \x3ccommon\x3e\n#include \x3cdithering_pars_fragment\x3e\n#include \x3ccolor_pars_fragment\x3e\n#include \x3cuv_pars_fragment\x3e\n#include \x3cmap_pars_fragment\x3e\n#include \x3calphamap_pars_fragment\x3e\n#include \x3calphatest_pars_fragment\x3e\n#include \x3calphahash_pars_fragment\x3e\n#include \x3cfog_pars_fragment\x3e\n#include \x3cnormal_pars_fragment\x3e\n#include \x3cbumpmap_pars_fragment\x3e\n#include \x3cnormalmap_pars_fragment\x3e\n#include \x3clogdepthbuf_pars_fragment\x3e\n#include \x3cclipping_planes_pars_fragment\x3e\nvoid main() {\n\t#include \x3cclipping_planes_fragment\x3e\n\tvec4 diffuseColor \x3d vec4( diffuse, opacity );\n\t#include \x3clogdepthbuf_fragment\x3e\n\t#include \x3cmap_fragment\x3e\n\t#include \x3ccolor_fragment\x3e\n\t#include \x3calphamap_fragment\x3e\n\t#include \x3calphatest_fragment\x3e\n\t#include \x3calphahash_fragment\x3e\n\t#include \x3cnormal_fragment_begin\x3e\n\t#include \x3cnormal_fragment_maps\x3e\n\tvec3 viewDir \x3d normalize( vViewPosition );\n\tvec3 x \x3d normalize( vec3( viewDir.z, 0.0, - viewDir.x ) );\n\tvec3 y \x3d cross( viewDir, x );\n\tvec2 uv \x3d vec2( dot( x, normal ), dot( y, normal ) ) * 0.495 + 0.5;\n\t#ifdef USE_MATCAP\n\t\tvec4 matcapColor \x3d texture2D( matcap, uv );\n\t#else\n\t\tvec4 matcapColor \x3d vec4( vec3( mix( 0.2, 0.8, uv.y ) ), 1.0 );\n\t#endif\n\tvec3 outgoingLight \x3d diffuseColor.rgb * matcapColor.rgb;\n\t#include \x3copaque_fragment\x3e\n\t#include \x3ctonemapping_fragment\x3e\n\t#include \x3ccolorspace_fragment\x3e\n\t#include \x3cfog_fragment\x3e\n\t#include \x3cpremultiplied_alpha_fragment\x3e\n\t#include \x3cdithering_fragment\x3e\n}",
meshnormal_vert:"#define NORMAL\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )\n\tvarying vec3 vViewPosition;\n#endif\n#include \x3ccommon\x3e\n#include \x3cuv_pars_vertex\x3e\n#include \x3cdisplacementmap_pars_vertex\x3e\n#include \x3cnormal_pars_vertex\x3e\n#include \x3cmorphtarget_pars_vertex\x3e\n#include \x3cskinning_pars_vertex\x3e\n#include \x3clogdepthbuf_pars_vertex\x3e\n#include \x3cclipping_planes_pars_vertex\x3e\nvoid main() {\n\t#include \x3cuv_vertex\x3e\n\t#include \x3cbeginnormal_vertex\x3e\n\t#include \x3cmorphnormal_vertex\x3e\n\t#include \x3cskinbase_vertex\x3e\n\t#include \x3cskinnormal_vertex\x3e\n\t#include \x3cdefaultnormal_vertex\x3e\n\t#include \x3cnormal_vertex\x3e\n\t#include \x3cbegin_vertex\x3e\n\t#include \x3cmorphtarget_vertex\x3e\n\t#include \x3cskinning_vertex\x3e\n\t#include \x3cdisplacementmap_vertex\x3e\n\t#include \x3cproject_vertex\x3e\n\t#include \x3clogdepthbuf_vertex\x3e\n\t#include \x3cclipping_planes_vertex\x3e\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )\n\tvViewPosition \x3d - mvPosition.xyz;\n#endif\n}",
meshnormal_frag:"#define NORMAL\nuniform float opacity;\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )\n\tvarying vec3 vViewPosition;\n#endif\n#include \x3cpacking\x3e\n#include \x3cuv_pars_fragment\x3e\n#include \x3cnormal_pars_fragment\x3e\n#include \x3cbumpmap_pars_fragment\x3e\n#include \x3cnormalmap_pars_fragment\x3e\n#include \x3clogdepthbuf_pars_fragment\x3e\n#include \x3cclipping_planes_pars_fragment\x3e\nvoid main() {\n\t#include \x3cclipping_planes_fragment\x3e\n\t#include \x3clogdepthbuf_fragment\x3e\n\t#include \x3cnormal_fragment_begin\x3e\n\t#include \x3cnormal_fragment_maps\x3e\n\tgl_FragColor \x3d vec4( packNormalToRGB( normal ), opacity );\n\t#ifdef OPAQUE\n\t\tgl_FragColor.a \x3d 1.0;\n\t#endif\n}",
meshphong_vert:"#define PHONG\nvarying vec3 vViewPosition;\n#include \x3ccommon\x3e\n#include \x3cuv_pars_vertex\x3e\n#include \x3cdisplacementmap_pars_vertex\x3e\n#include \x3cenvmap_pars_vertex\x3e\n#include \x3ccolor_pars_vertex\x3e\n#include \x3cfog_pars_vertex\x3e\n#include \x3cnormal_pars_vertex\x3e\n#include \x3cmorphtarget_pars_vertex\x3e\n#include \x3cskinning_pars_vertex\x3e\n#include \x3cshadowmap_pars_vertex\x3e\n#include \x3clogdepthbuf_pars_vertex\x3e\n#include \x3cclipping_planes_pars_vertex\x3e\nvoid main() {\n\t#include \x3cuv_vertex\x3e\n\t#include \x3ccolor_vertex\x3e\n\t#include \x3cmorphcolor_vertex\x3e\n\t#include \x3cbeginnormal_vertex\x3e\n\t#include \x3cmorphnormal_vertex\x3e\n\t#include \x3cskinbase_vertex\x3e\n\t#include \x3cskinnormal_vertex\x3e\n\t#include \x3cdefaultnormal_vertex\x3e\n\t#include \x3cnormal_vertex\x3e\n\t#include \x3cbegin_vertex\x3e\n\t#include \x3cmorphtarget_vertex\x3e\n\t#include \x3cskinning_vertex\x3e\n\t#include \x3cdisplacementmap_vertex\x3e\n\t#include \x3cproject_vertex\x3e\n\t#include \x3clogdepthbuf_vertex\x3e\n\t#include \x3cclipping_planes_vertex\x3e\n\tvViewPosition \x3d - mvPosition.xyz;\n\t#include \x3cworldpos_vertex\x3e\n\t#include \x3cenvmap_vertex\x3e\n\t#include \x3cshadowmap_vertex\x3e\n\t#include \x3cfog_vertex\x3e\n}",
meshphong_frag:"#define PHONG\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform vec3 specular;\nuniform float shininess;\nuniform float opacity;\n#include \x3ccommon\x3e\n#include \x3cpacking\x3e\n#include \x3cdithering_pars_fragment\x3e\n#include \x3ccolor_pars_fragment\x3e\n#include \x3cuv_pars_fragment\x3e\n#include \x3cmap_pars_fragment\x3e\n#include \x3calphamap_pars_fragment\x3e\n#include \x3calphatest_pars_fragment\x3e\n#include \x3calphahash_pars_fragment\x3e\n#include \x3caomap_pars_fragment\x3e\n#include \x3clightmap_pars_fragment\x3e\n#include \x3cemissivemap_pars_fragment\x3e\n#include \x3cenvmap_common_pars_fragment\x3e\n#include \x3cenvmap_pars_fragment\x3e\n#include \x3cfog_pars_fragment\x3e\n#include \x3cbsdfs\x3e\n#include \x3clights_pars_begin\x3e\n#include \x3cnormal_pars_fragment\x3e\n#include \x3clights_phong_pars_fragment\x3e\n#include \x3cshadowmap_pars_fragment\x3e\n#include \x3cbumpmap_pars_fragment\x3e\n#include \x3cnormalmap_pars_fragment\x3e\n#include \x3cspecularmap_pars_fragment\x3e\n#include \x3clogdepthbuf_pars_fragment\x3e\n#include \x3cclipping_planes_pars_fragment\x3e\nvoid main() {\n\t#include \x3cclipping_planes_fragment\x3e\n\tvec4 diffuseColor \x3d vec4( diffuse, opacity );\n\tReflectedLight reflectedLight \x3d ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance \x3d emissive;\n\t#include \x3clogdepthbuf_fragment\x3e\n\t#include \x3cmap_fragment\x3e\n\t#include \x3ccolor_fragment\x3e\n\t#include \x3calphamap_fragment\x3e\n\t#include \x3calphatest_fragment\x3e\n\t#include \x3calphahash_fragment\x3e\n\t#include \x3cspecularmap_fragment\x3e\n\t#include \x3cnormal_fragment_begin\x3e\n\t#include \x3cnormal_fragment_maps\x3e\n\t#include \x3cemissivemap_fragment\x3e\n\t#include \x3clights_phong_fragment\x3e\n\t#include \x3clights_fragment_begin\x3e\n\t#include \x3clights_fragment_maps\x3e\n\t#include \x3clights_fragment_end\x3e\n\t#include \x3caomap_fragment\x3e\n\tvec3 outgoingLight \x3d reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;\n\t#include \x3cenvmap_fragment\x3e\n\t#include \x3copaque_fragment\x3e\n\t#include \x3ctonemapping_fragment\x3e\n\t#include \x3ccolorspace_fragment\x3e\n\t#include \x3cfog_fragment\x3e\n\t#include \x3cpremultiplied_alpha_fragment\x3e\n\t#include \x3cdithering_fragment\x3e\n}",
meshphysical_vert:"#define STANDARD\nvarying vec3 vViewPosition;\n#ifdef USE_TRANSMISSION\n\tvarying vec3 vWorldPosition;\n#endif\n#include \x3ccommon\x3e\n#include \x3cuv_pars_vertex\x3e\n#include \x3cdisplacementmap_pars_vertex\x3e\n#include \x3ccolor_pars_vertex\x3e\n#include \x3cfog_pars_vertex\x3e\n#include \x3cnormal_pars_vertex\x3e\n#include \x3cmorphtarget_pars_vertex\x3e\n#include \x3cskinning_pars_vertex\x3e\n#include \x3cshadowmap_pars_vertex\x3e\n#include \x3clogdepthbuf_pars_vertex\x3e\n#include \x3cclipping_planes_pars_vertex\x3e\nvoid main() {\n\t#include \x3cuv_vertex\x3e\n\t#include \x3ccolor_vertex\x3e\n\t#include \x3cmorphcolor_vertex\x3e\n\t#include \x3cbeginnormal_vertex\x3e\n\t#include \x3cmorphnormal_vertex\x3e\n\t#include \x3cskinbase_vertex\x3e\n\t#include \x3cskinnormal_vertex\x3e\n\t#include \x3cdefaultnormal_vertex\x3e\n\t#include \x3cnormal_vertex\x3e\n\t#include \x3cbegin_vertex\x3e\n\t#include \x3cmorphtarget_vertex\x3e\n\t#include \x3cskinning_vertex\x3e\n\t#include \x3cdisplacementmap_vertex\x3e\n\t#include \x3cproject_vertex\x3e\n\t#include \x3clogdepthbuf_vertex\x3e\n\t#include \x3cclipping_planes_vertex\x3e\n\tvViewPosition \x3d - mvPosition.xyz;\n\t#include \x3cworldpos_vertex\x3e\n\t#include \x3cshadowmap_vertex\x3e\n\t#include \x3cfog_vertex\x3e\n#ifdef USE_TRANSMISSION\n\tvWorldPosition \x3d worldPosition.xyz;\n#endif\n}",
meshphysical_frag:"#define STANDARD\n#ifdef PHYSICAL\n\t#define IOR\n\t#define USE_SPECULAR\n#endif\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float roughness;\nuniform float metalness;\nuniform float opacity;\n#ifdef IOR\n\tuniform float ior;\n#endif\n#ifdef USE_SPECULAR\n\tuniform float specularIntensity;\n\tuniform vec3 specularColor;\n\t#ifdef USE_SPECULAR_COLORMAP\n\t\tuniform sampler2D specularColorMap;\n\t#endif\n\t#ifdef USE_SPECULAR_INTENSITYMAP\n\t\tuniform sampler2D specularIntensityMap;\n\t#endif\n#endif\n#ifdef USE_CLEARCOAT\n\tuniform float clearcoat;\n\tuniform float clearcoatRoughness;\n#endif\n#ifdef USE_IRIDESCENCE\n\tuniform float iridescence;\n\tuniform float iridescenceIOR;\n\tuniform float iridescenceThicknessMinimum;\n\tuniform float iridescenceThicknessMaximum;\n#endif\n#ifdef USE_SHEEN\n\tuniform vec3 sheenColor;\n\tuniform float sheenRoughness;\n\t#ifdef USE_SHEEN_COLORMAP\n\t\tuniform sampler2D sheenColorMap;\n\t#endif\n\t#ifdef USE_SHEEN_ROUGHNESSMAP\n\t\tuniform sampler2D sheenRoughnessMap;\n\t#endif\n#endif\n#ifdef USE_ANISOTROPY\n\tuniform vec2 anisotropyVector;\n\t#ifdef USE_ANISOTROPYMAP\n\t\tuniform sampler2D anisotropyMap;\n\t#endif\n#endif\nvarying vec3 vViewPosition;\n#include \x3ccommon\x3e\n#include \x3cpacking\x3e\n#include \x3cdithering_pars_fragment\x3e\n#include \x3ccolor_pars_fragment\x3e\n#include \x3cuv_pars_fragment\x3e\n#include \x3cmap_pars_fragment\x3e\n#include \x3calphamap_pars_fragment\x3e\n#include \x3calphatest_pars_fragment\x3e\n#include \x3calphahash_pars_fragment\x3e\n#include \x3caomap_pars_fragment\x3e\n#include \x3clightmap_pars_fragment\x3e\n#include \x3cemissivemap_pars_fragment\x3e\n#include \x3ciridescence_fragment\x3e\n#include \x3ccube_uv_reflection_fragment\x3e\n#include \x3cenvmap_common_pars_fragment\x3e\n#include \x3cenvmap_physical_pars_fragment\x3e\n#include \x3cfog_pars_fragment\x3e\n#include \x3clights_pars_begin\x3e\n#include \x3cnormal_pars_fragment\x3e\n#include \x3clights_physical_pars_fragment\x3e\n#include \x3ctransmission_pars_fragment\x3e\n#include \x3cshadowmap_pars_fragment\x3e\n#include \x3cbumpmap_pars_fragment\x3e\n#include \x3cnormalmap_pars_fragment\x3e\n#include \x3cclearcoat_pars_fragment\x3e\n#include \x3ciridescence_pars_fragment\x3e\n#include \x3croughnessmap_pars_fragment\x3e\n#include \x3cmetalnessmap_pars_fragment\x3e\n#include \x3clogdepthbuf_pars_fragment\x3e\n#include \x3cclipping_planes_pars_fragment\x3e\nvoid main() {\n\t#include \x3cclipping_planes_fragment\x3e\n\tvec4 diffuseColor \x3d vec4( diffuse, opacity );\n\tReflectedLight reflectedLight \x3d ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance \x3d emissive;\n\t#include \x3clogdepthbuf_fragment\x3e\n\t#include \x3cmap_fragment\x3e\n\t#include \x3ccolor_fragment\x3e\n\t#include \x3calphamap_fragment\x3e\n\t#include \x3calphatest_fragment\x3e\n\t#include \x3calphahash_fragment\x3e\n\t#include \x3croughnessmap_fragment\x3e\n\t#include \x3cmetalnessmap_fragment\x3e\n\t#include \x3cnormal_fragment_begin\x3e\n\t#include \x3cnormal_fragment_maps\x3e\n\t#include \x3cclearcoat_normal_fragment_begin\x3e\n\t#include \x3cclearcoat_normal_fragment_maps\x3e\n\t#include \x3cemissivemap_fragment\x3e\n\t#include \x3clights_physical_fragment\x3e\n\t#include \x3clights_fragment_begin\x3e\n\t#include \x3clights_fragment_maps\x3e\n\t#include \x3clights_fragment_end\x3e\n\t#include \x3caomap_fragment\x3e\n\tvec3 totalDiffuse \x3d reflectedLight.directDiffuse + reflectedLight.indirectDiffuse;\n\tvec3 totalSpecular \x3d reflectedLight.directSpecular + reflectedLight.indirectSpecular;\n\t#include \x3ctransmission_fragment\x3e\n\tvec3 outgoingLight \x3d totalDiffuse + totalSpecular + totalEmissiveRadiance;\n\t#ifdef USE_SHEEN\n\t\tfloat sheenEnergyComp \x3d 1.0 - 0.157 * max3( material.sheenColor );\n\t\toutgoingLight \x3d outgoingLight * sheenEnergyComp + sheenSpecularDirect + sheenSpecularIndirect;\n\t#endif\n\t#ifdef USE_CLEARCOAT\n\t\tfloat dotNVcc \x3d saturate( dot( geometryClearcoatNormal, geometryViewDir ) );\n\t\tvec3 Fcc \x3d F_Schlick( material.clearcoatF0, material.clearcoatF90, dotNVcc );\n\t\toutgoingLight \x3d outgoingLight * ( 1.0 - material.clearcoat * Fcc ) + ( clearcoatSpecularDirect + clearcoatSpecularIndirect ) * material.clearcoat;\n\t#endif\n\t#include \x3copaque_fragment\x3e\n\t#include \x3ctonemapping_fragment\x3e\n\t#include \x3ccolorspace_fragment\x3e\n\t#include \x3cfog_fragment\x3e\n\t#include \x3cpremultiplied_alpha_fragment\x3e\n\t#include \x3cdithering_fragment\x3e\n}",
meshtoon_vert:"#define TOON\nvarying vec3 vViewPosition;\n#include \x3ccommon\x3e\n#include \x3cuv_pars_vertex\x3e\n#include \x3cdisplacementmap_pars_vertex\x3e\n#include \x3ccolor_pars_vertex\x3e\n#include \x3cfog_pars_vertex\x3e\n#include \x3cnormal_pars_vertex\x3e\n#include \x3cmorphtarget_pars_vertex\x3e\n#include \x3cskinning_pars_vertex\x3e\n#include \x3cshadowmap_pars_vertex\x3e\n#include \x3clogdepthbuf_pars_vertex\x3e\n#include \x3cclipping_planes_pars_vertex\x3e\nvoid main() {\n\t#include \x3cuv_vertex\x3e\n\t#include \x3ccolor_vertex\x3e\n\t#include \x3cmorphcolor_vertex\x3e\n\t#include \x3cbeginnormal_vertex\x3e\n\t#include \x3cmorphnormal_vertex\x3e\n\t#include \x3cskinbase_vertex\x3e\n\t#include \x3cskinnormal_vertex\x3e\n\t#include \x3cdefaultnormal_vertex\x3e\n\t#include \x3cnormal_vertex\x3e\n\t#include \x3cbegin_vertex\x3e\n\t#include \x3cmorphtarget_vertex\x3e\n\t#include \x3cskinning_vertex\x3e\n\t#include \x3cdisplacementmap_vertex\x3e\n\t#include \x3cproject_vertex\x3e\n\t#include \x3clogdepthbuf_vertex\x3e\n\t#include \x3cclipping_planes_vertex\x3e\n\tvViewPosition \x3d - mvPosition.xyz;\n\t#include \x3cworldpos_vertex\x3e\n\t#include \x3cshadowmap_vertex\x3e\n\t#include \x3cfog_vertex\x3e\n}",
meshtoon_frag:"#define TOON\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float opacity;\n#include \x3ccommon\x3e\n#include \x3cpacking\x3e\n#include \x3cdithering_pars_fragment\x3e\n#include \x3ccolor_pars_fragment\x3e\n#include \x3cuv_pars_fragment\x3e\n#include \x3cmap_pars_fragment\x3e\n#include \x3calphamap_pars_fragment\x3e\n#include \x3calphatest_pars_fragment\x3e\n#include \x3calphahash_pars_fragment\x3e\n#include \x3caomap_pars_fragment\x3e\n#include \x3clightmap_pars_fragment\x3e\n#include \x3cemissivemap_pars_fragment\x3e\n#include \x3cgradientmap_pars_fragment\x3e\n#include \x3cfog_pars_fragment\x3e\n#include \x3cbsdfs\x3e\n#include \x3clights_pars_begin\x3e\n#include \x3cnormal_pars_fragment\x3e\n#include \x3clights_toon_pars_fragment\x3e\n#include \x3cshadowmap_pars_fragment\x3e\n#include \x3cbumpmap_pars_fragment\x3e\n#include \x3cnormalmap_pars_fragment\x3e\n#include \x3clogdepthbuf_pars_fragment\x3e\n#include \x3cclipping_planes_pars_fragment\x3e\nvoid main() {\n\t#include \x3cclipping_planes_fragment\x3e\n\tvec4 diffuseColor \x3d vec4( diffuse, opacity );\n\tReflectedLight reflectedLight \x3d ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance \x3d emissive;\n\t#include \x3clogdepthbuf_fragment\x3e\n\t#include \x3cmap_fragment\x3e\n\t#include \x3ccolor_fragment\x3e\n\t#include \x3calphamap_fragment\x3e\n\t#include \x3calphatest_fragment\x3e\n\t#include \x3calphahash_fragment\x3e\n\t#include \x3cnormal_fragment_begin\x3e\n\t#include \x3cnormal_fragment_maps\x3e\n\t#include \x3cemissivemap_fragment\x3e\n\t#include \x3clights_toon_fragment\x3e\n\t#include \x3clights_fragment_begin\x3e\n\t#include \x3clights_fragment_maps\x3e\n\t#include \x3clights_fragment_end\x3e\n\t#include \x3caomap_fragment\x3e\n\tvec3 outgoingLight \x3d reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;\n\t#include \x3copaque_fragment\x3e\n\t#include \x3ctonemapping_fragment\x3e\n\t#include \x3ccolorspace_fragment\x3e\n\t#include \x3cfog_fragment\x3e\n\t#include \x3cpremultiplied_alpha_fragment\x3e\n\t#include \x3cdithering_fragment\x3e\n}",
points_vert:"uniform float size;\nuniform float scale;\n#include \x3ccommon\x3e\n#include \x3ccolor_pars_vertex\x3e\n#include \x3cfog_pars_vertex\x3e\n#include \x3cmorphtarget_pars_vertex\x3e\n#include \x3clogdepthbuf_pars_vertex\x3e\n#include \x3cclipping_planes_pars_vertex\x3e\n#ifdef USE_POINTS_UV\n\tvarying vec2 vUv;\n\tuniform mat3 uvTransform;\n#endif\nvoid main() {\n\t#ifdef USE_POINTS_UV\n\t\tvUv \x3d ( uvTransform * vec3( uv, 1 ) ).xy;\n\t#endif\n\t#include \x3ccolor_vertex\x3e\n\t#include \x3cmorphcolor_vertex\x3e\n\t#include \x3cbegin_vertex\x3e\n\t#include \x3cmorphtarget_vertex\x3e\n\t#include \x3cproject_vertex\x3e\n\tgl_PointSize \x3d size;\n\t#ifdef USE_SIZEATTENUATION\n\t\tbool isPerspective \x3d isPerspectiveMatrix( projectionMatrix );\n\t\tif ( isPerspective ) gl_PointSize *\x3d ( scale / - mvPosition.z );\n\t#endif\n\t#include \x3clogdepthbuf_vertex\x3e\n\t#include \x3cclipping_planes_vertex\x3e\n\t#include \x3cworldpos_vertex\x3e\n\t#include \x3cfog_vertex\x3e\n}",
points_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#include \x3ccommon\x3e\n#include \x3ccolor_pars_fragment\x3e\n#include \x3cmap_particle_pars_fragment\x3e\n#include \x3calphatest_pars_fragment\x3e\n#include \x3calphahash_pars_fragment\x3e\n#include \x3cfog_pars_fragment\x3e\n#include \x3clogdepthbuf_pars_fragment\x3e\n#include \x3cclipping_planes_pars_fragment\x3e\nvoid main() {\n\t#include \x3cclipping_planes_fragment\x3e\n\tvec3 outgoingLight \x3d vec3( 0.0 );\n\tvec4 diffuseColor \x3d vec4( diffuse, opacity );\n\t#include \x3clogdepthbuf_fragment\x3e\n\t#include \x3cmap_particle_fragment\x3e\n\t#include \x3ccolor_fragment\x3e\n\t#include \x3calphatest_fragment\x3e\n\t#include \x3calphahash_fragment\x3e\n\toutgoingLight \x3d diffuseColor.rgb;\n\t#include \x3copaque_fragment\x3e\n\t#include \x3ctonemapping_fragment\x3e\n\t#include \x3ccolorspace_fragment\x3e\n\t#include \x3cfog_fragment\x3e\n\t#include \x3cpremultiplied_alpha_fragment\x3e\n}",
shadow_vert:"#include \x3ccommon\x3e\n#include \x3cfog_pars_vertex\x3e\n#include \x3cmorphtarget_pars_vertex\x3e\n#include \x3cskinning_pars_vertex\x3e\n#include \x3clogdepthbuf_pars_vertex\x3e\n#include \x3cshadowmap_pars_vertex\x3e\nvoid main() {\n\t#include \x3cbeginnormal_vertex\x3e\n\t#include \x3cmorphnormal_vertex\x3e\n\t#include \x3cskinbase_vertex\x3e\n\t#include \x3cskinnormal_vertex\x3e\n\t#include \x3cdefaultnormal_vertex\x3e\n\t#include \x3cbegin_vertex\x3e\n\t#include \x3cmorphtarget_vertex\x3e\n\t#include \x3cskinning_vertex\x3e\n\t#include \x3cproject_vertex\x3e\n\t#include \x3clogdepthbuf_vertex\x3e\n\t#include \x3cworldpos_vertex\x3e\n\t#include \x3cshadowmap_vertex\x3e\n\t#include \x3cfog_vertex\x3e\n}",
shadow_frag:"uniform vec3 color;\nuniform float opacity;\n#include \x3ccommon\x3e\n#include \x3cpacking\x3e\n#include \x3cfog_pars_fragment\x3e\n#include \x3cbsdfs\x3e\n#include \x3clights_pars_begin\x3e\n#include \x3clogdepthbuf_pars_fragment\x3e\n#include \x3cshadowmap_pars_fragment\x3e\n#include \x3cshadowmask_pars_fragment\x3e\nvoid main() {\n\t#include \x3clogdepthbuf_fragment\x3e\n\tgl_FragColor \x3d vec4( color, opacity * ( 1.0 - getShadowMask() ) );\n\t#include \x3ctonemapping_fragment\x3e\n\t#include \x3ccolorspace_fragment\x3e\n\t#include \x3cfog_fragment\x3e\n}",
sprite_vert:"uniform float rotation;\nuniform vec2 center;\n#include \x3ccommon\x3e\n#include \x3cuv_pars_vertex\x3e\n#include \x3cfog_pars_vertex\x3e\n#include \x3clogdepthbuf_pars_vertex\x3e\n#include \x3cclipping_planes_pars_vertex\x3e\nvoid main() {\n\t#include \x3cuv_vertex\x3e\n\tvec4 mvPosition \x3d modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );\n\tvec2 scale;\n\tscale.x \x3d length( vec3( modelMatrix[ 0 ].x, modelMatrix[ 0 ].y, modelMatrix[ 0 ].z ) );\n\tscale.y \x3d length( vec3( modelMatrix[ 1 ].x, modelMatrix[ 1 ].y, modelMatrix[ 1 ].z ) );\n\t#ifndef USE_SIZEATTENUATION\n\t\tbool isPerspective \x3d isPerspectiveMatrix( projectionMatrix );\n\t\tif ( isPerspective ) scale *\x3d - mvPosition.z;\n\t#endif\n\tvec2 alignedPosition \x3d ( position.xy - ( center - vec2( 0.5 ) ) ) * scale;\n\tvec2 rotatedPosition;\n\trotatedPosition.x \x3d cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;\n\trotatedPosition.y \x3d sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;\n\tmvPosition.xy +\x3d rotatedPosition;\n\tgl_Position \x3d projectionMatrix * mvPosition;\n\t#include \x3clogdepthbuf_vertex\x3e\n\t#include \x3cclipping_planes_vertex\x3e\n\t#include \x3cfog_vertex\x3e\n}",
sprite_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#include \x3ccommon\x3e\n#include \x3cuv_pars_fragment\x3e\n#include \x3cmap_pars_fragment\x3e\n#include \x3calphamap_pars_fragment\x3e\n#include \x3calphatest_pars_fragment\x3e\n#include \x3calphahash_pars_fragment\x3e\n#include \x3cfog_pars_fragment\x3e\n#include \x3clogdepthbuf_pars_fragment\x3e\n#include \x3cclipping_planes_pars_fragment\x3e\nvoid main() {\n\t#include \x3cclipping_planes_fragment\x3e\n\tvec3 outgoingLight \x3d vec3( 0.0 );\n\tvec4 diffuseColor \x3d vec4( diffuse, opacity );\n\t#include \x3clogdepthbuf_fragment\x3e\n\t#include \x3cmap_fragment\x3e\n\t#include \x3calphamap_fragment\x3e\n\t#include \x3calphatest_fragment\x3e\n\t#include \x3calphahash_fragment\x3e\n\toutgoingLight \x3d diffuseColor.rgb;\n\t#include \x3copaque_fragment\x3e\n\t#include \x3ctonemapping_fragment\x3e\n\t#include \x3ccolorspace_fragment\x3e\n\t#include \x3cfog_fragment\x3e\n}"};
q.ShaderChunk=p;const r={common:{diffuse:{value:new Ia(16777215)},opacity:{value:1},map:{value:null},mapTransform:{value:new Za},alphaMap:{value:null},alphaMapTransform:{value:new Za},alphaTest:{value:0}},specularmap:{specularMap:{value:null},specularMapTransform:{value:new Za}},envmap:{envMap:{value:null},flipEnvMap:{value:-1},reflectivity:{value:1},ior:{value:1.5},refractionRatio:{value:.98}},aomap:{aoMap:{value:null},aoMapIntensity:{value:1},aoMapTransform:{value:new Za}},lightmap:{lightMap:{value:null},
lightMapIntensity:{value:1},lightMapTransform:{value:new Za}},bumpmap:{bumpMap:{value:null},bumpMapTransform:{value:new Za},bumpScale:{value:1}},normalmap:{normalMap:{value:null},normalMapTransform:{value:new Za},normalScale:{value:new sa(1,1)}},displacementmap:{displacementMap:{value:null},displacementMapTransform:{value:new Za},displacementScale:{value:1},displacementBias:{value:0}},emissivemap:{emissiveMap:{value:null},emissiveMapTransform:{value:new Za}},metalnessmap:{metalnessMap:{value:null},
metalnessMapTransform:{value:new Za}},roughnessmap:{roughnessMap:{value:null},roughnessMapTransform:{value:new Za}},gradientmap:{gradientMap:{value:null}},fog:{fogDensity:{value:2.5E-4},fogNear:{value:1},fogFar:{value:2E3},fogColor:{value:new Ia(16777215)}},lights:{ambientLightColor:{value:[]},lightProbe:{value:[]},directionalLights:{value:[],properties:{direction:{},color:{}}},directionalLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},directionalShadowMap:{value:[]},
directionalShadowMatrix:{value:[]},spotLights:{value:[],properties:{color:{},position:{},direction:{},distance:{},coneCos:{},penumbraCos:{},decay:{}}},spotLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},spotLightMap:{value:[]},spotShadowMap:{value:[]},spotLightMatrix:{value:[]},pointLights:{value:[],properties:{color:{},position:{},decay:{},distance:{}}},pointLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},
shadowMapSize:{},shadowCameraNear:{},shadowCameraFar:{}}},pointShadowMap:{value:[]},pointShadowMatrix:{value:[]},hemisphereLights:{value:[],properties:{direction:{},skyColor:{},groundColor:{}}},rectAreaLights:{value:[],properties:{color:{},position:{},width:{},height:{}}},ltc_1:{value:null},ltc_2:{value:null}},points:{diffuse:{value:new Ia(16777215)},opacity:{value:1},size:{value:1},scale:{value:1},map:{value:null},alphaMap:{value:null},alphaMapTransform:{value:new Za},alphaTest:{value:0},uvTransform:{value:new Za}},
sprite:{diffuse:{value:new Ia(16777215)},opacity:{value:1},center:{value:new sa(.5,.5)},rotation:{value:0},map:{value:null},mapTransform:{value:new Za},alphaMap:{value:null},alphaMapTransform:{value:new Za},alphaTest:{value:0}}};q.UniformsLib=r;const x={basic:{uniforms:Ub([r.common,r.specularmap,r.envmap,r.aomap,r.lightmap,r.fog]),vertexShader:p.meshbasic_vert,fragmentShader:p.meshbasic_frag},lambert:{uniforms:Ub([r.common,r.specularmap,r.envmap,r.aomap,r.lightmap,r.emissivemap,r.bumpmap,r.normalmap,
r.displacementmap,r.fog,r.lights,{emissive:{value:new Ia(0)}}]),vertexShader:p.meshlambert_vert,fragmentShader:p.meshlambert_frag},phong:{uniforms:Ub([r.common,r.specularmap,r.envmap,r.aomap,r.lightmap,r.emissivemap,r.bumpmap,r.normalmap,r.displacementmap,r.fog,r.lights,{emissive:{value:new Ia(0)},specular:{value:new Ia(1118481)},shininess:{value:30}}]),vertexShader:p.meshphong_vert,fragmentShader:p.meshphong_frag},standard:{uniforms:Ub([r.common,r.envmap,r.aomap,r.lightmap,r.emissivemap,r.bumpmap,
r.normalmap,r.displacementmap,r.roughnessmap,r.metalnessmap,r.fog,r.lights,{emissive:{value:new Ia(0)},roughness:{value:1},metalness:{value:0},envMapIntensity:{value:1}}]),vertexShader:p.meshphysical_vert,fragmentShader:p.meshphysical_frag},toon:{uniforms:Ub([r.common,r.aomap,r.lightmap,r.emissivemap,r.bumpmap,r.normalmap,r.displacementmap,r.gradientmap,r.fog,r.lights,{emissive:{value:new Ia(0)}}]),vertexShader:p.meshtoon_vert,fragmentShader:p.meshtoon_frag},matcap:{uniforms:Ub([r.common,r.bumpmap,
r.normalmap,r.displacementmap,r.fog,{matcap:{value:null}}]),vertexShader:p.meshmatcap_vert,fragmentShader:p.meshmatcap_frag},points:{uniforms:Ub([r.points,r.fog]),vertexShader:p.points_vert,fragmentShader:p.points_frag},dashed:{uniforms:Ub([r.common,r.fog,{scale:{value:1},dashSize:{value:1},totalSize:{value:2}}]),vertexShader:p.linedashed_vert,fragmentShader:p.linedashed_frag},depth:{uniforms:Ub([r.common,r.displacementmap]),vertexShader:p.depth_vert,fragmentShader:p.depth_frag},normal:{uniforms:Ub([r.common,
r.bumpmap,r.normalmap,r.displacementmap,{opacity:{value:1}}]),vertexShader:p.meshnormal_vert,fragmentShader:p.meshnormal_frag},sprite:{uniforms:Ub([r.sprite,r.fog]),vertexShader:p.sprite_vert,fragmentShader:p.sprite_frag},background:{uniforms:{uvTransform:{value:new Za},t2D:{value:null},backgroundIntensity:{value:1}},vertexShader:p.background_vert,fragmentShader:p.background_frag},backgroundCube:{uniforms:{envMap:{value:null},flipEnvMap:{value:-1},backgroundBlurriness:{value:0},backgroundIntensity:{value:1}},
vertexShader:p.backgroundCube_vert,fragmentShader:p.backgroundCube_frag},cube:{uniforms:{tCube:{value:null},tFlip:{value:-1},opacity:{value:1}},vertexShader:p.cube_vert,fragmentShader:p.cube_frag},equirect:{uniforms:{tEquirect:{value:null}},vertexShader:p.equirect_vert,fragmentShader:p.equirect_frag},distanceRGBA:{uniforms:Ub([r.common,r.displacementmap,{referencePosition:{value:new O},nearDistance:{value:1},farDistance:{value:1E3}}]),vertexShader:p.distanceRGBA_vert,fragmentShader:p.distanceRGBA_frag},
shadow:{uniforms:Ub([r.lights,r.fog,{color:{value:new Ia(0)},opacity:{value:1}}]),vertexShader:p.shadow_vert,fragmentShader:p.shadow_frag}};q.ShaderLib=x;x.physical={uniforms:Ub([x.standard.uniforms,{clearcoat:{value:0},clearcoatMap:{value:null},clearcoatMapTransform:{value:new Za},clearcoatNormalMap:{value:null},clearcoatNormalMapTransform:{value:new Za},clearcoatNormalScale:{value:new sa(1,1)},clearcoatRoughness:{value:0},clearcoatRoughnessMap:{value:null},clearcoatRoughnessMapTransform:{value:new Za},
iridescence:{value:0},iridescenceMap:{value:null},iridescenceMapTransform:{value:new Za},iridescenceIOR:{value:1.3},iridescenceThicknessMinimum:{value:100},iridescenceThicknessMaximum:{value:400},iridescenceThicknessMap:{value:null},iridescenceThicknessMapTransform:{value:new Za},sheen:{value:0},sheenColor:{value:new Ia(0)},sheenColorMap:{value:null},sheenColorMapTransform:{value:new Za},sheenRoughness:{value:1},sheenRoughnessMap:{value:null},sheenRoughnessMapTransform:{value:new Za},transmission:{value:0},
transmissionMap:{value:null},transmissionMapTransform:{value:new Za},transmissionSamplerSize:{value:new sa},transmissionSamplerMap:{value:null},thickness:{value:0},thicknessMap:{value:null},thicknessMapTransform:{value:new Za},attenuationDistance:{value:0},attenuationColor:{value:new Ia(0)},specularColor:{value:new Ia(1,1,1)},specularColorMap:{value:null},specularColorMapTransform:{value:new Za},specularIntensity:{value:1},specularIntensityMap:{value:null},specularIntensityMapTransform:{value:new Za},
anisotropyVector:{value:new sa},anisotropyMap:{value:null},anisotropyMapTransform:{value:new Za}}]),vertexShader:p.meshphysical_vert,fragmentShader:p.meshphysical_frag};const z={r:0,b:0,g:0};class w extends vf{constructor(a=-1,b=1,c=1,d=-1,f=.1,g=2E3){super();this.isOrthographicCamera=!0;this.type="OrthographicCamera";this.zoom=1;this.view=null;this.left=a;this.right=b;this.top=c;this.bottom=d;this.near=f;this.far=g;this.updateProjectionMatrix()}copy(a,b){super.copy(a,b);this.left=a.left;this.right=
a.right;this.top=a.top;this.bottom=a.bottom;this.near=a.near;this.far=a.far;this.zoom=a.zoom;this.view=null===a.view?null:Object.assign({},a.view);return this}setViewOffset(a,b,c,d,f,g){null===this.view&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1});this.view.enabled=!0;this.view.fullWidth=a;this.view.fullHeight=b;this.view.offsetX=c;this.view.offsetY=d;this.view.width=f;this.view.height=g;this.updateProjectionMatrix()}clearViewOffset(){null!==this.view&&(this.view.enabled=
!1);this.updateProjectionMatrix()}updateProjectionMatrix(){var a=(this.right-this.left)/(2*this.zoom),b=(this.top-this.bottom)/(2*this.zoom),c=(this.right+this.left)/2,d=(this.top+this.bottom)/2;let f=c-a;c+=a;a=d+b;b=d-b;null!==this.view&&this.view.enabled&&(d=(this.right-this.left)/this.view.fullWidth/this.zoom,b=(this.top-this.bottom)/this.view.fullHeight/this.zoom,f+=d*this.view.offsetX,c=f+d*this.view.width,a-=b*this.view.offsetY,b=a-b*this.view.height);this.projectionMatrix.makeOrthographic(f,
c,a,b,this.near,this.far,this.coordinateSystem);this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(a){a=super.toJSON(a);a.object.zoom=this.zoom;a.object.left=this.left;a.object.right=this.right;a.object.top=this.top;a.object.bottom=this.bottom;a.object.near=this.near;a.object.far=this.far;null!==this.view&&(a.object.view=Object.assign({},this.view));return a}}q.OrthographicCamera=w;const C=[.125,.215,.35,.446,.526,.582],K=new w,R=new Ia;let M=null,V=0,T=0;const W=(1+Math.sqrt(5))/
2,S=1/W,ea=[new O(1,1,1),new O(-1,1,1),new O(1,1,-1),new O(-1,1,-1),new O(0,W,S),new O(0,W,-S),new O(S,0,W),new O(-S,0,W),new O(W,S,0),new O(-W,S,0)];class ha{constructor(a){this._renderer=a;this._pingPongRenderTarget=null;this._cubeSize=this._lodMax=0;this._lodPlanes=[];this._sizeLods=[];this._sigmas=[];this._equirectMaterial=this._cubemapMaterial=this._blurMaterial=null;this._compileMaterial(this._blurMaterial)}fromScene(a,b=0,c=.1,d=100){M=this._renderer.getRenderTarget();V=this._renderer.getActiveCubeFace();
T=this._renderer.getActiveMipmapLevel();this._setSize(256);const f=this._allocateTargets();f.depthBuffer=!0;this._sceneToCubeUV(a,c,d,f);0<b&&this._blur(f,0,0,b);this._applyPMREM(f);this._cleanup(f);return f}fromEquirectangular(a,b=null){return this._fromTexture(a,b)}fromCubemap(a,b=null){return this._fromTexture(a,b)}compileCubemapShader(){null===this._cubemapMaterial&&(this._cubemapMaterial=Hg(),this._compileMaterial(this._cubemapMaterial))}compileEquirectangularShader(){null===this._equirectMaterial&&
(this._equirectMaterial=Ka(),this._compileMaterial(this._equirectMaterial))}dispose(){this._dispose();null!==this._cubemapMaterial&&this._cubemapMaterial.dispose();null!==this._equirectMaterial&&this._equirectMaterial.dispose()}_setSize(a){this._lodMax=Math.floor(Math.log2(a));this._cubeSize=Math.pow(2,this._lodMax)}_dispose(){null!==this._blurMaterial&&this._blurMaterial.dispose();null!==this._pingPongRenderTarget&&this._pingPongRenderTarget.dispose();for(let a=0;a<this._lodPlanes.length;a++)this._lodPlanes[a].dispose()}_cleanup(a){this._renderer.setRenderTarget(M,
V,T);a.scissorTest=!1;qd(a,0,0,a.width,a.height)}_fromTexture(a,b){301===a.mapping||302===a.mapping?this._setSize(0===a.image.length?16:a.image[0].width||a.image[0].image.width):this._setSize(a.image.width/4);M=this._renderer.getRenderTarget();V=this._renderer.getActiveCubeFace();T=this._renderer.getActiveMipmapLevel();b=b||this._allocateTargets();this._textureToCubeUV(a,b);this._applyPMREM(b);this._cleanup(b);return b}_allocateTargets(){const a=3*Math.max(this._cubeSize,112),b=4*this._cubeSize;var c=
{magFilter:1006,minFilter:1006,generateMipmaps:!1,type:1016,format:1023,colorSpace:"srgb-linear",depthBuffer:!1};const d=oe(a,b,c);if(null===this._pingPongRenderTarget||this._pingPongRenderTarget.width!==a||this._pingPongRenderTarget.height!==b){null!==this._pingPongRenderTarget&&this._dispose();this._pingPongRenderTarget=oe(a,b,c);var {_lodMax:f}=this;c=f;var g=[];const t=[],u=[];let v=c;const A=c-4+1+C.length;for(let F=0;F<A;F++){var l=Math.pow(2,v);t.push(l);var m=1/l;F>c-4?m=C[F-c+4-1]:0===F&&
(m=0);u.push(m);m=1/(l-2);l=-m;m=1+m;var n=[l,l,m,l,m,m,l,l,m,m,l,m];l=new Float32Array(108);m=new Float32Array(72);const D=new Float32Array(36);for(let E=0;6>E;E++){const y=E%3*2/3-1,J=2<E?0:-1;l.set([y,J,0,y+2/3,J,0,y+2/3,J+1,0,y,J,0,y+2/3,J+1,0,y,J+1,0],18*E);m.set(n,12*E);D.set([E,E,E,E,E,E],6*E)}n=new ab;n.setAttribute("position",new rb(l,3));n.setAttribute("uv",new rb(m,2));n.setAttribute("faceIndex",new rb(D,1));g.push(n);4<v&&v--}({sizeLods:this._sizeLods,lodPlanes:this._lodPlanes,sigmas:this._sigmas}=
{lodPlanes:g,sizeLods:t,sigmas:u});c=f;f=new Float32Array(20);g=new O(0,1,0);this._blurMaterial=new bc({name:"SphericalGaussianBlur",defines:{n:20,CUBEUV_TEXEL_WIDTH:1/a,CUBEUV_TEXEL_HEIGHT:1/b,CUBEUV_MAX_MIP:`${c}.0`},uniforms:{envMap:{value:null},samples:{value:1},weights:{value:f},latitudinal:{value:!1},dTheta:{value:0},mipInt:{value:0},poleAxis:{value:g}},vertexShader:Mf(),fragmentShader:"\n\n\t\t\tprecision mediump float;\n\t\t\tprecision mediump int;\n\n\t\t\tvarying vec3 vOutputDirection;\n\n\t\t\tuniform sampler2D envMap;\n\t\t\tuniform int samples;\n\t\t\tuniform float weights[ n ];\n\t\t\tuniform bool latitudinal;\n\t\t\tuniform float dTheta;\n\t\t\tuniform float mipInt;\n\t\t\tuniform vec3 poleAxis;\n\n\t\t\t#define ENVMAP_TYPE_CUBE_UV\n\t\t\t#include \x3ccube_uv_reflection_fragment\x3e\n\n\t\t\tvec3 getSample( float theta, vec3 axis ) {\n\n\t\t\t\tfloat cosTheta \x3d cos( theta );\n\t\t\t\t// Rodrigues' axis-angle rotation\n\t\t\t\tvec3 sampleDirection \x3d vOutputDirection * cosTheta\n\t\t\t\t\t+ cross( axis, vOutputDirection ) * sin( theta )\n\t\t\t\t\t+ axis * dot( axis, vOutputDirection ) * ( 1.0 - cosTheta );\n\n\t\t\t\treturn bilinearCubeUV( envMap, sampleDirection, mipInt );\n\n\t\t\t}\n\n\t\t\tvoid main() {\n\n\t\t\t\tvec3 axis \x3d latitudinal ? poleAxis : cross( poleAxis, vOutputDirection );\n\n\t\t\t\tif ( all( equal( axis, vec3( 0.0 ) ) ) ) {\n\n\t\t\t\t\taxis \x3d vec3( vOutputDirection.z, 0.0, - vOutputDirection.x );\n\n\t\t\t\t}\n\n\t\t\t\taxis \x3d normalize( axis );\n\n\t\t\t\tgl_FragColor \x3d vec4( 0.0, 0.0, 0.0, 1.0 );\n\t\t\t\tgl_FragColor.rgb +\x3d weights[ 0 ] * getSample( 0.0, axis );\n\n\t\t\t\tfor ( int i \x3d 1; i \x3c n; i++ ) {\n\n\t\t\t\t\tif ( i \x3e\x3d samples ) {\n\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\t}\n\n\t\t\t\t\tfloat theta \x3d dTheta * float( i );\n\t\t\t\t\tgl_FragColor.rgb +\x3d weights[ i ] * getSample( -1.0 * theta, axis );\n\t\t\t\t\tgl_FragColor.rgb +\x3d weights[ i ] * getSample( theta, axis );\n\n\t\t\t\t}\n\n\t\t\t}\n\t\t",
blending:0,depthTest:!1,depthWrite:!1})}return d}_compileMaterial(a){a=new cb(this._lodPlanes[0],a);this._renderer.compile(a,K)}_sceneToCubeUV(a,b,c,d){b=new Rb(90,1,b,c);c=[1,-1,1,1,1,1];const f=[1,1,1,-1,-1,-1],g=this._renderer,l=g.autoClear,m=g.toneMapping;g.getClearColor(R);g.toneMapping=0;g.autoClear=!1;var n=new gd({name:"PMREM.Background",side:1,depthWrite:!1,depthTest:!1});const t=new cb(new Ld,n);let u=!1;const v=a.background;v?v.isColor&&(n.color.copy(v),a.background=null,u=!0):(n.color.copy(R),
u=!0);for(n=0;6>n;n++){const A=n%3;0===A?(b.up.set(0,c[n],0),b.lookAt(f[n],0,0)):1===A?(b.up.set(0,0,c[n]),b.lookAt(0,f[n],0)):(b.up.set(0,c[n],0),b.lookAt(0,0,f[n]));const F=this._cubeSize;qd(d,A*F,2<n?F:0,F,F);g.setRenderTarget(d);u&&g.render(t,b);g.render(a,b)}t.geometry.dispose();t.material.dispose();g.toneMapping=m;g.autoClear=l;a.background=v}_textureToCubeUV(a,b){const c=this._renderer;var d=301===a.mapping||302===a.mapping;d?(null===this._cubemapMaterial&&(this._cubemapMaterial=Hg()),this._cubemapMaterial.uniforms.flipEnvMap.value=
!1===a.isRenderTargetTexture?-1:1):null===this._equirectMaterial&&(this._equirectMaterial=Ka());const f=d?this._cubemapMaterial:this._equirectMaterial;d=new cb(this._lodPlanes[0],f);f.uniforms.envMap.value=a;a=this._cubeSize;qd(b,0,0,3*a,2*a);c.setRenderTarget(b);c.render(d,K)}_applyPMREM(a){const b=this._renderer,c=b.autoClear;b.autoClear=!1;for(let d=1;d<this._lodPlanes.length;d++)this._blur(a,d-1,d,Math.sqrt(this._sigmas[d]*this._sigmas[d]-this._sigmas[d-1]*this._sigmas[d-1]),ea[(d-1)%ea.length]);
b.autoClear=c}_blur(a,b,c,d,f){const g=this._pingPongRenderTarget;this._halfBlur(a,g,b,c,d,"latitudinal",f);this._halfBlur(g,a,c,c,d,"longitudinal",f)}_halfBlur(a,b,c,d,f,g,l){const m=this._renderer;var n=this._blurMaterial;"latitudinal"!==g&&"longitudinal"!==g&&console.error("blur direction must be either latitudinal or longitudinal!");const t=new cb(this._lodPlanes[d],n);n=n.uniforms;var u=this._sizeLods[c]-1;u=isFinite(f)?Math.PI/(2*u):2*Math.PI/39;var v=f/u;const A=isFinite(f)?1+Math.floor(3*
v):20;20<A&&console.warn(`sigmaRadians, ${f}, is too large and will clip, as it requested ${A} samples when the maximum is set to ${20}`);f=[];let F=0;for(let E=0;20>E;++E){var D=E/v;D=Math.exp(-D*D/2);f.push(D);0===E?F+=D:E<A&&(F+=2*D)}for(v=0;v<f.length;v++)f[v]/=F;n.envMap.value=a.texture;n.samples.value=A;n.weights.value=f;n.latitudinal.value="latitudinal"===g;l&&(n.poleAxis.value=l);({_lodMax:a}=this);n.dTheta.value=u;n.mipInt.value=a-c;c=this._sizeLods[d];qd(b,3*c*(d>a-4?d-a+4:0),4*(this._cubeSize-
c),3*c,2*c);m.setRenderTarget(b);m.render(t,K)}}q.PMREMGenerator=ha;const ya=new Gb,za=new Ue,Ua=new xc,Pa=new Ae,pb=[],db=[],qb=new Float32Array(16),Cb=new Float32Array(9),mc=new Float32Array(4);class gb{constructor(a,b,c){this.id=a;this.addr=c;this.cache=[];this.setValue=pe(b.type)}}class ic{constructor(a,b,c){this.id=a;this.addr=c;this.cache=[];this.size=b.size;this.setValue=Ei(b.type)}}class sb{constructor(a){this.id=a;this.seq=[];this.map={}}setValue(a,b,c){const d=this.seq;for(let f=0,g=d.length;f!==
g;++f){const l=d[f];l.setValue(a,b[l.id],c)}}}const Nb=/(\w+)(\])?(\[|\.)?/g;class bb{constructor(a,b){this.seq=[];this.map={};const c=a.getProgramParameter(b,a.ACTIVE_UNIFORMS);for(let t=0;t<c;++t){var d=a.getActiveUniform(b,t),f=a.getUniformLocation(b,d.name),g=this,l=d.name;const u=l.length;for(Nb.lastIndex=0;;){const v=Nb.exec(l),A=Nb.lastIndex;var m=v[1],n=v[3];"]"===v[2]&&(m|=0);if(void 0===n||"["===n&&A+2===u){l=g;d=void 0===n?new gb(m,d,f):new ic(m,d,f);l.seq.push(d);l.map[d.id]=d;break}else n=
g.map[m],void 0===n&&(n=new sb(m),m=g,g=n,m.seq.push(g),m.map[g.id]=g),g=n}}}setValue(a,b,c,d){b=this.map[b];void 0!==b&&b.setValue(a,c,d)}setOptional(a,b,c){b=b[c];void 0!==b&&this.setValue(a,c,b)}static upload(a,b,c,d){for(let f=0,g=b.length;f!==g;++f){const l=b[f],m=c[l.id];!1!==m.needsUpdate&&l.setValue(a,m.value,d)}}static seqWithValue(a,b){const c=[];for(let d=0,f=a.length;d!==f;++d){const g=a[d];g.id in b&&c.push(g)}return c}}let vc=0;const fc=/^[ \t]*#include +<([\w\d./]+)>/gm,uc=new Map([["encodings_fragment",
"colorspace_fragment"],["encodings_pars_fragment","colorspace_pars_fragment"],["output_fragment","opaque_fragment"]]),nc=/#pragma unroll_loop_start\s+for\s*\(\s*int\s+i\s*=\s*(\d+)\s*;\s*i\s*<\s*(\d+)\s*;\s*i\s*\+\+\s*\)\s*{([\s\S]+?)}\s+#pragma unroll_loop_end/g;let Dc=0;class Ze{constructor(){this.shaderCache=new Map;this.materialCache=new Map}update(a){var b=a.fragmentShader;const c=this._getShaderStage(a.vertexShader);b=this._getShaderStage(b);a=this._getShaderCacheForMaterial(a);!1===a.has(c)&&
(a.add(c),c.usedTimes++);!1===a.has(b)&&(a.add(b),b.usedTimes++);return this}remove(a){const b=this.materialCache.get(a);for(const c of b)c.usedTimes--,0===c.usedTimes&&this.shaderCache.delete(c.code);this.materialCache.delete(a);return this}getVertexShaderID(a){return this._getShaderStage(a.vertexShader).id}getFragmentShaderID(a){return this._getShaderStage(a.fragmentShader).id}dispose(){this.shaderCache.clear();this.materialCache.clear()}_getShaderCacheForMaterial(a){const b=this.materialCache;
let c=b.get(a);void 0===c&&(c=new Set,b.set(a,c));return c}_getShaderStage(a){const b=this.shaderCache;let c=b.get(a);void 0===c&&(c=new he(a),b.set(a,c));return c}}class he{constructor(a){this.id=Dc++;this.code=a;this.usedTimes=0}}let Sf=0;class $e extends Wb{constructor(a){super();this.isMeshDepthMaterial=!0;this.type="MeshDepthMaterial";this.depthPacking=3200;this.displacementMap=this.alphaMap=this.map=null;this.displacementScale=1;this.displacementBias=0;this.wireframe=!1;this.wireframeLinewidth=
1;this.setValues(a)}copy(a){super.copy(a);this.depthPacking=a.depthPacking;this.map=a.map;this.alphaMap=a.alphaMap;this.displacementMap=a.displacementMap;this.displacementScale=a.displacementScale;this.displacementBias=a.displacementBias;this.wireframe=a.wireframe;this.wireframeLinewidth=a.wireframeLinewidth;return this}}q.MeshDepthMaterial=$e;class Ri extends Wb{constructor(a){super();this.isMeshDistanceMaterial=!0;this.type="MeshDistanceMaterial";this.displacementMap=this.alphaMap=this.map=null;
this.displacementScale=1;this.displacementBias=0;this.setValues(a)}copy(a){super.copy(a);this.map=a.map;this.alphaMap=a.alphaMap;this.displacementMap=a.displacementMap;this.displacementScale=a.displacementScale;this.displacementBias=a.displacementBias;return this}}q.MeshDistanceMaterial=Ri;class ok extends Rb{constructor(a=[]){super();this.isArrayCamera=!0;this.cameras=a}}q.ArrayCamera=ok;class wf extends hb{constructor(){super();this.isGroup=!0;this.type="Group"}}q.Group=wf;const Wl={type:"move"};
class sj{constructor(){this._hand=this._grip=this._targetRay=null}getHandSpace(){null===this._hand&&(this._hand=new wf,this._hand.matrixAutoUpdate=!1,this._hand.visible=!1,this._hand.joints={},this._hand.inputState={pinching:!1});return this._hand}getTargetRaySpace(){null===this._targetRay&&(this._targetRay=new wf,this._targetRay.matrixAutoUpdate=!1,this._targetRay.visible=!1,this._targetRay.hasLinearVelocity=!1,this._targetRay.linearVelocity=new O,this._targetRay.hasAngularVelocity=!1,this._targetRay.angularVelocity=
new O);return this._targetRay}getGripSpace(){null===this._grip&&(this._grip=new wf,this._grip.matrixAutoUpdate=!1,this._grip.visible=!1,this._grip.hasLinearVelocity=!1,this._grip.linearVelocity=new O,this._grip.hasAngularVelocity=!1,this._grip.angularVelocity=new O);return this._grip}dispatchEvent(a){null!==this._targetRay&&this._targetRay.dispatchEvent(a);null!==this._grip&&this._grip.dispatchEvent(a);null!==this._hand&&this._hand.dispatchEvent(a);return this}connect(a){if(a&&a.hand){const b=this._hand;
if(b)for(const c of a.hand.values())this._getHandJoint(b,c)}this.dispatchEvent({type:"connected",data:a});return this}disconnect(a){this.dispatchEvent({type:"disconnected",data:a});null!==this._targetRay&&(this._targetRay.visible=!1);null!==this._grip&&(this._grip.visible=!1);null!==this._hand&&(this._hand.visible=!1);return this}update(a,b,c){let d=null,f=null,g=null;const l=this._targetRay,m=this._grip,n=this._hand;if(a&&"visible-blurred"!==b.session.visibilityState){if(n&&a.hand){g=!0;for(var t of a.hand.values()){const u=
b.getJointPose(t,c),v=this._getHandJoint(n,t);null!==u&&(v.matrix.fromArray(u.transform.matrix),v.matrix.decompose(v.position,v.rotation,v.scale),v.matrixWorldNeedsUpdate=!0,v.jointRadius=u.radius);v.visible=null!==u}t=n.joints["index-finger-tip"].position.distanceTo(n.joints["thumb-tip"].position);n.inputState.pinching&&.025<t?(n.inputState.pinching=!1,this.dispatchEvent({type:"pinchend",handedness:a.handedness,target:this})):!n.inputState.pinching&&.015>=t&&(n.inputState.pinching=!0,this.dispatchEvent({type:"pinchstart",
handedness:a.handedness,target:this}))}else null!==m&&a.gripSpace&&(f=b.getPose(a.gripSpace,c),null!==f&&(m.matrix.fromArray(f.transform.matrix),m.matrix.decompose(m.position,m.rotation,m.scale),m.matrixWorldNeedsUpdate=!0,f.linearVelocity?(m.hasLinearVelocity=!0,m.linearVelocity.copy(f.linearVelocity)):m.hasLinearVelocity=!1,f.angularVelocity?(m.hasAngularVelocity=!0,m.angularVelocity.copy(f.angularVelocity)):m.hasAngularVelocity=!1));null!==l&&(d=b.getPose(a.targetRaySpace,c),null===d&&null!==f&&
(d=f),null!==d&&(l.matrix.fromArray(d.transform.matrix),l.matrix.decompose(l.position,l.rotation,l.scale),l.matrixWorldNeedsUpdate=!0,d.linearVelocity?(l.hasLinearVelocity=!0,l.linearVelocity.copy(d.linearVelocity)):l.hasLinearVelocity=!1,d.angularVelocity?(l.hasAngularVelocity=!0,l.angularVelocity.copy(d.angularVelocity)):l.hasAngularVelocity=!1,this.dispatchEvent(Wl)))}null!==l&&(l.visible=null!==d);null!==m&&(m.visible=null!==f);null!==n&&(n.visible=null!==g);return this}_getHandJoint(a,b){if(void 0===
a.joints[b.jointName]){const c=new wf;c.matrixAutoUpdate=!1;c.visible=!1;a.joints[b.jointName]=c;a.add(c)}return a.joints[b.jointName]}}class pk extends Gb{constructor(a,b,c,d,f,g,l,m,n,t){t=void 0!==t?t:1026;if(1026!==t&&1027!==t)throw Error("DepthTexture format must be either THREE.DepthFormat or THREE.DepthStencilFormat");void 0===c&&1026===t&&(c=1014);void 0===c&&1027===t&&(c=1020);super(null,d,f,g,l,m,t,c,n);this.isDepthTexture=!0;this.image={width:a,height:b};this.magFilter=void 0!==l?l:1003;
this.minFilter=void 0!==m?m:1003;this.generateMipmaps=this.flipY=!1;this.compareFunction=null}copy(a){super.copy(a);this.compareFunction=a.compareFunction;return this}toJSON(a){a=super.toJSON(a);null!==this.compareFunction&&(a.compareFunction=this.compareFunction);return a}}q.DepthTexture=pk;class Xl extends Pc{constructor(a,b){function c(ia){var wa=ja.indexOf(ia.inputSource);-1!==wa&&(wa=X[wa],void 0!==wa&&(wa.update(ia.inputSource,ia.frame,A||t),wa.dispatchEvent({type:ia.type,data:ia.inputSource})))}
function d(){m.removeEventListener("select",c);m.removeEventListener("selectstart",c);m.removeEventListener("selectend",c);m.removeEventListener("squeeze",c);m.removeEventListener("squeezestart",c);m.removeEventListener("squeezeend",c);m.removeEventListener("end",d);m.removeEventListener("inputsourceschange",f);for(let ia=0;ia<X.length;ia++){const wa=ja[ia];null!==wa&&(ja[ia]=null,X[ia].disconnect(wa))}qa=xa=null;a.setRenderTarget(U);P=m=D=E=y=null;Ga.stop();l.isPresenting=!1;l.dispatchEvent({type:"sessionend"})}
function f(ia){for(var wa=0;wa<ia.removed.length;wa++){var ra=ia.removed[wa],Sa=ja.indexOf(ra);0<=Sa&&(ja[Sa]=null,X[Sa].disconnect(ra))}for(wa=0;wa<ia.added.length;wa++){ra=ia.added[wa];Sa=ja.indexOf(ra);if(-1===Sa){for(let Da=0;Da<X.length;Da++)if(Da>=ja.length){ja.push(ra);Sa=Da;break}else if(null===ja[Da]){ja[Da]=ra;Sa=Da;break}if(-1===Sa)break}(Sa=X[Sa])&&Sa.connect(ra)}}function g(ia,wa){null===wa?ia.matrixWorld.copy(ia.matrix):ia.matrixWorld.multiplyMatrices(wa.matrixWorld,ia.matrix);ia.matrixWorldInverse.copy(ia.matrixWorld).invert()}
super();const l=this;let m=null,n=1,t=null,u="local-floor",v=1,A=null,F=null,D=null,E=null,y=null,J=null;const L=b.getContextAttributes();let U=null,P=null;const X=[],ja=[],fa=new Rb;fa.layers.enable(1);fa.viewport=new mb;const aa=new Rb;aa.layers.enable(2);aa.viewport=new mb;const pa=[fa,aa],ba=new ok;ba.layers.enable(1);ba.layers.enable(2);let xa=null,qa=null;this.cameraAutoUpdate=!0;this.isPresenting=this.enabled=!1;this.getController=function(ia){let wa=X[ia];void 0===wa&&(wa=new sj,X[ia]=wa);
return wa.getTargetRaySpace()};this.getControllerGrip=function(ia){let wa=X[ia];void 0===wa&&(wa=new sj,X[ia]=wa);return wa.getGripSpace()};this.getHand=function(ia){let wa=X[ia];void 0===wa&&(wa=new sj,X[ia]=wa);return wa.getHandSpace()};this.setFramebufferScaleFactor=function(ia){n=ia;!0===l.isPresenting&&console.warn("THREE.WebXRManager: Cannot change framebuffer scale while presenting.")};this.setReferenceSpaceType=function(ia){u=ia;!0===l.isPresenting&&console.warn("THREE.WebXRManager: Cannot change reference space type while presenting.")};
this.getReferenceSpace=function(){return A||t};this.setReferenceSpace=function(ia){A=ia};this.getBaseLayer=function(){return null!==E?E:y};this.getBinding=function(){return D};this.getFrame=function(){return J};this.getSession=function(){return m};this.setSession=async function(ia){m=ia;if(null!==m){U=a.getRenderTarget();m.addEventListener("select",c);m.addEventListener("selectstart",c);m.addEventListener("selectend",c);m.addEventListener("squeeze",c);m.addEventListener("squeezestart",c);m.addEventListener("squeezeend",
c);m.addEventListener("end",d);m.addEventListener("inputsourceschange",f);!0!==L.xrCompatible&&await b.makeXRCompatible();if(void 0===m.renderState.layers||!1===a.capabilities.isWebGL2)y=new XRWebGLLayer(m,b,{antialias:void 0===m.renderState.layers?L.antialias:!0,alpha:!0,depth:L.depth,stencil:L.stencil,framebufferScaleFactor:n}),m.updateRenderState({baseLayer:y}),P=new rc(y.framebufferWidth,y.framebufferHeight,{format:1023,type:1009,colorSpace:a.outputColorSpace,stencilBuffer:L.stencil});else{let ra=
ia=null;var wa=null;L.depth&&(wa=L.stencil?b.DEPTH24_STENCIL8:b.DEPTH_COMPONENT24,ia=L.stencil?1027:1026,ra=L.stencil?1020:1014);wa={colorFormat:b.RGBA8,depthFormat:wa,scaleFactor:n};D=new XRWebGLBinding(m,b);E=D.createProjectionLayer(wa);m.updateRenderState({layers:[E]});P=new rc(E.textureWidth,E.textureHeight,{format:1023,type:1009,depthTexture:new pk(E.textureWidth,E.textureHeight,ra,void 0,void 0,void 0,void 0,void 0,void 0,ia),stencilBuffer:L.stencil,colorSpace:a.outputColorSpace,samples:L.antialias?
4:0});a.properties.get(P).__ignoreDepthValues=E.ignoreDepthValues}P.isXRRenderTarget=!0;this.setFoveation(v);A=null;t=await m.requestReferenceSpace(u);Ga.setContext(m);Ga.start();l.isPresenting=!0;l.dispatchEvent({type:"sessionstart"})}};this.getEnvironmentBlendMode=function(){if(null!==m)return m.environmentBlendMode};const ta=new O,Ba=new O;this.updateCamera=function(ia){if(null!==m){ba.near=aa.near=fa.near=ia.near;ba.far=aa.far=fa.far=ia.far;if(xa!==ba.near||qa!==ba.far)m.updateRenderState({depthNear:ba.near,
depthFar:ba.far}),xa=ba.near,qa=ba.far;var wa=ia.parent,ra=ba.cameras;g(ba,wa);for(var Sa=0;Sa<ra.length;Sa++)g(ra[Sa],wa);if(2===ra.length){ta.setFromMatrixPosition(fa.matrixWorld);Ba.setFromMatrixPosition(aa.matrixWorld);ra=ta.distanceTo(Ba);var Da=fa.projectionMatrix.elements,Na=aa.projectionMatrix.elements,Ea=Da[14]/(Da[10]-1);Sa=Da[14]/(Da[10]+1);const I=(Da[9]+1)/Da[5],Q=(Da[9]-1)/Da[5];var Ta=(Da[8]-1)/Da[0],G=(Na[8]+1)/Na[0];Na=Ea*Ta;Da=Ea*G;G=ra/(-Ta+G);Ta=G*-Ta;fa.matrixWorld.decompose(ba.position,
ba.quaternion,ba.scale);ba.translateX(Ta);ba.translateZ(G);ba.matrixWorld.compose(ba.position,ba.quaternion,ba.scale);ba.matrixWorldInverse.copy(ba.matrixWorld).invert();Ea+=G;G=Sa+G;ba.projectionMatrix.makePerspective(Na-Ta,Da+(ra-Ta),I*Sa/G*Ea,Q*Sa/G*Ea,Ea,G);ba.projectionMatrixInverse.copy(ba.projectionMatrix).invert()}else ba.projectionMatrix.copy(fa.projectionMatrix);null===wa?ia.matrix.copy(ba.matrixWorld):(ia.matrix.copy(wa.matrixWorld),ia.matrix.invert(),ia.matrix.multiply(ba.matrixWorld));
ia.matrix.decompose(ia.position,ia.quaternion,ia.scale);ia.updateMatrixWorld(!0);ia.projectionMatrix.copy(ba.projectionMatrix);ia.projectionMatrixInverse.copy(ba.projectionMatrixInverse);ia.isPerspectiveCamera&&(ia.fov=2*Wd*Math.atan(1/ia.projectionMatrix.elements[5]),ia.zoom=1)}};this.getCamera=function(){return ba};this.getFoveation=function(){if(null!==E||null!==y)return v};this.setFoveation=function(ia){v=ia;null!==E&&(E.fixedFoveation=ia);null!==y&&void 0!==y.fixedFoveation&&(y.fixedFoveation=
ia)};let va=null;const Ga=new Se;Ga.setAnimationLoop(function(ia,wa){F=wa.getViewerPose(A||t);J=wa;if(null!==F){var ra=F.views;null!==y&&(a.setRenderTargetFramebuffer(P,y.framebuffer),a.setRenderTarget(P));var Sa=!1;ra.length!==ba.cameras.length&&(ba.cameras.length=0,Sa=!0);for(var Da=0;Da<ra.length;Da++){const Ea=ra[Da];let Ta;if(null!==y)Ta=y.getViewport(Ea);else{var Na=D.getViewSubImage(E,Ea);Ta=Na.viewport;0===Da&&(a.setRenderTargetTextures(P,Na.colorTexture,E.ignoreDepthValues?void 0:Na.depthStencilTexture),
a.setRenderTarget(P))}Na=pa[Da];void 0===Na&&(Na=new Rb,Na.layers.enable(Da),Na.viewport=new mb,pa[Da]=Na);Na.matrix.fromArray(Ea.transform.matrix);Na.matrix.decompose(Na.position,Na.quaternion,Na.scale);Na.projectionMatrix.fromArray(Ea.projectionMatrix);Na.projectionMatrixInverse.copy(Na.projectionMatrix).invert();Na.viewport.set(Ta.x,Ta.y,Ta.width,Ta.height);0===Da&&(ba.matrix.copy(Na.matrix),ba.matrix.decompose(ba.position,ba.quaternion,ba.scale));!0===Sa&&ba.cameras.push(Na)}}for(ra=0;ra<X.length;ra++)Sa=
ja[ra],Da=X[ra],null!==Sa&&void 0!==Da&&Da.update(Sa,wa,A||t);va&&va(ia,wa);wa.detectedPlanes&&l.dispatchEvent({type:"planesdetected",data:wa});J=null});this.setAnimationLoop=function(ia){va=ia};this.dispose=function(){}}}class qk{constructor(a={}){function b(H,ca){for(let ma=0;ma<H.length;ma++){const oa=L.getContext(H[ma],ca);if(null!==oa)return oa}return null}function c(){Db=new fi(na);ub=new Te(na,Db,a);Db.init(ub);hd=new bh(na,Db,ub);fb=new Si(na,Db,ub);wc=new ii(na);vb=new Sd;zb=new td(na,Db,
fb,vb,ub,hd,wc);sd=new Fc(ra);xf=new ei(ra);qg=new Lf(na,ub);De=new ci(na,Db,qg,ub);tj=new gi(na,qg,wc,De);yf=new mi(na,tj,qg,wc);rk=new li(na,ub,zb);id=new ad(vb);Cd=new Ii(ra,sd,xf,Db,ub,De,id);uj=new Ti(ra,vb);Bh=new Ki;Ch=new Pi(Db,ub);jd=new bi(ra,sd,xf,fb,yf,qa,aa);Wc=new Qi(ra,yf,ub);Dh=new Ui(na,wc,ub,fb);sk=new di(na,Db,wc,ub);tk=new hi(na,Db,wc,ub);wc.programs=Cd.programs;ra.capabilities=ub;ra.extensions=Db;ra.properties=vb;ra.renderLists=Bh;ra.shadowMap=Wc;ra.state=fb;ra.info=wc}function d(H){H.preventDefault();
console.log("THREE.WebGLRenderer: Context Lost.");Sa=!0}function f(){console.log("THREE.WebGLRenderer: Context Restored.");Sa=!1;const H=wc.autoReset,ca=Wc.enabled,ma=Wc.autoUpdate,oa=Wc.needsUpdate,ka=Wc.type;c();wc.autoReset=H;Wc.enabled=ca;Wc.autoUpdate=ma;Wc.needsUpdate=oa;Wc.type=ka}function g(H){console.error("THREE.WebGLRenderer: A WebGL context could not be created. Reason: ",H.statusMessage)}function l(H){H=H.target;H.removeEventListener("dispose",l);m(H);vb.remove(H)}function m(H){const ca=
vb.get(H).programs;void 0!==ca&&(ca.forEach(function(ma){Cd.releaseProgram(ma)}),H.isShaderMaterial&&Cd.releaseShaderCache(H))}function n(H,ca,ma){!0===H.transparent&&2===H.side&&!1===H.forceSinglePass?(H.side=1,H.needsUpdate=!0,E(H,ca,ma),H.side=0,H.needsUpdate=!0,E(H,ca,ma),H.side=2):E(H,ca,ma)}function t(){Ee.stop()}function u(){Ee.start()}function v(H,ca,ma,oa){if(!1!==H.visible){if(H.layers.test(ca.layers))if(H.isGroup)ma=H.renderOrder;else if(H.isLOD)!0===H.autoUpdate&&H.update(ca);else if(H.isLight)Ga.pushLight(H),
H.castShadow&&Ga.pushShadow(H);else if(H.isSprite){if(!H.frustumCulled||Qa.intersectsSprite(H)){oa&&Nc.setFromMatrixPosition(H.matrixWorld).applyMatrix4(gc);var ka=yf.update(H),La=H.material;La.visible&&va.push(H,ka,La,ma,Nc.z,null)}}else if(H.isMesh||H.isLine||H.isPoints)if(!H.frustumCulled||Qa.intersectsObject(H))if(ka=yf.update(H),La=H.material,oa&&(void 0!==H.boundingSphere?(null===H.boundingSphere&&H.computeBoundingSphere(),Nc.copy(H.boundingSphere.center)):(null===ka.boundingSphere&&ka.computeBoundingSphere(),
Nc.copy(ka.boundingSphere.center)),Nc.applyMatrix4(H.matrixWorld).applyMatrix4(gc)),Array.isArray(La)){const Ra=ka.groups;for(let Ma=0,ib=Ra.length;Ma<ib;Ma++){const wb=Ra[Ma],eb=La[wb.materialIndex];eb&&eb.visible&&va.push(H,ka,eb,ma,Nc.z,wb)}}else La.visible&&va.push(H,ka,La,ma,Nc.z,null);H=H.children;for(let Ra=0,Ma=H.length;Ra<Ma;Ra++)v(H[Ra],ca,ma,oa)}}function A(H,ca,ma,oa){const ka=H.opaque,La=H.transmissive;H=H.transparent;Ga.setupLightsView(ma);!0===nb&&id.setGlobalState(ra.clippingPlanes,
ma);if(0<La.length&&null===(!0===ca.isScene?ca.overrideMaterial:null)){var Ra=ub.isWebGL2;null===Bb&&(Bb=new rc(1,1,{generateMipmaps:!0,type:Db.has("EXT_color_buffer_half_float")?1016:1009,minFilter:1008,samples:Ra?4:0}));ra.getDrawingBufferSize(Rd);Ra?Bb.setSize(Rd.x,Rd.y):Bb.setSize(Ne(Rd.x),Ne(Rd.y));Ra=ra.getRenderTarget();ra.setRenderTarget(Bb);ra.getClearColor(Z);Fa=ra.getClearAlpha();1>Fa&&ra.setClearColor(16777215,.5);ra.clear();var Ma=ra.toneMapping;ra.toneMapping=0;F(ka,ca,ma);zb.updateMultisampleRenderTarget(Bb);
zb.updateRenderTargetMipmap(Bb);var ib=!1;for(let eb=0,Zb=La.length;eb<Zb;eb++){var wb=La[eb];const kd=wb.object,Xc=wb.geometry,Yc=wb.material;wb=wb.group;2===Yc.side&&kd.layers.test(ma.layers)&&(ib=Yc.side,Yc.side=1,Yc.needsUpdate=!0,D(kd,ca,ma,Xc,Yc,wb),Yc.side=ib,ib=Yc.needsUpdate=!0)}!0===ib&&(zb.updateMultisampleRenderTarget(Bb),zb.updateRenderTargetMipmap(Bb));ra.setRenderTarget(Ra);ra.setClearColor(Z,Fa);ra.toneMapping=Ma}oa&&fb.viewport(I.copy(oa));0<ka.length&&F(ka,ca,ma);0<La.length&&F(La,
ca,ma);0<H.length&&F(H,ca,ma);fb.buffers.depth.setTest(!0);fb.buffers.depth.setMask(!0);fb.buffers.color.setMask(!0);fb.setPolygonOffset(!1)}function F(H,ca,ma){const oa=!0===ca.isScene?ca.overrideMaterial:null;for(let La=0,Ra=H.length;La<Ra;La++){var ka=H[La];const Ma=ka.object,ib=ka.geometry,wb=null===oa?ka.material:oa;ka=ka.group;Ma.layers.test(ma.layers)&&D(Ma,ca,ma,ib,wb,ka)}}function D(H,ca,ma,oa,ka,La){H.onBeforeRender(ra,ca,ma,oa,ka,La);H.modelViewMatrix.multiplyMatrices(ma.matrixWorldInverse,
H.matrixWorld);H.normalMatrix.getNormalMatrix(H.modelViewMatrix);ka.onBeforeRender(ra,ca,ma,oa,H,La);!0===ka.transparent&&2===ka.side&&!1===ka.forceSinglePass?(ka.side=1,ka.needsUpdate=!0,ra.renderBufferDirect(ma,ca,oa,ka,H,La),ka.side=0,ka.needsUpdate=!0,ra.renderBufferDirect(ma,ca,oa,ka,H,La),ka.side=2):ra.renderBufferDirect(ma,ca,oa,ka,H,La);H.onAfterRender(ra,ca,ma,oa,ka,La)}function E(H,ca,ma){!0!==ca.isScene&&(ca=Rf);const oa=vb.get(H),ka=Ga.state.lights,La=ka.state.version,Ra=Cd.getParameters(H,
ka.state,Ga.state.shadowsArray,ca,ma),Ma=Cd.getProgramCacheKey(Ra);let ib=oa.programs;oa.environment=H.isMeshStandardMaterial?ca.environment:null;oa.fog=ca.fog;oa.envMap=(H.isMeshStandardMaterial?xf:sd).get(H.envMap||oa.environment);void 0===ib&&(H.addEventListener("dispose",l),ib=new Map,oa.programs=ib);ca=ib.get(Ma);if(void 0!==ca){if(oa.currentProgram===ca&&oa.lightsStateVersion===La)return J(H,Ra),ca}else Ra.uniforms=Cd.getUniforms(H),H.onBuild(ma,Ra,ra),H.onBeforeCompile(Ra,ra),ca=Cd.acquireProgram(Ra,
Ma),ib.set(Ma,ca),oa.uniforms=Ra.uniforms;ma=oa.uniforms;if(!H.isShaderMaterial&&!H.isRawShaderMaterial||!0===H.clipping)ma.clippingPlanes=id.uniform;J(H,Ra);oa.needsLights=H.isMeshLambertMaterial||H.isMeshToonMaterial||H.isMeshPhongMaterial||H.isMeshStandardMaterial||H.isShadowMaterial||H.isShaderMaterial&&!0===H.lights;oa.lightsStateVersion=La;oa.needsLights&&(ma.ambientLightColor.value=ka.state.ambient,ma.lightProbe.value=ka.state.probe,ma.directionalLights.value=ka.state.directional,ma.directionalLightShadows.value=
ka.state.directionalShadow,ma.spotLights.value=ka.state.spot,ma.spotLightShadows.value=ka.state.spotShadow,ma.rectAreaLights.value=ka.state.rectArea,ma.ltc_1.value=ka.state.rectAreaLTC1,ma.ltc_2.value=ka.state.rectAreaLTC2,ma.pointLights.value=ka.state.point,ma.pointLightShadows.value=ka.state.pointShadow,ma.hemisphereLights.value=ka.state.hemi,ma.directionalShadowMap.value=ka.state.directionalShadowMap,ma.directionalShadowMatrix.value=ka.state.directionalShadowMatrix,ma.spotShadowMap.value=ka.state.spotShadowMap,
ma.spotLightMatrix.value=ka.state.spotLightMatrix,ma.spotLightMap.value=ka.state.spotLightMap,ma.pointShadowMap.value=ka.state.pointShadowMap,ma.pointShadowMatrix.value=ka.state.pointShadowMatrix);oa.currentProgram=ca;oa.uniformsList=null;return ca}function y(H){if(null===H.uniformsList){const ca=H.currentProgram.getUniforms();H.uniformsList=bb.seqWithValue(ca.seq,H.uniforms)}return H.uniformsList}function J(H,ca){H=vb.get(H);H.outputColorSpace=ca.outputColorSpace;H.instancing=ca.instancing;H.instancingColor=
ca.instancingColor;H.skinning=ca.skinning;H.morphTargets=ca.morphTargets;H.morphNormals=ca.morphNormals;H.morphColors=ca.morphColors;H.morphTargetsCount=ca.morphTargetsCount;H.numClippingPlanes=ca.numClippingPlanes;H.numIntersection=ca.numClipIntersection;H.vertexAlphas=ca.vertexAlphas;H.vertexTangents=ca.vertexTangents;H.toneMapping=ca.toneMapping}const {canvas:L=tb(),context:U=null,depth:P=!0,stencil:X=!0,alpha:ja=!1,antialias:fa=!1,premultipliedAlpha:aa=!0,preserveDrawingBuffer:pa=!1,powerPreference:ba=
"default",failIfMajorPerformanceCaveat:xa=!1}=a;this.isWebGLRenderer=!0;let qa;qa=null!==U?U.getContextAttributes().alpha:ja;const ta=new Uint32Array(4),Ba=new Int32Array(4);let va=null,Ga=null;const ia=[],wa=[];this.domElement=L;this.debug={checkShaderErrors:!0,onShaderError:null};this.sortObjects=this.autoClearStencil=this.autoClearDepth=this.autoClearColor=this.autoClear=!0;this.clippingPlanes=[];this.localClippingEnabled=!1;this._outputColorSpace="srgb";this._useLegacyLights=!1;this.toneMapping=
0;this.toneMappingExposure=1;const ra=this;let Sa=!1,Da=0,Na=0,Ea=null,Ta=-1,G=null;const I=new mb,Q=new mb;let Y=null;const Z=new Ia(0);let Fa=0,Ja=L.width,N=L.height,da=1,la=null,Aa=null;const ua=new mb(0,0,Ja,N),Ha=new mb(0,0,Ja,N);let Va=!1;const Qa=new h;let nb=!1,ob=!1,Bb=null;const gc=new Wa,Rd=new sa,Nc=new O,Rf={background:null,fog:null,environment:null,overrideMaterial:null,isScene:!0};let na=U;try{const H={alpha:!0,depth:P,stencil:X,antialias:fa,premultipliedAlpha:aa,preserveDrawingBuffer:pa,
powerPreference:ba,failIfMajorPerformanceCaveat:xa};"setAttribute"in L&&L.setAttribute("data-engine","three.js r158");L.addEventListener("webglcontextlost",d,!1);L.addEventListener("webglcontextrestored",f,!1);L.addEventListener("webglcontextcreationerror",g,!1);if(null===na){const ca=["webgl2","webgl","experimental-webgl"];!0===ra.isWebGL1Renderer&&ca.shift();na=b(ca,H);if(null===na){if(b(ca))throw Error("Error creating WebGL context with your selected attributes.");throw Error("Error creating WebGL context.");
}}"undefined"!==typeof WebGLRenderingContext&&na instanceof WebGLRenderingContext&&console.warn("THREE.WebGLRenderer: WebGL 1 support was deprecated in r153 and will be removed in r163.");void 0===na.getShaderPrecisionFormat&&(na.getShaderPrecisionFormat=function(){return{rangeMin:1,rangeMax:1,precision:1}})}catch(H){throw console.error("THREE.WebGLRenderer: "+H.message),H;}let Db,ub,fb,wc,vb,zb,sd,xf,qg,tj,yf,Cd,uj,Bh,Ch,id,Wc,jd,rk,sk,tk,hd,De,Dh;c();const Ec=new Xl(ra,na);this.xr=Ec;this.getContext=
function(){return na};this.getContextAttributes=function(){return na.getContextAttributes()};this.forceContextLoss=function(){const H=Db.get("WEBGL_lose_context");H&&H.loseContext()};this.forceContextRestore=function(){const H=Db.get("WEBGL_lose_context");H&&H.restoreContext()};this.getPixelRatio=function(){return da};this.setPixelRatio=function(H){void 0!==H&&(da=H,this.setSize(Ja,N,!1))};this.getSize=function(H){return H.set(Ja,N)};this.setSize=function(H,ca,ma=!0){Ec.isPresenting?console.warn("THREE.WebGLRenderer: Can't change size while VR device is presenting."):
(Ja=H,N=ca,L.width=Math.floor(H*da),L.height=Math.floor(ca*da),!0===ma&&(L.style.width=H+"px",L.style.height=ca+"px"),this.setViewport(0,0,H,ca))};this.getDrawingBufferSize=function(H){return H.set(Ja*da,N*da).floor()};this.setDrawingBufferSize=function(H,ca,ma){Ja=H;N=ca;da=ma;L.width=Math.floor(H*ma);L.height=Math.floor(ca*ma);this.setViewport(0,0,H,ca)};this.getCurrentViewport=function(H){return H.copy(I)};this.getViewport=function(H){return H.copy(ua)};this.setViewport=function(H,ca,ma,oa){H.isVector4?
ua.set(H.x,H.y,H.z,H.w):ua.set(H,ca,ma,oa);fb.viewport(I.copy(ua).multiplyScalar(da).floor())};this.getScissor=function(H){return H.copy(Ha)};this.setScissor=function(H,ca,ma,oa){H.isVector4?Ha.set(H.x,H.y,H.z,H.w):Ha.set(H,ca,ma,oa);fb.scissor(Q.copy(Ha).multiplyScalar(da).floor())};this.getScissorTest=function(){return Va};this.setScissorTest=function(H){fb.setScissorTest(Va=H)};this.setOpaqueSort=function(H){la=H};this.setTransparentSort=function(H){Aa=H};this.getClearColor=function(H){return H.copy(jd.getClearColor())};
this.setClearColor=function(){jd.setClearColor.apply(jd,arguments)};this.getClearAlpha=function(){return jd.getClearAlpha()};this.setClearAlpha=function(){jd.setClearAlpha.apply(jd,arguments)};this.clear=function(H=!0,ca=!0,ma=!0){let oa=0;if(H)if(H=!1,null!==Ea&&(H=Ea.texture.format,H=1033===H||1031===H||1029===H),H){H=Ea.texture.type;H=1009===H||1014===H||1012===H||1020===H||1017===H||1018===H;var ka=jd.getClearColor();const La=jd.getClearAlpha(),Ra=ka.r,Ma=ka.g;ka=ka.b;H?(ta[0]=Ra,ta[1]=Ma,ta[2]=
ka,ta[3]=La,na.clearBufferuiv(na.COLOR,0,ta)):(Ba[0]=Ra,Ba[1]=Ma,Ba[2]=ka,Ba[3]=La,na.clearBufferiv(na.COLOR,0,Ba))}else oa|=na.COLOR_BUFFER_BIT;ca&&(oa|=na.DEPTH_BUFFER_BIT);ma&&(oa|=na.STENCIL_BUFFER_BIT,this.state.buffers.stencil.setMask(4294967295));na.clear(oa)};this.clearColor=function(){this.clear(!0,!1,!1)};this.clearDepth=function(){this.clear(!1,!0,!1)};this.clearStencil=function(){this.clear(!1,!1,!0)};this.dispose=function(){L.removeEventListener("webglcontextlost",d,!1);L.removeEventListener("webglcontextrestored",
f,!1);L.removeEventListener("webglcontextcreationerror",g,!1);Bh.dispose();Ch.dispose();vb.dispose();sd.dispose();xf.dispose();yf.dispose();De.dispose();Dh.dispose();Cd.dispose();Ec.dispose();Ec.removeEventListener("sessionstart",t);Ec.removeEventListener("sessionend",u);Bb&&(Bb.dispose(),Bb=null);Ee.stop()};this.renderBufferDirect=function(H,ca,ma,oa,ka,La){null===ca&&(ca=Rf);var Ra=ka.isMesh&&0>ka.matrixWorld.determinant(),Ma=ca;!0!==Ma.isScene&&(Ma=Rf);zb.resetTextureUnits();ca=Ma.fog;var ib=oa.isMeshStandardMaterial?
Ma.environment:null,wb=null===Ea?ra.outputColorSpace:!0===Ea.isXRRenderTarget?Ea.texture.colorSpace:"srgb-linear";ib=(oa.isMeshStandardMaterial?xf:sd).get(oa.envMap||ib);var eb=!0===oa.vertexColors&&!!ma.attributes.color&&4===ma.attributes.color.itemSize,Zb=!!ma.attributes.tangent&&(!!oa.normalMap||0<oa.anisotropy),kd=!!ma.morphAttributes.position,Xc=!!ma.morphAttributes.normal;const Yc=!!ma.morphAttributes.color;let Eh=0;!oa.toneMapped||null!==Ea&&!0!==Ea.isXRRenderTarget||(Eh=ra.toneMapping);var Ya=
ma.morphAttributes.position||ma.morphAttributes.normal||ma.morphAttributes.color;const Yl=void 0!==Ya?Ya.length:0;Ya=vb.get(oa);const Zl=Ga.state.lights;!0!==nb||!0!==ob&&H===G||id.setState(oa,H,H===G&&oa.id===Ta);let Qb=!1;oa.version===Ya.__version?Ya.needsLights&&Ya.lightsStateVersion!==Zl.state.version?Qb=!0:Ya.outputColorSpace!==wb?Qb=!0:ka.isInstancedMesh&&!1===Ya.instancing?Qb=!0:ka.isInstancedMesh||!0!==Ya.instancing?ka.isSkinnedMesh&&!1===Ya.skinning?Qb=!0:ka.isSkinnedMesh||!0!==Ya.skinning?
ka.isInstancedMesh&&!0===Ya.instancingColor&&null===ka.instanceColor?Qb=!0:ka.isInstancedMesh&&!1===Ya.instancingColor&&null!==ka.instanceColor?Qb=!0:Ya.envMap!==ib?Qb=!0:!0===oa.fog&&Ya.fog!==ca?Qb=!0:void 0===Ya.numClippingPlanes||Ya.numClippingPlanes===id.numPlanes&&Ya.numIntersection===id.numIntersection?Ya.vertexAlphas!==eb?Qb=!0:Ya.vertexTangents!==Zb?Qb=!0:Ya.morphTargets!==kd?Qb=!0:Ya.morphNormals!==Xc?Qb=!0:Ya.morphColors!==Yc?Qb=!0:Ya.toneMapping!==Eh?Qb=!0:!0===ub.isWebGL2&&Ya.morphTargetsCount!==
Yl&&(Qb=!0):Qb=!0:Qb=!0:Qb=!0:(Qb=!0,Ya.__version=oa.version);wb=Ya.currentProgram;!0===Qb&&(wb=E(oa,Ma,ka));kd=Zb=Xc=!1;Ma=wb.getUniforms();eb=Ya.uniforms;fb.useProgram(wb.program)&&(kd=Zb=Xc=!0);oa.id!==Ta&&(Ta=oa.id,Zb=!0);if(Xc||G!==H)Ma.setValue(na,"projectionMatrix",H.projectionMatrix),Ma.setValue(na,"viewMatrix",H.matrixWorldInverse),Xc=Ma.map.cameraPosition,void 0!==Xc&&Xc.setValue(na,Nc.setFromMatrixPosition(H.matrixWorld)),ub.logarithmicDepthBuffer&&Ma.setValue(na,"logDepthBufFC",2/(Math.log(H.far+
1)/Math.LN2)),(oa.isMeshPhongMaterial||oa.isMeshToonMaterial||oa.isMeshLambertMaterial||oa.isMeshBasicMaterial||oa.isMeshStandardMaterial||oa.isShaderMaterial)&&Ma.setValue(na,"isOrthographic",!0===H.isOrthographicCamera),G!==H&&(G=H,kd=Zb=!0);ka.isSkinnedMesh&&(Ma.setOptional(na,ka,"bindMatrix"),Ma.setOptional(na,ka,"bindMatrixInverse"),H=ka.skeleton)&&(ub.floatVertexTextures?(null===H.boneTexture&&H.computeBoneTexture(),Ma.setValue(na,"boneTexture",H.boneTexture,zb),Ma.setValue(na,"boneTextureSize",
H.boneTextureSize)):console.warn("THREE.WebGLRenderer: SkinnedMesh can only be used with WebGL 2. With WebGL 1 OES_texture_float and vertex textures support is required."));H=ma.morphAttributes;(void 0!==H.position||void 0!==H.normal||void 0!==H.color&&!0===ub.isWebGL2)&&rk.update(ka,ma,wb);if(Zb||Ya.receiveShadow!==ka.receiveShadow)Ya.receiveShadow=ka.receiveShadow,Ma.setValue(na,"receiveShadow",ka.receiveShadow);oa.isMeshGouraudMaterial&&null!==oa.envMap&&(eb.envMap.value=ib,eb.flipEnvMap.value=
ib.isCubeTexture&&!1===ib.isRenderTargetTexture?-1:1);Zb&&(Ma.setValue(na,"toneMappingExposure",ra.toneMappingExposure),Ya.needsLights&&(H=kd,eb.ambientLightColor.needsUpdate=H,eb.lightProbe.needsUpdate=H,eb.directionalLights.needsUpdate=H,eb.directionalLightShadows.needsUpdate=H,eb.pointLights.needsUpdate=H,eb.pointLightShadows.needsUpdate=H,eb.spotLights.needsUpdate=H,eb.spotLightShadows.needsUpdate=H,eb.rectAreaLights.needsUpdate=H,eb.hemisphereLights.needsUpdate=H),ca&&!0===oa.fog&&uj.refreshFogUniforms(eb,
ca),uj.refreshMaterialUniforms(eb,oa,da,N,Bb),bb.upload(na,y(Ya),eb,zb));oa.isShaderMaterial&&!0===oa.uniformsNeedUpdate&&(bb.upload(na,y(Ya),eb,zb),oa.uniformsNeedUpdate=!1);oa.isSpriteMaterial&&Ma.setValue(na,"center",ka.center);Ma.setValue(na,"modelViewMatrix",ka.modelViewMatrix);Ma.setValue(na,"normalMatrix",ka.normalMatrix);Ma.setValue(na,"modelMatrix",ka.matrixWorld);if(oa.isShaderMaterial||oa.isRawShaderMaterial){ca=oa.uniformsGroups;for(let vj=0,$l=ca.length;vj<$l;vj++)ub.isWebGL2?(H=ca[vj],
Dh.update(H,wb),Dh.bind(H,wb)):console.warn("THREE.WebGLRenderer: Uniform Buffer Objects can only be used with WebGL 2.")}ca=wb;fb.setMaterial(oa,Ra);H=ma.index;ib=1;if(!0===oa.wireframe){H=tj.getWireframeAttribute(ma);if(void 0===H)return;ib=2}Ma=ma.drawRange;Ya=ma.attributes.position;Ra=Ma.start*ib;Ma=(Ma.start+Ma.count)*ib;null!==La&&(Ra=Math.max(Ra,La.start*ib),Ma=Math.min(Ma,(La.start+La.count)*ib));null!==H?(Ra=Math.max(Ra,0),Ma=Math.min(Ma,H.count)):void 0!==Ya&&null!==Ya&&(Ra=Math.max(Ra,
0),Ma=Math.min(Ma,Ya.count));La=Ma-Ra;0>La||Infinity===La||(De.setup(ka,oa,ca,ma,H),ca=sk,null!==H&&(H=qg.get(H),ca=tk,ca.setIndex(H)),ka.isMesh?!0===oa.wireframe?(fb.setLineWidth(oa.wireframeLinewidth*(null===Ea?da:1)),ca.setMode(na.LINES)):ca.setMode(na.TRIANGLES):ka.isLine?(oa=oa.linewidth,void 0===oa&&(oa=1),fb.setLineWidth(oa*(null===Ea?da:1)),ka.isLineSegments?ca.setMode(na.LINES):ka.isLineLoop?ca.setMode(na.LINE_LOOP):ca.setMode(na.LINE_STRIP)):ka.isPoints?ca.setMode(na.POINTS):ka.isSprite&&
ca.setMode(na.TRIANGLES),ka.isInstancedMesh?ca.renderInstances(Ra,La,ka.count):ma.isInstancedBufferGeometry?ca.renderInstances(Ra,La,Math.min(ma.instanceCount,void 0!==ma._maxInstanceCount?ma._maxInstanceCount:Infinity)):ca.render(Ra,La))};this.compile=function(H,ca,ma=null){null===ma&&(ma=H);Ga=Ch.get(ma);Ga.init();wa.push(Ga);ma.traverseVisible(function(ka){ka.isLight&&ka.layers.test(ca.layers)&&(Ga.pushLight(ka),ka.castShadow&&Ga.pushShadow(ka))});H!==ma&&H.traverseVisible(function(ka){ka.isLight&&
ka.layers.test(ca.layers)&&(Ga.pushLight(ka),ka.castShadow&&Ga.pushShadow(ka))});Ga.setupLights(ra._useLegacyLights);const oa=new Set;H.traverse(function(ka){const La=ka.material;if(La)if(Array.isArray(La))for(let Ra=0;Ra<La.length;Ra++){const Ma=La[Ra];n(Ma,ma,ka);oa.add(Ma)}else n(La,ma,ka),oa.add(La)});wa.pop();Ga=null;return oa};this.compileAsync=function(H,ca,ma=null){const oa=this.compile(H,ca,ma);return new Promise(ka=>{function La(){oa.forEach(function(Ra){vb.get(Ra).currentProgram.isReady()&&
oa.delete(Ra)});0===oa.size?ka(H):setTimeout(La,10)}null!==Db.get("KHR_parallel_shader_compile")?La():setTimeout(La,10)})};let wj=null;const Ee=new Se;Ee.setAnimationLoop(function(H){wj&&wj(H)});"undefined"!==typeof self&&Ee.setContext(self);this.setAnimationLoop=function(H){wj=H;Ec.setAnimationLoop(H);null===H?Ee.stop():Ee.start()};Ec.addEventListener("sessionstart",t);Ec.addEventListener("sessionend",u);this.render=function(H,ca){if(void 0!==ca&&!0!==ca.isCamera)console.error("THREE.WebGLRenderer.render: camera is not an instance of THREE.Camera.");
else if(!0!==Sa){!0===H.matrixWorldAutoUpdate&&H.updateMatrixWorld();null===ca.parent&&!0===ca.matrixWorldAutoUpdate&&ca.updateMatrixWorld();!0===Ec.enabled&&!0===Ec.isPresenting&&(!0===Ec.cameraAutoUpdate&&Ec.updateCamera(ca),ca=Ec.getCamera());if(!0===H.isScene)H.onBeforeRender(ra,H,ca,Ea);Ga=Ch.get(H,wa.length);Ga.init();wa.push(Ga);gc.multiplyMatrices(ca.projectionMatrix,ca.matrixWorldInverse);Qa.setFromProjectionMatrix(gc);ob=this.localClippingEnabled;nb=id.init(this.clippingPlanes,ob);va=Bh.get(H,
ia.length);va.init();ia.push(va);v(H,ca,0,ra.sortObjects);va.finish();!0===ra.sortObjects&&va.sort(la,Aa);this.info.render.frame++;!0===nb&&id.beginShadows();Wc.render(Ga.state.shadowsArray,H,ca);!0===nb&&id.endShadows();!0===this.info.autoReset&&this.info.reset();jd.render(va,H);Ga.setupLights(ra._useLegacyLights);if(ca.isArrayCamera){const ma=ca.cameras;for(let oa=0,ka=ma.length;oa<ka;oa++){const La=ma[oa];A(va,H,La,La.viewport)}}else A(va,H,ca);null!==Ea&&(zb.updateMultisampleRenderTarget(Ea),
zb.updateRenderTargetMipmap(Ea));if(!0===H.isScene)H.onAfterRender(ra,H,ca);De.resetDefaultState();Ta=-1;G=null;wa.pop();Ga=0<wa.length?wa[wa.length-1]:null;ia.pop();va=0<ia.length?ia[ia.length-1]:null}};this.getActiveCubeFace=function(){return Da};this.getActiveMipmapLevel=function(){return Na};this.getRenderTarget=function(){return Ea};this.setRenderTargetTextures=function(H,ca,ma){vb.get(H.texture).__webglTexture=ca;vb.get(H.depthTexture).__webglTexture=ma;H=vb.get(H);H.__hasExternalTextures=!0;
H.__hasExternalTextures&&(H.__autoAllocateDepthBuffer=void 0===ma,H.__autoAllocateDepthBuffer||!0!==Db.has("WEBGL_multisampled_render_to_texture")||(console.warn("THREE.WebGLRenderer: Render-to-texture extension was disabled because an external texture was provided"),H.__useRenderToTexture=!1))};this.setRenderTargetFramebuffer=function(H,ca){H=vb.get(H);H.__webglFramebuffer=ca;H.__useDefaultFramebuffer=void 0===ca};this.setRenderTarget=function(H,ca=0,ma=0){Ea=H;Da=ca;Na=ma;let oa=!0;var ka=null;
let La=!1,Ra=!1;if(H){ka=vb.get(H);void 0!==ka.__useDefaultFramebuffer?(fb.bindFramebuffer(na.FRAMEBUFFER,null),oa=!1):void 0===ka.__webglFramebuffer?zb.setupRenderTarget(H):ka.__hasExternalTextures&&zb.rebindTextures(H,vb.get(H.texture).__webglTexture,vb.get(H.depthTexture).__webglTexture);ka=H.texture;if(ka.isData3DTexture||ka.isDataArrayTexture||ka.isCompressedArrayTexture)Ra=!0;ka=vb.get(H).__webglFramebuffer;H.isWebGLCubeRenderTarget?(ka=Array.isArray(ka[ca])?ka[ca][ma]:ka[ca],La=!0):ka=ub.isWebGL2&&
0<H.samples&&!1===zb.useMultisampledRTT(H)?vb.get(H).__webglMultisampledFramebuffer:Array.isArray(ka)?ka[ma]:ka;I.copy(H.viewport);Q.copy(H.scissor);Y=H.scissorTest}else I.copy(ua).multiplyScalar(da).floor(),Q.copy(Ha).multiplyScalar(da).floor(),Y=Va;fb.bindFramebuffer(na.FRAMEBUFFER,ka)&&ub.drawBuffers&&oa&&fb.drawBuffers(H,ka);fb.viewport(I);fb.scissor(Q);fb.setScissorTest(Y);La?(H=vb.get(H.texture),na.framebufferTexture2D(na.FRAMEBUFFER,na.COLOR_ATTACHMENT0,na.TEXTURE_CUBE_MAP_POSITIVE_X+ca,H.__webglTexture,
ma)):Ra&&(H=vb.get(H.texture),na.framebufferTextureLayer(na.FRAMEBUFFER,na.COLOR_ATTACHMENT0,H.__webglTexture,ma||0,ca||0));Ta=-1};this.readRenderTargetPixels=function(H,ca,ma,oa,ka,La,Ra){if(H&&H.isWebGLRenderTarget){var Ma=vb.get(H).__webglFramebuffer;H.isWebGLCubeRenderTarget&&void 0!==Ra&&(Ma=Ma[Ra]);if(Ma){fb.bindFramebuffer(na.FRAMEBUFFER,Ma);try{const wb=H.texture,eb=wb.format,Zb=wb.type;if(1023!==eb&&hd.convert(eb)!==na.getParameter(na.IMPLEMENTATION_COLOR_READ_FORMAT))console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in RGBA or implementation defined format.");
else{var ib=1016===Zb&&(Db.has("EXT_color_buffer_half_float")||ub.isWebGL2&&Db.has("EXT_color_buffer_float"));1009===Zb||hd.convert(Zb)===na.getParameter(na.IMPLEMENTATION_COLOR_READ_TYPE)||1015===Zb&&(ub.isWebGL2||Db.has("OES_texture_float")||Db.has("WEBGL_color_buffer_float"))||ib?0<=ca&&ca<=H.width-oa&&0<=ma&&ma<=H.height-ka&&na.readPixels(ca,ma,oa,ka,hd.convert(eb),hd.convert(Zb),La):console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in UnsignedByteType or implementation defined type.")}}finally{H=
null!==Ea?vb.get(Ea).__webglFramebuffer:null,fb.bindFramebuffer(na.FRAMEBUFFER,H)}}}else console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.")};this.copyFramebufferToTexture=function(H,ca,ma=0){var oa=Math.pow(2,-ma);const ka=Math.floor(ca.image.width*oa);oa=Math.floor(ca.image.height*oa);zb.setTexture2D(ca,0);na.copyTexSubImage2D(na.TEXTURE_2D,ma,0,0,H.x,H.y,ka,oa);fb.unbindTexture()};this.copyTextureToTexture=function(H,ca,ma,oa=0){const ka=ca.image.width,
La=ca.image.height,Ra=hd.convert(ma.format),Ma=hd.convert(ma.type);zb.setTexture2D(ma,0);na.pixelStorei(na.UNPACK_FLIP_Y_WEBGL,ma.flipY);na.pixelStorei(na.UNPACK_PREMULTIPLY_ALPHA_WEBGL,ma.premultiplyAlpha);na.pixelStorei(na.UNPACK_ALIGNMENT,ma.unpackAlignment);ca.isDataTexture?na.texSubImage2D(na.TEXTURE_2D,oa,H.x,H.y,ka,La,Ra,Ma,ca.image.data):ca.isCompressedTexture?na.compressedTexSubImage2D(na.TEXTURE_2D,oa,H.x,H.y,ca.mipmaps[0].width,ca.mipmaps[0].height,Ra,ca.mipmaps[0].data):na.texSubImage2D(na.TEXTURE_2D,
oa,H.x,H.y,Ra,Ma,ca.image);0===oa&&ma.generateMipmaps&&na.generateMipmap(na.TEXTURE_2D);fb.unbindTexture()};this.copyTextureToTexture3D=function(H,ca,ma,oa,ka=0){if(ra.isWebGL1Renderer)console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: can only be used with WebGL2.");else{var La=H.max.x-H.min.x+1,Ra=H.max.y-H.min.y+1,Ma=H.max.z-H.min.z+1,ib=hd.convert(oa.format),wb=hd.convert(oa.type);if(oa.isData3DTexture){zb.setTexture3D(oa,0);var eb=na.TEXTURE_3D}else if(oa.isDataArrayTexture)zb.setTexture2DArray(oa,
0),eb=na.TEXTURE_2D_ARRAY;else{console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: only supports THREE.DataTexture3D and THREE.DataTexture2DArray.");return}na.pixelStorei(na.UNPACK_FLIP_Y_WEBGL,oa.flipY);na.pixelStorei(na.UNPACK_PREMULTIPLY_ALPHA_WEBGL,oa.premultiplyAlpha);na.pixelStorei(na.UNPACK_ALIGNMENT,oa.unpackAlignment);var Zb=na.getParameter(na.UNPACK_ROW_LENGTH),kd=na.getParameter(na.UNPACK_IMAGE_HEIGHT),Xc=na.getParameter(na.UNPACK_SKIP_PIXELS),Yc=na.getParameter(na.UNPACK_SKIP_ROWS),
Eh=na.getParameter(na.UNPACK_SKIP_IMAGES),Ya=ma.isCompressedTexture?ma.mipmaps[0]:ma.image;na.pixelStorei(na.UNPACK_ROW_LENGTH,Ya.width);na.pixelStorei(na.UNPACK_IMAGE_HEIGHT,Ya.height);na.pixelStorei(na.UNPACK_SKIP_PIXELS,H.min.x);na.pixelStorei(na.UNPACK_SKIP_ROWS,H.min.y);na.pixelStorei(na.UNPACK_SKIP_IMAGES,H.min.z);ma.isDataTexture||ma.isData3DTexture?na.texSubImage3D(eb,ka,ca.x,ca.y,ca.z,La,Ra,Ma,ib,wb,Ya.data):ma.isCompressedArrayTexture?(console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: untested support for compressed srcTexture."),
na.compressedTexSubImage3D(eb,ka,ca.x,ca.y,ca.z,La,Ra,Ma,ib,Ya.data)):na.texSubImage3D(eb,ka,ca.x,ca.y,ca.z,La,Ra,Ma,ib,wb,Ya);na.pixelStorei(na.UNPACK_ROW_LENGTH,Zb);na.pixelStorei(na.UNPACK_IMAGE_HEIGHT,kd);na.pixelStorei(na.UNPACK_SKIP_PIXELS,Xc);na.pixelStorei(na.UNPACK_SKIP_ROWS,Yc);na.pixelStorei(na.UNPACK_SKIP_IMAGES,Eh);0===ka&&oa.generateMipmaps&&na.generateMipmap(eb);fb.unbindTexture()}};this.initTexture=function(H){H.isCubeTexture?zb.setTextureCube(H,0):H.isData3DTexture?zb.setTexture3D(H,
0):H.isDataArrayTexture||H.isCompressedArrayTexture?zb.setTexture2DArray(H,0):zb.setTexture2D(H,0);fb.unbindTexture()};this.resetState=function(){Na=Da=0;Ea=null;fb.reset();De.reset()};"undefined"!==typeof __THREE_DEVTOOLS__&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}get coordinateSystem(){return 2E3}get outputColorSpace(){return this._outputColorSpace}set outputColorSpace(a){this._outputColorSpace=a;const b=this.getContext();b.drawingBufferColorSpace="display-p3"===
a?"display-p3":"srgb";b.unpackColorSpace="display-p3-linear"===jb.workingColorSpace?"display-p3":"srgb"}get physicallyCorrectLights(){console.warn("THREE.WebGLRenderer: The property .physicallyCorrectLights has been removed. Set renderer.useLegacyLights instead.");return!this.useLegacyLights}set physicallyCorrectLights(a){console.warn("THREE.WebGLRenderer: The property .physicallyCorrectLights has been removed. Set renderer.useLegacyLights instead.");this.useLegacyLights=!a}get outputEncoding(){console.warn("THREE.WebGLRenderer: Property .outputEncoding has been removed. Use .outputColorSpace instead.");
return"srgb"===this.outputColorSpace?3001:3E3}set outputEncoding(a){console.warn("THREE.WebGLRenderer: Property .outputEncoding has been removed. Use .outputColorSpace instead.");this.outputColorSpace=3001===a?"srgb":"srgb-linear"}get useLegacyLights(){console.warn("THREE.WebGLRenderer: The property .useLegacyLights has been deprecated. Migrate your lighting according to the following guide: https://discourse.threejs.org/t/updates-to-lighting-in-three-js-r155/53733.");return this._useLegacyLights}set useLegacyLights(a){console.warn("THREE.WebGLRenderer: The property .useLegacyLights has been deprecated. Migrate your lighting according to the following guide: https://discourse.threejs.org/t/updates-to-lighting-in-three-js-r155/53733.");
this._useLegacyLights=a}}q.WebGLRenderer=qk;class uk extends qk{}q.WebGL1Renderer=uk;uk.prototype.isWebGL1Renderer=!0;class xj{constructor(a,b=2.5E-4){this.isFogExp2=!0;this.name="";this.color=new Ia(a);this.density=b}clone(){return new xj(this.color,this.density)}toJSON(){return{type:"FogExp2",name:this.name,color:this.color.getHex(),density:this.density}}}q.FogExp2=xj;class yj{constructor(a,b=1,c=1E3){this.isFog=!0;this.name="";this.color=new Ia(a);this.near=b;this.far=c}clone(){return new yj(this.color,
this.near,this.far)}toJSON(){return{type:"Fog",name:this.name,color:this.color.getHex(),near:this.near,far:this.far}}}q.Fog=yj;class vk extends hb{constructor(){super();this.isScene=!0;this.type="Scene";this.fog=this.environment=this.background=null;this.backgroundBlurriness=0;this.backgroundIntensity=1;this.overrideMaterial=null;"undefined"!==typeof __THREE_DEVTOOLS__&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}copy(a,b){super.copy(a,b);null!==a.background&&(this.background=
a.background.clone());null!==a.environment&&(this.environment=a.environment.clone());null!==a.fog&&(this.fog=a.fog.clone());this.backgroundBlurriness=a.backgroundBlurriness;this.backgroundIntensity=a.backgroundIntensity;null!==a.overrideMaterial&&(this.overrideMaterial=a.overrideMaterial.clone());this.matrixAutoUpdate=a.matrixAutoUpdate;return this}toJSON(a){a=super.toJSON(a);null!==this.fog&&(a.object.fog=this.fog.toJSON());0<this.backgroundBlurriness&&(a.object.backgroundBlurriness=this.backgroundBlurriness);
1!==this.backgroundIntensity&&(a.object.backgroundIntensity=this.backgroundIntensity);return a}}q.Scene=vk;class Fh{constructor(a,b){this.isInterleavedBuffer=!0;this.array=a;this.stride=b;this.count=void 0!==a?a.length/b:0;this.usage=35044;this.updateRange={offset:0,count:-1};this.version=0;this.uuid=$b()}onUploadCallback(){}set needsUpdate(a){!0===a&&this.version++}setUsage(a){this.usage=a;return this}copy(a){this.array=new a.array.constructor(a.array);this.count=a.count;this.stride=a.stride;this.usage=
a.usage;return this}copyAt(a,b,c){a*=this.stride;c*=b.stride;for(let d=0,f=this.stride;d<f;d++)this.array[a+d]=b.array[c+d];return this}set(a,b=0){this.array.set(a,b);return this}clone(a){void 0===a.arrayBuffers&&(a.arrayBuffers={});void 0===this.array.buffer._uuid&&(this.array.buffer._uuid=$b());void 0===a.arrayBuffers[this.array.buffer._uuid]&&(a.arrayBuffers[this.array.buffer._uuid]=this.array.slice(0).buffer);a=new this.array.constructor(a.arrayBuffers[this.array.buffer._uuid]);a=new this.constructor(a,
this.stride);a.setUsage(this.usage);return a}onUpload(a){this.onUploadCallback=a;return this}toJSON(a){void 0===a.arrayBuffers&&(a.arrayBuffers={});void 0===this.array.buffer._uuid&&(this.array.buffer._uuid=$b());void 0===a.arrayBuffers[this.array.buffer._uuid]&&(a.arrayBuffers[this.array.buffer._uuid]=Array.from(new Uint32Array(this.array.buffer)));return{uuid:this.uuid,buffer:this.array.buffer._uuid,type:this.array.constructor.name,stride:this.stride}}}q.InterleavedBuffer=Fh;const jc=new O;class zf{constructor(a,
b,c,d=!1){this.isInterleavedBufferAttribute=!0;this.name="";this.data=a;this.itemSize=b;this.offset=c;this.normalized=d}get count(){return this.data.count}get array(){return this.data.array}set needsUpdate(a){this.data.needsUpdate=a}applyMatrix4(a){for(let b=0,c=this.data.count;b<c;b++)jc.fromBufferAttribute(this,b),jc.applyMatrix4(a),this.setXYZ(b,jc.x,jc.y,jc.z);return this}applyNormalMatrix(a){for(let b=0,c=this.count;b<c;b++)jc.fromBufferAttribute(this,b),jc.applyNormalMatrix(a),this.setXYZ(b,
jc.x,jc.y,jc.z);return this}transformDirection(a){for(let b=0,c=this.count;b<c;b++)jc.fromBufferAttribute(this,b),jc.transformDirection(a),this.setXYZ(b,jc.x,jc.y,jc.z);return this}setX(a,b){this.normalized&&(b=Xa(b,this.array));this.data.array[a*this.data.stride+this.offset]=b;return this}setY(a,b){this.normalized&&(b=Xa(b,this.array));this.data.array[a*this.data.stride+this.offset+1]=b;return this}setZ(a,b){this.normalized&&(b=Xa(b,this.array));this.data.array[a*this.data.stride+this.offset+2]=
b;return this}setW(a,b){this.normalized&&(b=Xa(b,this.array));this.data.array[a*this.data.stride+this.offset+3]=b;return this}getX(a){a=this.data.array[a*this.data.stride+this.offset];this.normalized&&(a=B(a,this.array));return a}getY(a){a=this.data.array[a*this.data.stride+this.offset+1];this.normalized&&(a=B(a,this.array));return a}getZ(a){a=this.data.array[a*this.data.stride+this.offset+2];this.normalized&&(a=B(a,this.array));return a}getW(a){a=this.data.array[a*this.data.stride+this.offset+3];
this.normalized&&(a=B(a,this.array));return a}setXY(a,b,c){a=a*this.data.stride+this.offset;this.normalized&&(b=Xa(b,this.array),c=Xa(c,this.array));this.data.array[a+0]=b;this.data.array[a+1]=c;return this}setXYZ(a,b,c,d){a=a*this.data.stride+this.offset;this.normalized&&(b=Xa(b,this.array),c=Xa(c,this.array),d=Xa(d,this.array));this.data.array[a+0]=b;this.data.array[a+1]=c;this.data.array[a+2]=d;return this}setXYZW(a,b,c,d,f){a=a*this.data.stride+this.offset;this.normalized&&(b=Xa(b,this.array),
c=Xa(c,this.array),d=Xa(d,this.array),f=Xa(f,this.array));this.data.array[a+0]=b;this.data.array[a+1]=c;this.data.array[a+2]=d;this.data.array[a+3]=f;return this}clone(a){if(void 0===a){console.log("THREE.InterleavedBufferAttribute.clone(): Cloning an interleaved buffer attribute will de-interleave buffer data.");a=[];for(let b=0;b<this.count;b++){const c=b*this.data.stride+this.offset;for(let d=0;d<this.itemSize;d++)a.push(this.data.array[c+d])}return new rb(new this.array.constructor(a),this.itemSize,
this.normalized)}void 0===a.interleavedBuffers&&(a.interleavedBuffers={});void 0===a.interleavedBuffers[this.data.uuid]&&(a.interleavedBuffers[this.data.uuid]=this.data.clone(a));return new zf(a.interleavedBuffers[this.data.uuid],this.itemSize,this.offset,this.normalized)}toJSON(a){if(void 0===a){console.log("THREE.InterleavedBufferAttribute.toJSON(): Serializing an interleaved buffer attribute will de-interleave buffer data.");a=[];for(let b=0;b<this.count;b++){const c=b*this.data.stride+this.offset;
for(let d=0;d<this.itemSize;d++)a.push(this.data.array[c+d])}return{itemSize:this.itemSize,type:this.array.constructor.name,array:a,normalized:this.normalized}}void 0===a.interleavedBuffers&&(a.interleavedBuffers={});void 0===a.interleavedBuffers[this.data.uuid]&&(a.interleavedBuffers[this.data.uuid]=this.data.toJSON(a));return{isInterleavedBufferAttribute:!0,itemSize:this.itemSize,data:this.data.uuid,offset:this.offset,normalized:this.normalized}}}q.InterleavedBufferAttribute=zf;class zj extends Wb{constructor(a){super();
this.isSpriteMaterial=!0;this.type="SpriteMaterial";this.color=new Ia(16777215);this.alphaMap=this.map=null;this.rotation=0;this.fog=this.transparent=this.sizeAttenuation=!0;this.setValues(a)}copy(a){super.copy(a);this.color.copy(a.color);this.map=a.map;this.alphaMap=a.alphaMap;this.rotation=a.rotation;this.sizeAttenuation=a.sizeAttenuation;this.fog=a.fog;return this}}q.SpriteMaterial=zj;let Af;const rg=new O,Bf=new O,Cf=new O,bf=new sa,Tf=new sa,nk=new Wa,Gh=new O,sg=new O,Hh=new O,wk=new sa,Aj=
new sa,xk=new sa;class yk extends hb{constructor(a=new zj){super();this.isSprite=!0;this.type="Sprite";if(void 0===Af){Af=new ab;var b=new Float32Array([-.5,-.5,0,0,0,.5,-.5,0,1,0,.5,.5,0,1,1,-.5,.5,0,0,1]);b=new Fh(b,5);Af.setIndex([0,1,2,0,2,3]);Af.setAttribute("position",new zf(b,3,0,!1));Af.setAttribute("uv",new zf(b,2,3,!1))}this.geometry=Af;this.material=a;this.center=new sa(.5,.5)}raycast(a,b){null===a.camera&&console.error('THREE.Sprite: "Raycaster.camera" needs to be set in order to raycast against sprites.');
Bf.setFromMatrixScale(this.matrixWorld);nk.copy(a.camera.matrixWorld);this.modelViewMatrix.multiplyMatrices(a.camera.matrixWorldInverse,this.matrixWorld);Cf.setFromMatrixPosition(this.modelViewMatrix);a.camera.isPerspectiveCamera&&!1===this.material.sizeAttenuation&&Bf.multiplyScalar(-Cf.z);var c=this.material.rotation;let d;if(0!==c){d=Math.cos(c);var f=Math.sin(c)}c=this.center;af(Gh.set(-.5,-.5,0),Cf,c,Bf,f,d);af(sg.set(.5,-.5,0),Cf,c,Bf,f,d);af(Hh.set(.5,.5,0),Cf,c,Bf,f,d);wk.set(0,0);Aj.set(1,
0);xk.set(1,1);let g=a.ray.intersectTriangle(Gh,sg,Hh,!1,rg);if(null===g&&(af(sg.set(-.5,.5,0),Cf,c,Bf,f,d),Aj.set(0,1),g=a.ray.intersectTriangle(Gh,Hh,sg,!1,rg),null===g))return;f=a.ray.origin.distanceTo(rg);f<a.near||f>a.far||b.push({distance:f,point:rg.clone(),uv:Tb.getInterpolation(rg,Gh,sg,Hh,wk,Aj,xk,new sa),face:null,object:this})}copy(a,b){super.copy(a,b);void 0!==a.center&&this.center.copy(a.center);this.material=a.material;return this}}q.Sprite=yk;const Ih=new O,zk=new O;class Ak extends hb{constructor(){super();
this._currentLevel=0;this.type="LOD";Object.defineProperties(this,{levels:{enumerable:!0,value:[]},isLOD:{value:!0}});this.autoUpdate=!0}copy(a){super.copy(a,!1);const b=a.levels;for(let c=0,d=b.length;c<d;c++){const f=b[c];this.addLevel(f.object.clone(),f.distance,f.hysteresis)}this.autoUpdate=a.autoUpdate;return this}addLevel(a,b=0,c=0){b=Math.abs(b);const d=this.levels;let f;for(f=0;f<d.length&&!(b<d[f].distance);f++);d.splice(f,0,{distance:b,hysteresis:c,object:a});this.add(a);return this}getCurrentLevel(){return this._currentLevel}getObjectForDistance(a){const b=
this.levels;if(0<b.length){let c,d;c=1;for(d=b.length;c<d;c++){let f=b[c].distance;b[c].object.visible&&(f-=f*b[c].hysteresis);if(a<f)break}return b[c-1].object}return null}raycast(a,b){if(0<this.levels.length){Ih.setFromMatrixPosition(this.matrixWorld);const c=a.ray.origin.distanceTo(Ih);this.getObjectForDistance(c).raycast(a,b)}}update(a){const b=this.levels;if(1<b.length){Ih.setFromMatrixPosition(a.matrixWorld);zk.setFromMatrixPosition(this.matrixWorld);a=Ih.distanceTo(zk)/a.zoom;b[0].object.visible=
!0;let c,d;c=1;for(d=b.length;c<d;c++){let f=b[c].distance;b[c].object.visible&&(f-=f*b[c].hysteresis);if(a>=f)b[c-1].object.visible=!1,b[c].object.visible=!0;else break}for(this._currentLevel=c-1;c<d;c++)b[c].object.visible=!1}}toJSON(a){a=super.toJSON(a);!1===this.autoUpdate&&(a.object.autoUpdate=!1);a.object.levels=[];const b=this.levels;for(let c=0,d=b.length;c<d;c++){const f=b[c];a.object.levels.push({object:f.object.uuid,distance:f.distance,hysteresis:f.hysteresis})}return a}}q.LOD=Ak;const Bk=
new O,Ck=new mb,Dk=new mb,am=new O,Ek=new Wa,Jh=new O,Bj=new oc,Fk=new Wa,Cj=new ce;class Gk extends cb{constructor(a,b){super(a,b);this.isSkinnedMesh=!0;this.type="SkinnedMesh";this.bindMode="attached";this.bindMatrix=new Wa;this.bindMatrixInverse=new Wa;this.boundingSphere=this.boundingBox=null}computeBoundingBox(){var a=this.geometry;null===this.boundingBox&&(this.boundingBox=new Jc);this.boundingBox.makeEmpty();a=a.getAttribute("position");for(let b=0;b<a.count;b++)this.getVertexPosition(b,Jh),
this.boundingBox.expandByPoint(Jh)}computeBoundingSphere(){var a=this.geometry;null===this.boundingSphere&&(this.boundingSphere=new oc);this.boundingSphere.makeEmpty();a=a.getAttribute("position");for(let b=0;b<a.count;b++)this.getVertexPosition(b,Jh),this.boundingSphere.expandByPoint(Jh)}copy(a,b){super.copy(a,b);this.bindMode=a.bindMode;this.bindMatrix.copy(a.bindMatrix);this.bindMatrixInverse.copy(a.bindMatrixInverse);this.skeleton=a.skeleton;null!==a.boundingBox&&(this.boundingBox=a.boundingBox.clone());
null!==a.boundingSphere&&(this.boundingSphere=a.boundingSphere.clone());return this}raycast(a,b){const c=this.matrixWorld;void 0!==this.material&&(null===this.boundingSphere&&this.computeBoundingSphere(),Bj.copy(this.boundingSphere),Bj.applyMatrix4(c),!1!==a.ray.intersectsSphere(Bj)&&(Fk.copy(c).invert(),Cj.copy(a.ray).applyMatrix4(Fk),null!==this.boundingBox&&!1===Cj.intersectsBox(this.boundingBox)||this._computeIntersections(a,b,Cj)))}getVertexPosition(a,b){super.getVertexPosition(a,b);this.applyBoneTransform(a,
b);return b}bind(a,b){this.skeleton=a;void 0===b&&(this.updateMatrixWorld(!0),this.skeleton.calculateInverses(),b=this.matrixWorld);this.bindMatrix.copy(b);this.bindMatrixInverse.copy(b).invert()}pose(){this.skeleton.pose()}normalizeSkinWeights(){const a=new mb,b=this.geometry.attributes.skinWeight;for(let c=0,d=b.count;c<d;c++){a.fromBufferAttribute(b,c);const f=1/a.manhattanLength();Infinity!==f?a.multiplyScalar(f):a.set(1,0,0,0);b.setXYZW(c,a.x,a.y,a.z,a.w)}}updateMatrixWorld(a){super.updateMatrixWorld(a);
"attached"===this.bindMode?this.bindMatrixInverse.copy(this.matrixWorld).invert():"detached"===this.bindMode?this.bindMatrixInverse.copy(this.bindMatrix).invert():console.warn("THREE.SkinnedMesh: Unrecognized bindMode: "+this.bindMode)}applyBoneTransform(a,b){const c=this.skeleton;var d=this.geometry;Ck.fromBufferAttribute(d.attributes.skinIndex,a);Dk.fromBufferAttribute(d.attributes.skinWeight,a);Bk.copy(b).applyMatrix4(this.bindMatrix);b.set(0,0,0);for(a=0;4>a;a++)if(d=Dk.getComponent(a),0!==d){const f=
Ck.getComponent(a);Ek.multiplyMatrices(c.bones[f].matrixWorld,c.boneInverses[f]);b.addScaledVector(am.copy(Bk).applyMatrix4(Ek),d)}return b.applyMatrix4(this.bindMatrixInverse)}boneTransform(a,b){console.warn("THREE.SkinnedMesh: .boneTransform() was renamed to .applyBoneTransform() in r151.");return this.applyBoneTransform(a,b)}}q.SkinnedMesh=Gk;class Dj extends hb{constructor(){super();this.isBone=!0;this.type="Bone"}}q.Bone=Dj;class Df extends Gb{constructor(a=null,b=1,c=1,d,f,g,l,m,n=1003,t=1003,
u,v){super(null,g,l,m,n,t,d,f,u,v);this.isDataTexture=!0;this.image={data:a,width:b,height:c};this.flipY=this.generateMipmaps=!1;this.unpackAlignment=1}}q.DataTexture=Df;const Hk=new Wa,bm=new Wa;class Ej{constructor(a=[],b=[]){this.uuid=$b();this.bones=a.slice(0);this.boneInverses=b;this.boneTexture=this.boneMatrices=null;this.boneTextureSize=0;this.init()}init(){const a=this.bones,b=this.boneInverses;this.boneMatrices=new Float32Array(16*a.length);if(0===b.length)this.calculateInverses();else if(a.length!==
b.length){console.warn("THREE.Skeleton: Number of inverse bone matrices does not match amount of bones.");this.boneInverses=[];for(let c=0,d=this.bones.length;c<d;c++)this.boneInverses.push(new Wa)}}calculateInverses(){this.boneInverses.length=0;for(let a=0,b=this.bones.length;a<b;a++){const c=new Wa;this.bones[a]&&c.copy(this.bones[a].matrixWorld).invert();this.boneInverses.push(c)}}pose(){for(let b=0,c=this.bones.length;b<c;b++){var a=this.bones[b];a&&a.matrixWorld.copy(this.boneInverses[b]).invert()}for(let b=
0,c=this.bones.length;b<c;b++)if(a=this.bones[b])a.parent&&a.parent.isBone?(a.matrix.copy(a.parent.matrixWorld).invert(),a.matrix.multiply(a.matrixWorld)):a.matrix.copy(a.matrixWorld),a.matrix.decompose(a.position,a.quaternion,a.scale)}update(){const a=this.bones,b=this.boneInverses,c=this.boneMatrices,d=this.boneTexture;for(let f=0,g=a.length;f<g;f++)Hk.multiplyMatrices(a[f]?a[f].matrixWorld:bm,b[f]),Hk.toArray(c,16*f);null!==d&&(d.needsUpdate=!0)}clone(){return new Ej(this.bones,this.boneInverses)}computeBoneTexture(){let a=
Math.sqrt(4*this.bones.length);a=lc(a);a=Math.max(a,4);const b=new Float32Array(a*a*4);b.set(this.boneMatrices);const c=new Df(b,a,a,1023,1015);c.needsUpdate=!0;this.boneMatrices=b;this.boneTexture=c;this.boneTextureSize=a;return this}getBoneByName(a){for(let b=0,c=this.bones.length;b<c;b++){const d=this.bones[b];if(d.name===a)return d}}dispose(){null!==this.boneTexture&&(this.boneTexture.dispose(),this.boneTexture=null)}fromJSON(a,b){this.uuid=a.uuid;for(let c=0,d=a.bones.length;c<d;c++){const f=
a.bones[c];let g=b[f];void 0===g&&(console.warn("THREE.Skeleton: No bone found with UUID:",f),g=new Dj);this.bones.push(g);this.boneInverses.push((new Wa).fromArray(a.boneInverses[c]))}this.init();return this}toJSON(){const a={metadata:{version:4.6,type:"Skeleton",generator:"Skeleton.toJSON"},bones:[],boneInverses:[]};a.uuid=this.uuid;const b=this.bones,c=this.boneInverses;for(let d=0,f=b.length;d<f;d++)a.bones.push(b[d].uuid),a.boneInverses.push(c[d].toArray());return a}}q.Skeleton=Ej;class Ef extends rb{constructor(a,
b,c,d=1){super(a,b,c);this.isInstancedBufferAttribute=!0;this.meshPerAttribute=d}copy(a){super.copy(a);this.meshPerAttribute=a.meshPerAttribute;return this}toJSON(){const a=super.toJSON();a.meshPerAttribute=this.meshPerAttribute;a.isInstancedBufferAttribute=!0;return a}}q.InstancedBufferAttribute=Ef;const Ff=new Wa,Ik=new Wa,Kh=[],Jk=new Jc,cm=new Wa,tg=new cb,ug=new oc;class Kk extends cb{constructor(a,b,c){super(a,b);this.isInstancedMesh=!0;this.instanceMatrix=new Ef(new Float32Array(16*c),16);
this.instanceColor=null;this.count=c;this.boundingSphere=this.boundingBox=null;for(a=0;a<c;a++)this.setMatrixAt(a,cm)}computeBoundingBox(){const a=this.geometry,b=this.count;null===this.boundingBox&&(this.boundingBox=new Jc);null===a.boundingBox&&a.computeBoundingBox();this.boundingBox.makeEmpty();for(let c=0;c<b;c++)this.getMatrixAt(c,Ff),Jk.copy(a.boundingBox).applyMatrix4(Ff),this.boundingBox.union(Jk)}computeBoundingSphere(){const a=this.geometry,b=this.count;null===this.boundingSphere&&(this.boundingSphere=
new oc);null===a.boundingSphere&&a.computeBoundingSphere();this.boundingSphere.makeEmpty();for(let c=0;c<b;c++)this.getMatrixAt(c,Ff),ug.copy(a.boundingSphere).applyMatrix4(Ff),this.boundingSphere.union(ug)}copy(a,b){super.copy(a,b);this.instanceMatrix.copy(a.instanceMatrix);null!==a.instanceColor&&(this.instanceColor=a.instanceColor.clone());this.count=a.count;null!==a.boundingBox&&(this.boundingBox=a.boundingBox.clone());null!==a.boundingSphere&&(this.boundingSphere=a.boundingSphere.clone());return this}getColorAt(a,
b){b.fromArray(this.instanceColor.array,3*a)}getMatrixAt(a,b){b.fromArray(this.instanceMatrix.array,16*a)}raycast(a,b){const c=this.matrixWorld,d=this.count;tg.geometry=this.geometry;tg.material=this.material;if(void 0!==tg.material&&(null===this.boundingSphere&&this.computeBoundingSphere(),ug.copy(this.boundingSphere),ug.applyMatrix4(c),!1!==a.ray.intersectsSphere(ug)))for(let f=0;f<d;f++){this.getMatrixAt(f,Ff);Ik.multiplyMatrices(c,Ff);tg.matrixWorld=Ik;tg.raycast(a,Kh);for(let g=0,l=Kh.length;g<
l;g++){const m=Kh[g];m.instanceId=f;m.object=this;b.push(m)}Kh.length=0}}setColorAt(a,b){null===this.instanceColor&&(this.instanceColor=new Ef(new Float32Array(3*this.instanceMatrix.count),3));b.toArray(this.instanceColor.array,3*a)}setMatrixAt(a,b){b.toArray(this.instanceMatrix.array,16*a)}updateMorphTargets(){}dispose(){this.dispatchEvent({type:"dispose"})}}q.InstancedMesh=Kk;class kc extends Wb{constructor(a){super();this.isLineBasicMaterial=!0;this.type="LineBasicMaterial";this.color=new Ia(16777215);
this.map=null;this.linewidth=1;this.linejoin=this.linecap="round";this.fog=!0;this.setValues(a)}copy(a){super.copy(a);this.color.copy(a.color);this.map=a.map;this.linewidth=a.linewidth;this.linecap=a.linecap;this.linejoin=a.linejoin;this.fog=a.fog;return this}}q.LineBasicMaterial=kc;const Lk=new O,Mk=new O,Nk=new Wa,Fj=new ce,vg=new oc;class ie extends hb{constructor(a=new ab,b=new kc){super();this.isLine=!0;this.type="Line";this.geometry=a;this.material=b;this.updateMorphTargets()}copy(a,b){super.copy(a,
b);this.material=Array.isArray(a.material)?a.material.slice():a.material;this.geometry=a.geometry;return this}computeLineDistances(){const a=this.geometry;if(null===a.index){const b=a.attributes.position,c=[0];for(let d=1,f=b.count;d<f;d++)Lk.fromBufferAttribute(b,d-1),Mk.fromBufferAttribute(b,d),c[d]=c[d-1],c[d]+=Lk.distanceTo(Mk);a.setAttribute("lineDistance",new Oa(c,1))}else console.warn("THREE.Line.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");return this}raycast(a,
b){var c=this.geometry,d=this.matrixWorld,f=a.params.Line.threshold,g=c.drawRange;null===c.boundingSphere&&c.computeBoundingSphere();vg.copy(c.boundingSphere);vg.applyMatrix4(d);vg.radius+=f;if(!1!==a.ray.intersectsSphere(vg)){Nk.copy(d).invert();Fj.copy(a.ray).applyMatrix4(Nk);d=f/((this.scale.x+this.scale.y+this.scale.z)/3);d*=d;f=new O;var l=new O,m=new O,n=new O,t=this.isLineSegments?2:1,u=c.index;c=c.attributes.position;if(null!==u){var v=Math.max(0,g.start);g=Math.min(u.count,g.start+g.count);
for(let A=v,F=g-1;A<F;A+=t)g=u.getX(A),v=u.getX(A+1),f.fromBufferAttribute(c,g),l.fromBufferAttribute(c,v),Fj.distanceSqToSegment(f,l,n,m)>d||(n.applyMatrix4(this.matrixWorld),g=a.ray.origin.distanceTo(n),g<a.near||g>a.far||b.push({distance:g,point:m.clone().applyMatrix4(this.matrixWorld),index:A,face:null,faceIndex:null,object:this}))}else{u=Math.max(0,g.start);g=Math.min(c.count,g.start+g.count);for(let A=u,F=g-1;A<F;A+=t)f.fromBufferAttribute(c,A),l.fromBufferAttribute(c,A+1),Fj.distanceSqToSegment(f,
l,n,m)>d||(n.applyMatrix4(this.matrixWorld),g=a.ray.origin.distanceTo(n),g<a.near||g>a.far||b.push({distance:g,point:m.clone().applyMatrix4(this.matrixWorld),index:A,face:null,faceIndex:null,object:this}))}}}updateMorphTargets(){var a=this.geometry.morphAttributes,b=Object.keys(a);if(0<b.length&&(a=a[b[0]],void 0!==a)){this.morphTargetInfluences=[];this.morphTargetDictionary={};for(let c=0,d=a.length;c<d;c++)b=a[c].name||String(c),this.morphTargetInfluences.push(0),this.morphTargetDictionary[b]=c}}}
q.Line=ie;const Ok=new O,Pk=new O;class ld extends ie{constructor(a,b){super(a,b);this.isLineSegments=!0;this.type="LineSegments"}computeLineDistances(){const a=this.geometry;if(null===a.index){const b=a.attributes.position,c=[];for(let d=0,f=b.count;d<f;d+=2)Ok.fromBufferAttribute(b,d),Pk.fromBufferAttribute(b,d+1),c[d]=0===d?0:c[d-1],c[d+1]=c[d]+Ok.distanceTo(Pk);a.setAttribute("lineDistance",new Oa(c,1))}else console.warn("THREE.LineSegments.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");
return this}}q.LineSegments=ld;class Qk extends ie{constructor(a,b){super(a,b);this.isLineLoop=!0;this.type="LineLoop"}}q.LineLoop=Qk;class Gj extends Wb{constructor(a){super();this.isPointsMaterial=!0;this.type="PointsMaterial";this.color=new Ia(16777215);this.alphaMap=this.map=null;this.size=1;this.fog=this.sizeAttenuation=!0;this.setValues(a)}copy(a){super.copy(a);this.color.copy(a.color);this.map=a.map;this.alphaMap=a.alphaMap;this.size=a.size;this.sizeAttenuation=a.sizeAttenuation;this.fog=a.fog;
return this}}q.PointsMaterial=Gj;const Rk=new Wa,Vi=new ce,wg=new oc,Lh=new O;class Sk extends hb{constructor(a=new ab,b=new Gj){super();this.isPoints=!0;this.type="Points";this.geometry=a;this.material=b;this.updateMorphTargets()}copy(a,b){super.copy(a,b);this.material=Array.isArray(a.material)?a.material.slice():a.material;this.geometry=a.geometry;return this}raycast(a,b){var c=this.geometry;const d=this.matrixWorld;var f=a.params.Points.threshold,g=c.drawRange;null===c.boundingSphere&&c.computeBoundingSphere();
wg.copy(c.boundingSphere);wg.applyMatrix4(d);wg.radius+=f;if(!1!==a.ray.intersectsSphere(wg)){Rk.copy(d).invert();Vi.copy(a.ray).applyMatrix4(Rk);f/=(this.scale.x+this.scale.y+this.scale.z)/3;f*=f;var l=c.index;c=c.attributes.position;if(null!==l){const m=Math.max(0,g.start);g=Math.min(l.count,g.start+g.count);for(let n=m,t=g;n<t;n++)g=l.getX(n),Lh.fromBufferAttribute(c,g),ch(Lh,g,f,d,a,b,this)}else{l=Math.max(0,g.start);g=Math.min(c.count,g.start+g.count);for(let m=l,n=g;m<n;m++)Lh.fromBufferAttribute(c,
m),ch(Lh,m,f,d,a,b,this)}}}updateMorphTargets(){var a=this.geometry.morphAttributes,b=Object.keys(a);if(0<b.length&&(a=a[b[0]],void 0!==a)){this.morphTargetInfluences=[];this.morphTargetDictionary={};for(let c=0,d=a.length;c<d;c++)b=a[c].name||String(c),this.morphTargetInfluences.push(0),this.morphTargetDictionary[b]=c}}}q.Points=Sk;class dm extends Gb{constructor(a,b,c,d,f,g,l,m,n){function t(){u.needsUpdate=!0;a.requestVideoFrameCallback(t)}super(a,b,c,d,f,g,l,m,n);this.isVideoTexture=!0;this.minFilter=
void 0!==g?g:1006;this.magFilter=void 0!==f?f:1006;this.generateMipmaps=!1;const u=this;"requestVideoFrameCallback"in a&&a.requestVideoFrameCallback(t)}clone(){return(new this.constructor(this.image)).copy(this)}update(){const a=this.image;!1==="requestVideoFrameCallback"in a&&a.readyState>=a.HAVE_CURRENT_DATA&&(this.needsUpdate=!0)}}q.VideoTexture=dm;class em extends Gb{constructor(a,b){super({width:a,height:b});this.isFramebufferTexture=!0;this.minFilter=this.magFilter=1003;this.generateMipmaps=
!1;this.needsUpdate=!0}}q.FramebufferTexture=em;class Mh extends Gb{constructor(a,b,c,d,f,g,l,m,n,t,u,v){super(null,g,l,m,n,t,d,f,u,v);this.isCompressedTexture=!0;this.image={width:b,height:c};this.mipmaps=a;this.generateMipmaps=this.flipY=!1}}q.CompressedTexture=Mh;class fm extends Mh{constructor(a,b,c,d,f,g){super(a,b,c,f,g);this.isCompressedArrayTexture=!0;this.image.depth=d;this.wrapR=1001}}q.CompressedArrayTexture=fm;class gm extends Mh{constructor(a,b,c){super(void 0,a[0].width,a[0].height,
b,c,301);this.isCubeTexture=this.isCompressedCubeTexture=!0;this.image=a}}q.CompressedCubeTexture=gm;class hm extends Gb{constructor(a,b,c,d,f,g,l,m,n){super(a,b,c,d,f,g,l,m,n);this.needsUpdate=this.isCanvasTexture=!0}}q.CanvasTexture=hm;class Zc{constructor(){this.type="Curve";this.arcLengthDivisions=200}getPoint(){console.warn("THREE.Curve: .getPoint() not implemented.");return null}getPointAt(a,b){a=this.getUtoTmapping(a);return this.getPoint(a,b)}getPoints(a=5){const b=[];for(let c=0;c<=a;c++)b.push(this.getPoint(c/
a));return b}getSpacedPoints(a=5){const b=[];for(let c=0;c<=a;c++)b.push(this.getPointAt(c/a));return b}getLength(){const a=this.getLengths();return a[a.length-1]}getLengths(a=this.arcLengthDivisions){if(this.cacheArcLengths&&this.cacheArcLengths.length===a+1&&!this.needsUpdate)return this.cacheArcLengths;this.needsUpdate=!1;const b=[];let c,d=this.getPoint(0),f=0;b.push(0);for(let g=1;g<=a;g++)c=this.getPoint(g/a),f+=c.distanceTo(d),b.push(f),d=c;return this.cacheArcLengths=b}updateArcLengths(){this.needsUpdate=
!0;this.getLengths()}getUtoTmapping(a,b){const c=this.getLengths(),d=c.length;b=b?b:a*c[d-1];var f=0;let g=d-1,l;for(;f<=g;)if(a=Math.floor(f+(g-f)/2),l=c[a]-b,0>l)f=a+1;else if(0<l)g=a-1;else{g=a;break}a=g;if(c[a]===b)return a/(d-1);f=c[a];return(a+(b-f)/(c[a+1]-f))/(d-1)}getTangent(a,b){var c=a-1E-4;a+=1E-4;0>c&&(c=0);1<a&&(a=1);c=this.getPoint(c);a=this.getPoint(a);b=b||(c.isVector2?new sa:new O);b.copy(a).sub(c).normalize();return b}getTangentAt(a,b){a=this.getUtoTmapping(a);return this.getTangent(a,
b)}computeFrenetFrames(a,b){var c=new O;const d=[],f=[],g=[];var l=new O;const m=new Wa;for(var n=0;n<=a;n++)d[n]=this.getTangentAt(n/a,new O);f[0]=new O;g[0]=new O;n=Number.MAX_VALUE;const t=Math.abs(d[0].x),u=Math.abs(d[0].y),v=Math.abs(d[0].z);t<=n&&(n=t,c.set(1,0,0));u<=n&&(n=u,c.set(0,1,0));v<=n&&c.set(0,0,1);l.crossVectors(d[0],c).normalize();f[0].crossVectors(d[0],l);g[0].crossVectors(d[0],f[0]);for(c=1;c<=a;c++)f[c]=f[c-1].clone(),g[c]=g[c-1].clone(),l.crossVectors(d[c-1],d[c]),l.length()>
Number.EPSILON&&(l.normalize(),n=Math.acos(yb(d[c-1].dot(d[c]),-1,1)),f[c].applyMatrix4(m.makeRotationAxis(l,n))),g[c].crossVectors(d[c],f[c]);if(!0===b)for(b=Math.acos(yb(f[0].dot(f[a]),-1,1)),b/=a,0<d[0].dot(l.crossVectors(f[0],f[a]))&&(b=-b),l=1;l<=a;l++)f[l].applyMatrix4(m.makeRotationAxis(d[l],b*l)),g[l].crossVectors(d[l],f[l]);return{tangents:d,normals:f,binormals:g}}clone(){return(new this.constructor).copy(this)}copy(a){this.arcLengthDivisions=a.arcLengthDivisions;return this}toJSON(){const a=
{metadata:{version:4.6,type:"Curve",generator:"Curve.toJSON"}};a.arcLengthDivisions=this.arcLengthDivisions;a.type=this.type;return a}fromJSON(a){this.arcLengthDivisions=a.arcLengthDivisions;return this}}q.Curve=Zc;class Nh extends Zc{constructor(a=0,b=0,c=1,d=1,f=0,g=2*Math.PI,l=!1,m=0){super();this.isEllipseCurve=!0;this.type="EllipseCurve";this.aX=a;this.aY=b;this.xRadius=c;this.yRadius=d;this.aStartAngle=f;this.aEndAngle=g;this.aClockwise=l;this.aRotation=m}getPoint(a,b){b=b||new sa;for(var c=
2*Math.PI,d=this.aEndAngle-this.aStartAngle,f=Math.abs(d)<Number.EPSILON;0>d;)d+=c;for(;d>c;)d-=c;d<Number.EPSILON&&(d=f?0:c);!0!==this.aClockwise||f||(d=d===c?-c:d-c);c=this.aStartAngle+a*d;a=this.aX+this.xRadius*Math.cos(c);var g=this.aY+this.yRadius*Math.sin(c);0!==this.aRotation&&(c=Math.cos(this.aRotation),d=Math.sin(this.aRotation),f=a-this.aX,g-=this.aY,a=f*c-g*d+this.aX,g=f*d+g*c+this.aY);return b.set(a,g)}copy(a){super.copy(a);this.aX=a.aX;this.aY=a.aY;this.xRadius=a.xRadius;this.yRadius=
a.yRadius;this.aStartAngle=a.aStartAngle;this.aEndAngle=a.aEndAngle;this.aClockwise=a.aClockwise;this.aRotation=a.aRotation;return this}toJSON(){const a=super.toJSON();a.aX=this.aX;a.aY=this.aY;a.xRadius=this.xRadius;a.yRadius=this.yRadius;a.aStartAngle=this.aStartAngle;a.aEndAngle=this.aEndAngle;a.aClockwise=this.aClockwise;a.aRotation=this.aRotation;return a}fromJSON(a){super.fromJSON(a);this.aX=a.aX;this.aY=a.aY;this.xRadius=a.xRadius;this.yRadius=a.yRadius;this.aStartAngle=a.aStartAngle;this.aEndAngle=
a.aEndAngle;this.aClockwise=a.aClockwise;this.aRotation=a.aRotation;return this}}q.EllipseCurve=Nh;class Tk extends Nh{constructor(a,b,c,d,f,g){super(a,b,c,c,d,f,g);this.isArcCurve=!0;this.type="ArcCurve"}}q.ArcCurve=Tk;const Oh=new O,Hj=new Uf,Ij=new Uf,Jj=new Uf;class Uk extends Zc{constructor(a=[],b=!1,c="centripetal",d=.5){super();this.isCatmullRomCurve3=!0;this.type="CatmullRomCurve3";this.points=a;this.closed=b;this.curveType=c;this.tension=d}getPoint(a,b=new O){var c=this.points,d=c.length;
a*=d-(this.closed?0:1);var f=Math.floor(a);a-=f;this.closed?f+=0<f?0:(Math.floor(Math.abs(f)/d)+1)*d:0===a&&f===d-1&&(f=d-2,a=1);let g;this.closed||0<f?g=c[(f-1)%d]:(Oh.subVectors(c[0],c[1]).add(c[0]),g=Oh);const l=c[f%d],m=c[(f+1)%d];this.closed||f+2<d?c=c[(f+2)%d]:(Oh.subVectors(c[d-1],c[d-2]).add(c[d-1]),c=Oh);if("centripetal"===this.curveType||"chordal"===this.curveType){var n="chordal"===this.curveType?.5:.25;d=Math.pow(g.distanceToSquared(l),n);f=Math.pow(l.distanceToSquared(m),n);n=Math.pow(m.distanceToSquared(c),
n);1E-4>f&&(f=1);1E-4>d&&(d=f);1E-4>n&&(n=f);Hj.initNonuniformCatmullRom(g.x,l.x,m.x,c.x,d,f,n);Ij.initNonuniformCatmullRom(g.y,l.y,m.y,c.y,d,f,n);Jj.initNonuniformCatmullRom(g.z,l.z,m.z,c.z,d,f,n)}else"catmullrom"===this.curveType&&(Hj.initCatmullRom(g.x,l.x,m.x,c.x,this.tension),Ij.initCatmullRom(g.y,l.y,m.y,c.y,this.tension),Jj.initCatmullRom(g.z,l.z,m.z,c.z,this.tension));b.set(Hj.calc(a),Ij.calc(a),Jj.calc(a));return b}copy(a){super.copy(a);this.points=[];for(let b=0,c=a.points.length;b<c;b++)this.points.push(a.points[b].clone());
this.closed=a.closed;this.curveType=a.curveType;this.tension=a.tension;return this}toJSON(){const a=super.toJSON();a.points=[];for(let b=0,c=this.points.length;b<c;b++)a.points.push(this.points[b].toArray());a.closed=this.closed;a.curveType=this.curveType;a.tension=this.tension;return a}fromJSON(a){super.fromJSON(a);this.points=[];for(let b=0,c=a.points.length;b<c;b++){const d=a.points[b];this.points.push((new O).fromArray(d))}this.closed=a.closed;this.curveType=a.curveType;this.tension=a.tension;
return this}}q.CatmullRomCurve3=Uk;class Kj extends Zc{constructor(a=new sa,b=new sa,c=new sa,d=new sa){super();this.isCubicBezierCurve=!0;this.type="CubicBezierCurve";this.v0=a;this.v1=b;this.v2=c;this.v3=d}getPoint(a,b=new sa){const c=this.v0,d=this.v1,f=this.v2,g=this.v3;b.set(Ud(a,c.x,d.x,f.x,g.x),Ud(a,c.y,d.y,f.y,g.y));return b}copy(a){super.copy(a);this.v0.copy(a.v0);this.v1.copy(a.v1);this.v2.copy(a.v2);this.v3.copy(a.v3);return this}toJSON(){const a=super.toJSON();a.v0=this.v0.toArray();a.v1=
this.v1.toArray();a.v2=this.v2.toArray();a.v3=this.v3.toArray();return a}fromJSON(a){super.fromJSON(a);this.v0.fromArray(a.v0);this.v1.fromArray(a.v1);this.v2.fromArray(a.v2);this.v3.fromArray(a.v3);return this}}q.CubicBezierCurve=Kj;class Vk extends Zc{constructor(a=new O,b=new O,c=new O,d=new O){super();this.isCubicBezierCurve3=!0;this.type="CubicBezierCurve3";this.v0=a;this.v1=b;this.v2=c;this.v3=d}getPoint(a,b=new O){const c=this.v0,d=this.v1,f=this.v2,g=this.v3;b.set(Ud(a,c.x,d.x,f.x,g.x),Ud(a,
c.y,d.y,f.y,g.y),Ud(a,c.z,d.z,f.z,g.z));return b}copy(a){super.copy(a);this.v0.copy(a.v0);this.v1.copy(a.v1);this.v2.copy(a.v2);this.v3.copy(a.v3);return this}toJSON(){const a=super.toJSON();a.v0=this.v0.toArray();a.v1=this.v1.toArray();a.v2=this.v2.toArray();a.v3=this.v3.toArray();return a}fromJSON(a){super.fromJSON(a);this.v0.fromArray(a.v0);this.v1.fromArray(a.v1);this.v2.fromArray(a.v2);this.v3.fromArray(a.v3);return this}}q.CubicBezierCurve3=Vk;class Lj extends Zc{constructor(a=new sa,b=new sa){super();
this.isLineCurve=!0;this.type="LineCurve";this.v1=a;this.v2=b}getPoint(a,b=new sa){1===a?b.copy(this.v2):(b.copy(this.v2).sub(this.v1),b.multiplyScalar(a).add(this.v1));return b}getPointAt(a,b){return this.getPoint(a,b)}getTangent(a,b=new sa){return b.subVectors(this.v2,this.v1).normalize()}getTangentAt(a,b){return this.getTangent(a,b)}copy(a){super.copy(a);this.v1.copy(a.v1);this.v2.copy(a.v2);return this}toJSON(){const a=super.toJSON();a.v1=this.v1.toArray();a.v2=this.v2.toArray();return a}fromJSON(a){super.fromJSON(a);
this.v1.fromArray(a.v1);this.v2.fromArray(a.v2);return this}}q.LineCurve=Lj;class Wk extends Zc{constructor(a=new O,b=new O){super();this.isLineCurve3=!0;this.type="LineCurve3";this.v1=a;this.v2=b}getPoint(a,b=new O){1===a?b.copy(this.v2):(b.copy(this.v2).sub(this.v1),b.multiplyScalar(a).add(this.v1));return b}getPointAt(a,b){return this.getPoint(a,b)}getTangent(a,b=new O){return b.subVectors(this.v2,this.v1).normalize()}getTangentAt(a,b){return this.getTangent(a,b)}copy(a){super.copy(a);this.v1.copy(a.v1);
this.v2.copy(a.v2);return this}toJSON(){const a=super.toJSON();a.v1=this.v1.toArray();a.v2=this.v2.toArray();return a}fromJSON(a){super.fromJSON(a);this.v1.fromArray(a.v1);this.v2.fromArray(a.v2);return this}}q.LineCurve3=Wk;class Mj extends Zc{constructor(a=new sa,b=new sa,c=new sa){super();this.isQuadraticBezierCurve=!0;this.type="QuadraticBezierCurve";this.v0=a;this.v1=b;this.v2=c}getPoint(a,b=new sa){const c=this.v0,d=this.v1,f=this.v2;b.set(Td(a,c.x,d.x,f.x),Td(a,c.y,d.y,f.y));return b}copy(a){super.copy(a);
this.v0.copy(a.v0);this.v1.copy(a.v1);this.v2.copy(a.v2);return this}toJSON(){const a=super.toJSON();a.v0=this.v0.toArray();a.v1=this.v1.toArray();a.v2=this.v2.toArray();return a}fromJSON(a){super.fromJSON(a);this.v0.fromArray(a.v0);this.v1.fromArray(a.v1);this.v2.fromArray(a.v2);return this}}q.QuadraticBezierCurve=Mj;class Nj extends Zc{constructor(a=new O,b=new O,c=new O){super();this.isQuadraticBezierCurve3=!0;this.type="QuadraticBezierCurve3";this.v0=a;this.v1=b;this.v2=c}getPoint(a,b=new O){const c=
this.v0,d=this.v1,f=this.v2;b.set(Td(a,c.x,d.x,f.x),Td(a,c.y,d.y,f.y),Td(a,c.z,d.z,f.z));return b}copy(a){super.copy(a);this.v0.copy(a.v0);this.v1.copy(a.v1);this.v2.copy(a.v2);return this}toJSON(){const a=super.toJSON();a.v0=this.v0.toArray();a.v1=this.v1.toArray();a.v2=this.v2.toArray();return a}fromJSON(a){super.fromJSON(a);this.v0.fromArray(a.v0);this.v1.fromArray(a.v1);this.v2.fromArray(a.v2);return this}}q.QuadraticBezierCurve3=Nj;class Oj extends Zc{constructor(a=[]){super();this.isSplineCurve=
!0;this.type="SplineCurve";this.points=a}getPoint(a,b=new sa){var c=this.points,d=(c.length-1)*a;a=Math.floor(d);d-=a;const f=c[0===a?a:a-1],g=c[a],l=c[a>c.length-2?c.length-1:a+1];c=c[a>c.length-3?c.length-1:a+2];b.set(dh(d,f.x,g.x,l.x,c.x),dh(d,f.y,g.y,l.y,c.y));return b}copy(a){super.copy(a);this.points=[];for(let b=0,c=a.points.length;b<c;b++)this.points.push(a.points[b].clone());return this}toJSON(){const a=super.toJSON();a.points=[];for(let b=0,c=this.points.length;b<c;b++)a.points.push(this.points[b].toArray());
return a}fromJSON(a){super.fromJSON(a);this.points=[];for(let b=0,c=a.points.length;b<c;b++){const d=a.points[b];this.points.push((new sa).fromArray(d))}return this}}q.SplineCurve=Oj;var Ph=Object.freeze({__proto__:null,ArcCurve:Tk,CatmullRomCurve3:Uk,CubicBezierCurve:Kj,CubicBezierCurve3:Vk,EllipseCurve:Nh,LineCurve:Lj,LineCurve3:Wk,QuadraticBezierCurve:Mj,QuadraticBezierCurve3:Nj,SplineCurve:Oj});class Xk extends Zc{constructor(){super();this.type="CurvePath";this.curves=[];this.autoClose=!1}add(a){this.curves.push(a)}closePath(){const a=
this.curves[0].getPoint(0),b=this.curves[this.curves.length-1].getPoint(1);a.equals(b)||this.curves.push(new Ph[!0===a.isVector2?"LineCurve":"LineCurve3"](b,a));return this}getPoint(a,b){var c=a*this.getLength(),d=this.getCurveLengths();for(a=0;a<d.length;){if(d[a]>=c)return c=d[a]-c,a=this.curves[a],d=a.getLength(),a.getPointAt(0===d?0:1-c/d,b);a++}return null}getLength(){const a=this.getCurveLengths();return a[a.length-1]}updateArcLengths(){this.needsUpdate=!0;this.cacheLengths=null;this.getCurveLengths()}getCurveLengths(){if(this.cacheLengths&&
this.cacheLengths.length===this.curves.length)return this.cacheLengths;const a=[];let b=0;for(let c=0,d=this.curves.length;c<d;c++)b+=this.curves[c].getLength(),a.push(b);return this.cacheLengths=a}getSpacedPoints(a=40){const b=[];for(let c=0;c<=a;c++)b.push(this.getPoint(c/a));this.autoClose&&b.push(b[0]);return b}getPoints(a=12){const b=[];let c;for(let f=0,g=this.curves;f<g.length;f++){var d=g[f];d=d.getPoints(d.isEllipseCurve?2*a:d.isLineCurve||d.isLineCurve3?1:d.isSplineCurve?a*d.points.length:
a);for(let l=0;l<d.length;l++){const m=d[l];c&&c.equals(m)||(b.push(m),c=m)}}this.autoClose&&1<b.length&&!b[b.length-1].equals(b[0])&&b.push(b[0]);return b}copy(a){super.copy(a);this.curves=[];for(let b=0,c=a.curves.length;b<c;b++)this.curves.push(a.curves[b].clone());this.autoClose=a.autoClose;return this}toJSON(){const a=super.toJSON();a.autoClose=this.autoClose;a.curves=[];for(let b=0,c=this.curves.length;b<c;b++)a.curves.push(this.curves[b].toJSON());return a}fromJSON(a){super.fromJSON(a);this.autoClose=
a.autoClose;this.curves=[];for(let b=0,c=a.curves.length;b<c;b++){const d=a.curves[b];this.curves.push((new Ph[d.type]).fromJSON(d))}return this}}q.CurvePath=Xk;class xg extends Xk{constructor(a){super();this.type="Path";this.currentPoint=new sa;a&&this.setFromPoints(a)}setFromPoints(a){this.moveTo(a[0].x,a[0].y);for(let b=1,c=a.length;b<c;b++)this.lineTo(a[b].x,a[b].y);return this}moveTo(a,b){this.currentPoint.set(a,b);return this}lineTo(a,b){const c=new Lj(this.currentPoint.clone(),new sa(a,b));
this.curves.push(c);this.currentPoint.set(a,b);return this}quadraticCurveTo(a,b,c,d){a=new Mj(this.currentPoint.clone(),new sa(a,b),new sa(c,d));this.curves.push(a);this.currentPoint.set(c,d);return this}bezierCurveTo(a,b,c,d,f,g){a=new Kj(this.currentPoint.clone(),new sa(a,b),new sa(c,d),new sa(f,g));this.curves.push(a);this.currentPoint.set(f,g);return this}splineThru(a){var b=[this.currentPoint.clone()].concat(a);b=new Oj(b);this.curves.push(b);this.currentPoint.copy(a[a.length-1]);return this}arc(a,
b,c,d,f,g){this.absarc(a+this.currentPoint.x,b+this.currentPoint.y,c,d,f,g);return this}absarc(a,b,c,d,f,g){this.absellipse(a,b,c,c,d,f,g);return this}ellipse(a,b,c,d,f,g,l,m){this.absellipse(a+this.currentPoint.x,b+this.currentPoint.y,c,d,f,g,l,m);return this}absellipse(a,b,c,d,f,g,l,m){a=new Nh(a,b,c,d,f,g,l,m);0<this.curves.length&&(b=a.getPoint(0),b.equals(this.currentPoint)||this.lineTo(b.x,b.y));this.curves.push(a);a=a.getPoint(1);this.currentPoint.copy(a);return this}copy(a){super.copy(a);
this.currentPoint.copy(a.currentPoint);return this}toJSON(){const a=super.toJSON();a.currentPoint=this.currentPoint.toArray();return a}fromJSON(a){super.fromJSON(a);this.currentPoint.fromArray(a.currentPoint);return this}}q.Path=xg;class Qh extends ab{constructor(a=[new sa(0,-.5),new sa(.5,0),new sa(0,.5)],b=12,c=0,d=2*Math.PI){super();this.type="LatheGeometry";this.parameters={points:a,segments:b,phiStart:c,phiLength:d};b=Math.floor(b);d=yb(d,0,2*Math.PI);const f=[],g=[],l=[];var m=[];const n=[];
var t=1/b,u=new O,v=new sa,A=new O,F=new O,D=new O;let E;for(let J=0;J<=a.length-1;J++)switch(J){case 0:var y=a[J+1].x-a[J].x;E=a[J+1].y-a[J].y;A.x=1*E;A.y=-y;A.z=0*E;D.copy(A);A.normalize();m.push(A.x,A.y,A.z);break;case a.length-1:m.push(D.x,D.y,D.z);break;default:y=a[J+1].x-a[J].x,E=a[J+1].y-a[J].y,A.x=1*E,A.y=-y,A.z=0*E,F.copy(A),A.x+=D.x,A.y+=D.y,A.z+=D.z,A.normalize(),m.push(A.x,A.y,A.z),D.copy(F)}for(A=0;A<=b;A++)for(D=c+A*t*d,F=Math.sin(D),D=Math.cos(D),y=0;y<=a.length-1;y++)u.x=a[y].x*F,
u.y=a[y].y,u.z=a[y].x*D,g.push(u.x,u.y,u.z),v.x=A/b,v.y=y/(a.length-1),l.push(v.x,v.y),n.push(m[3*y]*F,m[3*y+1],m[3*y]*D);for(c=0;c<b;c++)for(d=0;d<a.length-1;d++)m=d+c*a.length,t=m+a.length,u=m+a.length+1,v=m+1,f.push(m,t,v),f.push(u,v,t);this.setIndex(f);this.setAttribute("position",new Oa(g,3));this.setAttribute("uv",new Oa(l,2));this.setAttribute("normal",new Oa(n,3))}copy(a){super.copy(a);this.parameters=Object.assign({},a.parameters);return this}static fromJSON(a){return new Qh(a.points,a.segments,
a.phiStart,a.phiLength)}}q.LatheGeometry=Qh;class Pj extends Qh{constructor(a=1,b=1,c=4,d=8){const f=new xg;f.absarc(0,-b/2,a,1.5*Math.PI,0);f.absarc(0,b/2,a,0,.5*Math.PI);super(f.getPoints(c),d);this.type="CapsuleGeometry";this.parameters={radius:a,length:b,capSegments:c,radialSegments:d}}static fromJSON(a){return new Pj(a.radius,a.length,a.capSegments,a.radialSegments)}}q.CapsuleGeometry=Pj;class Qj extends ab{constructor(a=1,b=32,c=0,d=2*Math.PI){super();this.type="CircleGeometry";this.parameters=
{radius:a,segments:b,thetaStart:c,thetaLength:d};b=Math.max(3,b);const f=[],g=[],l=[],m=[],n=new O,t=new sa;g.push(0,0,0);l.push(0,0,1);m.push(.5,.5);for(let u=0,v=3;u<=b;u++,v+=3){const A=c+u/b*d;n.x=a*Math.cos(A);n.y=a*Math.sin(A);g.push(n.x,n.y,n.z);l.push(0,0,1);t.x=(g[v]/a+1)/2;t.y=(g[v+1]/a+1)/2;m.push(t.x,t.y)}for(a=1;a<=b;a++)f.push(a,a+1,0);this.setIndex(f);this.setAttribute("position",new Oa(g,3));this.setAttribute("normal",new Oa(l,3));this.setAttribute("uv",new Oa(m,2))}copy(a){super.copy(a);
this.parameters=Object.assign({},a.parameters);return this}static fromJSON(a){return new Qj(a.radius,a.segments,a.thetaStart,a.thetaLength)}}q.CircleGeometry=Qj;class yg extends ab{constructor(a=1,b=1,c=1,d=32,f=1,g=!1,l=0,m=2*Math.PI){function n(L){const U=D;var P=new sa,X=new O;let ja=0;var fa=!0===L?a:b;const aa=!0===L?1:-1;for(var pa=1;pa<=d;pa++)v.push(0,y*aa,0),A.push(0,aa,0),F.push(.5,.5),D++;pa=D;for(let xa=0;xa<=d;xa++){var ba=xa/d*m+l;const qa=Math.cos(ba);ba=Math.sin(ba);X.x=fa*ba;X.y=
y*aa;X.z=fa*qa;v.push(X.x,X.y,X.z);A.push(0,aa,0);P.x=.5*qa+.5;P.y=.5*ba*aa+.5;F.push(P.x,P.y);D++}for(P=0;P<d;P++)X=U+P,fa=pa+P,!0===L?u.push(fa,fa+1,X):u.push(fa+1,fa,X),ja+=3;t.addGroup(J,ja,!0===L?1:2);J+=ja}super();this.type="CylinderGeometry";this.parameters={radiusTop:a,radiusBottom:b,height:c,radialSegments:d,heightSegments:f,openEnded:g,thetaStart:l,thetaLength:m};const t=this;d=Math.floor(d);f=Math.floor(f);const u=[],v=[],A=[],F=[];let D=0;const E=[],y=c/2;let J=0;(function(){var L=new O,
U=new O;let P=0;var X=(b-a)/c;for(var ja=0;ja<=f;ja++){var fa=[];const pa=ja/f,ba=pa*(b-a)+a;for(let xa=0;xa<=d;xa++){const qa=xa/d;var aa=qa*m+l;const ta=Math.sin(aa);aa=Math.cos(aa);U.x=ba*ta;U.y=-pa*c+y;U.z=ba*aa;v.push(U.x,U.y,U.z);L.set(ta,X,aa).normalize();A.push(L.x,L.y,L.z);F.push(qa,1-pa);fa.push(D++)}E.push(fa)}for(L=0;L<d;L++)for(U=0;U<f;U++)X=E[U+1][L],ja=E[U+1][L+1],fa=E[U][L+1],u.push(E[U][L],X,fa),u.push(X,ja,fa),P+=6;t.addGroup(J,P,0);J+=P})();!1===g&&(0<a&&n(!0),0<b&&n(!1));this.setIndex(u);
this.setAttribute("position",new Oa(v,3));this.setAttribute("normal",new Oa(A,3));this.setAttribute("uv",new Oa(F,2))}copy(a){super.copy(a);this.parameters=Object.assign({},a.parameters);return this}static fromJSON(a){return new yg(a.radiusTop,a.radiusBottom,a.height,a.radialSegments,a.heightSegments,a.openEnded,a.thetaStart,a.thetaLength)}}q.CylinderGeometry=yg;class Rj extends yg{constructor(a=1,b=1,c=32,d=1,f=!1,g=0,l=2*Math.PI){super(0,a,b,c,d,f,g,l);this.type="ConeGeometry";this.parameters={radius:a,
height:b,radialSegments:c,heightSegments:d,openEnded:f,thetaStart:g,thetaLength:l}}static fromJSON(a){return new Rj(a.radius,a.height,a.radialSegments,a.heightSegments,a.openEnded,a.thetaStart,a.thetaLength)}}q.ConeGeometry=Rj;class Fe extends ab{constructor(a=[],b=[],c=1,d=0){function f(t){m.push(t.x,t.y,t.z)}function g(t,u){t*=3;u.x=a[t+0];u.y=a[t+1];u.z=a[t+2]}function l(t,u,v,A){0>A&&1===t.x&&(n[u]=t.x-1);0===v.x&&0===v.z&&(n[u]=A/2/Math.PI+.5)}super();this.type="PolyhedronGeometry";this.parameters=
{vertices:a,indices:b,radius:c,detail:d};const m=[],n=[];(function(t){const u=new O,v=new O,A=new O;for(let y=0;y<b.length;y+=3){g(b[y+0],u);g(b[y+1],v);g(b[y+2],A);var F=u,D=v,E=A;const J=t+1,L=[];for(let U=0;U<=J;U++){L[U]=[];const P=F.clone().lerp(E,U/J),X=D.clone().lerp(E,U/J),ja=J-U;for(let fa=0;fa<=ja;fa++)L[U][fa]=0===fa&&U===J?P:P.clone().lerp(X,fa/ja)}for(F=0;F<J;F++)for(D=0;D<2*(J-F)-1;D++)E=Math.floor(D/2),0===D%2?(f(L[F][E+1]),f(L[F+1][E]),f(L[F][E])):(f(L[F][E+1]),f(L[F+1][E+1]),f(L[F+
1][E]))}})(d);(function(t){const u=new O;for(let v=0;v<m.length;v+=3)u.x=m[v+0],u.y=m[v+1],u.z=m[v+2],u.normalize().multiplyScalar(t),m[v+0]=u.x,m[v+1]=u.y,m[v+2]=u.z})(c);(function(){var t=new O;for(var u=0;u<m.length;u+=3)t.x=m[u+0],t.y=m[u+1],t.z=m[u+2],n.push(Math.atan2(t.z,-t.x)/2/Math.PI+.5,1-(Math.atan2(-t.y,Math.sqrt(t.x*t.x+t.z*t.z))/Math.PI+.5));t=new O;u=new O;var v=new O,A=new O,F=new sa;const D=new sa,E=new sa;for(let y=0,J=0;y<m.length;y+=9,J+=6){t.set(m[y+0],m[y+1],m[y+2]);u.set(m[y+
3],m[y+4],m[y+5]);v.set(m[y+6],m[y+7],m[y+8]);F.set(n[J+0],n[J+1]);D.set(n[J+2],n[J+3]);E.set(n[J+4],n[J+5]);A.copy(t).add(u).add(v).divideScalar(3);const L=Math.atan2(A.z,-A.x);l(F,J+0,t,L);l(D,J+2,u,L);l(E,J+4,v,L)}for(t=0;t<n.length;t+=6)u=n[t+0],v=n[t+2],A=n[t+4],F=Math.min(u,v,A),.9<Math.max(u,v,A)&&.1>F&&(.2>u&&(n[t+0]+=1),.2>v&&(n[t+2]+=1),.2>A&&(n[t+4]+=1))})();this.setAttribute("position",new Oa(m,3));this.setAttribute("normal",new Oa(m.slice(),3));this.setAttribute("uv",new Oa(n,2));0===
d?this.computeVertexNormals():this.normalizeNormals()}copy(a){super.copy(a);this.parameters=Object.assign({},a.parameters);return this}static fromJSON(a){return new Fe(a.vertices,a.indices,a.radius,a.details)}}q.PolyhedronGeometry=Fe;class Sj extends Fe{constructor(a=1,b=0){const c=(1+Math.sqrt(5))/2,d=1/c;super([-1,-1,-1,-1,-1,1,-1,1,-1,-1,1,1,1,-1,-1,1,-1,1,1,1,-1,1,1,1,0,-d,-c,0,-d,c,0,d,-c,0,d,c,-d,-c,0,-d,c,0,d,-c,0,d,c,0,-c,0,-d,c,0,-d,-c,0,d,c,0,d],[3,11,7,3,7,15,3,15,13,7,19,17,7,17,6,7,6,
15,17,4,8,17,8,10,17,10,6,8,0,16,8,16,2,8,2,10,0,12,1,0,1,18,0,18,16,6,10,2,6,2,13,6,13,15,2,16,18,2,18,3,2,3,13,18,1,9,18,9,11,18,11,3,4,14,12,4,12,0,4,0,8,11,9,5,11,5,19,11,19,7,19,5,14,19,14,4,19,4,17,1,12,14,1,14,5,1,5,9],a,b);this.type="DodecahedronGeometry";this.parameters={radius:a,detail:b}}static fromJSON(a){return new Sj(a.radius,a.detail)}}q.DodecahedronGeometry=Sj;const Rh=new O,Sh=new O,Tj=new O,Th=new Tb;class Yk extends ab{constructor(a=null,b=1){super();this.type="EdgesGeometry";this.parameters=
{geometry:a,thresholdAngle:b};if(null!==a){const d=Math.pow(10,4);b=Math.cos(wd*b);const f=a.getIndex();a=a.getAttribute("position");const g=f?f.count:a.count,l=[0,0,0],m=["a","b","c"],n=Array(3),t={},u=[];for(let v=0;v<g;v+=3){f?(l[0]=f.getX(v),l[1]=f.getX(v+1),l[2]=f.getX(v+2)):(l[0]=v,l[1]=v+1,l[2]=v+2);const {a:A,b:F,c:D}=Th;A.fromBufferAttribute(a,l[0]);F.fromBufferAttribute(a,l[1]);D.fromBufferAttribute(a,l[2]);Th.getNormal(Tj);n[0]=`${Math.round(A.x*d)},${Math.round(A.y*d)},${Math.round(A.z*
d)}`;n[1]=`${Math.round(F.x*d)},${Math.round(F.y*d)},${Math.round(F.z*d)}`;n[2]=`${Math.round(D.x*d)},${Math.round(D.y*d)},${Math.round(D.z*d)}`;if(n[0]!==n[1]&&n[1]!==n[2]&&n[2]!==n[0])for(let E=0;3>E;E++){const y=(E+1)%3;var c=n[E];const J=n[y],L=Th[m[E]],U=Th[m[y]],P=`${c}_${J}`;c=`${J}_${c}`;c in t&&t[c]?(Tj.dot(t[c].normal)<=b&&(u.push(L.x,L.y,L.z),u.push(U.x,U.y,U.z)),t[c]=null):P in t||(t[P]={index0:l[E],index1:l[y],normal:Tj.clone()})}}for(const v in t)if(t[v]){const {index0:A,index1:F}=t[v];
Rh.fromBufferAttribute(a,A);Sh.fromBufferAttribute(a,F);u.push(Rh.x,Rh.y,Rh.z);u.push(Sh.x,Sh.y,Sh.z)}this.setAttribute("position",new Oa(u,3))}}copy(a){super.copy(a);this.parameters=Object.assign({},a.parameters);return this}}q.EdgesGeometry=Yk;class Ge extends xg{constructor(a){super(a);this.uuid=$b();this.type="Shape";this.holes=[]}getPointsHoles(a){const b=[];for(let c=0,d=this.holes.length;c<d;c++)b[c]=this.holes[c].getPoints(a);return b}extractPoints(a){return{shape:this.getPoints(a),holes:this.getPointsHoles(a)}}copy(a){super.copy(a);
this.holes=[];for(let b=0,c=a.holes.length;b<c;b++)this.holes.push(a.holes[b].clone());return this}toJSON(){const a=super.toJSON();a.uuid=this.uuid;a.holes=[];for(let b=0,c=this.holes.length;b<c;b++)a.holes.push(this.holes[b].toJSON());return a}fromJSON(a){super.fromJSON(a);this.uuid=a.uuid;this.holes=[];for(let b=0,c=a.holes.length;b<c;b++){const d=a.holes[b];this.holes.push((new xg).fromJSON(d))}return this}}q.Shape=Ge;const im={triangulate:function(a,b,c=2){var d=b&&b.length;const f=d?b[0]*c:a.length;
var g=eh(a,0,f,c,!0);const l=[];if(!g||g.next===g.prev)return l;let m,n;var t;if(d){var u=g;g=[];var v;d=0;for(v=b.length;d<v;d++){var A=b[d]*c;var F=d<v-1?b[d+1]*c:a.length;var D=eh(a,A,F,c,!1);D===D.next&&(D.steiner=!0);A=g;F=A.push;var E=D,y=D;do{if(E.x<y.x||E.x===y.x&&E.y<y.y)y=E;E=E.next}while(E!==D);F.call(A,y)}g.sort(Xi);for(d=0;d<g.length;d++){v=void 0;b=g[d];b:{A=u;F=-Infinity;D=b.x;E=b.y;do{if(E<=A.y&&E>=A.next.y&&A.next.y!==A.y&&(y=A.x+(E-A.y)*(A.next.x-A.x)/(A.next.y-A.y),y<=D&&y>F&&(F=
y,v=A.x<A.next.x?A:A.next,y===D)))break b;A=A.next}while(A!==u);if(v){var J=v,L=v.x,U=v.y,P=Infinity;A=v;do{if(D>=A.x&&A.x>=L&&D!==A.x&&Oc(E<U?D:F,E,L,U,E<U?F:D,E,A.x,A.y)){y=Math.abs(E-A.y)/(D-A.x);var X;if((X=ue(A,b))&&!(X=y<P)&&(X=y===P)&&!(X=A.x>v.x)&&(X=A.x===v.x)){X=v;var ja=A;X=0>Ab(X.prev,X,ja.prev)&&0>Ab(ja.next,X,X.next)}X&&(v=A,P=y)}A=A.next}while(A!==J)}else v=null}v&&(b=hh(v,b),ud(b,b.next),u=ud(v,v.next))}g=u}if(a.length>80*c){m=t=a[0];n=d=a[1];for(v=c;v<f;v+=c)b=a[v],u=a[v+1],b<m&&
(m=b),u<n&&(n=u),b>t&&(t=b),u>d&&(d=u);t=Math.max(t-m,d-n);t=0!==t?32767/t:0}vd(g,l,c,m,n,t,0);return l}};class Dd{static area(a){const b=a.length;let c=0;for(let d=b-1,f=0;f<b;d=f++)c+=a[d].x*a[f].y-a[f].x*a[d].y;return.5*c}static isClockWise(a){return 0>Dd.area(a)}static triangulateShape(a,b){var c=[];const d=[],f=[];ih(a);jh(c,a);a=a.length;b.forEach(ih);for(let g=0;g<b.length;g++)d.push(a),a+=b[g].length,jh(c,b[g]);b=im.triangulate(c,d);for(c=0;c<b.length;c+=3)f.push(b.slice(c,c+3));return f}}
q.ShapeUtils=Dd;class Uj extends ab{constructor(a=new Ge([new sa(.5,.5),new sa(-.5,.5),new sa(-.5,-.5),new sa(.5,-.5)]),b={}){function c(l){function m(G,I,Q){I||console.error("THREE.ExtrudeGeometry: vec does not exist");return G.clone().addScaledVector(I,Q)}function n(G,I,Q){var Y=G.x-I.x;var Z=G.y-I.y;var Fa=Q.x-G.x;var Ja=Q.y-G.y,N=Y*Y+Z*Z;if(Math.abs(Y*Ja-Z*Fa)>Number.EPSILON){const da=Math.sqrt(N),la=Math.sqrt(Fa*Fa+Ja*Ja);N=I.x-Z/da;I=I.y+Y/da;Ja=((Q.x-Ja/la-N)*Ja-(Q.y+Fa/la-I)*Fa)/(Y*Ja-Z*Fa);
Fa=N+Y*Ja-G.x;Y=I+Z*Ja-G.y;Z=Fa*Fa+Y*Y;if(2>=Z)return new sa(Fa,Y);Z=Math.sqrt(Z/2)}else G=!1,Y>Number.EPSILON?Fa>Number.EPSILON&&(G=!0):Y<-Number.EPSILON?Fa<-Number.EPSILON&&(G=!0):Math.sign(Z)===Math.sign(Ja)&&(G=!0),G?(Fa=-Z,Z=Math.sqrt(N)):(Fa=Y,Y=Z,Z=Math.sqrt(N/2));return new sa(Fa/Z,Y/Z)}function t(G,I){let Q=G.length;for(;0<=--Q;){const Ja=Q;let N=Q-1;0>N&&(N=G.length-1);for(let da=0,la=y+2*ja;da<la;da++){const Aa=wa*da;var Y=wa*(da+1),Z=I+N+Aa,Fa=I+N+Y;Y=I+Ja+Y;A(I+Ja+Aa);A(Z);A(Y);A(Z);
A(Fa);A(Y);Z=f.length/3;Z=aa.generateSideWallUV(d,f,Z-6,Z-3,Z-2,Z-1);F(Z[0]);F(Z[1]);F(Z[3]);F(Z[1]);F(Z[2]);F(Z[3])}}}function u(G,I,Q){D.push(G);D.push(I);D.push(Q)}function v(G,I,Q){A(G);A(I);A(Q);G=f.length/3;G=aa.generateTopUV(d,f,G-3,G-2,G-1);F(G[0]);F(G[1]);F(G[2])}function A(G){f.push(D[3*G]);f.push(D[3*G+1]);f.push(D[3*G+2])}function F(G){g.push(G.x);g.push(G.y)}const D=[];var E=void 0!==b.curveSegments?b.curveSegments:12;const y=void 0!==b.steps?b.steps:1,J=void 0!==b.depth?b.depth:1;let L=
void 0!==b.bevelEnabled?b.bevelEnabled:!0,U=void 0!==b.bevelThickness?b.bevelThickness:.2,P=void 0!==b.bevelSize?b.bevelSize:U-.1,X=void 0!==b.bevelOffset?b.bevelOffset:0,ja=void 0!==b.bevelSegments?b.bevelSegments:3;var fa=b.extrudePath;const aa=void 0!==b.UVGenerator?b.UVGenerator:jm;let pa,ba=!1;if(fa){pa=fa.getSpacedPoints(y);ba=!0;L=!1;var xa=fa.computeFrenetFrames(y,!1);var qa=new O;var ta=new O;var Ba=new O}L||(X=P=U=ja=0);l=l.extractPoints(E);fa=l.shape;const va=l.holes;if(!Dd.isClockWise(fa)){fa=
fa.reverse();for(let G=0,I=va.length;G<I;G++)l=va[G],Dd.isClockWise(l)&&(va[G]=l.reverse())}const Ga=Dd.triangulateShape(fa,va),ia=fa;for(let G=0,I=va.length;G<I;G++)fa=fa.concat(va[G]);const wa=fa.length,ra=Ga.length;l=[];for(let G=0,I=ia.length,Q=I-1,Y=G+1;G<I;G++,Q++,Y++)Q===I&&(Q=0),Y===I&&(Y=0),l[G]=n(ia[G],ia[Q],ia[Y]);E=[];let Sa=l.concat();for(let G=0,I=va.length;G<I;G++){var Da=va[G];var Na=[];for(let Q=0,Y=Da.length,Z=Y-1,Fa=Q+1;Q<Y;Q++,Z++,Fa++)Z===Y&&(Z=0),Fa===Y&&(Fa=0),Na[Q]=n(Da[Q],
Da[Z],Da[Fa]);E.push(Na);Sa=Sa.concat(Na)}for(Da=0;Da<ja;Da++){Na=Da/ja;var Ea=U*Math.cos(Na*Math.PI/2),Ta=P*Math.sin(Na*Math.PI/2)+X;for(let G=0,I=ia.length;G<I;G++)Na=m(ia[G],l[G],Ta),u(Na.x,Na.y,-Ea);for(let G=0,I=va.length;G<I;G++){const Q=va[G];Na=E[G];for(let Y=0,Z=Q.length;Y<Z;Y++){const Fa=m(Q[Y],Na[Y],Ta);u(Fa.x,Fa.y,-Ea)}}}Na=P+X;for(Da=0;Da<wa;Da++)Ea=L?m(fa[Da],Sa[Da],Na):fa[Da],ba?(ta.copy(xa.normals[0]).multiplyScalar(Ea.x),qa.copy(xa.binormals[0]).multiplyScalar(Ea.y),Ba.copy(pa[0]).add(ta).add(qa),
u(Ba.x,Ba.y,Ba.z)):u(Ea.x,Ea.y,0);for(Da=1;Da<=y;Da++)for(Ea=0;Ea<wa;Ea++)Ta=L?m(fa[Ea],Sa[Ea],Na):fa[Ea],ba?(ta.copy(xa.normals[Da]).multiplyScalar(Ta.x),qa.copy(xa.binormals[Da]).multiplyScalar(Ta.y),Ba.copy(pa[Da]).add(ta).add(qa),u(Ba.x,Ba.y,Ba.z)):u(Ta.x,Ta.y,J/y*Da);for(xa=ja-1;0<=xa;xa--){ta=xa/ja;qa=U*Math.cos(ta*Math.PI/2);ta=P*Math.sin(ta*Math.PI/2)+X;for(let G=0,I=ia.length;G<I;G++)Ba=m(ia[G],l[G],ta),u(Ba.x,Ba.y,J+qa);for(let G=0,I=va.length;G<I;G++){Ba=va[G];Na=E[G];for(let Q=0,Y=Ba.length;Q<
Y;Q++)fa=m(Ba[Q],Na[Q],ta),ba?u(fa.x,fa.y+pa[y-1].y,pa[y-1].x+qa):u(fa.x,fa.y,J+qa)}}(function(){const G=f.length/3;if(L){var I=0*wa;for(var Q=0;Q<ra;Q++){var Y=Ga[Q];v(Y[2]+I,Y[1]+I,Y[0]+I)}I=wa*(y+2*ja);for(Q=0;Q<ra;Q++)Y=Ga[Q],v(Y[0]+I,Y[1]+I,Y[2]+I)}else{for(I=0;I<ra;I++)Q=Ga[I],v(Q[2],Q[1],Q[0]);for(I=0;I<ra;I++)Q=Ga[I],v(Q[0]+wa*y,Q[1]+wa*y,Q[2]+wa*y)}d.addGroup(G,f.length/3-G,0)})();(function(){const G=f.length/3;let I=0;t(ia,I);I+=ia.length;for(let Q=0,Y=va.length;Q<Y;Q++){const Z=va[Q];t(Z,
I);I+=Z.length}d.addGroup(G,f.length/3-G,1)})()}super();this.type="ExtrudeGeometry";this.parameters={shapes:a,options:b};a=Array.isArray(a)?a:[a];const d=this,f=[],g=[];for(let l=0,m=a.length;l<m;l++)c(a[l]);this.setAttribute("position",new Oa(f,3));this.setAttribute("uv",new Oa(g,2));this.computeVertexNormals()}copy(a){super.copy(a);this.parameters=Object.assign({},a.parameters);return this}toJSON(){const a=super.toJSON();var b=this.parameters.shapes,c=this.parameters.options;a.shapes=[];if(Array.isArray(b))for(let d=
0,f=b.length;d<f;d++)a.shapes.push(b[d].uuid);else a.shapes.push(b.uuid);a.options=Object.assign({},c);void 0!==c.extrudePath&&(a.options.extrudePath=c.extrudePath.toJSON());return a}static fromJSON(a,b){const c=[];for(let d=0,f=a.shapes.length;d<f;d++)c.push(b[a.shapes[d]]);b=a.options.extrudePath;void 0!==b&&(a.options.extrudePath=(new Ph[b.type]).fromJSON(b));return new Uj(c,a.options)}}q.ExtrudeGeometry=Uj;const jm={generateTopUV:function(a,b,c,d,f){a=b[3*d];d=b[3*d+1];const g=b[3*f];f=b[3*f+
1];return[new sa(b[3*c],b[3*c+1]),new sa(a,d),new sa(g,f)]},generateSideWallUV:function(a,b,c,d,f,g){a=b[3*c];const l=b[3*c+1];c=b[3*c+2];const m=b[3*d],n=b[3*d+1];d=b[3*d+2];const t=b[3*f],u=b[3*f+1];f=b[3*f+2];const v=b[3*g],A=b[3*g+1];b=b[3*g+2];return Math.abs(l-n)<Math.abs(a-m)?[new sa(a,1-c),new sa(m,1-d),new sa(t,1-f),new sa(v,1-b)]:[new sa(l,1-c),new sa(n,1-d),new sa(u,1-f),new sa(A,1-b)]}};class Vj extends Fe{constructor(a=1,b=0){const c=(1+Math.sqrt(5))/2;super([-1,c,0,1,c,0,-1,-c,0,1,-c,
0,0,-1,c,0,1,c,0,-1,-c,0,1,-c,c,0,-1,c,0,1,-c,0,-1,-c,0,1],[0,11,5,0,5,1,0,1,7,0,7,10,0,10,11,1,5,9,5,11,4,11,10,2,10,7,6,7,1,8,3,9,4,3,4,2,3,2,6,3,6,8,3,8,9,4,9,5,2,4,11,6,2,10,8,6,7,9,8,1],a,b);this.type="IcosahedronGeometry";this.parameters={radius:a,detail:b}}static fromJSON(a){return new Vj(a.radius,a.detail)}}q.IcosahedronGeometry=Vj;class Uh extends Fe{constructor(a=1,b=0){super([1,0,0,-1,0,0,0,1,0,0,-1,0,0,0,1,0,0,-1],[0,2,4,0,4,3,0,3,5,0,5,2,1,2,5,1,5,3,1,3,4,1,4,2],a,b);this.type="OctahedronGeometry";
this.parameters={radius:a,detail:b}}static fromJSON(a){return new Uh(a.radius,a.detail)}}q.OctahedronGeometry=Uh;class Wj extends ab{constructor(a=.5,b=1,c=32,d=1,f=0,g=2*Math.PI){super();this.type="RingGeometry";this.parameters={innerRadius:a,outerRadius:b,thetaSegments:c,phiSegments:d,thetaStart:f,thetaLength:g};c=Math.max(3,c);d=Math.max(1,d);const l=[],m=[],n=[],t=[];var u=a;a=(b-a)/d;var v=new O,A=new sa;for(let F=0;F<=d;F++){for(let D=0;D<=c;D++){const E=f+D/c*g;v.x=u*Math.cos(E);v.y=u*Math.sin(E);
m.push(v.x,v.y,v.z);n.push(0,0,1);A.x=(v.x/b+1)/2;A.y=(v.y/b+1)/2;t.push(A.x,A.y)}u+=a}for(b=0;b<d;b++)for(f=b*(c+1),g=0;g<c;g++)u=g+f,a=u+c+1,v=u+c+2,A=u+1,l.push(u,a,A),l.push(a,v,A);this.setIndex(l);this.setAttribute("position",new Oa(m,3));this.setAttribute("normal",new Oa(n,3));this.setAttribute("uv",new Oa(t,2))}copy(a){super.copy(a);this.parameters=Object.assign({},a.parameters);return this}static fromJSON(a){return new Wj(a.innerRadius,a.outerRadius,a.thetaSegments,a.phiSegments,a.thetaStart,
a.thetaLength)}}q.RingGeometry=Wj;class Xj extends ab{constructor(a=new Ge([new sa(0,.5),new sa(-.5,-.5),new sa(.5,-.5)]),b=12){function c(t){const u=f.length/3;var v=t.extractPoints(b);t=v.shape;var A=v.holes;!1===Dd.isClockWise(t)&&(t=t.reverse());for(let F=0,D=A.length;F<D;F++)v=A[F],!0===Dd.isClockWise(v)&&(A[F]=v.reverse());v=Dd.triangulateShape(t,A);for(let F=0,D=A.length;F<D;F++)t=t.concat(A[F]);for(let F=0,D=t.length;F<D;F++)A=t[F],f.push(A.x,A.y,0),g.push(0,0,1),l.push(A.x,A.y);for(let F=
0,D=v.length;F<D;F++)t=v[F],d.push(t[0]+u,t[1]+u,t[2]+u),n+=3}super();this.type="ShapeGeometry";this.parameters={shapes:a,curveSegments:b};const d=[],f=[],g=[],l=[];let m=0,n=0;if(!1===Array.isArray(a))c(a);else for(let t=0;t<a.length;t++)c(a[t]),this.addGroup(m,n,t),m+=n,n=0;this.setIndex(d);this.setAttribute("position",new Oa(f,3));this.setAttribute("normal",new Oa(g,3));this.setAttribute("uv",new Oa(l,2))}copy(a){super.copy(a);this.parameters=Object.assign({},a.parameters);return this}toJSON(){const a=
super.toJSON();var b=this.parameters.shapes;a.shapes=[];if(Array.isArray(b))for(let c=0,d=b.length;c<d;c++)a.shapes.push(b[c].uuid);else a.shapes.push(b.uuid);return a}static fromJSON(a,b){const c=[];for(let d=0,f=a.shapes.length;d<f;d++)c.push(b[a.shapes[d]]);return new Xj(c,a.curveSegments)}}q.ShapeGeometry=Xj;class Vh extends ab{constructor(a=1,b=32,c=16,d=0,f=2*Math.PI,g=0,l=Math.PI){super();this.type="SphereGeometry";this.parameters={radius:a,widthSegments:b,heightSegments:c,phiStart:d,phiLength:f,
thetaStart:g,thetaLength:l};b=Math.max(3,Math.floor(b));c=Math.max(2,Math.floor(c));const m=Math.min(g+l,Math.PI);var n=0;const t=[];var u=new O;const v=new O,A=[],F=[],D=[],E=[];for(let y=0;y<=c;y++){const J=[],L=y/c;let U=0;0===y&&0===g?U=.5/b:y===c&&m===Math.PI&&(U=-.5/b);for(let P=0;P<=b;P++){const X=P/b;u.x=-a*Math.cos(d+X*f)*Math.sin(g+L*l);u.y=a*Math.cos(g+L*l);u.z=a*Math.sin(d+X*f)*Math.sin(g+L*l);F.push(u.x,u.y,u.z);v.copy(u).normalize();D.push(v.x,v.y,v.z);E.push(X+U,1-L);J.push(n++)}t.push(J)}for(a=
0;a<c;a++)for(d=0;d<b;d++)f=t[a][d+1],l=t[a][d],n=t[a+1][d],u=t[a+1][d+1],(0!==a||0<g)&&A.push(f,l,u),(a!==c-1||m<Math.PI)&&A.push(l,n,u);this.setIndex(A);this.setAttribute("position",new Oa(F,3));this.setAttribute("normal",new Oa(D,3));this.setAttribute("uv",new Oa(E,2))}copy(a){super.copy(a);this.parameters=Object.assign({},a.parameters);return this}static fromJSON(a){return new Vh(a.radius,a.widthSegments,a.heightSegments,a.phiStart,a.phiLength,a.thetaStart,a.thetaLength)}}q.SphereGeometry=Vh;
class Yj extends Fe{constructor(a=1,b=0){super([1,1,1,-1,-1,1,-1,1,-1,1,-1,-1],[2,1,0,0,3,2,1,3,0,2,3,1],a,b);this.type="TetrahedronGeometry";this.parameters={radius:a,detail:b}}static fromJSON(a){return new Yj(a.radius,a.detail)}}q.TetrahedronGeometry=Yj;class Zj extends ab{constructor(a=1,b=.4,c=12,d=48,f=2*Math.PI){super();this.type="TorusGeometry";this.parameters={radius:a,tube:b,radialSegments:c,tubularSegments:d,arc:f};c=Math.floor(c);d=Math.floor(d);const g=[],l=[],m=[],n=[];var t=new O,u=
new O;const v=new O;for(let A=0;A<=c;A++)for(let F=0;F<=d;F++){const D=F/d*f,E=A/c*Math.PI*2;u.x=(a+b*Math.cos(E))*Math.cos(D);u.y=(a+b*Math.cos(E))*Math.sin(D);u.z=b*Math.sin(E);l.push(u.x,u.y,u.z);t.x=a*Math.cos(D);t.y=a*Math.sin(D);v.subVectors(u,t).normalize();m.push(v.x,v.y,v.z);n.push(F/d);n.push(A/c)}for(a=1;a<=c;a++)for(b=1;b<=d;b++)f=(d+1)*(a-1)+b-1,t=(d+1)*(a-1)+b,u=(d+1)*a+b,g.push((d+1)*a+b-1,f,u),g.push(f,t,u);this.setIndex(g);this.setAttribute("position",new Oa(l,3));this.setAttribute("normal",
new Oa(m,3));this.setAttribute("uv",new Oa(n,2))}copy(a){super.copy(a);this.parameters=Object.assign({},a.parameters);return this}static fromJSON(a){return new Zj(a.radius,a.tube,a.radialSegments,a.tubularSegments,a.arc)}}q.TorusGeometry=Zj;class ak extends ab{constructor(a=1,b=.4,c=64,d=8,f=2,g=3){function l(P,X,ja,fa,aa){const pa=Math.sin(P);X=ja/X*P;ja=Math.cos(X);aa.x=fa*(2+ja)*.5*Math.cos(P);aa.y=fa*(2+ja)*pa*.5;aa.z=fa*Math.sin(X)*.5}super();this.type="TorusKnotGeometry";this.parameters={radius:a,
tube:b,tubularSegments:c,radialSegments:d,p:f,q:g};c=Math.floor(c);d=Math.floor(d);const m=[],n=[],t=[],u=[];var v=new O;const A=new O,F=new O,D=new O,E=new O,y=new O,J=new O;for(let P=0;P<=c;++P){var L=P/c*f*Math.PI*2;l(L,f,g,a,F);l(L+.01,f,g,a,D);y.subVectors(D,F);J.addVectors(D,F);E.crossVectors(y,J);J.crossVectors(E,y);E.normalize();J.normalize();for(L=0;L<=d;++L){var U=L/d*Math.PI*2;const X=-b*Math.cos(U);U=b*Math.sin(U);v.x=F.x+(X*J.x+U*E.x);v.y=F.y+(X*J.y+U*E.y);v.z=F.z+(X*J.z+U*E.z);n.push(v.x,
v.y,v.z);A.subVectors(v,F).normalize();t.push(A.x,A.y,A.z);u.push(P/c);u.push(L/d)}}for(a=1;a<=c;a++)for(b=1;b<=d;b++)f=(d+1)*a+(b-1),g=(d+1)*a+b,v=(d+1)*(a-1)+b,m.push((d+1)*(a-1)+(b-1),f,v),m.push(f,g,v);this.setIndex(m);this.setAttribute("position",new Oa(n,3));this.setAttribute("normal",new Oa(t,3));this.setAttribute("uv",new Oa(u,2))}copy(a){super.copy(a);this.parameters=Object.assign({},a.parameters);return this}static fromJSON(a){return new ak(a.radius,a.tube,a.tubularSegments,a.radialSegments,
a.p,a.q)}}q.TorusKnotGeometry=ak;class bk extends ab{constructor(a=new Nj(new O(-1,-1,0),new O(-1,1,0),new O(1,1,0)),b=64,c=1,d=8,f=!1){function g(E){u=a.getPointAt(E/b,u);const y=l.normals[E];E=l.binormals[E];for(let L=0;L<=d;L++){var J=L/d*Math.PI*2;const U=Math.sin(J);J=-Math.cos(J);n.x=J*y.x+U*E.x;n.y=J*y.y+U*E.y;n.z=J*y.z+U*E.z;n.normalize();A.push(n.x,n.y,n.z);m.x=u.x+c*n.x;m.y=u.y+c*n.y;m.z=u.z+c*n.z;v.push(m.x,m.y,m.z)}}super();this.type="TubeGeometry";this.parameters={path:a,tubularSegments:b,
radius:c,radialSegments:d,closed:f};const l=a.computeFrenetFrames(b,f);this.tangents=l.tangents;this.normals=l.normals;this.binormals=l.binormals;const m=new O,n=new O,t=new sa;let u=new O;const v=[],A=[],F=[],D=[];(function(){for(var E=0;E<b;E++)g(E);g(!1===f?b:0);for(E=0;E<=b;E++)for(var y=0;y<=d;y++)t.x=E/b,t.y=y/d,F.push(t.x,t.y);for(E=1;E<=b;E++)for(y=1;y<=d;y++){const J=(d+1)*E+(y-1),L=(d+1)*E+y,U=(d+1)*(E-1)+y;D.push((d+1)*(E-1)+(y-1),J,U);D.push(J,L,U)}})();this.setIndex(D);this.setAttribute("position",
new Oa(v,3));this.setAttribute("normal",new Oa(A,3));this.setAttribute("uv",new Oa(F,2))}copy(a){super.copy(a);this.parameters=Object.assign({},a.parameters);return this}toJSON(){const a=super.toJSON();a.path=this.parameters.path.toJSON();return a}static fromJSON(a){return new bk((new Ph[a.path.type]).fromJSON(a.path),a.tubularSegments,a.radius,a.radialSegments,a.closed)}}q.TubeGeometry=bk;class Zk extends ab{constructor(a=null){super();this.type="WireframeGeometry";this.parameters={geometry:a};if(null!==
a){const g=[],l=new Set,m=new O,n=new O;if(null!==a.index){var b=a.attributes.position,c=a.index;a=a.groups;0===a.length&&(a=[{start:0,count:c.count,materialIndex:0}]);for(let t=0,u=a.length;t<u;++t){var d=a[t],f=d.start;d=d.count;for(let v=f,A=f+d;v<A;v+=3)for(f=0;3>f;f++){d=c.getX(v+f);const F=c.getX(v+(f+1)%3);m.fromBufferAttribute(b,d);n.fromBufferAttribute(b,F);!0===Wf(m,n,l)&&(g.push(m.x,m.y,m.z),g.push(n.x,n.y,n.z))}}}else{b=a.attributes.position;for(let t=0,u=b.count/3;t<u;t++)for(c=0;3>c;c++)a=
3*t+(c+1)%3,m.fromBufferAttribute(b,3*t+c),n.fromBufferAttribute(b,a),!0===Wf(m,n,l)&&(g.push(m.x,m.y,m.z),g.push(n.x,n.y,n.z))}this.setAttribute("position",new Oa(g,3))}}copy(a){super.copy(a);this.parameters=Object.assign({},a.parameters);return this}}q.WireframeGeometry=Zk;var $k=Object.freeze({__proto__:null,BoxGeometry:Ld,CapsuleGeometry:Pj,CircleGeometry:Qj,ConeGeometry:Rj,CylinderGeometry:yg,DodecahedronGeometry:Sj,EdgesGeometry:Yk,ExtrudeGeometry:Uj,IcosahedronGeometry:Vj,LatheGeometry:Qh,
OctahedronGeometry:Uh,PlaneGeometry:k,PolyhedronGeometry:Fe,RingGeometry:Wj,ShapeGeometry:Xj,SphereGeometry:Vh,TetrahedronGeometry:Yj,TorusGeometry:Zj,TorusKnotGeometry:ak,TubeGeometry:bk,WireframeGeometry:Zk});class al extends Wb{constructor(a){super();this.isShadowMaterial=!0;this.type="ShadowMaterial";this.color=new Ia(0);this.fog=this.transparent=!0;this.setValues(a)}copy(a){super.copy(a);this.color.copy(a.color);this.fog=a.fog;return this}}q.ShadowMaterial=al;class bl extends bc{constructor(a){super(a);
this.isRawShaderMaterial=!0;this.type="RawShaderMaterial"}}q.RawShaderMaterial=bl;class ck extends Wb{constructor(a){super();this.isMeshStandardMaterial=!0;this.defines={STANDARD:""};this.type="MeshStandardMaterial";this.color=new Ia(16777215);this.roughness=1;this.metalness=0;this.lightMap=this.map=null;this.lightMapIntensity=1;this.aoMap=null;this.aoMapIntensity=1;this.emissive=new Ia(0);this.emissiveIntensity=1;this.bumpMap=this.emissiveMap=null;this.bumpScale=1;this.normalMap=null;this.normalMapType=
0;this.normalScale=new sa(1,1);this.displacementMap=null;this.displacementScale=1;this.displacementBias=0;this.envMap=this.alphaMap=this.metalnessMap=this.roughnessMap=null;this.envMapIntensity=1;this.wireframe=!1;this.wireframeLinewidth=1;this.wireframeLinejoin=this.wireframeLinecap="round";this.flatShading=!1;this.fog=!0;this.setValues(a)}copy(a){super.copy(a);this.defines={STANDARD:""};this.color.copy(a.color);this.roughness=a.roughness;this.metalness=a.metalness;this.map=a.map;this.lightMap=a.lightMap;
this.lightMapIntensity=a.lightMapIntensity;this.aoMap=a.aoMap;this.aoMapIntensity=a.aoMapIntensity;this.emissive.copy(a.emissive);this.emissiveMap=a.emissiveMap;this.emissiveIntensity=a.emissiveIntensity;this.bumpMap=a.bumpMap;this.bumpScale=a.bumpScale;this.normalMap=a.normalMap;this.normalMapType=a.normalMapType;this.normalScale.copy(a.normalScale);this.displacementMap=a.displacementMap;this.displacementScale=a.displacementScale;this.displacementBias=a.displacementBias;this.roughnessMap=a.roughnessMap;
this.metalnessMap=a.metalnessMap;this.alphaMap=a.alphaMap;this.envMap=a.envMap;this.envMapIntensity=a.envMapIntensity;this.wireframe=a.wireframe;this.wireframeLinewidth=a.wireframeLinewidth;this.wireframeLinecap=a.wireframeLinecap;this.wireframeLinejoin=a.wireframeLinejoin;this.flatShading=a.flatShading;this.fog=a.fog;return this}}q.MeshStandardMaterial=ck;class cl extends ck{constructor(a){super();this.isMeshPhysicalMaterial=!0;this.defines={STANDARD:"",PHYSICAL:""};this.type="MeshPhysicalMaterial";
this.anisotropyRotation=0;this.clearcoatMap=this.anisotropyMap=null;this.clearcoatRoughness=0;this.clearcoatRoughnessMap=null;this.clearcoatNormalScale=new sa(1,1);this.clearcoatNormalMap=null;this.ior=1.5;Object.defineProperty(this,"reflectivity",{get:function(){return yb(2.5*(this.ior-1)/(this.ior+1),0,1)},set:function(b){this.ior=(1+.4*b)/(1-.4*b)}});this.iridescenceMap=null;this.iridescenceIOR=1.3;this.iridescenceThicknessRange=[100,400];this.iridescenceThicknessMap=null;this.sheenColor=new Ia(0);
this.sheenColorMap=null;this.sheenRoughness=1;this.transmissionMap=this.sheenRoughnessMap=null;this.thickness=0;this.thicknessMap=null;this.attenuationDistance=Infinity;this.attenuationColor=new Ia(1,1,1);this.specularIntensity=1;this.specularIntensityMap=null;this.specularColor=new Ia(1,1,1);this.specularColorMap=null;this._transmission=this._sheen=this._iridescence=this._clearcoat=this._anisotropy=0;this.setValues(a)}get anisotropy(){return this._anisotropy}set anisotropy(a){0<this._anisotropy!==
0<a&&this.version++;this._anisotropy=a}get clearcoat(){return this._clearcoat}set clearcoat(a){0<this._clearcoat!==0<a&&this.version++;this._clearcoat=a}get iridescence(){return this._iridescence}set iridescence(a){0<this._iridescence!==0<a&&this.version++;this._iridescence=a}get sheen(){return this._sheen}set sheen(a){0<this._sheen!==0<a&&this.version++;this._sheen=a}get transmission(){return this._transmission}set transmission(a){0<this._transmission!==0<a&&this.version++;this._transmission=a}copy(a){super.copy(a);
this.defines={STANDARD:"",PHYSICAL:""};this.anisotropy=a.anisotropy;this.anisotropyRotation=a.anisotropyRotation;this.anisotropyMap=a.anisotropyMap;this.clearcoat=a.clearcoat;this.clearcoatMap=a.clearcoatMap;this.clearcoatRoughness=a.clearcoatRoughness;this.clearcoatRoughnessMap=a.clearcoatRoughnessMap;this.clearcoatNormalMap=a.clearcoatNormalMap;this.clearcoatNormalScale.copy(a.clearcoatNormalScale);this.ior=a.ior;this.iridescence=a.iridescence;this.iridescenceMap=a.iridescenceMap;this.iridescenceIOR=
a.iridescenceIOR;this.iridescenceThicknessRange=[...a.iridescenceThicknessRange];this.iridescenceThicknessMap=a.iridescenceThicknessMap;this.sheen=a.sheen;this.sheenColor.copy(a.sheenColor);this.sheenColorMap=a.sheenColorMap;this.sheenRoughness=a.sheenRoughness;this.sheenRoughnessMap=a.sheenRoughnessMap;this.transmission=a.transmission;this.transmissionMap=a.transmissionMap;this.thickness=a.thickness;this.thicknessMap=a.thicknessMap;this.attenuationDistance=a.attenuationDistance;this.attenuationColor.copy(a.attenuationColor);
this.specularIntensity=a.specularIntensity;this.specularIntensityMap=a.specularIntensityMap;this.specularColor.copy(a.specularColor);this.specularColorMap=a.specularColorMap;return this}}q.MeshPhysicalMaterial=cl;class dl extends Wb{constructor(a){super();this.isMeshPhongMaterial=!0;this.type="MeshPhongMaterial";this.color=new Ia(16777215);this.specular=new Ia(1118481);this.shininess=30;this.lightMap=this.map=null;this.lightMapIntensity=1;this.aoMap=null;this.aoMapIntensity=1;this.emissive=new Ia(0);
this.emissiveIntensity=1;this.bumpMap=this.emissiveMap=null;this.bumpScale=1;this.normalMap=null;this.normalMapType=0;this.normalScale=new sa(1,1);this.displacementMap=null;this.displacementScale=1;this.displacementBias=0;this.envMap=this.alphaMap=this.specularMap=null;this.combine=0;this.reflectivity=1;this.refractionRatio=.98;this.wireframe=!1;this.wireframeLinewidth=1;this.wireframeLinejoin=this.wireframeLinecap="round";this.flatShading=!1;this.fog=!0;this.setValues(a)}copy(a){super.copy(a);this.color.copy(a.color);
this.specular.copy(a.specular);this.shininess=a.shininess;this.map=a.map;this.lightMap=a.lightMap;this.lightMapIntensity=a.lightMapIntensity;this.aoMap=a.aoMap;this.aoMapIntensity=a.aoMapIntensity;this.emissive.copy(a.emissive);this.emissiveMap=a.emissiveMap;this.emissiveIntensity=a.emissiveIntensity;this.bumpMap=a.bumpMap;this.bumpScale=a.bumpScale;this.normalMap=a.normalMap;this.normalMapType=a.normalMapType;this.normalScale.copy(a.normalScale);this.displacementMap=a.displacementMap;this.displacementScale=
a.displacementScale;this.displacementBias=a.displacementBias;this.specularMap=a.specularMap;this.alphaMap=a.alphaMap;this.envMap=a.envMap;this.combine=a.combine;this.reflectivity=a.reflectivity;this.refractionRatio=a.refractionRatio;this.wireframe=a.wireframe;this.wireframeLinewidth=a.wireframeLinewidth;this.wireframeLinecap=a.wireframeLinecap;this.wireframeLinejoin=a.wireframeLinejoin;this.flatShading=a.flatShading;this.fog=a.fog;return this}}q.MeshPhongMaterial=dl;class el extends Wb{constructor(a){super();
this.isMeshToonMaterial=!0;this.defines={TOON:""};this.type="MeshToonMaterial";this.color=new Ia(16777215);this.lightMap=this.gradientMap=this.map=null;this.lightMapIntensity=1;this.aoMap=null;this.aoMapIntensity=1;this.emissive=new Ia(0);this.emissiveIntensity=1;this.bumpMap=this.emissiveMap=null;this.bumpScale=1;this.normalMap=null;this.normalMapType=0;this.normalScale=new sa(1,1);this.displacementMap=null;this.displacementScale=1;this.displacementBias=0;this.alphaMap=null;this.wireframe=!1;this.wireframeLinewidth=
1;this.wireframeLinejoin=this.wireframeLinecap="round";this.fog=!0;this.setValues(a)}copy(a){super.copy(a);this.color.copy(a.color);this.map=a.map;this.gradientMap=a.gradientMap;this.lightMap=a.lightMap;this.lightMapIntensity=a.lightMapIntensity;this.aoMap=a.aoMap;this.aoMapIntensity=a.aoMapIntensity;this.emissive.copy(a.emissive);this.emissiveMap=a.emissiveMap;this.emissiveIntensity=a.emissiveIntensity;this.bumpMap=a.bumpMap;this.bumpScale=a.bumpScale;this.normalMap=a.normalMap;this.normalMapType=
a.normalMapType;this.normalScale.copy(a.normalScale);this.displacementMap=a.displacementMap;this.displacementScale=a.displacementScale;this.displacementBias=a.displacementBias;this.alphaMap=a.alphaMap;this.wireframe=a.wireframe;this.wireframeLinewidth=a.wireframeLinewidth;this.wireframeLinecap=a.wireframeLinecap;this.wireframeLinejoin=a.wireframeLinejoin;this.fog=a.fog;return this}}q.MeshToonMaterial=el;class fl extends Wb{constructor(a){super();this.isMeshNormalMaterial=!0;this.type="MeshNormalMaterial";
this.bumpMap=null;this.bumpScale=1;this.normalMap=null;this.normalMapType=0;this.normalScale=new sa(1,1);this.displacementMap=null;this.displacementScale=1;this.displacementBias=0;this.wireframe=!1;this.wireframeLinewidth=1;this.flatShading=!1;this.setValues(a)}copy(a){super.copy(a);this.bumpMap=a.bumpMap;this.bumpScale=a.bumpScale;this.normalMap=a.normalMap;this.normalMapType=a.normalMapType;this.normalScale.copy(a.normalScale);this.displacementMap=a.displacementMap;this.displacementScale=a.displacementScale;
this.displacementBias=a.displacementBias;this.wireframe=a.wireframe;this.wireframeLinewidth=a.wireframeLinewidth;this.flatShading=a.flatShading;return this}}q.MeshNormalMaterial=fl;class gl extends Wb{constructor(a){super();this.isMeshLambertMaterial=!0;this.type="MeshLambertMaterial";this.color=new Ia(16777215);this.lightMap=this.map=null;this.lightMapIntensity=1;this.aoMap=null;this.aoMapIntensity=1;this.emissive=new Ia(0);this.emissiveIntensity=1;this.bumpMap=this.emissiveMap=null;this.bumpScale=
1;this.normalMap=null;this.normalMapType=0;this.normalScale=new sa(1,1);this.displacementMap=null;this.displacementScale=1;this.displacementBias=0;this.envMap=this.alphaMap=this.specularMap=null;this.combine=0;this.reflectivity=1;this.refractionRatio=.98;this.wireframe=!1;this.wireframeLinewidth=1;this.wireframeLinejoin=this.wireframeLinecap="round";this.flatShading=!1;this.fog=!0;this.setValues(a)}copy(a){super.copy(a);this.color.copy(a.color);this.map=a.map;this.lightMap=a.lightMap;this.lightMapIntensity=
a.lightMapIntensity;this.aoMap=a.aoMap;this.aoMapIntensity=a.aoMapIntensity;this.emissive.copy(a.emissive);this.emissiveMap=a.emissiveMap;this.emissiveIntensity=a.emissiveIntensity;this.bumpMap=a.bumpMap;this.bumpScale=a.bumpScale;this.normalMap=a.normalMap;this.normalMapType=a.normalMapType;this.normalScale.copy(a.normalScale);this.displacementMap=a.displacementMap;this.displacementScale=a.displacementScale;this.displacementBias=a.displacementBias;this.specularMap=a.specularMap;this.alphaMap=a.alphaMap;
this.envMap=a.envMap;this.combine=a.combine;this.reflectivity=a.reflectivity;this.refractionRatio=a.refractionRatio;this.wireframe=a.wireframe;this.wireframeLinewidth=a.wireframeLinewidth;this.wireframeLinecap=a.wireframeLinecap;this.wireframeLinejoin=a.wireframeLinejoin;this.flatShading=a.flatShading;this.fog=a.fog;return this}}q.MeshLambertMaterial=gl;class hl extends Wb{constructor(a){super();this.isMeshMatcapMaterial=!0;this.defines={MATCAP:""};this.type="MeshMatcapMaterial";this.color=new Ia(16777215);
this.bumpMap=this.map=this.matcap=null;this.bumpScale=1;this.normalMap=null;this.normalMapType=0;this.normalScale=new sa(1,1);this.displacementMap=null;this.displacementScale=1;this.displacementBias=0;this.alphaMap=null;this.flatShading=!1;this.fog=!0;this.setValues(a)}copy(a){super.copy(a);this.defines={MATCAP:""};this.color.copy(a.color);this.matcap=a.matcap;this.map=a.map;this.bumpMap=a.bumpMap;this.bumpScale=a.bumpScale;this.normalMap=a.normalMap;this.normalMapType=a.normalMapType;this.normalScale.copy(a.normalScale);
this.displacementMap=a.displacementMap;this.displacementScale=a.displacementScale;this.displacementBias=a.displacementBias;this.alphaMap=a.alphaMap;this.flatShading=a.flatShading;this.fog=a.fog;return this}}q.MeshMatcapMaterial=hl;class il extends kc{constructor(a){super();this.isLineDashedMaterial=!0;this.type="LineDashedMaterial";this.scale=1;this.dashSize=3;this.gapSize=1;this.setValues(a)}copy(a){super.copy(a);this.scale=a.scale;this.dashSize=a.dashSize;this.gapSize=a.gapSize;return this}}q.LineDashedMaterial=
il;q.AnimationUtils={convertArray:cd,isTypedArray:Xf,getKeyframeOrder:kh,sortedArray:Yf,flattenJSON:Zf,subclip:function(a,b,c,d,f=30){a=a.clone();a.name=b;b=[];for(let l=0;l<a.tracks.length;++l){const m=a.tracks[l],n=m.getValueSize(),t=[],u=[];for(let v=0;v<m.times.length;++v){var g=m.times[v]*f;if(!(g<c||g>=d))for(t.push(m.times[v]),g=0;g<n;++g)u.push(m.values[v*n+g])}0!==t.length&&(m.times=cd(t,m.times.constructor),m.values=cd(u,m.values.constructor),b.push(m))}a.tracks=b;c=Infinity;for(d=0;d<a.tracks.length;++d)c>
a.tracks[d].times[0]&&(c=a.tracks[d].times[0]);for(d=0;d<a.tracks.length;++d)a.tracks[d].shift(-1*c);a.resetDuration();return a},makeClipAdditive:function(a,b=0,c=a,d=30){0>=d&&(d=30);const f=c.tracks.length;b/=d;for(d=0;d<f;++d){const t=c.tracks[d],u=t.ValueTypeName;if("bool"===u||"string"===u)continue;const v=a.tracks.find(function(D){return D.name===t.name&&D.ValueTypeName===u});if(void 0===v)continue;var g=0,l=t.getValueSize();t.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline&&(g=
l/3);let A=0;const F=v.getValueSize();v.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline&&(A=F/3);var m=t.times.length-1;if(b<=t.times[0])g=t.values.slice(g,l-g);else if(b>=t.times[m])m=m*l+g,g=t.values.slice(m,m+l-g);else{m=t.createInterpolant();var n=g;g=l-g;m.evaluate(b);g=m.resultBuffer.slice(n,g)}"quaternion"===u&&(new Xb).fromArray(g).normalize().conjugate().toArray(g);l=v.times.length;for(m=0;m<l;++m)if(n=m*F+A,"quaternion"===u)Xb.multiplyQuaternionsFlat(v.values,n,g,0,v.values,
n);else{const D=F-2*A;for(let E=0;E<D;++E)v.values[n+E]-=g[E]}}a.blendMode=2501;return a}};class zg{constructor(a,b,c,d){this.parameterPositions=a;this._cachedIndex=0;this.resultBuffer=void 0!==d?d:new b.constructor(c);this.sampleValues=b;this.valueSize=c;this.settings=null;this.DefaultSettings_={}}evaluate(a){const b=this.parameterPositions;let c=this._cachedIndex;var d=b[c],f=b[c-1];a:{b:{c:{d:if(!(a<d)){for(var g=c+2;;){if(void 0===d){if(a<f)break d;this._cachedIndex=c=b.length;return this.copySampleValue_(c-
1)}if(c===g)break;f=d;d=b[++c];if(a<d)break b}f=b.length;break c}if(a>=f)break a;else{d=b[1];a<d&&(c=2,f=d);for(g=c-2;;){if(void 0===f)return this._cachedIndex=0,this.copySampleValue_(0);if(c===g)break;d=f;f=b[--c-1];if(a>=f)break b}f=c;c=0}}for(;c<f;)d=c+f>>>1,a<b[d]?f=d:c=d+1;d=b[c];f=b[c-1];if(void 0===f)return this._cachedIndex=0,this.copySampleValue_(0);if(void 0===d)return this._cachedIndex=c=b.length,this.copySampleValue_(c-1)}this._cachedIndex=c;this.intervalChanged_(c,f,d)}return this.interpolate_(c,
f,a,d)}getSettings_(){return this.settings||this.DefaultSettings_}copySampleValue_(a){const b=this.resultBuffer,c=this.sampleValues,d=this.valueSize;a*=d;for(let f=0;f!==d;++f)b[f]=c[a+f];return b}interpolate_(){throw Error("call to abstract method");}intervalChanged_(){}}q.Interpolant=zg;class jl extends zg{constructor(a,b,c,d){super(a,b,c,d);this._offsetNext=this._weightNext=this._offsetPrev=this._weightPrev=-0;this.DefaultSettings_={endingStart:2400,endingEnd:2400}}intervalChanged_(a,b,c){var d=
this.parameterPositions;let f=a-2,g=a+1,l=d[f],m=d[g];if(void 0===l)switch(this.getSettings_().endingStart){case 2401:f=a;l=2*b-c;break;case 2402:f=d.length-2;l=b+d[f]-d[f+1];break;default:f=a,l=c}if(void 0===m)switch(this.getSettings_().endingEnd){case 2401:g=a;m=2*c-b;break;case 2402:g=1;m=c+d[1]-d[0];break;default:g=a-1,m=b}a=.5*(c-b);d=this.valueSize;this._weightPrev=a/(b-l);this._weightNext=a/(m-c);this._offsetPrev=f*d;this._offsetNext=g*d}interpolate_(a,b,c,d){const f=this.resultBuffer,g=this.sampleValues,
l=this.valueSize;a*=l;const m=a-l,n=this._offsetPrev,t=this._offsetNext;var u=this._weightPrev,v=this._weightNext,A=(c-b)/(d-b);c=A*A;d=c*A;b=-u*d+2*u*c-u*A;u=(1+u)*d+(-1.5-2*u)*c+(-.5+u)*A+1;A=(-1-v)*d+(1.5+v)*c+.5*A;v=v*d-v*c;for(c=0;c!==l;++c)f[c]=b*g[n+c]+u*g[m+c]+A*g[a+c]+v*g[t+c];return f}}q.CubicInterpolant=jl;class dk extends zg{constructor(a,b,c,d){super(a,b,c,d)}interpolate_(a,b,c,d){const f=this.resultBuffer,g=this.sampleValues,l=this.valueSize;a*=l;const m=a-l;b=(c-b)/(d-b);c=1-b;for(d=
0;d!==l;++d)f[d]=g[m+d]*c+g[a+d]*b;return f}}q.LinearInterpolant=dk;class kl extends zg{constructor(a,b,c,d){super(a,b,c,d)}interpolate_(a){return this.copySampleValue_(a-1)}}q.DiscreteInterpolant=kl;class $c{constructor(a,b,c,d){if(void 0===a)throw Error("THREE.KeyframeTrack: track name is undefined");if(void 0===b||0===b.length)throw Error("THREE.KeyframeTrack: no keyframes in track named "+a);this.name=a;this.times=cd(b,this.TimeBufferType);this.values=cd(c,this.ValueBufferType);this.setInterpolation(d||
this.DefaultInterpolation)}static toJSON(a){var b=a.constructor;if(b.toJSON!==this.toJSON)b=b.toJSON(a);else{b={name:a.name,times:cd(a.times,Array),values:cd(a.values,Array)};const c=a.getInterpolation();c!==a.DefaultInterpolation&&(b.interpolation=c)}b.type=a.ValueTypeName;return b}InterpolantFactoryMethodDiscrete(a){return new kl(this.times,this.values,this.getValueSize(),a)}InterpolantFactoryMethodLinear(a){return new dk(this.times,this.values,this.getValueSize(),a)}InterpolantFactoryMethodSmooth(a){return new jl(this.times,
this.values,this.getValueSize(),a)}setInterpolation(a){switch(a){case 2300:var b=this.InterpolantFactoryMethodDiscrete;break;case 2301:b=this.InterpolantFactoryMethodLinear;break;case 2302:b=this.InterpolantFactoryMethodSmooth}if(void 0===b){b="unsupported interpolation for "+this.ValueTypeName+" keyframe track named "+this.name;if(void 0===this.createInterpolant)if(a!==this.DefaultInterpolation)this.setInterpolation(this.DefaultInterpolation);else throw Error(b);console.warn("THREE.KeyframeTrack:",
b);return this}this.createInterpolant=b;return this}getInterpolation(){switch(this.createInterpolant){case this.InterpolantFactoryMethodDiscrete:return 2300;case this.InterpolantFactoryMethodLinear:return 2301;case this.InterpolantFactoryMethodSmooth:return 2302}}getValueSize(){return this.values.length/this.times.length}shift(a){if(0!==a){const b=this.times;for(let c=0,d=b.length;c!==d;++c)b[c]+=a}return this}scale(a){if(1!==a){const b=this.times;for(let c=0,d=b.length;c!==d;++c)b[c]*=a}return this}trim(a,
b){const c=this.times,d=c.length;let f=0,g=d-1;for(;f!==d&&c[f]<a;)++f;for(;-1!==g&&c[g]>b;)--g;++g;if(0!==f||g!==d)f>=g&&(g=Math.max(g,1),f=g-1),a=this.getValueSize(),this.times=c.slice(f,g),this.values=this.values.slice(f*a,g*a);return this}validate(){let a=!0;var b=this.getValueSize();0!==b-Math.floor(b)&&(console.error("THREE.KeyframeTrack: Invalid value size in track.",this),a=!1);var c=this.times;b=this.values;const d=c.length;0===d&&(console.error("THREE.KeyframeTrack: Track is empty.",this),
a=!1);let f=null;for(let g=0;g!==d;g++){const l=c[g];if("number"===typeof l&&isNaN(l)){console.error("THREE.KeyframeTrack: Time is not a valid number.",this,g,l);a=!1;break}if(null!==f&&f>l){console.error("THREE.KeyframeTrack: Out of order keys.",this,g,l,f);a=!1;break}f=l}if(void 0!==b&&Xf(b))for(let g=0,l=b.length;g!==l;++g)if(c=b[g],isNaN(c)){console.error("THREE.KeyframeTrack: Value is not a valid number.",this,g,c);a=!1;break}return a}optimize(){const a=this.times.slice(),b=this.values.slice(),
c=this.getValueSize(),d=2302===this.getInterpolation(),f=a.length-1;let g=1;for(let t=1;t<f;++t){var l=!1,m=a[t];if(m!==a[t+1]&&(1!==t||m!==a[0]))if(d)l=!0;else{m=t*c;var n=m-c;const u=m+c;for(let v=0;v!==c;++v){const A=b[m+v];if(A!==b[n+v]||A!==b[u+v]){l=!0;break}}}if(l){if(t!==g)for(a[g]=a[t],l=t*c,m=g*c,n=0;n!==c;++n)b[m+n]=b[l+n];++g}}if(0<f){a[g]=a[f];for(let t=f*c,u=g*c,v=0;v!==c;++v)b[u+v]=b[t+v];++g}g!==a.length?(this.times=a.slice(0,g),this.values=b.slice(0,g*c)):(this.times=a,this.values=
b);return this}clone(){var a=this.times.slice();const b=this.values.slice();a=new this.constructor(this.name,a,b);a.createInterpolant=this.createInterpolant;return a}}q.KeyframeTrack=$c;$c.prototype.TimeBufferType=Float32Array;$c.prototype.ValueBufferType=Float32Array;$c.prototype.DefaultInterpolation=2301;class ve extends $c{}q.BooleanKeyframeTrack=ve;ve.prototype.ValueTypeName="bool";ve.prototype.ValueBufferType=Array;ve.prototype.DefaultInterpolation=2300;ve.prototype.InterpolantFactoryMethodLinear=
void 0;ve.prototype.InterpolantFactoryMethodSmooth=void 0;class Zi extends $c{}q.ColorKeyframeTrack=Zi;Zi.prototype.ValueTypeName="color";class $f extends $c{}q.NumberKeyframeTrack=$f;$f.prototype.ValueTypeName="number";class ll extends zg{constructor(a,b,c,d){super(a,b,c,d)}interpolate_(a,b,c,d){const f=this.resultBuffer,g=this.sampleValues,l=this.valueSize;b=(c-b)/(d-b);a*=l;for(c=a+l;a!==c;a+=4)Xb.slerpFlat(f,0,g,a-l,g,a,b);return f}}q.QuaternionLinearInterpolant=ll;class ff extends $c{InterpolantFactoryMethodLinear(a){return new ll(this.times,
this.values,this.getValueSize(),a)}}q.QuaternionKeyframeTrack=ff;ff.prototype.ValueTypeName="quaternion";ff.prototype.DefaultInterpolation=2301;ff.prototype.InterpolantFactoryMethodSmooth=void 0;class we extends $c{}q.StringKeyframeTrack=we;we.prototype.ValueTypeName="string";we.prototype.ValueBufferType=Array;we.prototype.DefaultInterpolation=2300;we.prototype.InterpolantFactoryMethodLinear=void 0;we.prototype.InterpolantFactoryMethodSmooth=void 0;class ag extends $c{}q.VectorKeyframeTrack=ag;ag.prototype.ValueTypeName=
"vector";class Ag{constructor(a,b=-1,c,d=2500){this.name=a;this.tracks=c;this.duration=b;this.blendMode=d;this.uuid=$b();0>this.duration&&this.resetDuration()}static parse(a){var b=[];const c=a.tracks,d=1/(a.fps||1);for(let m=0,n=c.length;m!==n;++m){var f=b,g=f.push;{var l=c[m];if(void 0===l.type)throw Error("THREE.KeyframeTrack: track type undefined, can not parse");const t=Yi(l.type);if(void 0===l.times){const u=[],v=[];Zf(l.keys,u,v,"value");l.times=u;l.values=v}l=void 0!==t.parse?t.parse(l):new t(l.name,
l.times,l.values,l.interpolation)}g.call(f,l.scale(d))}b=new this(a.name,a.duration,b,a.blendMode);b.uuid=a.uuid;return b}static toJSON(a){const b=[],c=a.tracks;a={name:a.name,duration:a.duration,tracks:b,uuid:a.uuid,blendMode:a.blendMode};for(let d=0,f=c.length;d!==f;++d)b.push($c.toJSON(c[d]));return a}static CreateFromMorphTargetSequence(a,b,c,d){const f=b.length,g=[];for(let l=0;l<f;l++){let m=[],n=[];m.push((l+f-1)%f,l,(l+1)%f);n.push(0,1,0);const t=kh(m);m=Yf(m,1,t);n=Yf(n,1,t);d||0!==m[0]||
(m.push(f),n.push(n[0]));g.push((new $f(".morphTargetInfluences["+b[l].name+"]",m,n)).scale(1/c))}return new this(a,-1,g)}static findByName(a,b){let c=a;Array.isArray(a)||(c=a.geometry&&a.geometry.animations||a.animations);for(a=0;a<c.length;a++)if(c[a].name===b)return c[a];return null}static CreateClipsFromMorphTargetSequences(a,b,c){const d={},f=/^([\w-]*?)([\d]+)$/;for(let l=0,m=a.length;l<m;l++){const n=a[l];var g=n.name.match(f);if(g&&1<g.length){g=g[1];let t=d[g];t||(d[g]=t=[]);t.push(n)}}a=
[];for(const l in d)a.push(this.CreateFromMorphTargetSequence(l,d[l],b,c));return a}static parseAnimation(a,b){if(!a)return console.error("THREE.AnimationClip: No animation in JSONLoader data."),null;const c=function(u,v,A,F,D){if(0!==A.length){const E=[],y=[];Zf(A,E,y,F);0!==E.length&&D.push(new u(v,E,y))}},d=[],f=a.name||"default",g=a.fps||30,l=a.blendMode;var m=a.length||-1;a=a.hierarchy||[];for(let u=0;u<a.length;u++){const v=a[u].keys;if(v&&0!==v.length)if(v[0].morphTargets){m={};var n=void 0;
for(n=0;n<v.length;n++)if(v[n].morphTargets)for(var t=0;t<v[n].morphTargets.length;t++)m[v[n].morphTargets[t]]=-1;for(const A in m){t=[];const F=[];for(let D=0;D!==v[n].morphTargets.length;++D){const E=v[n];t.push(E.time);F.push(E.morphTarget===A?1:0)}d.push(new $f(".morphTargetInfluence["+A+"]",t,F))}m=m.length*g}else n=".bones["+b[u].name+"]",c(ag,n+".position",v,"pos",d),c(ff,n+".quaternion",v,"rot",d),c(ag,n+".scale",v,"scl",d)}return 0===d.length?null:new this(f,m,d,l)}resetDuration(){var a=
this.tracks;let b=0;for(let c=0,d=a.length;c!==d;++c)a=this.tracks[c],b=Math.max(b,a.times[a.times.length-1]);this.duration=b;return this}trim(){for(let a=0;a<this.tracks.length;a++)this.tracks[a].trim(0,this.duration);return this}validate(){let a=!0;for(let b=0;b<this.tracks.length;b++)a=a&&this.tracks[b].validate();return a}optimize(){for(let a=0;a<this.tracks.length;a++)this.tracks[a].optimize();return this}clone(){const a=[];for(let b=0;b<this.tracks.length;b++)a.push(this.tracks[b].clone());
return new this.constructor(this.name,this.duration,a,this.blendMode)}toJSON(){return this.constructor.toJSON(this)}}q.AnimationClip=Ag;const He={enabled:!1,files:{},add:function(a,b){!1!==this.enabled&&(this.files[a]=b)},get:function(a){if(!1!==this.enabled)return this.files[a]},remove:function(a){delete this.files[a]},clear:function(){this.files={}}};q.Cache=He;class ek{constructor(a,b,c){const d=this;let f=!1,g=0,l=0,m=void 0;const n=[];this.onStart=void 0;this.onLoad=a;this.onProgress=b;this.onError=
c;this.itemStart=function(t){l++;if(!1===f&&void 0!==d.onStart)d.onStart(t,g,l);f=!0};this.itemEnd=function(t){g++;if(void 0!==d.onProgress)d.onProgress(t,g,l);if(g===l&&(f=!1,void 0!==d.onLoad))d.onLoad()};this.itemError=function(t){if(void 0!==d.onError)d.onError(t)};this.resolveURL=function(t){return m?m(t):t};this.setURLModifier=function(t){m=t;return this};this.addHandler=function(t,u){n.push(t,u);return this};this.removeHandler=function(t){t=n.indexOf(t);-1!==t&&n.splice(t,2);return this};this.getHandler=
function(t){for(let u=0,v=n.length;u<v;u+=2){const A=n[u],F=n[u+1];A.global&&(A.lastIndex=0);if(A.test(t))return F}return null}}}q.LoadingManager=ek;const ml=new ek;q.DefaultLoadingManager=ml;class qc{constructor(a){this.manager=void 0!==a?a:ml;this.crossOrigin="anonymous";this.withCredentials=!1;this.resourcePath=this.path="";this.requestHeader={}}load(){}loadAsync(a,b){const c=this;return new Promise(function(d,f){c.load(a,d,b,f)})}parse(){}setCrossOrigin(a){this.crossOrigin=a;return this}setWithCredentials(a){this.withCredentials=
a;return this}setPath(a){this.path=a;return this}setResourcePath(a){this.resourcePath=a;return this}setRequestHeader(a){this.requestHeader=a;return this}}q.Loader=qc;qc.DEFAULT_MATERIAL_NAME="__DEFAULT";const Ed={};class km extends Error{constructor(a,b){super(a);this.response=b}}class Fd extends qc{constructor(a){super(a)}load(a,b,c,d){void 0===a&&(a="");void 0!==this.path&&(a=this.path+a);a=this.manager.resolveURL(a);const f=He.get(a);if(void 0!==f)return this.manager.itemStart(a),setTimeout(()=>
{b&&b(f);this.manager.itemEnd(a)},0),f;if(void 0!==Ed[a])Ed[a].push({onLoad:b,onProgress:c,onError:d});else{Ed[a]=[];Ed[a].push({onLoad:b,onProgress:c,onError:d});c=new Request(a,{headers:new Headers(this.requestHeader),credentials:this.withCredentials?"include":"same-origin"});var g=this.mimeType,l=this.responseType;fetch(c).then(m=>{if(200===m.status||0===m.status){0===m.status&&console.warn("THREE.FileLoader: HTTP Status 0 received.");if("undefined"===typeof ReadableStream||void 0===m.body||void 0===
m.body.getReader)return m;const n=Ed[a],t=m.body.getReader(),u=(m=m.headers.get("Content-Length")||m.headers.get("X-File-Size"))?parseInt(m):0,v=0!==u;let A=0;m=new ReadableStream({start(F){function D(){t.read().then(({done:E,value:y})=>{if(E)F.close();else{A+=y.byteLength;E=new ProgressEvent("progress",{lengthComputable:v,loaded:A,total:u});for(let J=0,L=n.length;J<L;J++){const U=n[J];if(U.onProgress)U.onProgress(E)}F.enqueue(y);D()}})}D()}});return new Response(m)}throw new km(`fetch for "${m.url}" responded with ${m.status}: ${m.statusText}`,
m);}).then(m=>{switch(l){case "arraybuffer":return m.arrayBuffer();case "blob":return m.blob();case "document":return m.text().then(u=>(new DOMParser).parseFromString(u,g));case "json":return m.json();default:if(void 0===g)return m.text();var n=/charset="?([^;"\s]*)"?/i.exec(g);n=n&&n[1]?n[1].toLowerCase():void 0;const t=new TextDecoder(n);return m.arrayBuffer().then(u=>t.decode(u))}}).then(m=>{He.add(a,m);const n=Ed[a];delete Ed[a];for(let t=0,u=n.length;t<u;t++){const v=n[t];if(v.onLoad)v.onLoad(m)}}).catch(m=>
{const n=Ed[a];if(void 0===n)throw this.manager.itemError(a),m;delete Ed[a];for(let t=0,u=n.length;t<u;t++){const v=n[t];if(v.onError)v.onError(m)}this.manager.itemError(a)}).finally(()=>{this.manager.itemEnd(a)});this.manager.itemStart(a)}}setResponseType(a){this.responseType=a;return this}setMimeType(a){this.mimeType=a;return this}}q.FileLoader=Fd;class lm extends qc{constructor(a){super(a)}load(a,b,c,d){const f=this,g=new Fd(this.manager);g.setPath(this.path);g.setRequestHeader(this.requestHeader);
g.setWithCredentials(this.withCredentials);g.load(a,function(l){try{b(f.parse(JSON.parse(l)))}catch(m){d?d(m):console.error(m),f.manager.itemError(a)}},c,d)}parse(a){const b=[];for(let c=0;c<a.length;c++){const d=Ag.parse(a[c]);b.push(d)}return b}}q.AnimationLoader=lm;class mm extends qc{constructor(a){super(a)}load(a,b,c,d){function f(u){n.load(a[u],function(v){v=g.parse(v,!0);l[u]={width:v.width,height:v.height,format:v.format,mipmaps:v.mipmaps};t+=1;6===t&&(1===v.mipmapCount&&(m.minFilter=1006),
m.image=l,m.format=v.format,m.needsUpdate=!0,b&&b(m))},c,d)}const g=this,l=[],m=new Mh,n=new Fd(this.manager);n.setPath(this.path);n.setResponseType("arraybuffer");n.setRequestHeader(this.requestHeader);n.setWithCredentials(g.withCredentials);let t=0;if(Array.isArray(a))for(let u=0,v=a.length;u<v;++u)f(u);else n.load(a,function(u){u=g.parse(u,!0);if(u.isCubemap){const v=u.mipmaps.length/u.mipmapCount;for(let A=0;A<v;A++){l[A]={mipmaps:[]};for(let F=0;F<u.mipmapCount;F++)l[A].mipmaps.push(u.mipmaps[A*
u.mipmapCount+F]),l[A].format=u.format,l[A].width=u.width,l[A].height=u.height}m.image=l}else m.image.width=u.width,m.image.height=u.height,m.mipmaps=u.mipmaps;1===u.mipmapCount&&(m.minFilter=1006);m.format=u.format;m.needsUpdate=!0;b&&b(m)},c,d);return m}}q.CompressedTextureLoader=mm;class Bg extends qc{constructor(a){super(a)}load(a,b,c,d){function f(){l();He.add(a,this);b&&b(this);m.manager.itemEnd(a)}function g(u){l();d&&d(u);m.manager.itemError(a);m.manager.itemEnd(a)}function l(){t.removeEventListener("load",
f,!1);t.removeEventListener("error",g,!1)}void 0!==this.path&&(a=this.path+a);a=this.manager.resolveURL(a);const m=this,n=He.get(a);if(void 0!==n)return m.manager.itemStart(a),setTimeout(function(){b&&b(n);m.manager.itemEnd(a)},0),n;const t=md("img");t.addEventListener("load",f,!1);t.addEventListener("error",g,!1);"data:"!==a.slice(0,5)&&void 0!==this.crossOrigin&&(t.crossOrigin=this.crossOrigin);m.manager.itemStart(a);t.src=a;return t}}q.ImageLoader=Bg;class nm extends qc{constructor(a){super(a)}load(a,
b,c,d){function f(n){l.load(a[n],function(t){g.images[n]=t;m++;6===m&&(g.needsUpdate=!0,b&&b(g))},void 0,d)}const g=new Ae;g.colorSpace="srgb";const l=new Bg(this.manager);l.setCrossOrigin(this.crossOrigin);l.setPath(this.path);let m=0;for(c=0;c<a.length;++c)f(c);return g}}q.CubeTextureLoader=nm;class om extends qc{constructor(a){super(a)}load(a,b,c,d){const f=this,g=new Df,l=new Fd(this.manager);l.setResponseType("arraybuffer");l.setRequestHeader(this.requestHeader);l.setPath(this.path);l.setWithCredentials(f.withCredentials);
l.load(a,function(m){let n;try{n=f.parse(m)}catch(t){if(void 0!==d)d(t);else{console.error(t);return}}void 0!==n.image?g.image=n.image:void 0!==n.data&&(g.image.width=n.width,g.image.height=n.height,g.image.data=n.data);g.wrapS=void 0!==n.wrapS?n.wrapS:1001;g.wrapT=void 0!==n.wrapT?n.wrapT:1001;g.magFilter=void 0!==n.magFilter?n.magFilter:1006;g.minFilter=void 0!==n.minFilter?n.minFilter:1006;g.anisotropy=void 0!==n.anisotropy?n.anisotropy:1;void 0!==n.colorSpace?g.colorSpace=n.colorSpace:void 0!==
n.encoding&&(g.encoding=n.encoding);void 0!==n.flipY&&(g.flipY=n.flipY);void 0!==n.format&&(g.format=n.format);void 0!==n.type&&(g.type=n.type);void 0!==n.mipmaps&&(g.mipmaps=n.mipmaps,g.minFilter=1008);1===n.mipmapCount&&(g.minFilter=1006);void 0!==n.generateMipmaps&&(g.generateMipmaps=n.generateMipmaps);g.needsUpdate=!0;b&&b(g,n)},c,d);return g}}q.DataTextureLoader=om;class pm extends qc{constructor(a){super(a)}load(a,b,c,d){const f=new Gb,g=new Bg(this.manager);g.setCrossOrigin(this.crossOrigin);
g.setPath(this.path);g.load(a,function(l){f.image=l;f.needsUpdate=!0;void 0!==b&&b(f)},c,d);return f}}q.TextureLoader=pm;class je extends hb{constructor(a,b=1){super();this.isLight=!0;this.type="Light";this.color=new Ia(a);this.intensity=b}dispose(){}copy(a,b){super.copy(a,b);this.color.copy(a.color);this.intensity=a.intensity;return this}toJSON(a){a=super.toJSON(a);a.object.color=this.color.getHex();a.object.intensity=this.intensity;void 0!==this.groundColor&&(a.object.groundColor=this.groundColor.getHex());
void 0!==this.distance&&(a.object.distance=this.distance);void 0!==this.angle&&(a.object.angle=this.angle);void 0!==this.decay&&(a.object.decay=this.decay);void 0!==this.penumbra&&(a.object.penumbra=this.penumbra);void 0!==this.shadow&&(a.object.shadow=this.shadow.toJSON());return a}}q.Light=je;class nl extends je{constructor(a,b,c){super(a,c);this.isHemisphereLight=!0;this.type="HemisphereLight";this.position.copy(hb.DEFAULT_UP);this.updateMatrix();this.groundColor=new Ia(b)}copy(a,b){super.copy(a,
b);this.groundColor.copy(a.groundColor);return this}}q.HemisphereLight=nl;const fk=new Wa,ol=new O,pl=new O;class gk{constructor(a){this.camera=a;this.normalBias=this.bias=0;this.radius=1;this.blurSamples=8;this.mapSize=new sa(512,512);this.mapPass=this.map=null;this.matrix=new Wa;this.autoUpdate=!0;this.needsUpdate=!1;this._frustum=new h;this._frameExtents=new sa(1,1);this._viewportCount=1;this._viewports=[new mb(0,0,1,1)]}getViewportCount(){return this._viewportCount}getFrustum(){return this._frustum}updateMatrices(a){const b=
this.camera,c=this.matrix;ol.setFromMatrixPosition(a.matrixWorld);b.position.copy(ol);pl.setFromMatrixPosition(a.target.matrixWorld);b.lookAt(pl);b.updateMatrixWorld();fk.multiplyMatrices(b.projectionMatrix,b.matrixWorldInverse);this._frustum.setFromProjectionMatrix(fk);c.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1);c.multiply(fk)}getViewport(a){return this._viewports[a]}getFrameExtents(){return this._frameExtents}dispose(){this.map&&this.map.dispose();this.mapPass&&this.mapPass.dispose()}copy(a){this.camera=
a.camera.clone();this.bias=a.bias;this.radius=a.radius;this.mapSize.copy(a.mapSize);return this}clone(){return(new this.constructor).copy(this)}toJSON(){const a={};0!==this.bias&&(a.bias=this.bias);0!==this.normalBias&&(a.normalBias=this.normalBias);1!==this.radius&&(a.radius=this.radius);if(512!==this.mapSize.x||512!==this.mapSize.y)a.mapSize=this.mapSize.toArray();a.camera=this.camera.toJSON(!1).object;delete a.camera.matrix;return a}}class qm extends gk{constructor(){super(new Rb(50,1,.5,500));
this.isSpotLightShadow=!0;this.focus=1}updateMatrices(a){const b=this.camera,c=2*Wd*a.angle*this.focus,d=this.mapSize.width/this.mapSize.height,f=a.distance||b.far;if(c!==b.fov||d!==b.aspect||f!==b.far)b.fov=c,b.aspect=d,b.far=f,b.updateProjectionMatrix();super.updateMatrices(a)}copy(a){super.copy(a);this.focus=a.focus;return this}}class ql extends je{constructor(a,b,c=0,d=Math.PI/3,f=0,g=2){super(a,b);this.isSpotLight=!0;this.type="SpotLight";this.position.copy(hb.DEFAULT_UP);this.updateMatrix();
this.target=new hb;this.distance=c;this.angle=d;this.penumbra=f;this.decay=g;this.map=null;this.shadow=new qm}get power(){return this.intensity*Math.PI}set power(a){this.intensity=a/Math.PI}dispose(){this.shadow.dispose()}copy(a,b){super.copy(a,b);this.distance=a.distance;this.angle=a.angle;this.penumbra=a.penumbra;this.decay=a.decay;this.target=a.target.clone();this.shadow=a.shadow.clone();return this}}q.SpotLight=ql;const rl=new Wa,Cg=new O,hk=new O;class rm extends gk{constructor(){super(new Rb(90,
1,.5,500));this.isPointLightShadow=!0;this._frameExtents=new sa(4,2);this._viewportCount=6;this._viewports=[new mb(2,1,1,1),new mb(0,1,1,1),new mb(3,1,1,1),new mb(1,1,1,1),new mb(3,0,1,1),new mb(1,0,1,1)];this._cubeDirections=[new O(1,0,0),new O(-1,0,0),new O(0,0,1),new O(0,0,-1),new O(0,1,0),new O(0,-1,0)];this._cubeUps=[new O(0,1,0),new O(0,1,0),new O(0,1,0),new O(0,1,0),new O(0,0,1),new O(0,0,-1)]}updateMatrices(a,b=0){const c=this.camera,d=this.matrix,f=a.distance||c.far;f!==c.far&&(c.far=f,c.updateProjectionMatrix());
Cg.setFromMatrixPosition(a.matrixWorld);c.position.copy(Cg);hk.copy(c.position);hk.add(this._cubeDirections[b]);c.up.copy(this._cubeUps[b]);c.lookAt(hk);c.updateMatrixWorld();d.makeTranslation(-Cg.x,-Cg.y,-Cg.z);rl.multiplyMatrices(c.projectionMatrix,c.matrixWorldInverse);this._frustum.setFromProjectionMatrix(rl)}}class sl extends je{constructor(a,b,c=0,d=2){super(a,b);this.isPointLight=!0;this.type="PointLight";this.distance=c;this.decay=d;this.shadow=new rm}get power(){return 4*this.intensity*Math.PI}set power(a){this.intensity=
a/(4*Math.PI)}dispose(){this.shadow.dispose()}copy(a,b){super.copy(a,b);this.distance=a.distance;this.decay=a.decay;this.shadow=a.shadow.clone();return this}}q.PointLight=sl;class sm extends gk{constructor(){super(new w(-5,5,5,-5,.5,500));this.isDirectionalLightShadow=!0}}class tl extends je{constructor(a,b){super(a,b);this.isDirectionalLight=!0;this.type="DirectionalLight";this.position.copy(hb.DEFAULT_UP);this.updateMatrix();this.target=new hb;this.shadow=new sm}dispose(){this.shadow.dispose()}copy(a){super.copy(a);
this.target=a.target.clone();this.shadow=a.shadow.clone();return this}}q.DirectionalLight=tl;class ul extends je{constructor(a,b){super(a,b);this.isAmbientLight=!0;this.type="AmbientLight"}}q.AmbientLight=ul;class vl extends je{constructor(a,b,c=10,d=10){super(a,b);this.isRectAreaLight=!0;this.type="RectAreaLight";this.width=c;this.height=d}get power(){return this.intensity*this.width*this.height*Math.PI}set power(a){this.intensity=a/(this.width*this.height*Math.PI)}copy(a){super.copy(a);this.width=
a.width;this.height=a.height;return this}toJSON(a){a=super.toJSON(a);a.object.width=this.width;a.object.height=this.height;return a}}q.RectAreaLight=vl;class wl{constructor(){this.isSphericalHarmonics3=!0;this.coefficients=[];for(let a=0;9>a;a++)this.coefficients.push(new O)}set(a){for(let b=0;9>b;b++)this.coefficients[b].copy(a[b]);return this}zero(){for(let a=0;9>a;a++)this.coefficients[a].set(0,0,0);return this}getAt(a,b){const c=a.x,d=a.y;a=a.z;const f=this.coefficients;b.copy(f[0]).multiplyScalar(.282095);
b.addScaledVector(f[1],.488603*d);b.addScaledVector(f[2],.488603*a);b.addScaledVector(f[3],.488603*c);b.addScaledVector(f[4],1.092548*c*d);b.addScaledVector(f[5],1.092548*d*a);b.addScaledVector(f[6],.315392*(3*a*a-1));b.addScaledVector(f[7],1.092548*c*a);b.addScaledVector(f[8],.546274*(c*c-d*d));return b}getIrradianceAt(a,b){const c=a.x,d=a.y;a=a.z;const f=this.coefficients;b.copy(f[0]).multiplyScalar(.886227);b.addScaledVector(f[1],1.023328*d);b.addScaledVector(f[2],1.023328*a);b.addScaledVector(f[3],
1.023328*c);b.addScaledVector(f[4],.858086*c*d);b.addScaledVector(f[5],.858086*d*a);b.addScaledVector(f[6],.743125*a*a-.247708);b.addScaledVector(f[7],.858086*c*a);b.addScaledVector(f[8],.429043*(c*c-d*d));return b}add(a){for(let b=0;9>b;b++)this.coefficients[b].add(a.coefficients[b]);return this}addScaledSH(a,b){for(let c=0;9>c;c++)this.coefficients[c].addScaledVector(a.coefficients[c],b);return this}scale(a){for(let b=0;9>b;b++)this.coefficients[b].multiplyScalar(a);return this}lerp(a,b){for(let c=
0;9>c;c++)this.coefficients[c].lerp(a.coefficients[c],b);return this}equals(a){for(let b=0;9>b;b++)if(!this.coefficients[b].equals(a.coefficients[b]))return!1;return!0}copy(a){return this.set(a.coefficients)}clone(){return(new this.constructor).copy(this)}fromArray(a,b=0){const c=this.coefficients;for(let d=0;9>d;d++)c[d].fromArray(a,b+3*d);return this}toArray(a=[],b=0){const c=this.coefficients;for(let d=0;9>d;d++)c[d].toArray(a,b+3*d);return a}static getBasisAt(a,b){const c=a.x,d=a.y;a=a.z;b[0]=
.282095;b[1]=.488603*d;b[2]=.488603*a;b[3]=.488603*c;b[4]=1.092548*c*d;b[5]=1.092548*d*a;b[6]=.315392*(3*a*a-1);b[7]=1.092548*c*a;b[8]=.546274*(c*c-d*d)}}q.SphericalHarmonics3=wl;class xl extends je{constructor(a=new wl,b=1){super(void 0,b);this.isLightProbe=!0;this.sh=a}copy(a){super.copy(a);this.sh.copy(a.sh);return this}fromJSON(a){this.intensity=a.intensity;this.sh.fromArray(a.sh);return this}toJSON(a){a=super.toJSON(a);a.object.sh=this.sh.toArray();return a}}q.LightProbe=xl;class ik extends qc{constructor(a){super(a);
this.textures={}}load(a,b,c,d){const f=this,g=new Fd(f.manager);g.setPath(f.path);g.setRequestHeader(f.requestHeader);g.setWithCredentials(f.withCredentials);g.load(a,function(l){try{b(f.parse(JSON.parse(l)))}catch(m){d?d(m):console.error(m),f.manager.itemError(a)}},c,d)}parse(a){function b(g){void 0===c[g]&&console.warn("THREE.MaterialLoader: Undefined texture",g);return c[g]}const c=this.textures,d=ik.createMaterialFromType(a.type);void 0!==a.uuid&&(d.uuid=a.uuid);void 0!==a.name&&(d.name=a.name);
void 0!==a.color&&void 0!==d.color&&d.color.setHex(a.color);void 0!==a.roughness&&(d.roughness=a.roughness);void 0!==a.metalness&&(d.metalness=a.metalness);void 0!==a.sheen&&(d.sheen=a.sheen);void 0!==a.sheenColor&&(d.sheenColor=(new Ia).setHex(a.sheenColor));void 0!==a.sheenRoughness&&(d.sheenRoughness=a.sheenRoughness);void 0!==a.emissive&&void 0!==d.emissive&&d.emissive.setHex(a.emissive);void 0!==a.specular&&void 0!==d.specular&&d.specular.setHex(a.specular);void 0!==a.specularIntensity&&(d.specularIntensity=
a.specularIntensity);void 0!==a.specularColor&&void 0!==d.specularColor&&d.specularColor.setHex(a.specularColor);void 0!==a.shininess&&(d.shininess=a.shininess);void 0!==a.clearcoat&&(d.clearcoat=a.clearcoat);void 0!==a.clearcoatRoughness&&(d.clearcoatRoughness=a.clearcoatRoughness);void 0!==a.iridescence&&(d.iridescence=a.iridescence);void 0!==a.iridescenceIOR&&(d.iridescenceIOR=a.iridescenceIOR);void 0!==a.iridescenceThicknessRange&&(d.iridescenceThicknessRange=a.iridescenceThicknessRange);void 0!==
a.transmission&&(d.transmission=a.transmission);void 0!==a.thickness&&(d.thickness=a.thickness);void 0!==a.attenuationDistance&&(d.attenuationDistance=a.attenuationDistance);void 0!==a.attenuationColor&&void 0!==d.attenuationColor&&d.attenuationColor.setHex(a.attenuationColor);void 0!==a.anisotropy&&(d.anisotropy=a.anisotropy);void 0!==a.anisotropyRotation&&(d.anisotropyRotation=a.anisotropyRotation);void 0!==a.fog&&(d.fog=a.fog);void 0!==a.flatShading&&(d.flatShading=a.flatShading);void 0!==a.blending&&
(d.blending=a.blending);void 0!==a.combine&&(d.combine=a.combine);void 0!==a.side&&(d.side=a.side);void 0!==a.shadowSide&&(d.shadowSide=a.shadowSide);void 0!==a.opacity&&(d.opacity=a.opacity);void 0!==a.transparent&&(d.transparent=a.transparent);void 0!==a.alphaTest&&(d.alphaTest=a.alphaTest);void 0!==a.alphaHash&&(d.alphaHash=a.alphaHash);void 0!==a.depthFunc&&(d.depthFunc=a.depthFunc);void 0!==a.depthTest&&(d.depthTest=a.depthTest);void 0!==a.depthWrite&&(d.depthWrite=a.depthWrite);void 0!==a.colorWrite&&
(d.colorWrite=a.colorWrite);void 0!==a.blendSrc&&(d.blendSrc=a.blendSrc);void 0!==a.blendDst&&(d.blendDst=a.blendDst);void 0!==a.blendEquation&&(d.blendEquation=a.blendEquation);void 0!==a.blendSrcAlpha&&(d.blendSrcAlpha=a.blendSrcAlpha);void 0!==a.blendDstAlpha&&(d.blendDstAlpha=a.blendDstAlpha);void 0!==a.blendEquationAlpha&&(d.blendEquationAlpha=a.blendEquationAlpha);void 0!==a.blendColor&&void 0!==d.blendColor&&d.blendColor.setHex(a.blendColor);void 0!==a.blendAlpha&&(d.blendAlpha=a.blendAlpha);
void 0!==a.stencilWriteMask&&(d.stencilWriteMask=a.stencilWriteMask);void 0!==a.stencilFunc&&(d.stencilFunc=a.stencilFunc);void 0!==a.stencilRef&&(d.stencilRef=a.stencilRef);void 0!==a.stencilFuncMask&&(d.stencilFuncMask=a.stencilFuncMask);void 0!==a.stencilFail&&(d.stencilFail=a.stencilFail);void 0!==a.stencilZFail&&(d.stencilZFail=a.stencilZFail);void 0!==a.stencilZPass&&(d.stencilZPass=a.stencilZPass);void 0!==a.stencilWrite&&(d.stencilWrite=a.stencilWrite);void 0!==a.wireframe&&(d.wireframe=a.wireframe);
void 0!==a.wireframeLinewidth&&(d.wireframeLinewidth=a.wireframeLinewidth);void 0!==a.wireframeLinecap&&(d.wireframeLinecap=a.wireframeLinecap);void 0!==a.wireframeLinejoin&&(d.wireframeLinejoin=a.wireframeLinejoin);void 0!==a.rotation&&(d.rotation=a.rotation);void 0!==a.linewidth&&(d.linewidth=a.linewidth);void 0!==a.dashSize&&(d.dashSize=a.dashSize);void 0!==a.gapSize&&(d.gapSize=a.gapSize);void 0!==a.scale&&(d.scale=a.scale);void 0!==a.polygonOffset&&(d.polygonOffset=a.polygonOffset);void 0!==
a.polygonOffsetFactor&&(d.polygonOffsetFactor=a.polygonOffsetFactor);void 0!==a.polygonOffsetUnits&&(d.polygonOffsetUnits=a.polygonOffsetUnits);void 0!==a.dithering&&(d.dithering=a.dithering);void 0!==a.alphaToCoverage&&(d.alphaToCoverage=a.alphaToCoverage);void 0!==a.premultipliedAlpha&&(d.premultipliedAlpha=a.premultipliedAlpha);void 0!==a.forceSinglePass&&(d.forceSinglePass=a.forceSinglePass);void 0!==a.visible&&(d.visible=a.visible);void 0!==a.toneMapped&&(d.toneMapped=a.toneMapped);void 0!==
a.userData&&(d.userData=a.userData);void 0!==a.vertexColors&&(d.vertexColors="number"===typeof a.vertexColors?0<a.vertexColors?!0:!1:a.vertexColors);if(void 0!==a.uniforms)for(var f in a.uniforms){const g=a.uniforms[f];d.uniforms[f]={};switch(g.type){case "t":d.uniforms[f].value=b(g.value);break;case "c":d.uniforms[f].value=(new Ia).setHex(g.value);break;case "v2":d.uniforms[f].value=(new sa).fromArray(g.value);break;case "v3":d.uniforms[f].value=(new O).fromArray(g.value);break;case "v4":d.uniforms[f].value=
(new mb).fromArray(g.value);break;case "m3":d.uniforms[f].value=(new Za).fromArray(g.value);break;case "m4":d.uniforms[f].value=(new Wa).fromArray(g.value);break;default:d.uniforms[f].value=g.value}}void 0!==a.defines&&(d.defines=a.defines);void 0!==a.vertexShader&&(d.vertexShader=a.vertexShader);void 0!==a.fragmentShader&&(d.fragmentShader=a.fragmentShader);void 0!==a.glslVersion&&(d.glslVersion=a.glslVersion);if(void 0!==a.extensions)for(const g in a.extensions)d.extensions[g]=a.extensions[g];void 0!==
a.lights&&(d.lights=a.lights);void 0!==a.clipping&&(d.clipping=a.clipping);void 0!==a.size&&(d.size=a.size);void 0!==a.sizeAttenuation&&(d.sizeAttenuation=a.sizeAttenuation);void 0!==a.map&&(d.map=b(a.map));void 0!==a.matcap&&(d.matcap=b(a.matcap));void 0!==a.alphaMap&&(d.alphaMap=b(a.alphaMap));void 0!==a.bumpMap&&(d.bumpMap=b(a.bumpMap));void 0!==a.bumpScale&&(d.bumpScale=a.bumpScale);void 0!==a.normalMap&&(d.normalMap=b(a.normalMap));void 0!==a.normalMapType&&(d.normalMapType=a.normalMapType);
void 0!==a.normalScale&&(f=a.normalScale,!1===Array.isArray(f)&&(f=[f,f]),d.normalScale=(new sa).fromArray(f));void 0!==a.displacementMap&&(d.displacementMap=b(a.displacementMap));void 0!==a.displacementScale&&(d.displacementScale=a.displacementScale);void 0!==a.displacementBias&&(d.displacementBias=a.displacementBias);void 0!==a.roughnessMap&&(d.roughnessMap=b(a.roughnessMap));void 0!==a.metalnessMap&&(d.metalnessMap=b(a.metalnessMap));void 0!==a.emissiveMap&&(d.emissiveMap=b(a.emissiveMap));void 0!==
a.emissiveIntensity&&(d.emissiveIntensity=a.emissiveIntensity);void 0!==a.specularMap&&(d.specularMap=b(a.specularMap));void 0!==a.specularIntensityMap&&(d.specularIntensityMap=b(a.specularIntensityMap));void 0!==a.specularColorMap&&(d.specularColorMap=b(a.specularColorMap));void 0!==a.envMap&&(d.envMap=b(a.envMap));void 0!==a.envMapIntensity&&(d.envMapIntensity=a.envMapIntensity);void 0!==a.reflectivity&&(d.reflectivity=a.reflectivity);void 0!==a.refractionRatio&&(d.refractionRatio=a.refractionRatio);
void 0!==a.lightMap&&(d.lightMap=b(a.lightMap));void 0!==a.lightMapIntensity&&(d.lightMapIntensity=a.lightMapIntensity);void 0!==a.aoMap&&(d.aoMap=b(a.aoMap));void 0!==a.aoMapIntensity&&(d.aoMapIntensity=a.aoMapIntensity);void 0!==a.gradientMap&&(d.gradientMap=b(a.gradientMap));void 0!==a.clearcoatMap&&(d.clearcoatMap=b(a.clearcoatMap));void 0!==a.clearcoatRoughnessMap&&(d.clearcoatRoughnessMap=b(a.clearcoatRoughnessMap));void 0!==a.clearcoatNormalMap&&(d.clearcoatNormalMap=b(a.clearcoatNormalMap));
void 0!==a.clearcoatNormalScale&&(d.clearcoatNormalScale=(new sa).fromArray(a.clearcoatNormalScale));void 0!==a.iridescenceMap&&(d.iridescenceMap=b(a.iridescenceMap));void 0!==a.iridescenceThicknessMap&&(d.iridescenceThicknessMap=b(a.iridescenceThicknessMap));void 0!==a.transmissionMap&&(d.transmissionMap=b(a.transmissionMap));void 0!==a.thicknessMap&&(d.thicknessMap=b(a.thicknessMap));void 0!==a.anisotropyMap&&(d.anisotropyMap=b(a.anisotropyMap));void 0!==a.sheenColorMap&&(d.sheenColorMap=b(a.sheenColorMap));
void 0!==a.sheenRoughnessMap&&(d.sheenRoughnessMap=b(a.sheenRoughnessMap));return d}setTextures(a){this.textures=a;return this}static createMaterialFromType(a){return new {ShadowMaterial:al,SpriteMaterial:zj,RawShaderMaterial:bl,ShaderMaterial:bc,PointsMaterial:Gj,MeshPhysicalMaterial:cl,MeshStandardMaterial:ck,MeshPhongMaterial:dl,MeshToonMaterial:el,MeshNormalMaterial:fl,MeshLambertMaterial:gl,MeshDepthMaterial:$e,MeshDistanceMaterial:Ri,MeshBasicMaterial:gd,MeshMatcapMaterial:hl,LineDashedMaterial:il,
LineBasicMaterial:kc,Material:Wb}[a]}}q.MaterialLoader=ik;class jk{static decodeText(a){if("undefined"!==typeof TextDecoder)return(new TextDecoder).decode(a);let b="";for(let c=0,d=a.length;c<d;c++)b+=String.fromCharCode(a[c]);try{return decodeURIComponent(escape(b))}catch(c){return b}}static extractUrlBase(a){const b=a.lastIndexOf("/");return-1===b?"./":a.slice(0,b+1)}static resolveURL(a,b){if("string"!==typeof a||""===a)return"";/^https?:\/\//i.test(b)&&/^\//.test(a)&&(b=b.replace(/(^https?:\/\/[^\/]+).*/i,
"$1"));return/^(https?:)?\/\//i.test(a)||/^data:.*,.*$/i.test(a)||/^blob:.*$/i.test(a)?a:b+a}}q.LoaderUtils=jk;class yl extends ab{constructor(){super();this.isInstancedBufferGeometry=!0;this.type="InstancedBufferGeometry";this.instanceCount=Infinity}copy(a){super.copy(a);this.instanceCount=a.instanceCount;return this}toJSON(){const a=super.toJSON();a.instanceCount=this.instanceCount;a.isInstancedBufferGeometry=!0;return a}}q.InstancedBufferGeometry=yl;class zl extends qc{constructor(a){super(a)}load(a,
b,c,d){const f=this,g=new Fd(f.manager);g.setPath(f.path);g.setRequestHeader(f.requestHeader);g.setWithCredentials(f.withCredentials);g.load(a,function(l){try{b(f.parse(JSON.parse(l)))}catch(m){d?d(m):console.error(m),f.manager.itemError(a)}},c,d)}parse(a){function b(v,A){if(void 0!==c[A])return c[A];const F=v.interleavedBuffers[A];var D=F.buffer;void 0!==d[D]?D=d[D]:(v=(new Uint32Array(v.arrayBuffers[D])).buffer,D=d[D]=v);D=new Xd[F.type](D);D=new Fh(D,F.stride);D.uuid=F.uuid;return c[A]=D}const c=
{},d={},f=a.isInstancedBufferGeometry?new yl:new ab;var g=a.data.index;void 0!==g&&(g=new Xd[g.type](g.array),f.setIndex(new rb(g,1)));g=a.data.attributes;for(var l in g){var m=g[l],n=void 0;m.isInterleavedBufferAttribute?(n=b(a.data,m.data),n=new zf(n,m.itemSize,m.offset,m.normalized)):(n=new Xd[m.type](m.array),n=new (m.isInstancedBufferAttribute?Ef:rb)(n,m.itemSize,m.normalized));void 0!==m.name&&(n.name=m.name);void 0!==m.usage&&n.setUsage(m.usage);void 0!==m.updateRange&&(n.updateRange.offset=
m.updateRange.offset,n.updateRange.count=m.updateRange.count);f.setAttribute(l,n)}if(l=a.data.morphAttributes)for(var t in l){g=l[t];m=[];for(let v=0,A=g.length;v<A;v++){n=g[v];var u=void 0;n.isInterleavedBufferAttribute?(u=b(a.data,n.data),u=new zf(u,n.itemSize,n.offset,n.normalized)):(u=new Xd[n.type](n.array),u=new rb(u,n.itemSize,n.normalized));void 0!==n.name&&(u.name=n.name);m.push(u)}f.morphAttributes[t]=m}a.data.morphTargetsRelative&&(f.morphTargetsRelative=!0);t=a.data.groups||a.data.drawcalls||
a.data.offsets;if(void 0!==t)for(let v=0,A=t.length;v!==A;++v)l=t[v],f.addGroup(l.start,l.count,l.materialIndex);t=a.data.boundingSphere;void 0!==t&&(l=new O,void 0!==t.center&&l.fromArray(t.center),f.boundingSphere=new oc(l,t.radius));a.name&&(f.name=a.name);a.userData&&(f.userData=a.userData);return f}}q.BufferGeometryLoader=zl;class tm extends qc{constructor(a){super(a)}load(a,b,c,d){const f=this;var g=""===this.path?jk.extractUrlBase(a):this.path;this.resourcePath=this.resourcePath||g;g=new Fd(this.manager);
g.setPath(this.path);g.setRequestHeader(this.requestHeader);g.setWithCredentials(this.withCredentials);g.load(a,function(l){let m=null;try{m=JSON.parse(l)}catch(n){void 0!==d&&d(n);console.error("THREE:ObjectLoader: Can't parse "+a+".",n.message);return}l=m.metadata;void 0===l||void 0===l.type||"geometry"===l.type.toLowerCase()?(void 0!==d&&d(Error("THREE.ObjectLoader: Can't load "+a)),console.error("THREE.ObjectLoader: Can't load "+a)):f.parse(m,b)},c,d)}async loadAsync(a,b){var c=""===this.path?
jk.extractUrlBase(a):this.path;this.resourcePath=this.resourcePath||c;c=new Fd(this.manager);c.setPath(this.path);c.setRequestHeader(this.requestHeader);c.setWithCredentials(this.withCredentials);b=await c.loadAsync(a,b);b=JSON.parse(b);c=b.metadata;if(void 0===c||void 0===c.type||"geometry"===c.type.toLowerCase())throw Error("THREE.ObjectLoader: Can't load "+a);return await this.parseAsync(b)}parse(a,b){const c=this.parseAnimations(a.animations);var d=this.parseShapes(a.shapes);const f=this.parseGeometries(a.geometries,
d);d=this.parseImages(a.images,function(){void 0!==b&&b(m)});const g=this.parseTextures(a.textures,d),l=this.parseMaterials(a.materials,g),m=this.parseObject(a.object,f,l,g,c);a=this.parseSkeletons(a.skeletons,m);this.bindSkeletons(m,a);if(void 0!==b){a=!1;for(const n in d)if(d[n].data instanceof HTMLImageElement){a=!0;break}!1===a&&b(m)}return m}async parseAsync(a){var b=this.parseAnimations(a.animations),c=this.parseShapes(a.shapes);c=this.parseGeometries(a.geometries,c);var d=await this.parseImagesAsync(a.images);
d=this.parseTextures(a.textures,d);const f=this.parseMaterials(a.materials,d);b=this.parseObject(a.object,c,f,d,b);a=this.parseSkeletons(a.skeletons,b);this.bindSkeletons(b,a);return b}parseShapes(a){const b={};if(void 0!==a)for(let c=0,d=a.length;c<d;c++){const f=(new Ge).fromJSON(a[c]);b[f.uuid]=f}return b}parseSkeletons(a,b){const c={},d={};b.traverse(function(f){f.isBone&&(d[f.uuid]=f)});if(void 0!==a)for(let f=0,g=a.length;f<g;f++)b=(new Ej).fromJSON(a[f],d),c[b.uuid]=b;return c}parseGeometries(a,
b){const c={};if(void 0!==a){const d=new zl;for(let f=0,g=a.length;f<g;f++){let l;const m=a[f];switch(m.type){case "BufferGeometry":case "InstancedBufferGeometry":l=d.parse(m);break;default:m.type in $k?l=$k[m.type].fromJSON(m,b):console.warn(`THREE.ObjectLoader: Unsupported geometry type "${m.type}"`)}l.uuid=m.uuid;void 0!==m.name&&(l.name=m.name);void 0!==m.userData&&(l.userData=m.userData);c[m.uuid]=l}}return c}parseMaterials(a,b){const c={},d={};if(void 0!==a){const f=new ik;f.setTextures(b);
for(let g=0,l=a.length;g<l;g++)b=a[g],void 0===c[b.uuid]&&(c[b.uuid]=f.parse(b)),d[b.uuid]=c[b.uuid]}return d}parseAnimations(a){const b={};if(void 0!==a)for(let c=0;c<a.length;c++){const d=Ag.parse(a[c]);b[d.uuid]=d}return b}parseImages(a,b){function c(n){f.manager.itemStart(n);return l.load(n,function(){f.manager.itemEnd(n)},void 0,function(){f.manager.itemError(n);f.manager.itemEnd(n)})}function d(n){return"string"===typeof n?(n=/^(\/\/)|([a-z]+:(\/\/)?)/i.test(n)?n:f.resourcePath+n,c(n)):n.data?
{data:new Xd[n.type](n.data),width:n.width,height:n.height}:null}const f=this,g={};let l;if(void 0!==a&&0<a.length){b=new ek(b);l=new Bg(b);l.setCrossOrigin(this.crossOrigin);for(let n=0,t=a.length;n<t;n++){b=a[n];var m=b.url;if(Array.isArray(m)){const u=[];for(let v=0,A=m.length;v<A;v++){const F=d(m[v]);null!==F&&(F instanceof HTMLImageElement?u.push(F):u.push(new Df(F.data,F.width,F.height)))}g[b.uuid]=new xd(u)}else m=d(b.url),g[b.uuid]=new xd(m)}}return g}async parseImagesAsync(a){async function b(l){return"string"===
typeof l?(l=/^(\/\/)|([a-z]+:(\/\/)?)/i.test(l)?l:c.resourcePath+l,await f.loadAsync(l)):l.data?{data:new Xd[l.type](l.data),width:l.width,height:l.height}:null}const c=this,d={};let f;if(void 0!==a&&0<a.length){f=new Bg(this.manager);f.setCrossOrigin(this.crossOrigin);for(let l=0,m=a.length;l<m;l++){const n=a[l];var g=n.url;if(Array.isArray(g)){const t=[];for(let u=0,v=g.length;u<v;u++){const A=await b(g[u]);null!==A&&(A instanceof HTMLImageElement?t.push(A):t.push(new Df(A.data,A.width,A.height)))}d[n.uuid]=
new xd(t)}else g=await b(n.url),d[n.uuid]=new xd(g)}}return d}parseTextures(a,b){function c(f,g){if("number"===typeof f)return f;console.warn("THREE.ObjectLoader.parseTexture: Constant should be in numeric form.",f);return g[f]}const d={};if(void 0!==a)for(let f=0,g=a.length;f<g;f++){const l=a[f];void 0===l.image&&console.warn('THREE.ObjectLoader: No "image" specified for',l.uuid);void 0===b[l.image]&&console.warn("THREE.ObjectLoader: Undefined image",l.image);const m=b[l.image],n=m.data;let t;Array.isArray(n)?
(t=new Ae,6===n.length&&(t.needsUpdate=!0)):(t=n&&n.data?new Df:new Gb,n&&(t.needsUpdate=!0));t.source=m;t.uuid=l.uuid;void 0!==l.name&&(t.name=l.name);void 0!==l.mapping&&(t.mapping=c(l.mapping,um));void 0!==l.channel&&(t.channel=l.channel);void 0!==l.offset&&t.offset.fromArray(l.offset);void 0!==l.repeat&&t.repeat.fromArray(l.repeat);void 0!==l.center&&t.center.fromArray(l.center);void 0!==l.rotation&&(t.rotation=l.rotation);void 0!==l.wrap&&(t.wrapS=c(l.wrap[0],Al),t.wrapT=c(l.wrap[1],Al));void 0!==
l.format&&(t.format=l.format);void 0!==l.internalFormat&&(t.internalFormat=l.internalFormat);void 0!==l.type&&(t.type=l.type);void 0!==l.colorSpace&&(t.colorSpace=l.colorSpace);void 0!==l.encoding&&(t.encoding=l.encoding);void 0!==l.minFilter&&(t.minFilter=c(l.minFilter,Bl));void 0!==l.magFilter&&(t.magFilter=c(l.magFilter,Bl));void 0!==l.anisotropy&&(t.anisotropy=l.anisotropy);void 0!==l.flipY&&(t.flipY=l.flipY);void 0!==l.generateMipmaps&&(t.generateMipmaps=l.generateMipmaps);void 0!==l.premultiplyAlpha&&
(t.premultiplyAlpha=l.premultiplyAlpha);void 0!==l.unpackAlignment&&(t.unpackAlignment=l.unpackAlignment);void 0!==l.compareFunction&&(t.compareFunction=l.compareFunction);void 0!==l.userData&&(t.userData=l.userData);d[l.uuid]=t}return d}parseObject(a,b,c,d,f){function g(A){void 0===b[A]&&console.warn("THREE.ObjectLoader: Undefined geometry",A);return b[A]}function l(A){if(void 0!==A){if(Array.isArray(A)){const F=[];for(let D=0,E=A.length;D<E;D++){const y=A[D];void 0===c[y]&&console.warn("THREE.ObjectLoader: Undefined material",
y);F.push(c[y])}return F}void 0===c[A]&&console.warn("THREE.ObjectLoader: Undefined material",A);return c[A]}}function m(A){void 0===d[A]&&console.warn("THREE.ObjectLoader: Undefined texture",A);return d[A]}let n;switch(a.type){case "Scene":var t=new vk;void 0!==a.background&&(Number.isInteger(a.background)?t.background=new Ia(a.background):t.background=m(a.background));void 0!==a.environment&&(t.environment=m(a.environment));void 0!==a.fog&&("Fog"===a.fog.type?t.fog=new yj(a.fog.color,a.fog.near,
a.fog.far):"FogExp2"===a.fog.type&&(t.fog=new xj(a.fog.color,a.fog.density)),""!==a.fog.name&&(t.fog.name=a.fog.name));void 0!==a.backgroundBlurriness&&(t.backgroundBlurriness=a.backgroundBlurriness);void 0!==a.backgroundIntensity&&(t.backgroundIntensity=a.backgroundIntensity);break;case "PerspectiveCamera":t=new Rb(a.fov,a.aspect,a.near,a.far);void 0!==a.focus&&(t.focus=a.focus);void 0!==a.zoom&&(t.zoom=a.zoom);void 0!==a.filmGauge&&(t.filmGauge=a.filmGauge);void 0!==a.filmOffset&&(t.filmOffset=
a.filmOffset);void 0!==a.view&&(t.view=Object.assign({},a.view));break;case "OrthographicCamera":t=new w(a.left,a.right,a.top,a.bottom,a.near,a.far);void 0!==a.zoom&&(t.zoom=a.zoom);void 0!==a.view&&(t.view=Object.assign({},a.view));break;case "AmbientLight":t=new ul(a.color,a.intensity);break;case "DirectionalLight":t=new tl(a.color,a.intensity);break;case "PointLight":t=new sl(a.color,a.intensity,a.distance,a.decay);break;case "RectAreaLight":t=new vl(a.color,a.intensity,a.width,a.height);break;
case "SpotLight":t=new ql(a.color,a.intensity,a.distance,a.angle,a.penumbra,a.decay);break;case "HemisphereLight":t=new nl(a.color,a.groundColor,a.intensity);break;case "LightProbe":t=(new xl).fromJSON(a);break;case "SkinnedMesh":t=g(a.geometry);n=l(a.material);t=new Gk(t,n);void 0!==a.bindMode&&(t.bindMode=a.bindMode);void 0!==a.bindMatrix&&t.bindMatrix.fromArray(a.bindMatrix);void 0!==a.skeleton&&(t.skeleton=a.skeleton);break;case "Mesh":t=g(a.geometry);n=l(a.material);t=new cb(t,n);break;case "InstancedMesh":t=
g(a.geometry);n=l(a.material);var u=a.instanceMatrix,v=a.instanceColor;t=new Kk(t,n,a.count);t.instanceMatrix=new Ef(new Float32Array(u.array),16);void 0!==v&&(t.instanceColor=new Ef(new Float32Array(v.array),v.itemSize));break;case "LOD":t=new Ak;break;case "Line":t=new ie(g(a.geometry),l(a.material));break;case "LineLoop":t=new Qk(g(a.geometry),l(a.material));break;case "LineSegments":t=new ld(g(a.geometry),l(a.material));break;case "PointCloud":case "Points":t=new Sk(g(a.geometry),l(a.material));
break;case "Sprite":t=new yk(l(a.material));break;case "Group":t=new wf;break;case "Bone":t=new Dj;break;default:t=new hb}t.uuid=a.uuid;void 0!==a.name&&(t.name=a.name);void 0!==a.matrix?(t.matrix.fromArray(a.matrix),void 0!==a.matrixAutoUpdate&&(t.matrixAutoUpdate=a.matrixAutoUpdate),t.matrixAutoUpdate&&t.matrix.decompose(t.position,t.quaternion,t.scale)):(void 0!==a.position&&t.position.fromArray(a.position),void 0!==a.rotation&&t.rotation.fromArray(a.rotation),void 0!==a.quaternion&&t.quaternion.fromArray(a.quaternion),
void 0!==a.scale&&t.scale.fromArray(a.scale));void 0!==a.up&&t.up.fromArray(a.up);void 0!==a.castShadow&&(t.castShadow=a.castShadow);void 0!==a.receiveShadow&&(t.receiveShadow=a.receiveShadow);a.shadow&&(void 0!==a.shadow.bias&&(t.shadow.bias=a.shadow.bias),void 0!==a.shadow.normalBias&&(t.shadow.normalBias=a.shadow.normalBias),void 0!==a.shadow.radius&&(t.shadow.radius=a.shadow.radius),void 0!==a.shadow.mapSize&&t.shadow.mapSize.fromArray(a.shadow.mapSize),void 0!==a.shadow.camera&&(t.shadow.camera=
this.parseObject(a.shadow.camera)));void 0!==a.visible&&(t.visible=a.visible);void 0!==a.frustumCulled&&(t.frustumCulled=a.frustumCulled);void 0!==a.renderOrder&&(t.renderOrder=a.renderOrder);void 0!==a.userData&&(t.userData=a.userData);void 0!==a.layers&&(t.layers.mask=a.layers);if(void 0!==a.children)for(u=a.children,v=0;v<u.length;v++)t.add(this.parseObject(u[v],b,c,d,f));if(void 0!==a.animations)for(u=a.animations,v=0;v<u.length;v++)t.animations.push(f[u[v]]);if("LOD"===a.type)for(void 0!==a.autoUpdate&&
(t.autoUpdate=a.autoUpdate),a=a.levels,f=0;f<a.length;f++)u=a[f],v=t.getObjectByProperty("uuid",u.object),void 0!==v&&t.addLevel(v,u.distance,u.hysteresis);return t}bindSkeletons(a,b){0!==Object.keys(b).length&&a.traverse(function(c){if(!0===c.isSkinnedMesh&&void 0!==c.skeleton){const d=b[c.skeleton];void 0===d?console.warn("THREE.ObjectLoader: No skeleton found with UUID:",c.skeleton):c.bind(d,c.bindMatrix)}})}}q.ObjectLoader=tm;const um={UVMapping:300,CubeReflectionMapping:301,CubeRefractionMapping:302,
EquirectangularReflectionMapping:303,EquirectangularRefractionMapping:304,CubeUVReflectionMapping:306},Al={RepeatWrapping:1E3,ClampToEdgeWrapping:1001,MirroredRepeatWrapping:1002},Bl={NearestFilter:1003,NearestMipmapNearestFilter:1004,NearestMipmapLinearFilter:1005,LinearFilter:1006,LinearMipmapNearestFilter:1007,LinearMipmapLinearFilter:1008};class vm extends qc{constructor(a){super(a);this.isImageBitmapLoader=!0;"undefined"===typeof createImageBitmap&&console.warn("THREE.ImageBitmapLoader: createImageBitmap() not supported.");
"undefined"===typeof fetch&&console.warn("THREE.ImageBitmapLoader: fetch() not supported.");this.options={premultiplyAlpha:"none"}}setOptions(a){this.options=a;return this}load(a,b,c,d){void 0===a&&(a="");void 0!==this.path&&(a=this.path+a);a=this.manager.resolveURL(a);const f=this,g=He.get(a);if(void 0!==g)return f.manager.itemStart(a),setTimeout(function(){b&&b(g);f.manager.itemEnd(a)},0),g;c={};c.credentials="anonymous"===this.crossOrigin?"same-origin":"include";c.headers=this.requestHeader;fetch(a,
c).then(function(l){return l.blob()}).then(function(l){return createImageBitmap(l,Object.assign(f.options,{colorSpaceConversion:"none"}))}).then(function(l){He.add(a,l);b&&b(l);f.manager.itemEnd(a)}).catch(function(l){d&&d(l);f.manager.itemError(a);f.manager.itemEnd(a)});f.manager.itemStart(a)}}q.ImageBitmapLoader=vm;let Wh;class kk{static getContext(){void 0===Wh&&(Wh=new (window.AudioContext||window.webkitAudioContext));return Wh}static setContext(a){Wh=a}}q.AudioContext=kk;class wm extends qc{constructor(a){super(a)}load(a,
b,c,d){function f(m){d?d(m):console.error(m);g.manager.itemError(a)}const g=this,l=new Fd(this.manager);l.setResponseType("arraybuffer");l.setPath(this.path);l.setRequestHeader(this.requestHeader);l.setWithCredentials(this.withCredentials);l.load(a,function(m){try{const n=m.slice(0);kk.getContext().decodeAudioData(n,function(t){b(t)},f)}catch(n){f(n)}},c,d)}}q.AudioLoader=wm;const Cl=new Wa,Dl=new Wa,Ie=new Wa;class xm{constructor(){this.type="StereoCamera";this.aspect=1;this.eyeSep=.064;this.cameraL=
new Rb;this.cameraL.layers.enable(1);this.cameraL.matrixAutoUpdate=!1;this.cameraR=new Rb;this.cameraR.layers.enable(2);this.cameraR.matrixAutoUpdate=!1;this._cache={focus:null,fov:null,aspect:null,near:null,far:null,zoom:null,eyeSep:null}}update(a){const b=this._cache;if(b.focus!==a.focus||b.fov!==a.fov||b.aspect!==a.aspect*this.aspect||b.near!==a.near||b.far!==a.far||b.zoom!==a.zoom||b.eyeSep!==this.eyeSep){b.focus=a.focus;b.fov=a.fov;b.aspect=a.aspect*this.aspect;b.near=a.near;b.far=a.far;b.zoom=
a.zoom;b.eyeSep=this.eyeSep;Ie.copy(a.projectionMatrix);var c=b.eyeSep/2;const d=c*b.near/b.focus,f=b.near*Math.tan(wd*b.fov*.5)/b.zoom;let g;Dl.elements[12]=-c;Cl.elements[12]=c;c=-f*b.aspect+d;g=f*b.aspect+d;Ie.elements[0]=2*b.near/(g-c);Ie.elements[8]=(g+c)/(g-c);this.cameraL.projectionMatrix.copy(Ie);c=-f*b.aspect-d;g=f*b.aspect-d;Ie.elements[0]=2*b.near/(g-c);Ie.elements[8]=(g+c)/(g-c);this.cameraR.projectionMatrix.copy(Ie)}this.cameraL.matrixWorld.copy(a.matrixWorld).multiply(Dl);this.cameraR.matrixWorld.copy(a.matrixWorld).multiply(Cl)}}
q.StereoCamera=xm;class El{constructor(a=!0){this.autoStart=a;this.elapsedTime=this.oldTime=this.startTime=0;this.running=!1}start(){this.oldTime=this.startTime=lh();this.elapsedTime=0;this.running=!0}stop(){this.getElapsedTime();this.autoStart=this.running=!1}getElapsedTime(){this.getDelta();return this.elapsedTime}getDelta(){let a=0;if(this.autoStart&&!this.running)return this.start(),0;if(this.running){const b=lh();a=(b-this.oldTime)/1E3;this.oldTime=b;this.elapsedTime+=a}return a}}q.Clock=El;
const Je=new O,Fl=new Xb,ym=new O,Ke=new O;class zm extends hb{constructor(){super();this.type="AudioListener";this.context=kk.getContext();this.gain=this.context.createGain();this.gain.connect(this.context.destination);this.filter=null;this.timeDelta=0;this._clock=new El}getInput(){return this.gain}removeFilter(){null!==this.filter&&(this.gain.disconnect(this.filter),this.filter.disconnect(this.context.destination),this.gain.connect(this.context.destination),this.filter=null);return this}getFilter(){return this.filter}setFilter(a){null!==
this.filter?(this.gain.disconnect(this.filter),this.filter.disconnect(this.context.destination)):this.gain.disconnect(this.context.destination);this.filter=a;this.gain.connect(this.filter);this.filter.connect(this.context.destination);return this}getMasterVolume(){return this.gain.gain.value}setMasterVolume(a){this.gain.gain.setTargetAtTime(a,this.context.currentTime,.01);return this}updateMatrixWorld(a){super.updateMatrixWorld(a);a=this.context.listener;const b=this.up;this.timeDelta=this._clock.getDelta();
this.matrixWorld.decompose(Je,Fl,ym);Ke.set(0,0,-1).applyQuaternion(Fl);if(a.positionX){const c=this.context.currentTime+this.timeDelta;a.positionX.linearRampToValueAtTime(Je.x,c);a.positionY.linearRampToValueAtTime(Je.y,c);a.positionZ.linearRampToValueAtTime(Je.z,c);a.forwardX.linearRampToValueAtTime(Ke.x,c);a.forwardY.linearRampToValueAtTime(Ke.y,c);a.forwardZ.linearRampToValueAtTime(Ke.z,c);a.upX.linearRampToValueAtTime(b.x,c);a.upY.linearRampToValueAtTime(b.y,c);a.upZ.linearRampToValueAtTime(b.z,
c)}else a.setPosition(Je.x,Je.y,Je.z),a.setOrientation(Ke.x,Ke.y,Ke.z,b.x,b.y,b.z)}}q.AudioListener=zm;class Gl extends hb{constructor(a){super();this.type="Audio";this.listener=a;this.context=a.context;this.gain=this.context.createGain();this.gain.connect(a.getInput());this.autoplay=!1;this.buffer=null;this.detune=0;this.loop=!1;this.offset=this.loopEnd=this.loopStart=0;this.duration=void 0;this.playbackRate=1;this.isPlaying=!1;this.hasPlaybackControl=!0;this.source=null;this.sourceType="empty";
this._progress=this._startedAt=0;this._connected=!1;this.filters=[]}getOutput(){return this.gain}setNodeSource(a){this.hasPlaybackControl=!1;this.sourceType="audioNode";this.source=a;this.connect();return this}setMediaElementSource(a){this.hasPlaybackControl=!1;this.sourceType="mediaNode";this.source=this.context.createMediaElementSource(a);this.connect();return this}setMediaStreamSource(a){this.hasPlaybackControl=!1;this.sourceType="mediaStreamNode";this.source=this.context.createMediaStreamSource(a);
this.connect();return this}setBuffer(a){this.buffer=a;this.sourceType="buffer";this.autoplay&&this.play();return this}play(a=0){if(!0===this.isPlaying)console.warn("THREE.Audio: Audio is already playing.");else if(!1===this.hasPlaybackControl)console.warn("THREE.Audio: this Audio has no playback control.");else return this._startedAt=this.context.currentTime+a,a=this.context.createBufferSource(),a.buffer=this.buffer,a.loop=this.loop,a.loopStart=this.loopStart,a.loopEnd=this.loopEnd,a.onended=this.onEnded.bind(this),
a.start(this._startedAt,this._progress+this.offset,this.duration),this.isPlaying=!0,this.source=a,this.setDetune(this.detune),this.setPlaybackRate(this.playbackRate),this.connect()}pause(){if(!1===this.hasPlaybackControl)console.warn("THREE.Audio: this Audio has no playback control.");else return!0===this.isPlaying&&(this._progress+=Math.max(this.context.currentTime-this._startedAt,0)*this.playbackRate,!0===this.loop&&(this._progress%=this.duration||this.buffer.duration),this.source.stop(),this.source.onended=
null,this.isPlaying=!1),this}stop(){if(!1===this.hasPlaybackControl)console.warn("THREE.Audio: this Audio has no playback control.");else return this._progress=0,null!==this.source&&(this.source.stop(),this.source.onended=null),this.isPlaying=!1,this}connect(){if(0<this.filters.length){this.source.connect(this.filters[0]);for(let a=1,b=this.filters.length;a<b;a++)this.filters[a-1].connect(this.filters[a]);this.filters[this.filters.length-1].connect(this.getOutput())}else this.source.connect(this.getOutput());
this._connected=!0;return this}disconnect(){if(!1!==this._connected){if(0<this.filters.length){this.source.disconnect(this.filters[0]);for(let a=1,b=this.filters.length;a<b;a++)this.filters[a-1].disconnect(this.filters[a]);this.filters[this.filters.length-1].disconnect(this.getOutput())}else this.source.disconnect(this.getOutput());this._connected=!1;return this}}getFilters(){return this.filters}setFilters(a){a||(a=[]);!0===this._connected?(this.disconnect(),this.filters=a.slice(),this.connect()):
this.filters=a.slice();return this}setDetune(a){this.detune=a;if(void 0!==this.source.detune)return!0===this.isPlaying&&this.source.detune.setTargetAtTime(this.detune,this.context.currentTime,.01),this}getDetune(){return this.detune}getFilter(){return this.getFilters()[0]}setFilter(a){return this.setFilters(a?[a]:[])}setPlaybackRate(a){if(!1===this.hasPlaybackControl)console.warn("THREE.Audio: this Audio has no playback control.");else return this.playbackRate=a,!0===this.isPlaying&&this.source.playbackRate.setTargetAtTime(this.playbackRate,
this.context.currentTime,.01),this}getPlaybackRate(){return this.playbackRate}onEnded(){this.isPlaying=!1}getLoop(){return!1===this.hasPlaybackControl?(console.warn("THREE.Audio: this Audio has no playback control."),!1):this.loop}setLoop(a){if(!1===this.hasPlaybackControl)console.warn("THREE.Audio: this Audio has no playback control.");else return this.loop=a,!0===this.isPlaying&&(this.source.loop=this.loop),this}setLoopStart(a){this.loopStart=a;return this}setLoopEnd(a){this.loopEnd=a;return this}getVolume(){return this.gain.gain.value}setVolume(a){this.gain.gain.setTargetAtTime(a,
this.context.currentTime,.01);return this}}q.Audio=Gl;const Le=new O,Hl=new Xb,Am=new O,Me=new O;class Bm extends Gl{constructor(a){super(a);this.panner=this.context.createPanner();this.panner.panningModel="HRTF";this.panner.connect(this.gain)}connect(){super.connect();this.panner.connect(this.gain)}disconnect(){super.disconnect();this.panner.disconnect(this.gain)}getOutput(){return this.panner}getRefDistance(){return this.panner.refDistance}setRefDistance(a){this.panner.refDistance=a;return this}getRolloffFactor(){return this.panner.rolloffFactor}setRolloffFactor(a){this.panner.rolloffFactor=
a;return this}getDistanceModel(){return this.panner.distanceModel}setDistanceModel(a){this.panner.distanceModel=a;return this}getMaxDistance(){return this.panner.maxDistance}setMaxDistance(a){this.panner.maxDistance=a;return this}setDirectionalCone(a,b,c){this.panner.coneInnerAngle=a;this.panner.coneOuterAngle=b;this.panner.coneOuterGain=c;return this}updateMatrixWorld(a){super.updateMatrixWorld(a);if(!0!==this.hasPlaybackControl||!1!==this.isPlaying)if(this.matrixWorld.decompose(Le,Hl,Am),Me.set(0,
0,1).applyQuaternion(Hl),a=this.panner,a.positionX){const b=this.context.currentTime+this.listener.timeDelta;a.positionX.linearRampToValueAtTime(Le.x,b);a.positionY.linearRampToValueAtTime(Le.y,b);a.positionZ.linearRampToValueAtTime(Le.z,b);a.orientationX.linearRampToValueAtTime(Me.x,b);a.orientationY.linearRampToValueAtTime(Me.y,b);a.orientationZ.linearRampToValueAtTime(Me.z,b)}else a.setPosition(Le.x,Le.y,Le.z),a.setOrientation(Me.x,Me.y,Me.z)}}q.PositionalAudio=Bm;class Cm{constructor(a,b=2048){this.analyser=
a.context.createAnalyser();this.analyser.fftSize=b;this.data=new Uint8Array(this.analyser.frequencyBinCount);a.getOutput().connect(this.analyser)}getFrequencyData(){this.analyser.getByteFrequencyData(this.data);return this.data}getAverageFrequency(){let a=0;const b=this.getFrequencyData();for(let c=0;c<b.length;c++)a+=b[c];return a/b.length}}q.AudioAnalyser=Cm;class Il{constructor(a,b,c){this.binding=a;this.valueSize=c;let d;switch(b){case "quaternion":a=this._slerp;b=this._slerpAdditive;d=this._setAdditiveIdentityQuaternion;
this.buffer=new Float64Array(6*c);this._workIndex=5;break;case "string":case "bool":b=a=this._select;d=this._setAdditiveIdentityOther;this.buffer=Array(5*c);break;default:a=this._lerp,b=this._lerpAdditive,d=this._setAdditiveIdentityNumeric,this.buffer=new Float64Array(5*c)}this._mixBufferRegion=a;this._mixBufferRegionAdditive=b;this._setIdentity=d;this._origIndex=3;this._addIndex=4;this.referenceCount=this.useCount=this.cumulativeWeightAdditive=this.cumulativeWeight=0}accumulate(a,b){const c=this.buffer,
d=this.valueSize;a=a*d+d;var f=this.cumulativeWeight;if(0===f){for(f=0;f!==d;++f)c[a+f]=c[f];f=b}else f+=b,this._mixBufferRegion(c,a,0,b/f,d);this.cumulativeWeight=f}accumulateAdditive(a){const b=this.buffer,c=this.valueSize,d=c*this._addIndex;0===this.cumulativeWeightAdditive&&this._setIdentity();this._mixBufferRegionAdditive(b,d,0,a,c);this.cumulativeWeightAdditive+=a}apply(a){const b=this.valueSize,c=this.buffer;a=a*b+b;const d=this.cumulativeWeight,f=this.cumulativeWeightAdditive,g=this.binding;
this.cumulativeWeightAdditive=this.cumulativeWeight=0;1>d&&this._mixBufferRegion(c,a,b*this._origIndex,1-d,b);0<f&&this._mixBufferRegionAdditive(c,a,this._addIndex*b,1,b);for(let l=b,m=b+b;l!==m;++l)if(c[l]!==c[l+b]){g.setValue(c,a);break}}saveOriginalState(){const a=this.buffer,b=this.valueSize,c=b*this._origIndex;this.binding.getValue(a,c);for(let d=b,f=c;d!==f;++d)a[d]=a[c+d%b];this._setIdentity();this.cumulativeWeightAdditive=this.cumulativeWeight=0}restoreOriginalState(){this.binding.setValue(this.buffer,
3*this.valueSize)}_setAdditiveIdentityNumeric(){var a=this._addIndex*this.valueSize;const b=a+this.valueSize;for(;a<b;a++)this.buffer[a]=0}_setAdditiveIdentityQuaternion(){this._setAdditiveIdentityNumeric();this.buffer[this._addIndex*this.valueSize+3]=1}_setAdditiveIdentityOther(){const a=this._origIndex*this.valueSize,b=this._addIndex*this.valueSize;for(let c=0;c<this.valueSize;c++)this.buffer[b+c]=this.buffer[a+c]}_select(a,b,c,d,f){if(.5<=d)for(d=0;d!==f;++d)a[b+d]=a[c+d]}_slerp(a,b,c,d){Xb.slerpFlat(a,
b,a,b,a,c,d)}_slerpAdditive(a,b,c,d,f){f*=this._workIndex;Xb.multiplyQuaternionsFlat(a,f,a,b,a,c);Xb.slerpFlat(a,b,a,b,a,f,d)}_lerp(a,b,c,d,f){const g=1-d;for(let l=0;l!==f;++l){const m=b+l;a[m]=a[m]*g+a[c+l]*d}}_lerpAdditive(a,b,c,d,f){for(let g=0;g!==f;++g){const l=b+g;a[l]+=a[c+g]*d}}}q.PropertyMixer=Il;const Dm=RegExp("[\\[\\]\\.:\\/]","g"),Em=/((?:WC+[\/:])*)/.source.replace("WC","[^\\[\\]\\.:\\/]"),Fm=/(WCOD+)?/.source.replace("WCOD","[^\\[\\]:\\/]"),Gm=/(?:\.(WC+)(?:\[(.+)\])?)?/.source.replace("WC",
"[^\\[\\]\\.:\\/]"),Hm=/\.(WC+)(?:\[(.+)\])?/.source.replace("WC","[^\\[\\]\\.:\\/]"),Im=new RegExp("^"+Em+Fm+Gm+Hm+"$"),Jm=["material","materials","bones","map"];class Km{constructor(a,b,c){c=c||kb.parseTrackName(b);this._targetGroup=a;this._bindings=a.subscribe_(b,c)}getValue(a,b){this.bind();const c=this._bindings[this._targetGroup.nCachedObjects_];void 0!==c&&c.getValue(a,b)}setValue(a,b){const c=this._bindings;for(let d=this._targetGroup.nCachedObjects_,f=c.length;d!==f;++d)c[d].setValue(a,b)}bind(){const a=
this._bindings;for(let b=this._targetGroup.nCachedObjects_,c=a.length;b!==c;++b)a[b].bind()}unbind(){const a=this._bindings;for(let b=this._targetGroup.nCachedObjects_,c=a.length;b!==c;++b)a[b].unbind()}}class kb{constructor(a,b,c){this.path=b;this.parsedPath=c||kb.parseTrackName(b);this.node=kb.findNode(a,this.parsedPath.nodeName);this.rootNode=a;this.getValue=this._getValue_unbound;this.setValue=this._setValue_unbound}static create(a,b,c){return a&&a.isAnimationObjectGroup?new kb.Composite(a,b,
c):new kb(a,b,c)}static sanitizeNodeName(a){return a.replace(/\s/g,"_").replace(Dm,"")}static parseTrackName(a){var b=Im.exec(a);if(null===b)throw Error("PropertyBinding: Cannot parse trackName: "+a);b={nodeName:b[2],objectName:b[3],objectIndex:b[4],propertyName:b[5],propertyIndex:b[6]};const c=b.nodeName&&b.nodeName.lastIndexOf(".");if(void 0!==c&&-1!==c){const d=b.nodeName.substring(c+1);-1!==Jm.indexOf(d)&&(b.nodeName=b.nodeName.substring(0,c),b.objectName=d)}if(null===b.propertyName||0===b.propertyName.length)throw Error("PropertyBinding: can not parse propertyName from trackName: "+
a);return b}static findNode(a,b){if(void 0===b||""===b||"."===b||-1===b||b===a.name||b===a.uuid)return a;if(a.skeleton){const c=a.skeleton.getBoneByName(b);if(void 0!==c)return c}if(a.children){const c=function(d){for(let g=0;g<d.length;g++){var f=d[g];if(f.name===b||f.uuid===b||(f=c(f.children)))return f}return null};if(a=c(a.children))return a}return null}_getValue_unavailable(){}_setValue_unavailable(){}_getValue_direct(a,b){a[b]=this.targetObject[this.propertyName]}_getValue_array(a,b){const c=
this.resolvedProperty;for(let d=0,f=c.length;d!==f;++d)a[b++]=c[d]}_getValue_arrayElement(a,b){a[b]=this.resolvedProperty[this.propertyIndex]}_getValue_toArray(a,b){this.resolvedProperty.toArray(a,b)}_setValue_direct(a,b){this.targetObject[this.propertyName]=a[b]}_setValue_direct_setNeedsUpdate(a,b){this.targetObject[this.propertyName]=a[b];this.targetObject.needsUpdate=!0}_setValue_direct_setMatrixWorldNeedsUpdate(a,b){this.targetObject[this.propertyName]=a[b];this.targetObject.matrixWorldNeedsUpdate=
!0}_setValue_array(a,b){const c=this.resolvedProperty;for(let d=0,f=c.length;d!==f;++d)c[d]=a[b++]}_setValue_array_setNeedsUpdate(a,b){const c=this.resolvedProperty;for(let d=0,f=c.length;d!==f;++d)c[d]=a[b++];this.targetObject.needsUpdate=!0}_setValue_array_setMatrixWorldNeedsUpdate(a,b){const c=this.resolvedProperty;for(let d=0,f=c.length;d!==f;++d)c[d]=a[b++];this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_arrayElement(a,b){this.resolvedProperty[this.propertyIndex]=a[b]}_setValue_arrayElement_setNeedsUpdate(a,
b){this.resolvedProperty[this.propertyIndex]=a[b];this.targetObject.needsUpdate=!0}_setValue_arrayElement_setMatrixWorldNeedsUpdate(a,b){this.resolvedProperty[this.propertyIndex]=a[b];this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_fromArray(a,b){this.resolvedProperty.fromArray(a,b)}_setValue_fromArray_setNeedsUpdate(a,b){this.resolvedProperty.fromArray(a,b);this.targetObject.needsUpdate=!0}_setValue_fromArray_setMatrixWorldNeedsUpdate(a,b){this.resolvedProperty.fromArray(a,b);this.targetObject.matrixWorldNeedsUpdate=
!0}_getValue_unbound(a,b){this.bind();this.getValue(a,b)}_setValue_unbound(a,b){this.bind();this.setValue(a,b)}bind(){let a=this.node;var b=this.parsedPath,c=b.objectName;const d=b.propertyName;let f=b.propertyIndex;a||(this.node=a=kb.findNode(this.rootNode,b.nodeName));this.getValue=this._getValue_unavailable;this.setValue=this._setValue_unavailable;if(a){if(c){var g=b.objectIndex;switch(c){case "materials":if(!a.material){console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",
this);return}if(!a.material.materials){console.error("THREE.PropertyBinding: Can not bind to material.materials as node.material does not have a materials array.",this);return}a=a.material.materials;break;case "bones":if(!a.skeleton){console.error("THREE.PropertyBinding: Can not bind to bones as node does not have a skeleton.",this);return}a=a.skeleton.bones;for(c=0;c<a.length;c++)if(a[c].name===g){g=c;break}break;case "map":if("map"in a){a=a.map;break}if(!a.material){console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",
this);return}if(!a.material.map){console.error("THREE.PropertyBinding: Can not bind to material.map as node.material does not have a map.",this);return}a=a.material.map;break;default:if(void 0===a[c]){console.error("THREE.PropertyBinding: Can not bind to objectName of node undefined.",this);return}a=a[c]}if(void 0!==g){if(void 0===a[g]){console.error("THREE.PropertyBinding: Trying to bind to objectIndex of objectName, but is undefined.",this,a);return}a=a[g]}}g=a[d];if(void 0===g)console.error("THREE.PropertyBinding: Trying to update property for track: "+
b.nodeName+"."+d+" but it wasn't found.",a);else{b=this.Versioning.None;this.targetObject=a;void 0!==a.needsUpdate?b=this.Versioning.NeedsUpdate:void 0!==a.matrixWorldNeedsUpdate&&(b=this.Versioning.MatrixWorldNeedsUpdate);c=this.BindingType.Direct;if(void 0!==f){if("morphTargetInfluences"===d){if(!a.geometry){console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.",this);return}if(!a.geometry.morphAttributes){console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.morphAttributes.",
this);return}void 0!==a.morphTargetDictionary[f]&&(f=a.morphTargetDictionary[f])}c=this.BindingType.ArrayElement;this.resolvedProperty=g;this.propertyIndex=f}else void 0!==g.fromArray&&void 0!==g.toArray?(c=this.BindingType.HasFromToArray,this.resolvedProperty=g):Array.isArray(g)?(c=this.BindingType.EntireArray,this.resolvedProperty=g):this.propertyName=d;this.getValue=this.GetterByBindingType[c];this.setValue=this.SetterByBindingTypeAndVersioning[c][b]}}else console.warn("THREE.PropertyBinding: No target node found for track: "+
this.path+".")}unbind(){this.node=null;this.getValue=this._getValue_unbound;this.setValue=this._setValue_unbound}}q.PropertyBinding=kb;kb.Composite=Km;kb.prototype.BindingType={Direct:0,EntireArray:1,ArrayElement:2,HasFromToArray:3};kb.prototype.Versioning={None:0,NeedsUpdate:1,MatrixWorldNeedsUpdate:2};kb.prototype.GetterByBindingType=[kb.prototype._getValue_direct,kb.prototype._getValue_array,kb.prototype._getValue_arrayElement,kb.prototype._getValue_toArray];kb.prototype.SetterByBindingTypeAndVersioning=
[[kb.prototype._setValue_direct,kb.prototype._setValue_direct_setNeedsUpdate,kb.prototype._setValue_direct_setMatrixWorldNeedsUpdate],[kb.prototype._setValue_array,kb.prototype._setValue_array_setNeedsUpdate,kb.prototype._setValue_array_setMatrixWorldNeedsUpdate],[kb.prototype._setValue_arrayElement,kb.prototype._setValue_arrayElement_setNeedsUpdate,kb.prototype._setValue_arrayElement_setMatrixWorldNeedsUpdate],[kb.prototype._setValue_fromArray,kb.prototype._setValue_fromArray_setNeedsUpdate,kb.prototype._setValue_fromArray_setMatrixWorldNeedsUpdate]];
class Lm{constructor(){this.isAnimationObjectGroup=!0;this.uuid=$b();this._objects=Array.prototype.slice.call(arguments);this.nCachedObjects_=0;const a={};this._indicesByUUID=a;for(let c=0,d=arguments.length;c!==d;++c)a[arguments[c].uuid]=c;this._paths=[];this._parsedPaths=[];this._bindings=[];this._bindingsIndicesByPath={};const b=this;this.stats={objects:{get total(){return b._objects.length},get inUse(){return this.total-b.nCachedObjects_}},get bindingsPerObject(){return b._bindings.length}}}add(){const a=
this._objects,b=this._indicesByUUID,c=this._paths,d=this._parsedPaths,f=this._bindings,g=f.length;let l=void 0,m=a.length,n=this.nCachedObjects_;for(let v=0,A=arguments.length;v!==A;++v){const F=arguments[v];var t=F.uuid;let D=b[t];if(void 0===D){D=m++;b[t]=D;a.push(F);for(let E=0,y=g;E!==y;++E)f[E].push(new kb(F,c[E],d[E]))}else if(D<n){l=a[D];const E=--n;var u=a[E];b[u.uuid]=D;a[D]=u;b[t]=E;a[E]=F;for(let y=0,J=g;y!==J;++y)t=f[y],u=t[D],t[D]=t[E],void 0===u&&(u=new kb(F,c[y],d[y])),t[E]=u}else a[D]!==
l&&console.error("THREE.AnimationObjectGroup: Different objects with the same UUID detected. Clean the caches or recreate your infrastructure when reloading scenes.")}this.nCachedObjects_=n}remove(){const a=this._objects,b=this._indicesByUUID,c=this._bindings,d=c.length;let f=this.nCachedObjects_;for(let m=0,n=arguments.length;m!==n;++m){var g=arguments[m],l=g.uuid;const t=b[l];if(void 0!==t&&t>=f){const u=f++,v=a[u];b[v.uuid]=t;a[t]=v;b[l]=u;a[u]=g;for(let A=0,F=d;A!==F;++A)g=c[A],l=g[t],g[t]=g[u],
g[u]=l}}this.nCachedObjects_=f}uncache(){const a=this._objects,b=this._indicesByUUID,c=this._bindings,d=c.length;let f=this.nCachedObjects_,g=a.length;for(let u=0,v=arguments.length;u!==v;++u){var l=arguments[u].uuid;const A=b[l];if(void 0!==A)if(delete b[l],A<f){l=--f;var m=a[l],n=--g,t=a[n];b[m.uuid]=A;a[A]=m;b[t.uuid]=l;a[l]=t;a.pop();for(let F=0,D=d;F!==D;++F)m=c[F],t=m[n],m[A]=m[l],m[l]=t,m.pop()}else{l=--g;n=a[l];0<l&&(b[n.uuid]=A);a[A]=n;a.pop();for(let F=0,D=d;F!==D;++F)n=c[F],n[A]=n[l],n.pop()}}this.nCachedObjects_=
f}subscribe_(a,b){const c=this._bindingsIndicesByPath;let d=c[a];const f=this._bindings;if(void 0!==d)return f[d];const g=this._paths,l=this._parsedPaths,m=this._objects,n=this.nCachedObjects_,t=Array(m.length);d=f.length;c[a]=d;g.push(a);l.push(b);f.push(t);for(let u=n,v=m.length;u!==v;++u)t[u]=new kb(m[u],a,b);return t}unsubscribe_(a){const b=this._bindingsIndicesByPath,c=b[a];if(void 0!==c){const d=this._paths,f=this._parsedPaths,g=this._bindings,l=g.length-1,m=g[l];b[a[l]]=c;g[c]=m;g.pop();f[c]=
f[l];f.pop();d[c]=d[l];d.pop()}}}q.AnimationObjectGroup=Lm;class Jl{constructor(a,b,c=null,d=b.blendMode){this._mixer=a;this._clip=b;this._localRoot=c;this.blendMode=d;a=b.tracks;b=a.length;c=Array(b);d={endingStart:2400,endingEnd:2400};for(let f=0;f!==b;++f){const g=a[f].createInterpolant(null);c[f]=g;g.settings=d}this._interpolantSettings=d;this._interpolants=c;this._propertyBindings=Array(b);this._weightInterpolant=this._timeScaleInterpolant=this._byClipCacheIndex=this._cacheIndex=null;this.loop=
2201;this._loopCount=-1;this._startTime=null;this.time=0;this._effectiveWeight=this.weight=this._effectiveTimeScale=this.timeScale=1;this.repetitions=Infinity;this.paused=!1;this.enabled=!0;this.clampWhenFinished=!1;this.zeroSlopeAtEnd=this.zeroSlopeAtStart=!0}play(){this._mixer._activateAction(this);return this}stop(){this._mixer._deactivateAction(this);return this.reset()}reset(){this.paused=!1;this.enabled=!0;this.time=0;this._loopCount=-1;this._startTime=null;return this.stopFading().stopWarping()}isRunning(){return this.enabled&&
!this.paused&&0!==this.timeScale&&null===this._startTime&&this._mixer._isActiveAction(this)}isScheduled(){return this._mixer._isActiveAction(this)}startAt(a){this._startTime=a;return this}setLoop(a,b){this.loop=a;this.repetitions=b;return this}setEffectiveWeight(a){this.weight=a;this._effectiveWeight=this.enabled?a:0;return this.stopFading()}getEffectiveWeight(){return this._effectiveWeight}fadeIn(a){return this._scheduleFading(a,0,1)}fadeOut(a){return this._scheduleFading(a,1,0)}crossFadeFrom(a,
b,c){a.fadeOut(b);this.fadeIn(b);if(c){c=this._clip.duration;const d=a._clip.duration,f=c/d;a.warp(1,d/c,b);this.warp(f,1,b)}return this}crossFadeTo(a,b,c){return a.crossFadeFrom(this,b,c)}stopFading(){const a=this._weightInterpolant;null!==a&&(this._weightInterpolant=null,this._mixer._takeBackControlInterpolant(a));return this}setEffectiveTimeScale(a){this.timeScale=a;this._effectiveTimeScale=this.paused?0:a;return this.stopWarping()}getEffectiveTimeScale(){return this._effectiveTimeScale}setDuration(a){this.timeScale=
this._clip.duration/a;return this.stopWarping()}syncWith(a){this.time=a.time;this.timeScale=a.timeScale;return this.stopWarping()}halt(a){return this.warp(this._effectiveTimeScale,0,a)}warp(a,b,c){var d=this._mixer;const f=d.time,g=this.timeScale;var l=this._timeScaleInterpolant;null===l&&(this._timeScaleInterpolant=l=d._lendControlInterpolant());d=l.parameterPositions;l=l.sampleValues;d[0]=f;d[1]=f+c;l[0]=a/g;l[1]=b/g;return this}stopWarping(){const a=this._timeScaleInterpolant;null!==a&&(this._timeScaleInterpolant=
null,this._mixer._takeBackControlInterpolant(a));return this}getMixer(){return this._mixer}getClip(){return this._clip}getRoot(){return this._localRoot||this._mixer._root}_update(a,b,c,d){if(this.enabled){var f=this._startTime;null!==f&&(b=(a-f)*c,0>b||0===c?b=0:(this._startTime=null,b*=c));b*=this._updateTimeScale(a);c=this._updateTime(b);a=this._updateWeight(a);if(0<a)switch(b=this._interpolants,f=this._propertyBindings,this.blendMode){case 2501:for(let g=0,l=b.length;g!==l;++g)b[g].evaluate(c),
f[g].accumulateAdditive(a);break;default:for(let g=0,l=b.length;g!==l;++g)b[g].evaluate(c),f[g].accumulate(d,a)}}else this._updateWeight(a)}_updateWeight(a){let b=0;if(this.enabled){b=this.weight;const c=this._weightInterpolant;if(null!==c){const d=c.evaluate(a)[0];b*=d;a>c.parameterPositions[1]&&(this.stopFading(),0===d&&(this.enabled=!1))}}return this._effectiveWeight=b}_updateTimeScale(a){let b=0;if(!this.paused){b=this.timeScale;const c=this._timeScaleInterpolant;if(null!==c){const d=c.evaluate(a)[0];
b*=d;a>c.parameterPositions[1]&&(this.stopWarping(),0===b?this.paused=!0:this.timeScale=b)}}return this._effectiveTimeScale=b}_updateTime(a){const b=this._clip.duration;var c=this.loop;let d=this.time+a,f=this._loopCount;const g=2202===c;if(0===a)return-1===f?d:g&&1===(f&1)?b-d:d;if(2200===c)a:{if(-1===f&&(this._loopCount=0,this._setEndings(!0,!0,!1)),d>=b)d=b;else if(0>d)d=0;else{this.time=d;break a}this.clampWhenFinished?this.paused=!0:this.enabled=!1;this.time=d;this._mixer.dispatchEvent({type:"finished",
action:this,direction:0>a?-1:1})}else{-1===f&&(0<=a?(f=0,this._setEndings(!0,0===this.repetitions,g)):this._setEndings(0===this.repetitions,!0,g));if(d>=b||0>d){c=Math.floor(d/b);d-=b*c;f+=Math.abs(c);const l=this.repetitions-f;0>=l?(this.clampWhenFinished?this.paused=!0:this.enabled=!1,this.time=d=0<a?b:0,this._mixer.dispatchEvent({type:"finished",action:this,direction:0<a?1:-1})):(1===l?(a=0>a,this._setEndings(a,!a,g)):this._setEndings(!1,!1,g),this._loopCount=f,this.time=d,this._mixer.dispatchEvent({type:"loop",
action:this,loopDelta:c}))}else this.time=d;if(g&&1===(f&1))return b-d}return d}_setEndings(a,b,c){const d=this._interpolantSettings;c?(d.endingStart=2401,d.endingEnd=2401):(d.endingStart=a?this.zeroSlopeAtStart?2401:2400:2402,d.endingEnd=b?this.zeroSlopeAtEnd?2401:2400:2402)}_scheduleFading(a,b,c){var d=this._mixer;const f=d.time;var g=this._weightInterpolant;null===g&&(this._weightInterpolant=g=d._lendControlInterpolant());d=g.parameterPositions;g=g.sampleValues;d[0]=f;g[0]=b;d[1]=f+a;g[1]=c;return this}}
q.AnimationAction=Jl;const Mm=new Float32Array(1);class Nm extends Pc{constructor(a){super();this._root=a;this._initMemoryManager();this.time=this._accuIndex=0;this.timeScale=1}_bindAction(a,b){const c=a._localRoot||this._root,d=a._clip.tracks,f=d.length,g=a._propertyBindings;a=a._interpolants;const l=c.uuid;var m=this._bindingsByRootAndName;let n=m[l];void 0===n&&(n={},m[l]=n);for(m=0;m!==f;++m){const t=d[m],u=t.name;let v=n[u];if(void 0!==v)++v.referenceCount;else{v=g[m];if(void 0!==v){null===v._cacheIndex&&
(++v.referenceCount,this._addInactiveBinding(v,l,u));continue}v=new Il(kb.create(c,u,b&&b._propertyBindings[m].binding.parsedPath),t.ValueTypeName,t.getValueSize());++v.referenceCount;this._addInactiveBinding(v,l,u)}g[m]=v;a[m].resultBuffer=v.buffer}}_activateAction(a){if(!this._isActiveAction(a)){if(null===a._cacheIndex){var b=(a._localRoot||this._root).uuid,c=a._clip.uuid;const d=this._actionsByClip[c];this._bindAction(a,d&&d.knownActions[0]);this._addInactiveAction(a,c,b)}b=a._propertyBindings;
for(let d=0,f=b.length;d!==f;++d)c=b[d],0===c.useCount++&&(this._lendBinding(c),c.saveOriginalState());this._lendAction(a)}}_deactivateAction(a){if(this._isActiveAction(a)){const b=a._propertyBindings;for(let c=0,d=b.length;c!==d;++c){const f=b[c];0===--f.useCount&&(f.restoreOriginalState(),this._takeBackBinding(f))}this._takeBackAction(a)}}_initMemoryManager(){this._actions=[];this._nActiveActions=0;this._actionsByClip={};this._bindings=[];this._nActiveBindings=0;this._bindingsByRootAndName={};this._controlInterpolants=
[];this._nActiveControlInterpolants=0;const a=this;this.stats={actions:{get total(){return a._actions.length},get inUse(){return a._nActiveActions}},bindings:{get total(){return a._bindings.length},get inUse(){return a._nActiveBindings}},controlInterpolants:{get total(){return a._controlInterpolants.length},get inUse(){return a._nActiveControlInterpolants}}}}_isActiveAction(a){a=a._cacheIndex;return null!==a&&a<this._nActiveActions}_addInactiveAction(a,b,c){const d=this._actions,f=this._actionsByClip;
let g=f[b];void 0===g?(g={knownActions:[a],actionByRoot:{}},a._byClipCacheIndex=0,f[b]=g):(b=g.knownActions,a._byClipCacheIndex=b.length,b.push(a));a._cacheIndex=d.length;d.push(a);g.actionByRoot[c]=a}_removeInactiveAction(a){var b=this._actions,c=b[b.length-1],d=a._cacheIndex;c._cacheIndex=d;b[d]=c;b.pop();a._cacheIndex=null;b=a._clip.uuid;c=this._actionsByClip;d=c[b];const f=d.knownActions,g=f[f.length-1],l=a._byClipCacheIndex;g._byClipCacheIndex=l;f[l]=g;f.pop();a._byClipCacheIndex=null;delete d.actionByRoot[(a._localRoot||
this._root).uuid];0===f.length&&delete c[b];this._removeInactiveBindingsForAction(a)}_removeInactiveBindingsForAction(a){a=a._propertyBindings;for(let b=0,c=a.length;b!==c;++b){const d=a[b];0===--d.referenceCount&&this._removeInactiveBinding(d)}}_lendAction(a){const b=this._actions,c=a._cacheIndex,d=this._nActiveActions++,f=b[d];a._cacheIndex=d;b[d]=a;f._cacheIndex=c;b[c]=f}_takeBackAction(a){const b=this._actions,c=a._cacheIndex,d=--this._nActiveActions,f=b[d];a._cacheIndex=d;b[d]=a;f._cacheIndex=
c;b[c]=f}_addInactiveBinding(a,b,c){const d=this._bindingsByRootAndName,f=this._bindings;let g=d[b];void 0===g&&(g={},d[b]=g);g[c]=a;a._cacheIndex=f.length;f.push(a)}_removeInactiveBinding(a){const b=this._bindings;var c=a.binding;const d=c.rootNode.uuid;c=c.path;const f=this._bindingsByRootAndName,g=f[d],l=b[b.length-1];a=a._cacheIndex;l._cacheIndex=a;b[a]=l;b.pop();delete g[c];0===Object.keys(g).length&&delete f[d]}_lendBinding(a){const b=this._bindings,c=a._cacheIndex,d=this._nActiveBindings++,
f=b[d];a._cacheIndex=d;b[d]=a;f._cacheIndex=c;b[c]=f}_takeBackBinding(a){const b=this._bindings,c=a._cacheIndex,d=--this._nActiveBindings,f=b[d];a._cacheIndex=d;b[d]=a;f._cacheIndex=c;b[c]=f}_lendControlInterpolant(){const a=this._controlInterpolants,b=this._nActiveControlInterpolants++;let c=a[b];void 0===c&&(c=new dk(new Float32Array(2),new Float32Array(2),1,Mm),c.__cacheIndex=b,a[b]=c);return c}_takeBackControlInterpolant(a){const b=this._controlInterpolants,c=a.__cacheIndex,d=--this._nActiveControlInterpolants,
f=b[d];a.__cacheIndex=d;b[d]=a;f.__cacheIndex=c;b[c]=f}clipAction(a,b,c){var d=b||this._root;const f=d.uuid;d="string"===typeof a?Ag.findByName(d,a):a;a=null!==d?d.uuid:a;const g=this._actionsByClip[a];var l=null;void 0===c&&(c=null!==d?d.blendMode:2500);if(void 0!==g){l=g.actionByRoot[f];if(void 0!==l&&l.blendMode===c)return l;l=g.knownActions[0];null===d&&(d=l._clip)}if(null===d)return null;b=new Jl(this,d,b,c);this._bindAction(b,l);this._addInactiveAction(b,a,f);return b}existingAction(a,b){var c=
b||this._root;b=c.uuid;c="string"===typeof a?Ag.findByName(c,a):a;a=this._actionsByClip[c?c.uuid:a];return void 0!==a?a.actionByRoot[b]||null:null}stopAllAction(){const a=this._actions;var b=this._nActiveActions;for(--b;0<=b;--b)a[b].stop();return this}update(a){a*=this.timeScale;var b=this._actions,c=this._nActiveActions;const d=this.time+=a,f=Math.sign(a),g=this._accuIndex^=1;for(let l=0;l!==c;++l)b[l]._update(d,a,f,g);a=this._bindings;b=this._nActiveBindings;for(c=0;c!==b;++c)a[c].apply(g);return this}setTime(a){this.time=
0;for(let b=0;b<this._actions.length;b++)this._actions[b].time=0;return this.update(a)}getRoot(){return this._root}uncacheClip(a){const b=this._actions;a=a.uuid;const c=this._actionsByClip;var d=c[a];if(void 0!==d){d=d.knownActions;for(let f=0,g=d.length;f!==g;++f){const l=d[f];this._deactivateAction(l);const m=l._cacheIndex,n=b[b.length-1];l._cacheIndex=null;l._byClipCacheIndex=null;n._cacheIndex=m;b[m]=n;b.pop();this._removeInactiveBindingsForAction(l)}delete c[a]}}uncacheRoot(a){a=a.uuid;const b=
this._actionsByClip;for(var c in b){const d=b[c].actionByRoot[a];void 0!==d&&(this._deactivateAction(d),this._removeInactiveAction(d))}c=this._bindingsByRootAndName[a];if(void 0!==c)for(const d in c)a=c[d],a.restoreOriginalState(),this._removeInactiveBinding(a)}uncacheAction(a,b){a=this.existingAction(a,b);null!==a&&(this._deactivateAction(a),this._removeInactiveAction(a))}}q.AnimationMixer=Nm;class Kl{constructor(a){this.value=a}clone(){return new Kl(void 0===this.value.clone?this.value:this.value.clone())}}
q.Uniform=Kl;let Om=0;class Pm extends Pc{constructor(){super();this.isUniformsGroup=!0;Object.defineProperty(this,"id",{value:Om++});this.name="";this.usage=35044;this.uniforms=[]}add(a){this.uniforms.push(a);return this}remove(a){a=this.uniforms.indexOf(a);-1!==a&&this.uniforms.splice(a,1);return this}setName(a){this.name=a;return this}setUsage(a){this.usage=a;return this}dispose(){this.dispatchEvent({type:"dispose"});return this}copy(a){this.name=a.name;this.usage=a.usage;a=a.uniforms;this.uniforms.length=
0;for(let b=0,c=a.length;b<c;b++)this.uniforms.push(a[b].clone());return this}clone(){return(new this.constructor).copy(this)}}q.UniformsGroup=Pm;class Qm extends Fh{constructor(a,b,c=1){super(a,b);this.isInstancedInterleavedBuffer=!0;this.meshPerAttribute=c}copy(a){super.copy(a);this.meshPerAttribute=a.meshPerAttribute;return this}clone(a){a=super.clone(a);a.meshPerAttribute=this.meshPerAttribute;return a}toJSON(a){a=super.toJSON(a);a.isInstancedInterleavedBuffer=!0;a.meshPerAttribute=this.meshPerAttribute;
return a}}q.InstancedInterleavedBuffer=Qm;class Rm{constructor(a,b,c,d,f){this.isGLBufferAttribute=!0;this.name="";this.buffer=a;this.type=b;this.itemSize=c;this.elementSize=d;this.count=f;this.version=0}set needsUpdate(a){!0===a&&this.version++}setBuffer(a){this.buffer=a;return this}setType(a,b){this.type=a;this.elementSize=b;return this}setItemSize(a){this.itemSize=a;return this}setCount(a){this.count=a;return this}}q.GLBufferAttribute=Rm;class Sm{constructor(a,b,c=0,d=Infinity){this.ray=new ce(a,
b);this.near=c;this.far=d;this.camera=null;this.layers=new re;this.params={Mesh:{},Line:{threshold:1},LOD:{},Points:{threshold:1},Sprite:{}}}set(a,b){this.ray.set(a,b)}setFromCamera(a,b){b.isPerspectiveCamera?(this.ray.origin.setFromMatrixPosition(b.matrixWorld),this.ray.direction.set(a.x,a.y,.5).unproject(b).sub(this.ray.origin).normalize(),this.camera=b):b.isOrthographicCamera?(this.ray.origin.set(a.x,a.y,(b.near+b.far)/(b.near-b.far)).unproject(b),this.ray.direction.set(0,0,-1).transformDirection(b.matrixWorld),
this.camera=b):console.error("THREE.Raycaster: Unsupported camera type: "+b.type)}intersectObject(a,b=!0,c=[]){bg(a,this,c,b);c.sort(mh);return c}intersectObjects(a,b=!0,c=[]){for(let d=0,f=a.length;d<f;d++)bg(a[d],this,c,b);c.sort(mh);return c}}q.Raycaster=Sm;class Tm{constructor(a=1,b=0,c=0){this.radius=a;this.phi=b;this.theta=c;return this}set(a,b,c){this.radius=a;this.phi=b;this.theta=c;return this}copy(a){this.radius=a.radius;this.phi=a.phi;this.theta=a.theta;return this}makeSafe(){this.phi=
Math.max(1E-6,Math.min(Math.PI-1E-6,this.phi));return this}setFromVector3(a){return this.setFromCartesianCoords(a.x,a.y,a.z)}setFromCartesianCoords(a,b,c){this.radius=Math.sqrt(a*a+b*b+c*c);0===this.radius?this.phi=this.theta=0:(this.theta=Math.atan2(a,c),this.phi=Math.acos(yb(b/this.radius,-1,1)));return this}clone(){return(new this.constructor).copy(this)}}q.Spherical=Tm;class Um{constructor(a=1,b=0,c=0){this.radius=a;this.theta=b;this.y=c;return this}set(a,b,c){this.radius=a;this.theta=b;this.y=
c;return this}copy(a){this.radius=a.radius;this.theta=a.theta;this.y=a.y;return this}setFromVector3(a){return this.setFromCartesianCoords(a.x,a.y,a.z)}setFromCartesianCoords(a,b,c){this.radius=Math.sqrt(a*a+c*c);this.theta=Math.atan2(a,c);this.y=b;return this}clone(){return(new this.constructor).copy(this)}}q.Cylindrical=Um;const Ll=new sa;class Vm{constructor(a=new sa(Infinity,Infinity),b=new sa(-Infinity,-Infinity)){this.isBox2=!0;this.min=a;this.max=b}set(a,b){this.min.copy(a);this.max.copy(b);
return this}setFromPoints(a){this.makeEmpty();for(let b=0,c=a.length;b<c;b++)this.expandByPoint(a[b]);return this}setFromCenterAndSize(a,b){b=Ll.copy(b).multiplyScalar(.5);this.min.copy(a).sub(b);this.max.copy(a).add(b);return this}clone(){return(new this.constructor).copy(this)}copy(a){this.min.copy(a.min);this.max.copy(a.max);return this}makeEmpty(){this.min.x=this.min.y=Infinity;this.max.x=this.max.y=-Infinity;return this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y}getCenter(a){return this.isEmpty()?
a.set(0,0):a.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(a){return this.isEmpty()?a.set(0,0):a.subVectors(this.max,this.min)}expandByPoint(a){this.min.min(a);this.max.max(a);return this}expandByVector(a){this.min.sub(a);this.max.add(a);return this}expandByScalar(a){this.min.addScalar(-a);this.max.addScalar(a);return this}containsPoint(a){return a.x<this.min.x||a.x>this.max.x||a.y<this.min.y||a.y>this.max.y?!1:!0}containsBox(a){return this.min.x<=a.min.x&&a.max.x<=this.max.x&&this.min.y<=
a.min.y&&a.max.y<=this.max.y}getParameter(a,b){return b.set((a.x-this.min.x)/(this.max.x-this.min.x),(a.y-this.min.y)/(this.max.y-this.min.y))}intersectsBox(a){return a.max.x<this.min.x||a.min.x>this.max.x||a.max.y<this.min.y||a.min.y>this.max.y?!1:!0}clampPoint(a,b){return b.copy(a).clamp(this.min,this.max)}distanceToPoint(a){return this.clampPoint(a,Ll).distanceTo(a)}intersect(a){this.min.max(a.min);this.max.min(a.max);this.isEmpty()&&this.makeEmpty();return this}union(a){this.min.min(a.min);this.max.max(a.max);
return this}translate(a){this.min.add(a);this.max.add(a);return this}equals(a){return a.min.equals(this.min)&&a.max.equals(this.max)}}q.Box2=Vm;const Ml=new O,Xh=new O;class Wm{constructor(a=new O,b=new O){this.start=a;this.end=b}set(a,b){this.start.copy(a);this.end.copy(b);return this}copy(a){this.start.copy(a.start);this.end.copy(a.end);return this}getCenter(a){return a.addVectors(this.start,this.end).multiplyScalar(.5)}delta(a){return a.subVectors(this.end,this.start)}distanceSq(){return this.start.distanceToSquared(this.end)}distance(){return this.start.distanceTo(this.end)}at(a,
b){return this.delta(b).multiplyScalar(a).add(this.start)}closestPointToPointParameter(a,b){Ml.subVectors(a,this.start);Xh.subVectors(this.end,this.start);a=Xh.dot(Xh);a=Xh.dot(Ml)/a;b&&(a=yb(a,0,1));return a}closestPointToPoint(a,b,c){a=this.closestPointToPointParameter(a,b);return this.delta(c).multiplyScalar(a).add(this.start)}applyMatrix4(a){this.start.applyMatrix4(a);this.end.applyMatrix4(a);return this}equals(a){return a.start.equals(this.start)&&a.end.equals(this.end)}clone(){return(new this.constructor).copy(this)}}
q.Line3=Wm;const Nl=new O;class Xm extends hb{constructor(a,b){super();this.light=a;this.matrix=a.matrixWorld;this.matrixAutoUpdate=!1;this.color=b;this.type="SpotLightHelper";a=new ab;b=[0,0,0,0,0,1,0,0,0,1,0,1,0,0,0,-1,0,1,0,0,0,0,1,1,0,0,0,0,-1,1];for(let c=0,d=1,f=32;c<f;c++,d++){const g=c/f*Math.PI*2,l=d/f*Math.PI*2;b.push(Math.cos(g),Math.sin(g),1,Math.cos(l),Math.sin(l),1)}a.setAttribute("position",new Oa(b,3));b=new kc({fog:!1,toneMapped:!1});this.cone=new ld(a,b);this.add(this.cone);this.update()}dispose(){this.cone.geometry.dispose();
this.cone.material.dispose()}update(){this.light.updateWorldMatrix(!0,!1);this.light.target.updateWorldMatrix(!0,!1);const a=this.light.distance?this.light.distance:1E3,b=a*Math.tan(this.light.angle);this.cone.scale.set(b,b,a);Nl.setFromMatrixPosition(this.light.target.matrixWorld);this.cone.lookAt(Nl);void 0!==this.color?this.cone.material.color.set(this.color):this.cone.material.color.copy(this.light.color)}}q.SpotLightHelper=Xm;const ke=new O,Yh=new Wa,lk=new Wa;class Ym extends ld{constructor(a){const b=
nh(a),c=new ab;var d=[];const f=[],g=new Ia(0,0,1),l=new Ia(0,1,0);for(let m=0;m<b.length;m++){const n=b[m];n.parent&&n.parent.isBone&&(d.push(0,0,0),d.push(0,0,0),f.push(g.r,g.g,g.b),f.push(l.r,l.g,l.b))}c.setAttribute("position",new Oa(d,3));c.setAttribute("color",new Oa(f,3));d=new kc({vertexColors:!0,depthTest:!1,depthWrite:!1,toneMapped:!1,transparent:!0});super(c,d);this.isSkeletonHelper=!0;this.type="SkeletonHelper";this.root=a;this.bones=b;this.matrix=a.matrixWorld;this.matrixAutoUpdate=!1}updateMatrixWorld(a){const b=
this.bones,c=this.geometry,d=c.getAttribute("position");lk.copy(this.root.matrixWorld).invert();for(let f=0,g=0;f<b.length;f++){const l=b[f];l.parent&&l.parent.isBone&&(Yh.multiplyMatrices(lk,l.matrixWorld),ke.setFromMatrixPosition(Yh),d.setXYZ(g,ke.x,ke.y,ke.z),Yh.multiplyMatrices(lk,l.parent.matrixWorld),ke.setFromMatrixPosition(Yh),d.setXYZ(g+1,ke.x,ke.y,ke.z),g+=2)}c.getAttribute("position").needsUpdate=!0;super.updateMatrixWorld(a)}dispose(){this.geometry.dispose();this.material.dispose()}}q.SkeletonHelper=
Ym;class Zm extends cb{constructor(a,b,c){b=new Vh(b,4,2);const d=new gd({wireframe:!0,fog:!1,toneMapped:!1});super(b,d);this.light=a;this.color=c;this.type="PointLightHelper";this.matrix=this.light.matrixWorld;this.matrixAutoUpdate=!1;this.update()}dispose(){this.geometry.dispose();this.material.dispose()}update(){this.light.updateWorldMatrix(!0,!1);void 0!==this.color?this.material.color.set(this.color):this.material.color.copy(this.light.color)}}q.PointLightHelper=Zm;const $m=new O,Ol=new Ia,Pl=
new Ia;class an extends hb{constructor(a,b,c){super();this.light=a;this.matrix=a.matrixWorld;this.matrixAutoUpdate=!1;this.color=c;this.type="HemisphereLightHelper";a=new Uh(b);a.rotateY(.5*Math.PI);this.material=new gd({wireframe:!0,fog:!1,toneMapped:!1});void 0===this.color&&(this.material.vertexColors=!0);b=a.getAttribute("position");b=new Float32Array(3*b.count);a.setAttribute("color",new rb(b,3));this.add(new cb(a,this.material));this.update()}dispose(){this.children[0].geometry.dispose();this.children[0].material.dispose()}update(){const a=
this.children[0];if(void 0!==this.color)this.material.color.set(this.color);else{const b=a.geometry.getAttribute("color");Ol.copy(this.light.color);Pl.copy(this.light.groundColor);for(let c=0,d=b.count;c<d;c++){const f=c<d/2?Ol:Pl;b.setXYZ(c,f.r,f.g,f.b)}b.needsUpdate=!0}this.light.updateWorldMatrix(!0,!1);a.lookAt($m.setFromMatrixPosition(this.light.matrixWorld).negate())}}q.HemisphereLightHelper=an;class bn extends ld{constructor(a=10,b=10,c=4473924,d=8947848){c=new Ia(c);d=new Ia(d);const f=b/
2,g=a/b,l=a/2;a=[];const m=[];for(let n=0,t=0,u=-l;n<=b;n++,u+=g){a.push(-l,0,u,l,0,u);a.push(u,0,-l,u,0,l);const v=n===f?c:d;v.toArray(m,t);t+=3;v.toArray(m,t);t+=3;v.toArray(m,t);t+=3;v.toArray(m,t);t+=3}b=new ab;b.setAttribute("position",new Oa(a,3));b.setAttribute("color",new Oa(m,3));c=new kc({vertexColors:!0,toneMapped:!1});super(b,c);this.type="GridHelper"}dispose(){this.geometry.dispose();this.material.dispose()}}q.GridHelper=bn;class cn extends ld{constructor(a=10,b=16,c=8,d=64,f=4473924,
g=8947848){f=new Ia(f);g=new Ia(g);var l=[];const m=[];if(1<b)for(var n=0;n<b;n++){var t=n/b*2*Math.PI,u=Math.sin(t)*a;t=Math.cos(t)*a;l.push(0,0,0);l.push(u,0,t);u=n&1?f:g;m.push(u.r,u.g,u.b);m.push(u.r,u.g,u.b)}for(b=0;b<c;b++)for(n=b&1?f:g,u=a-a/c*b,t=0;t<d;t++){var v=t/d*2*Math.PI;let A=Math.sin(v)*u;v=Math.cos(v)*u;l.push(A,0,v);m.push(n.r,n.g,n.b);v=(t+1)/d*2*Math.PI;A=Math.sin(v)*u;v=Math.cos(v)*u;l.push(A,0,v);m.push(n.r,n.g,n.b)}a=new ab;a.setAttribute("position",new Oa(l,3));a.setAttribute("color",
new Oa(m,3));l=new kc({vertexColors:!0,toneMapped:!1});super(a,l);this.type="PolarGridHelper"}dispose(){this.geometry.dispose();this.material.dispose()}}q.PolarGridHelper=cn;const Ql=new O,Zh=new O,Rl=new O;class dn extends hb{constructor(a,b,c){super();this.light=a;this.matrix=a.matrixWorld;this.matrixAutoUpdate=!1;this.color=c;this.type="DirectionalLightHelper";void 0===b&&(b=1);a=new ab;a.setAttribute("position",new Oa([-b,b,0,b,b,0,b,-b,0,-b,-b,0,-b,b,0],3));b=new kc({fog:!1,toneMapped:!1});this.lightPlane=
new ie(a,b);this.add(this.lightPlane);a=new ab;a.setAttribute("position",new Oa([0,0,0,0,0,1],3));this.targetLine=new ie(a,b);this.add(this.targetLine);this.update()}dispose(){this.lightPlane.geometry.dispose();this.lightPlane.material.dispose();this.targetLine.geometry.dispose();this.targetLine.material.dispose()}update(){this.light.updateWorldMatrix(!0,!1);this.light.target.updateWorldMatrix(!0,!1);Ql.setFromMatrixPosition(this.light.matrixWorld);Zh.setFromMatrixPosition(this.light.target.matrixWorld);
Rl.subVectors(Zh,Ql);this.lightPlane.lookAt(Zh);void 0!==this.color?(this.lightPlane.material.color.set(this.color),this.targetLine.material.color.set(this.color)):(this.lightPlane.material.color.copy(this.light.color),this.targetLine.material.color.copy(this.light.color));this.targetLine.lookAt(Zh);this.targetLine.scale.z=Rl.length()}}q.DirectionalLightHelper=dn;const oh=new O,Jb=new vf;class en extends ld{constructor(a){function b(u,v){c(u);c(v)}function c(u){g.push(0,0,0);l.push(0,0,0);void 0===
m[u]&&(m[u]=[]);m[u].push(g.length/3-1)}var d=new ab,f=new kc({color:16777215,vertexColors:!0,toneMapped:!1});const g=[],l=[],m={};b("n1","n2");b("n2","n4");b("n4","n3");b("n3","n1");b("f1","f2");b("f2","f4");b("f4","f3");b("f3","f1");b("n1","f1");b("n2","f2");b("n3","f3");b("n4","f4");b("p","n1");b("p","n2");b("p","n3");b("p","n4");b("u1","u2");b("u2","u3");b("u3","u1");b("c","t");b("p","c");b("cn1","cn2");b("cn3","cn4");b("cf1","cf2");b("cf3","cf4");d.setAttribute("position",new Oa(g,3));d.setAttribute("color",
new Oa(l,3));super(d,f);this.type="CameraHelper";this.camera=a;this.camera.updateProjectionMatrix&&this.camera.updateProjectionMatrix();this.matrix=a.matrixWorld;this.matrixAutoUpdate=!1;this.pointMap=m;this.update();a=new Ia(16755200);d=new Ia(16711680);f=new Ia(43775);const n=new Ia(16777215),t=new Ia(3355443);this.setColors(a,d,f,n,t)}setColors(a,b,c,d,f){const g=this.geometry.getAttribute("color");g.setXYZ(0,a.r,a.g,a.b);g.setXYZ(1,a.r,a.g,a.b);g.setXYZ(2,a.r,a.g,a.b);g.setXYZ(3,a.r,a.g,a.b);
g.setXYZ(4,a.r,a.g,a.b);g.setXYZ(5,a.r,a.g,a.b);g.setXYZ(6,a.r,a.g,a.b);g.setXYZ(7,a.r,a.g,a.b);g.setXYZ(8,a.r,a.g,a.b);g.setXYZ(9,a.r,a.g,a.b);g.setXYZ(10,a.r,a.g,a.b);g.setXYZ(11,a.r,a.g,a.b);g.setXYZ(12,a.r,a.g,a.b);g.setXYZ(13,a.r,a.g,a.b);g.setXYZ(14,a.r,a.g,a.b);g.setXYZ(15,a.r,a.g,a.b);g.setXYZ(16,a.r,a.g,a.b);g.setXYZ(17,a.r,a.g,a.b);g.setXYZ(18,a.r,a.g,a.b);g.setXYZ(19,a.r,a.g,a.b);g.setXYZ(20,a.r,a.g,a.b);g.setXYZ(21,a.r,a.g,a.b);g.setXYZ(22,a.r,a.g,a.b);g.setXYZ(23,a.r,a.g,a.b);g.setXYZ(24,
b.r,b.g,b.b);g.setXYZ(25,b.r,b.g,b.b);g.setXYZ(26,b.r,b.g,b.b);g.setXYZ(27,b.r,b.g,b.b);g.setXYZ(28,b.r,b.g,b.b);g.setXYZ(29,b.r,b.g,b.b);g.setXYZ(30,b.r,b.g,b.b);g.setXYZ(31,b.r,b.g,b.b);g.setXYZ(32,c.r,c.g,c.b);g.setXYZ(33,c.r,c.g,c.b);g.setXYZ(34,c.r,c.g,c.b);g.setXYZ(35,c.r,c.g,c.b);g.setXYZ(36,c.r,c.g,c.b);g.setXYZ(37,c.r,c.g,c.b);g.setXYZ(38,d.r,d.g,d.b);g.setXYZ(39,d.r,d.g,d.b);g.setXYZ(40,f.r,f.g,f.b);g.setXYZ(41,f.r,f.g,f.b);g.setXYZ(42,f.r,f.g,f.b);g.setXYZ(43,f.r,f.g,f.b);g.setXYZ(44,f.r,
f.g,f.b);g.setXYZ(45,f.r,f.g,f.b);g.setXYZ(46,f.r,f.g,f.b);g.setXYZ(47,f.r,f.g,f.b);g.setXYZ(48,f.r,f.g,f.b);g.setXYZ(49,f.r,f.g,f.b);g.needsUpdate=!0}update(){const a=this.geometry,b=this.pointMap;Jb.projectionMatrixInverse.copy(this.camera.projectionMatrixInverse);Eb("c",b,a,Jb,0,0,-1);Eb("t",b,a,Jb,0,0,1);Eb("n1",b,a,Jb,-1,-1,-1);Eb("n2",b,a,Jb,1,-1,-1);Eb("n3",b,a,Jb,-1,1,-1);Eb("n4",b,a,Jb,1,1,-1);Eb("f1",b,a,Jb,-1,-1,1);Eb("f2",b,a,Jb,1,-1,1);Eb("f3",b,a,Jb,-1,1,1);Eb("f4",b,a,Jb,1,1,1);Eb("u1",
b,a,Jb,.7,1.1,-1);Eb("u2",b,a,Jb,-.7,1.1,-1);Eb("u3",b,a,Jb,0,2,-1);Eb("cf1",b,a,Jb,-1,0,1);Eb("cf2",b,a,Jb,1,0,1);Eb("cf3",b,a,Jb,0,-1,1);Eb("cf4",b,a,Jb,0,1,1);Eb("cn1",b,a,Jb,-1,0,-1);Eb("cn2",b,a,Jb,1,0,-1);Eb("cn3",b,a,Jb,0,-1,-1);Eb("cn4",b,a,Jb,0,1,-1);a.getAttribute("position").needsUpdate=!0}dispose(){this.geometry.dispose();this.material.dispose()}}q.CameraHelper=en;const $h=new Jc;class fn extends ld{constructor(a,b=16776960){const c=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,
1,5,2,6,3,7]),d=new Float32Array(24),f=new ab;f.setIndex(new rb(c,1));f.setAttribute("position",new rb(d,3));super(f,new kc({color:b,toneMapped:!1}));this.object=a;this.type="BoxHelper";this.matrixAutoUpdate=!1;this.update()}update(a){void 0!==a&&console.warn("THREE.BoxHelper: .update() has no longer arguments.");void 0!==this.object&&$h.setFromObject(this.object);if(!$h.isEmpty()){a=$h.min;var b=$h.max,c=this.geometry.attributes.position,d=c.array;d[0]=b.x;d[1]=b.y;d[2]=b.z;d[3]=a.x;d[4]=b.y;d[5]=
b.z;d[6]=a.x;d[7]=a.y;d[8]=b.z;d[9]=b.x;d[10]=a.y;d[11]=b.z;d[12]=b.x;d[13]=b.y;d[14]=a.z;d[15]=a.x;d[16]=b.y;d[17]=a.z;d[18]=a.x;d[19]=a.y;d[20]=a.z;d[21]=b.x;d[22]=a.y;d[23]=a.z;c.needsUpdate=!0;this.geometry.computeBoundingSphere()}}setFromObject(a){this.object=a;this.update();return this}copy(a,b){super.copy(a,b);this.object=a.object;return this}dispose(){this.geometry.dispose();this.material.dispose()}}q.BoxHelper=fn;class gn extends ld{constructor(a,b=16776960){const c=new Uint16Array([0,1,
1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]),d=new ab;d.setIndex(new rb(c,1));d.setAttribute("position",new Oa([1,1,1,-1,1,1,-1,-1,1,1,-1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1],3));super(d,new kc({color:b,toneMapped:!1}));this.box=a;this.type="Box3Helper";this.geometry.computeBoundingSphere()}updateMatrixWorld(a){const b=this.box;b.isEmpty()||(b.getCenter(this.position),b.getSize(this.scale),this.scale.multiplyScalar(.5),super.updateMatrixWorld(a))}dispose(){this.geometry.dispose();this.material.dispose()}}
q.Box3Helper=gn;class hn extends ie{constructor(a,b=1,c=16776960){const d=new ab;d.setAttribute("position",new Oa([1,-1,0,-1,1,0,-1,-1,0,1,1,0,-1,1,0,-1,-1,0,1,-1,0,1,1,0],3));d.computeBoundingSphere();super(d,new kc({color:c,toneMapped:!1}));this.type="PlaneHelper";this.plane=a;this.size=b;a=new ab;a.setAttribute("position",new Oa([1,1,0,-1,1,0,-1,-1,0,1,1,0,-1,-1,0,1,-1,0],3));a.computeBoundingSphere();this.add(new cb(a,new gd({color:c,opacity:.2,transparent:!0,depthWrite:!1,toneMapped:!1})))}updateMatrixWorld(a){this.position.set(0,
0,0);this.scale.set(.5*this.size,.5*this.size,1);this.lookAt(this.plane.normal);this.translateZ(-this.plane.constant);super.updateMatrixWorld(a)}dispose(){this.geometry.dispose();this.material.dispose();this.children[0].geometry.dispose();this.children[0].material.dispose()}}q.PlaneHelper=hn;const Sl=new O;let ai,mk;class jn extends hb{constructor(a=new O(0,0,1),b=new O(0,0,0),c=1,d=16776960,f=.2*c,g=.2*f){super();this.type="ArrowHelper";void 0===ai&&(ai=new ab,ai.setAttribute("position",new Oa([0,
0,0,0,1,0],3)),mk=new yg(0,.5,1,5,1),mk.translate(0,-.5,0));this.position.copy(b);this.line=new ie(ai,new kc({color:d,toneMapped:!1}));this.line.matrixAutoUpdate=!1;this.add(this.line);this.cone=new cb(mk,new gd({color:d,toneMapped:!1}));this.cone.matrixAutoUpdate=!1;this.add(this.cone);this.setDirection(a);this.setLength(c,f,g)}setDirection(a){.99999<a.y?this.quaternion.set(0,0,0,1):-.99999>a.y?this.quaternion.set(1,0,0,0):(Sl.set(a.z,0,-a.x).normalize(),this.quaternion.setFromAxisAngle(Sl,Math.acos(a.y)))}setLength(a,
b=.2*a,c=.2*b){this.line.scale.set(1,Math.max(1E-4,a-b),1);this.line.updateMatrix();this.cone.scale.set(c,b,c);this.cone.position.y=a;this.cone.updateMatrix()}setColor(a){this.line.material.color.set(a);this.cone.material.color.set(a)}copy(a){super.copy(a,!1);this.line.copy(a.line);this.cone.copy(a.cone);return this}dispose(){this.line.geometry.dispose();this.line.material.dispose();this.cone.geometry.dispose();this.cone.material.dispose()}}q.ArrowHelper=jn;class kn extends ld{constructor(a=1){var b=
[0,0,0,a,0,0,0,0,0,0,a,0,0,0,0,0,0,a];a=new ab;a.setAttribute("position",new Oa(b,3));a.setAttribute("color",new Oa([1,0,0,1,.6,0,0,1,0,.6,1,0,0,0,1,0,.6,1],3));b=new kc({vertexColors:!0,toneMapped:!1});super(a,b);this.type="AxesHelper"}setColors(a,b,c){const d=new Ia,f=this.geometry.attributes.color.array;d.set(a);d.toArray(f,0);d.toArray(f,3);d.set(b);d.toArray(f,6);d.toArray(f,9);d.set(c);d.toArray(f,12);d.toArray(f,15);this.geometry.attributes.color.needsUpdate=!0;return this}dispose(){this.geometry.dispose();
this.material.dispose()}}q.AxesHelper=kn;class ln{constructor(){this.type="ShapePath";this.color=new Ia;this.subPaths=[];this.currentPath=null}moveTo(a,b){this.currentPath=new xg;this.subPaths.push(this.currentPath);this.currentPath.moveTo(a,b);return this}lineTo(a,b){this.currentPath.lineTo(a,b);return this}quadraticCurveTo(a,b,c,d){this.currentPath.quadraticCurveTo(a,b,c,d);return this}bezierCurveTo(a,b,c,d,f,g){this.currentPath.bezierCurveTo(a,b,c,d,f,g);return this}splineThru(a){this.currentPath.splineThru(a);
return this}toShapes(a){function b(D){const E=[];for(let y=0,J=D.length;y<J;y++){const L=D[y],U=new Ge;U.curves=L.curves;E.push(U)}return E}function c(D,E){const y=E.length;let J=!1;for(let U=y-1,P=0;P<y;U=P++){var L=E[U];let X=E[P],ja=X.x-L.x,fa=X.y-L.y;if(Math.abs(fa)>Number.EPSILON){if(0>fa&&(L=E[P],ja=-ja,X=E[U],fa=-fa),!(D.y<L.y||D.y>X.y))if(D.y===L.y){if(D.x===L.x)return!0}else{L=fa*(D.x-L.x)-ja*(D.y-L.y);if(0===L)return!0;0>L||(J=!J)}}else if(D.y===L.y&&(X.x<=D.x&&D.x<=L.x||L.x<=D.x&&D.x<=
X.x))return!0}return J}var d=Dd.isClockWise,f=this.subPaths;if(0===f.length)return[];const g=[];if(1===f.length){var l=f[0];var m=new Ge;m.curves=l.curves;g.push(m);return g}var n=!d(f[0].getPoints());n=a?!n:n;m=[];const t=[];let u=[];var v=0;let A;t[v]=void 0;u[v]=[];for(let D=0,E=f.length;D<E;D++){l=f[D];A=l.getPoints();var F=d(A);(F=a?!F:F)?(!n&&t[v]&&v++,t[v]={s:new Ge,p:A},t[v].s.curves=l.curves,n&&v++,u[v]=[]):u[v].push({h:l,p:A[0]})}if(!t[0])return b(f);if(1<t.length){l=!1;a=0;for(let D=0,
E=t.length;D<E;D++)m[D]=[];for(let D=0,E=t.length;D<E;D++)for(d=u[D],f=0;f<d.length;f++){F=d[f];n=!0;for(v=0;v<t.length;v++)c(F.p,t[v].p)&&(D!==v&&a++,n?(n=!1,m[v].push(F)):l=!0);n&&m[D].push(F)}0<a&&!1===l&&(u=m)}for(let D=0,E=t.length;D<E;D++){m=t[D].s;g.push(m);l=u[D];for(let y=0,J=l.length;y<J;y++)m.holes.push(l[y].h)}return g}}q.ShapePath=ln;"undefined"!==typeof __THREE_DEVTOOLS__&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("register",{detail:{revision:"158"}}));"undefined"!==typeof window&&
(window.__THREE__?console.warn("WARNING: Multiple instances of Three.js being imported."):window.__THREE__="158")};
shadow$provide[1]=function(Tl,Ul,Vl,q){function $b(e,h,k){const p=Wd,r=sa,x=Za,z=cg;h.vsub(e.position,p);p.cross(k,r);e.invInertiaWorld.vmult(r,z);z.cross(p,x);return e.invMass+k.dot(x)}function yb(e){const h=e.length;for(let k=0;k!==h;k++){const p=e[k];if(!(p.visited||p.body.type&of))return p}return!1}function Gf(e,h,k){h.push(e.body);h=e.eqs.length;for(let p=0;p!==h;p++){const r=e.eqs[p];k.includes(r)||k.push(r)}}function le(e,h){return h.id-e.id}Object.defineProperty(q,"__esModule",{value:!0});
q.World=q.WheelInfo=q.Vec3Pool=q.Vec3=q.Trimesh=q.Transform=q.Spring=q.SplitSolver=q.Sphere=q.Solver=q.Shape=q.SPHSystem=q.SHAPE_TYPES=q.SAPBroadphase=q.RotationalMotorEquation=q.RotationalEquation=q.RigidVehicle=q.RaycastVehicle=q.RaycastResult=q.Ray=q.RAY_MODES=q.Quaternion=q.Pool=q.PointToPointConstraint=q.Plane=q.Particle=q.ObjectCollisionMatrix=q.Narrowphase=q.NaiveBroadphase=q.Material=q.Mat3=q.LockConstraint=q.JacobianElement=q.HingeConstraint=q.Heightfield=q.GridBroadphase=q.GSSolver=q.FrictionEquation=
q.EventTarget=q.Equation=q.DistanceConstraint=q.Cylinder=q.ConvexPolyhedron=q.ContactMaterial=q.ContactEquation=q.Constraint=q.ConeTwistConstraint=q.COLLISION_TYPES=q.Broadphase=q.Box=q.Body=q.BODY_TYPES=q.BODY_SLEEP_STATES=q.ArrayCollisionMatrix=q.AABB=void 0;class Hf{constructor(){this.matrix={}}get(e,h){({id:e}=e);({id:h}=h);if(h>e){const k=h;h=e;e=k}return`${e}-${h}`in this.matrix}set(e,h,k){({id:e}=e);({id:h}=h);if(h>e){const p=h;h=e;e=p}k?this.matrix[`${e}-${h}`]=!0:delete this.matrix[`${e}-${h}`]}reset(){this.matrix=
{}}setNumObjects(e){}}q.ObjectCollisionMatrix=Hf;class lc{constructor(e){void 0===e&&(e=[0,0,0,0,0,0,0,0,0]);this.elements=e}identity(){const e=this.elements;e[0]=1;e[1]=0;e[2]=0;e[3]=0;e[4]=1;e[5]=0;e[6]=0;e[7]=0;e[8]=1}setZero(){const e=this.elements;e[0]=0;e[1]=0;e[2]=0;e[3]=0;e[4]=0;e[5]=0;e[6]=0;e[7]=0;e[8]=0}setTrace(e){const h=this.elements;h[0]=e.x;h[4]=e.y;h[8]=e.z}getTrace(e){void 0===e&&(e=new B);const h=this.elements;e.x=h[0];e.y=h[4];e.z=h[8];return e}vmult(e,h){void 0===h&&(h=new B);
const k=this.elements,p=e.x,r=e.y;e=e.z;h.x=k[0]*p+k[1]*r+k[2]*e;h.y=k[3]*p+k[4]*r+k[5]*e;h.z=k[6]*p+k[7]*r+k[8]*e;return h}smult(e){for(let h=0;h<this.elements.length;h++)this.elements[h]*=e}mmult(e,h){void 0===h&&(h=new lc);var k=this.elements,p=e.elements;e=h.elements;const r=k[0],x=k[1],z=k[2],w=k[3],C=k[4],K=k[5],R=k[6],M=k[7];k=k[8];const V=p[0],T=p[1],W=p[2],S=p[3],ea=p[4],ha=p[5],ya=p[6],za=p[7];p=p[8];e[0]=r*V+x*S+z*ya;e[1]=r*T+x*ea+z*za;e[2]=r*W+x*ha+z*p;e[3]=w*V+C*S+K*ya;e[4]=w*T+C*ea+
K*za;e[5]=w*W+C*ha+K*p;e[6]=R*V+M*S+k*ya;e[7]=R*T+M*ea+k*za;e[8]=R*W+M*ha+k*p;return h}scale(e,h){void 0===h&&(h=new lc);const k=this.elements,p=h.elements;for(let r=0;3!==r;r++)p[3*r]=e.x*k[3*r],p[3*r+1]=e.y*k[3*r+1],p[3*r+2]=e.z*k[3*r+2];return h}solve(e,h){void 0===h&&(h=new B);const k=[];let p,r;for(p=0;12>p;p++)k.push(0);for(p=0;3>p;p++)for(r=0;3>r;r++)k[p+4*r]=this.elements[p+3*r];k[3]=e.x;k[7]=e.y;k[11]=e.z;let x=3;const z=x;let w,C;do{p=z-x;if(0===k[p+4*p])for(r=p+1;r<z;r++)if(0!==k[p+4*r]){w=
4;do C=4-w,k[C+4*p]+=k[C+4*r];while(--w);break}if(0!==k[p+4*p])for(r=p+1;r<z;r++){const K=k[p+4*r]/k[p+4*p];w=4;do C=4-w,k[C+4*r]=C<=p?0:k[C+4*r]-k[C+4*p]*K;while(--w)}}while(--x);h.z=k[11]/k[10];h.y=(k[7]-k[6]*h.z)/k[5];h.x=(k[3]-k[2]*h.z-k[1]*h.y)/k[0];if(isNaN(h.x)||isNaN(h.y)||isNaN(h.z)||Infinity===h.x||Infinity===h.y||Infinity===h.z)throw`Could not solve equation! Got x=[${h.toString()}], b=[${e.toString()}], A=[${this.toString()}]`;return h}e(e,h,k){if(void 0===k)return this.elements[h+3*e];
this.elements[h+3*e]=k}copy(e){for(let h=0;h<e.elements.length;h++)this.elements[h]=e.elements[h];return this}toString(){let e="";for(let h=0;9>h;h++)e+=this.elements[h]+",";return e}reverse(e){void 0===e&&(e=new lc);const h=Ne;let k;var p;for(k=0;3>k;k++)for(p=0;3>p;p++)h[k+6*p]=this.elements[k+3*p];h[3]=1;h[9]=0;h[15]=0;h[4]=0;h[10]=1;h[16]=0;h[5]=0;h[11]=0;h[17]=1;var r=3;const x=r;let z,w;do{k=x-r;if(0===h[k+6*k])for(p=k+1;p<x;p++)if(0!==h[k+6*p]){z=6;do w=6-z,h[w+6*k]+=h[w+6*p];while(--z);break}if(0!==
h[k+6*k])for(p=k+1;p<x;p++){const C=h[k+6*p]/h[k+6*k];z=6;do w=6-z,h[w+6*p]=w<=k?0:h[w+6*p]-h[w+6*k]*C;while(--z)}}while(--r);k=2;do{p=k-1;do{r=h[k+6*p]/h[k+6*k];z=6;do w=6-z,h[w+6*p]-=h[w+6*k]*r;while(--z)}while(p--)}while(--k);k=2;do{p=1/h[k+6*k];z=6;do w=6-z,h[w+6*k]*=p;while(--z)}while(k--);k=2;do{p=2;do{w=h[3+p+6*k];if(isNaN(w)||Infinity===w)throw`Could not reverse! A=[${this.toString()}]`;e.e(k,p,w)}while(p--)}while(k--);return e}setRotationFromQuaternion(e){var h=e.x,k=e.y,p=e.z,r=e.w,x=h+
h,z=k+k,w=p+p;e=h*x;const C=h*z;h*=w;const K=k*z;k*=w;p*=w;x*=r;z*=r;r*=w;w=this.elements;w[0]=1-(K+p);w[1]=C-r;w[2]=h+z;w[3]=C+r;w[4]=1-(e+p);w[5]=k-x;w[6]=h-z;w[7]=k+x;w[8]=1-(e+K);return this}transpose(e){void 0===e&&(e=new lc);const h=this.elements,k=e.elements;let p;k[0]=h[0];k[4]=h[4];k[8]=h[8];p=h[1];k[1]=h[3];k[3]=p;p=h[2];k[2]=h[6];k[6]=p;p=h[5];k[5]=h[7];k[7]=p;return e}}q.Mat3=lc;const Ne=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];class B{constructor(e,h,k){void 0===e&&(e=0);void 0===h&&(h=
0);void 0===k&&(k=0);this.x=e;this.y=h;this.z=k}cross(e,h){void 0===h&&(h=new B);const k=e.x,p=e.y;e=e.z;const r=this.x,x=this.y,z=this.z;h.x=x*e-z*p;h.y=z*k-r*e;h.z=r*p-x*k;return h}set(e,h,k){this.x=e;this.y=h;this.z=k;return this}setZero(){this.x=this.y=this.z=0}vadd(e,h){if(h)h.x=e.x+this.x,h.y=e.y+this.y,h.z=e.z+this.z;else return new B(this.x+e.x,this.y+e.y,this.z+e.z)}vsub(e,h){if(h)h.x=this.x-e.x,h.y=this.y-e.y,h.z=this.z-e.z;else return new B(this.x-e.x,this.y-e.y,this.z-e.z)}crossmat(){return new lc([0,
-this.z,this.y,this.z,0,-this.x,-this.y,this.x,0])}normalize(){var e=this.x,h=this.y;const k=this.z;e=Math.sqrt(e*e+h*h+k*k);0<e?(h=1/e,this.x*=h,this.y*=h,this.z*=h):this.z=this.y=this.x=0;return e}unit(e){void 0===e&&(e=new B);const h=this.x,k=this.y,p=this.z;let r=Math.sqrt(h*h+k*k+p*p);0<r?(r=1/r,e.x=h*r,e.y=k*r,e.z=p*r):(e.x=1,e.y=0,e.z=0);return e}length(){const e=this.x,h=this.y,k=this.z;return Math.sqrt(e*e+h*h+k*k)}lengthSquared(){return this.dot(this)}distanceTo(e){const h=this.x,k=this.y,
p=this.z,r=e.x,x=e.y;e=e.z;return Math.sqrt((r-h)*(r-h)+(x-k)*(x-k)+(e-p)*(e-p))}distanceSquared(e){const h=this.x,k=this.y,p=this.z,r=e.x,x=e.y;e=e.z;return(r-h)*(r-h)+(x-k)*(x-k)+(e-p)*(e-p)}scale(e,h){void 0===h&&(h=new B);const k=this.y,p=this.z;h.x=e*this.x;h.y=e*k;h.z=e*p;return h}vmul(e,h){void 0===h&&(h=new B);h.x=e.x*this.x;h.y=e.y*this.y;h.z=e.z*this.z;return h}addScaledVector(e,h,k){void 0===k&&(k=new B);k.x=this.x+e*h.x;k.y=this.y+e*h.y;k.z=this.z+e*h.z;return k}dot(e){return this.x*e.x+
this.y*e.y+this.z*e.z}isZero(){return 0===this.x&&0===this.y&&0===this.z}negate(e){void 0===e&&(e=new B);e.x=-this.x;e.y=-this.y;e.z=-this.z;return e}tangents(e,h){var k=this.length();if(0<k){const p=Xa;k=1/k;p.set(this.x*k,this.y*k,this.z*k);k=Dg;.9>Math.abs(p.x)?k.set(1,0,0):k.set(0,1,0);p.cross(k,e);p.cross(e,h)}else e.set(1,0,0),h.set(0,1,0)}toString(){return`${this.x},${this.y},${this.z}`}toArray(){return[this.x,this.y,this.z]}copy(e){this.x=e.x;this.y=e.y;this.z=e.z;return this}lerp(e,h,k){const p=
this.x,r=this.y,x=this.z;k.x=p+(e.x-p)*h;k.y=r+(e.y-r)*h;k.z=x+(e.z-x)*h}almostEquals(e,h){void 0===h&&(h=1E-6);return Math.abs(this.x-e.x)>h||Math.abs(this.y-e.y)>h||Math.abs(this.z-e.z)>h?!1:!0}almostZero(e){void 0===e&&(e=1E-6);return Math.abs(this.x)>e||Math.abs(this.y)>e||Math.abs(this.z)>e?!1:!0}isAntiparallelTo(e,h){this.negate(md);return md.almostEquals(e,h)}clone(){return new B(this.x,this.y,this.z)}}q.Vec3=B;B.ZERO=new B(0,0,0);B.UNIT_X=new B(1,0,0);B.UNIT_Y=new B(0,1,0);B.UNIT_Z=new B(0,
0,1);const Xa=new B,Dg=new B,md=new B;class tb{constructor(e){void 0===e&&(e={});this.lowerBound=new B;this.upperBound=new B;e.lowerBound&&this.lowerBound.copy(e.lowerBound);e.upperBound&&this.upperBound.copy(e.upperBound)}setFromPoints(e,h,k,p){const r=this.lowerBound,x=this.upperBound;r.copy(e[0]);k&&k.vmult(r,r);x.copy(r);for(let z=1;z<e.length;z++){let w=e[z];k&&(k.vmult(w,Gd),w=Gd);w.x>x.x&&(x.x=w.x);w.x<r.x&&(r.x=w.x);w.y>x.y&&(x.y=w.y);w.y<r.y&&(r.y=w.y);w.z>x.z&&(x.z=w.z);w.z<r.z&&(r.z=w.z)}h&&
(h.vadd(r,r),h.vadd(x,x));p&&(r.x-=p,r.y-=p,r.z-=p,x.x+=p,x.y+=p,x.z+=p);return this}copy(e){this.lowerBound.copy(e.lowerBound);this.upperBound.copy(e.upperBound);return this}clone(){return(new tb).copy(this)}extend(e){this.lowerBound.x=Math.min(this.lowerBound.x,e.lowerBound.x);this.upperBound.x=Math.max(this.upperBound.x,e.upperBound.x);this.lowerBound.y=Math.min(this.lowerBound.y,e.lowerBound.y);this.upperBound.y=Math.max(this.upperBound.y,e.upperBound.y);this.lowerBound.z=Math.min(this.lowerBound.z,
e.lowerBound.z);this.upperBound.z=Math.max(this.upperBound.z,e.upperBound.z)}overlaps(e){const h=this.lowerBound,k=this.upperBound,p=e.lowerBound;e=e.upperBound;const r=p.y<=k.y&&k.y<=e.y||h.y<=e.y&&e.y<=k.y,x=p.z<=k.z&&k.z<=e.z||h.z<=e.z&&e.z<=k.z;return(p.x<=k.x&&k.x<=e.x||h.x<=e.x&&e.x<=k.x)&&r&&x}volume(){const e=this.lowerBound,h=this.upperBound;return(h.x-e.x)*(h.y-e.y)*(h.z-e.z)}contains(e){const h=this.lowerBound,k=this.upperBound,p=e.lowerBound;e=e.upperBound;return h.x<=p.x&&k.x>=e.x&&h.y<=
p.y&&k.y>=e.y&&h.z<=p.z&&k.z>=e.z}getCorners(e,h,k,p,r,x,z,w){const C=this.lowerBound,K=this.upperBound;e.copy(C);h.set(K.x,C.y,C.z);k.set(K.x,K.y,C.z);p.set(C.x,K.y,K.z);r.set(K.x,C.y,K.z);x.set(C.x,K.y,C.z);z.set(C.x,C.y,K.z);w.copy(K)}toLocalFrame(e,h){const k=nd;this.getCorners(k[0],k[1],k[2],k[3],k[4],k[5],k[6],k[7]);for(let p=0;8!==p;p++){const r=k[p];e.pointToLocal(r,r)}return h.setFromPoints(k)}toWorldFrame(e,h){const k=nd;this.getCorners(k[0],k[1],k[2],k[3],k[4],k[5],k[6],k[7]);for(let p=
0;8!==p;p++){const r=k[p];e.pointToWorld(r,r)}return h.setFromPoints(k)}overlapsRay(e){const {direction:h,from:k}=e;var p=1/h.x,r=1/h.y,x=1/h.z;e=(this.lowerBound.x-k.x)*p;p*=this.upperBound.x-k.x;const z=(this.lowerBound.y-k.y)*r;r*=this.upperBound.y-k.y;const w=(this.lowerBound.z-k.z)*x;x*=this.upperBound.z-k.z;const C=Math.min(Math.min(Math.max(e,p),Math.max(z,r)),Math.max(w,x));return 0>C||Math.max(Math.max(Math.min(e,p),Math.min(z,r)),Math.min(w,x))>C?!1:!0}}q.AABB=tb;const Gd=new B,nd=[new B,
new B,new B,new B,new B,new B,new B,new B];class me{constructor(){this.matrix=[]}get(e,h){({index:e}=e);({index:h}=h);if(h>e){const k=h;h=e;e=k}return this.matrix[(e*(e+1)>>1)+h-1]}set(e,h,k){({index:e}=e);({index:h}=h);if(h>e){const p=h;h=e;e=p}this.matrix[(e*(e+1)>>1)+h-1]=k?1:0}reset(){for(let e=0,h=this.matrix.length;e!==h;e++)this.matrix[e]=0}setNumObjects(e){this.matrix.length=e*(e-1)>>1}}q.ArrayCollisionMatrix=me;class ne{addEventListener(e,h){void 0===this._listeners&&(this._listeners={});
const k=this._listeners;void 0===k[e]&&(k[e]=[]);k[e].includes(h)||k[e].push(h);return this}hasEventListener(e,h){if(void 0===this._listeners)return!1;const k=this._listeners;return void 0!==k[e]&&k[e].includes(h)?!0:!1}hasAnyEventListener(e){return void 0===this._listeners?!1:void 0!==this._listeners[e]}removeEventListener(e,h){if(void 0===this._listeners)return this;const k=this._listeners;if(void 0===k[e])return this;h=k[e].indexOf(h);-1!==h&&k[e].splice(h,1);return this}dispatchEvent(e){if(void 0===
this._listeners)return this;const h=this._listeners[e.type];if(void 0!==h){e.target=this;for(let k=0,p=h.length;k<p;k++)h[k].call(this,e)}return this}}q.EventTarget=ne;class xb{constructor(e,h,k,p){void 0===e&&(e=0);void 0===h&&(h=0);void 0===k&&(k=0);void 0===p&&(p=1);this.x=e;this.y=h;this.z=k;this.w=p}set(e,h,k,p){this.x=e;this.y=h;this.z=k;this.w=p;return this}toString(){return`${this.x},${this.y},${this.z},${this.w}`}toArray(){return[this.x,this.y,this.z,this.w]}setFromAxisAngle(e,h){const k=
Math.sin(.5*h);this.x=e.x*k;this.y=e.y*k;this.z=e.z*k;this.w=Math.cos(.5*h);return this}toAxisAngle(e){void 0===e&&(e=new B);this.normalize();const h=2*Math.acos(this.w),k=Math.sqrt(1-this.w*this.w);.001>k?(e.x=this.x,e.y=this.y,e.z=this.z):(e.x=this.x/k,e.y=this.y/k,e.z=this.z/k);return[e,h]}setFromVectors(e,h){if(e.isAntiparallelTo(h))h=Jf,e.tangents(h,ac),this.setFromAxisAngle(h,Math.PI);else{const k=e.cross(h);this.x=k.x;this.y=k.y;this.z=k.z;this.w=Math.sqrt(e.length()**2*h.length()**2)+e.dot(h);
this.normalize()}return this}mult(e,h){void 0===h&&(h=new xb);const k=this.x,p=this.y,r=this.z,x=this.w,z=e.x,w=e.y,C=e.z;e=e.w;h.x=k*e+x*z+p*C-r*w;h.y=p*e+x*w+r*z-k*C;h.z=r*e+x*C+k*w-p*z;h.w=x*e-k*z-p*w-r*C;return h}inverse(e){void 0===e&&(e=new xb);var h=this.x;const k=this.y,p=this.z,r=this.w;this.conjugate(e);h=1/(h*h+k*k+p*p+r*r);e.x*=h;e.y*=h;e.z*=h;e.w*=h;return e}conjugate(e){void 0===e&&(e=new xb);e.x=-this.x;e.y=-this.y;e.z=-this.z;e.w=this.w;return e}normalize(){let e=Math.sqrt(this.x*
this.x+this.y*this.y+this.z*this.z+this.w*this.w);0===e?this.w=this.z=this.y=this.x=0:(e=1/e,this.x*=e,this.y*=e,this.z*=e,this.w*=e);return this}normalizeFast(){const e=(3-(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w))/2;0===e?this.w=this.z=this.y=this.x=0:(this.x*=e,this.y*=e,this.z*=e,this.w*=e);return this}vmult(e,h){void 0===h&&(h=new B);var k=e.x;const p=e.y,r=e.z;e=this.x;const x=this.y,z=this.z,w=this.w,C=w*k+x*r-z*p,K=w*p+z*k-e*r,R=w*r+e*p-x*k;k=-e*k-x*p-z*r;h.x=C*w+k*-e+K*-z-
R*-x;h.y=K*w+k*-x+R*-e-C*-z;h.z=R*w+k*-z+C*-x-K*-e;return h}copy(e){this.x=e.x;this.y=e.y;this.z=e.z;this.w=e.w;return this}toEuler(e,h){void 0===h&&(h="YZX");let k,p;const r=this.x,x=this.y,z=this.z,w=this.w;switch(h){case "YZX":h=r*x+z*w;if(.499<h){k=2*Math.atan2(r,w);p=Math.PI/2;var C=0}-.499>h&&(k=-2*Math.atan2(r,w),p=-Math.PI/2,C=0);void 0===k&&(C=z*z,k=Math.atan2(2*x*w-2*r*z,1-2*x*x-2*C),p=Math.asin(2*h),C=Math.atan2(2*r*w-2*x*z,1-2*r*r-2*C));break;default:throw Error(`Euler order ${h} not supported yet.`);
}e.y=k;e.z=p;e.x=C}setFromEuler(e,h,k,p){void 0===p&&(p="XYZ");const r=Math.cos(e/2),x=Math.cos(h/2),z=Math.cos(k/2);e=Math.sin(e/2);h=Math.sin(h/2);k=Math.sin(k/2);"XYZ"===p?(this.x=e*x*z+r*h*k,this.y=r*h*z-e*x*k,this.z=r*x*k+e*h*z,this.w=r*x*z-e*h*k):"YXZ"===p?(this.x=e*x*z+r*h*k,this.y=r*h*z-e*x*k,this.z=r*x*k-e*h*z,this.w=r*x*z+e*h*k):"ZXY"===p?(this.x=e*x*z-r*h*k,this.y=r*h*z+e*x*k,this.z=r*x*k+e*h*z,this.w=r*x*z-e*h*k):"ZYX"===p?(this.x=e*x*z-r*h*k,this.y=r*h*z+e*x*k,this.z=r*x*k-e*h*z,this.w=
r*x*z+e*h*k):"YZX"===p?(this.x=e*x*z+r*h*k,this.y=r*h*z+e*x*k,this.z=r*x*k-e*h*z,this.w=r*x*z-e*h*k):"XZY"===p&&(this.x=e*x*z-r*h*k,this.y=r*h*z-e*x*k,this.z=r*x*k+e*h*z,this.w=r*x*z+e*h*k);return this}clone(){return new xb(this.x,this.y,this.z,this.w)}slerp(e,h,k){void 0===k&&(k=new xb);const p=this.x,r=this.y,x=this.z,z=this.w;let w=e.x,C=e.y,K=e.z;e=e.w;let R;let M;var V=p*w+r*C+x*K+z*e;0>V&&(V=-V,w=-w,C=-C,K=-K,e=-e);1E-6<1-V?(R=Math.acos(V),M=Math.sin(R),V=Math.sin((1-h)*R)/M,h=Math.sin(h*R)/
M):V=1-h;k.x=V*p+h*w;k.y=V*r+h*C;k.z=V*x+h*K;k.w=V*z+h*e;return k}integrate(e,h,k,p){void 0===p&&(p=new xb);const r=e.x*k.x,x=e.y*k.y;e=e.z*k.z;k=this.x;const z=this.y,w=this.z,C=this.w;h*=.5;p.x+=h*(r*C+x*w-e*z);p.y+=h*(x*C+e*k-r*w);p.z+=h*(e*C+r*z-x*k);p.w+=h*(-r*k-x*z-e*w);return p}}q.Quaternion=xb;const Jf=new B,ac=new B,Hd={SPHERE:1,PLANE:2,BOX:4,COMPOUND:8,CONVEXPOLYHEDRON:16,HEIGHTFIELD:32,PARTICLE:64,CYLINDER:128,TRIMESH:256};q.SHAPE_TYPES=Hd;class Ca{constructor(e){void 0===e&&(e={});this.id=
Ca.idCounter++;this.type=e.type||0;this.boundingSphereRadius=0;this.collisionResponse=e.collisionResponse?e.collisionResponse:!0;this.collisionFilterGroup=void 0!==e.collisionFilterGroup?e.collisionFilterGroup:1;this.collisionFilterMask=void 0!==e.collisionFilterMask?e.collisionFilterMask:-1;this.material=e.material?e.material:null;this.body=null}updateBoundingSphereRadius(){throw`computeBoundingSphereRadius() not implemented for shape type ${this.type}`;}volume(){throw`volume() not implemented for shape type ${this.type}`;
}calculateLocalInertia(e,h){throw`calculateLocalInertia() not implemented for shape type ${this.type}`;}calculateWorldAABB(e,h,k,p){throw`calculateWorldAABB() not implemented for shape type ${this.type}`;}}q.Shape=Ca;Ca.idCounter=0;Ca.types=Hd;class $a{constructor(e){void 0===e&&(e={});this.position=new B;this.quaternion=new xb;e.position&&this.position.copy(e.position);e.quaternion&&this.quaternion.copy(e.quaternion)}pointToLocal(e,h){return $a.pointToLocalFrame(this.position,this.quaternion,e,h)}pointToWorld(e,
h){return $a.pointToWorldFrame(this.position,this.quaternion,e,h)}vectorToWorldFrame(e,h){void 0===h&&(h=new B);this.quaternion.vmult(e,h);return h}static pointToLocalFrame(e,h,k,p){void 0===p&&(p=new B);k.vsub(e,p);h.conjugate(Ub);Ub.vmult(p,p);return p}static pointToWorldFrame(e,h,k,p){void 0===p&&(p=new B);h.vmult(k,p);p.vadd(e,p);return p}static vectorToWorldFrame(e,h,k){void 0===k&&(k=new B);e.vmult(h,k);return k}static vectorToLocalFrame(e,h,k,p){void 0===p&&(p=new B);h.w*=-1;h.vmult(k,p);h.w*=
-1;return p}}q.Transform=$a;const Ub=new xb;class Mc extends Ca{constructor(e){void 0===e&&(e={});const {vertices:h=[],faces:k=[],normals:p=[],axes:r,boundingSphereRadius:x}=e;super({type:Ca.types.CONVEXPOLYHEDRON});this.vertices=h;this.faces=k;this.faceNormals=p;0===this.faceNormals.length&&this.computeNormals();x?this.boundingSphereRadius=x:this.updateBoundingSphereRadius();this.worldVertices=[];this.worldVerticesNeedsUpdate=!0;this.worldFaceNormals=[];this.worldFaceNormalsNeedsUpdate=!0;this.uniqueAxes=
r?r.slice():null;this.uniqueEdges=[];this.computeEdges()}computeEdges(){const e=this.faces,h=this.vertices,k=this.uniqueEdges;k.length=0;const p=new B;for(let r=0;r!==e.length;r++){const x=e[r],z=x.length;for(let w=0;w!==z;w++){h[x[w]].vsub(h[x[(w+1)%z]],p);p.normalize();let C=!1;for(let K=0;K!==k.length;K++)if(k[K].almostEquals(p)||k[K].almostEquals(p)){C=!0;break}C||k.push(p.clone())}}}computeNormals(){this.faceNormals.length=this.faces.length;for(let h=0;h<this.faces.length;h++){for(var e=0;e<
this.faces[h].length;e++)if(!this.vertices[this.faces[h][e]])throw Error(`Vertex ${this.faces[h][e]} not found!`);e=this.faceNormals[h]||new B;this.getFaceNormal(h,e);e.negate(e);this.faceNormals[h]=e;if(0>e.dot(this.vertices[this.faces[h][0]]))for(console.error(`.faceNormals[${h}] = Vec3(${e.toString()}) looks like it points into the shape? The vertices follow. Make sure they are ordered CCW around the normal, using the right hand rule.`),e=0;e<this.faces[h].length;e++)console.warn(`.vertices[${this.faces[h][e]}] = Vec3(${this.vertices[this.faces[h][e]].toString()})`)}}getFaceNormal(e,
h){e=this.faces[e];Mc.computeNormal(this.vertices[e[0]],this.vertices[e[1]],this.vertices[e[2]],h)}static computeNormal(e,h,k,p){const r=new B,x=new B;h.vsub(e,x);k.vsub(h,r);r.cross(x,p);p.isZero()||p.normalize()}clipAgainstHull(e,h,k,p,r,x,z,w,C){var K=new B;let R=-1;var M=-Number.MAX_VALUE;for(var V=0;V<k.faces.length;V++){K.copy(k.faceNormals[V]);r.vmult(K,K);var T=K.dot(x);T>M&&(M=T,R=V)}K=[];for(M=0;M<k.faces[R].length;M++)V=k.vertices[k.faces[R][M]],T=new B,T.copy(V),r.vmult(T,T),p.vadd(T,
T),K.push(T);0<=R&&this.clipFaceAgainstHull(x,e,h,K,z,w,C)}findSeparatingAxis(e,h,k,p,r,x,z,w){var C=new B,K=new B;const R=new B,M=new B,V=new B,T=new B;let W=Number.MAX_VALUE;if(this.uniqueAxes)for(z=0;z!==this.uniqueAxes.length;z++){k.vmult(this.uniqueAxes[z],C);var S=this.testSepAxis(C,e,h,k,p,r);if(!1===S)return!1;S<W&&(W=S,x.copy(C))}else{S=z?z.length:this.faces.length;for(let ea=0;ea<S;ea++){C.copy(this.faceNormals[z?z[ea]:ea]);k.vmult(C,C);const ha=this.testSepAxis(C,e,h,k,p,r);if(!1===ha)return!1;
ha<W&&(W=ha,x.copy(C))}}if(e.uniqueAxes)for(w=0;w!==e.uniqueAxes.length;w++){r.vmult(e.uniqueAxes[w],K);C=this.testSepAxis(K,e,h,k,p,r);if(!1===C)return!1;C<W&&(W=C,x.copy(K))}else for(C=w?w.length:e.faces.length,z=0;z<C;z++){K.copy(e.faceNormals[w?w[z]:z]);r.vmult(K,K);S=this.testSepAxis(K,e,h,k,p,r);if(!1===S)return!1;S<W&&(W=S,x.copy(K))}for(K=0;K!==this.uniqueEdges.length;K++)for(k.vmult(this.uniqueEdges[K],M),w=0;w!==e.uniqueEdges.length;w++)if(r.vmult(e.uniqueEdges[w],V),M.cross(V,T),!T.almostZero()){T.normalize();
C=this.testSepAxis(T,e,h,k,p,r);if(!1===C)return!1;C<W&&(W=C,x.copy(T))}p.vsub(h,R);0<R.dot(x)&&x.negate(x);return!0}testSepAxis(e,h,k,p,r,x){Mc.project(this,e,k,p,Se);Mc.project(h,e,r,x,Lf);k=Se[0];e=Se[1];h=Lf[0];p=Lf[1];if(k<p||h<e)return!1;k-=p;e=h-e;return k<e?k:e}calculateLocalInertia(e,h){var k=new B;const p=new B;this.computeLocalAABB(p,k);const r=k.x-p.x,x=k.y-p.y;k=k.z-p.z;h.x=1/12*e*(4*x*x+4*k*k);h.y=1/12*e*(4*r*r+4*k*k);h.z=1/12*e*(4*x*x+4*r*r)}getPlaneConstantOfFace(e){return-this.faceNormals[e].dot(this.vertices[this.faces[e][0]])}clipFaceAgainstHull(e,
h,k,p,r,x,z){var w=new B,C=new B;const K=new B,R=new B,M=new B,V=new B;var T=new B;const W=new B,S=[];let ea=-1;var ha=Number.MAX_VALUE;for(var ya=0;ya<this.faces.length;ya++){w.copy(this.faceNormals[ya]);k.vmult(w,w);const za=w.dot(e);za<ha&&(ha=za,ea=ya)}if(!(0>ea)){e=this.faces[ea];e.connectedFaces=[];for(w=0;w<this.faces.length;w++)for(ha=0;ha<this.faces[w].length;ha++)-1!==e.indexOf(this.faces[w][ha])&&w!==ea&&-1===e.connectedFaces.indexOf(w)&&e.connectedFaces.push(w);w=e.length;for(ha=0;ha<
w;ha++){ya=this.vertices[e[ha]];ya.vsub(this.vertices[e[(ha+1)%w]],C);K.copy(C);k.vmult(K,K);h.vadd(K,K);R.copy(this.faceNormals[ea]);k.vmult(R,R);h.vadd(R,R);K.cross(R,M);M.negate(M);V.copy(ya);k.vmult(V,V);h.vadd(V,V);ya=e.connectedFaces[ha];T.copy(this.faceNormals[ya]);ya=this.getPlaneConstantOfFace(ya);W.copy(T);k.vmult(W,W);ya-=W.dot(h);for(this.clipFaceAgainstPlane(p,S,W,ya);p.length;)p.shift();for(;S.length;)p.push(S.shift())}T.copy(this.faceNormals[ea]);C=this.getPlaneConstantOfFace(ea);W.copy(T);
k.vmult(W,W);h=C-W.dot(h);for(k=0;k<p.length;k++)T=W.dot(p[k])+h,T<=r&&(console.log(`clamped: depth=${T} to minDist=${r}`),T=r),T<=x&&(C=p[k],1E-6>=T&&z.push({point:C,normal:W,depth:T}))}}clipFaceAgainstPlane(e,h,k,p){let r;const x=e.length;if(2>x)return h;let z=e[e.length-1],w;var C=k.dot(z)+p;for(let R=0;R<x;R++){w=e[R];r=k.dot(w)+p;if(0>C)if(0>r)C=new B,C.copy(w),h.push(C);else{var K=new B;z.lerp(w,C/(C-r),K);h.push(K)}else 0>r&&(K=new B,z.lerp(w,C/(C-r),K),h.push(K),h.push(w));z=w;C=r}return h}computeWorldVertices(e,
h){for(;this.worldVertices.length<this.vertices.length;)this.worldVertices.push(new B);const k=this.vertices,p=this.worldVertices;for(let r=0;r!==this.vertices.length;r++)h.vmult(k[r],p[r]),e.vadd(p[r],p[r]);this.worldVerticesNeedsUpdate=!1}computeLocalAABB(e,h){const k=this.vertices;e.set(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE);h.set(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE);for(let p=0;p<this.vertices.length;p++){const r=k[p];r.x<e.x?e.x=r.x:r.x>h.x&&(h.x=r.x);r.y<e.y?e.y=
r.y:r.y>h.y&&(h.y=r.y);r.z<e.z?e.z=r.z:r.z>h.z&&(h.z=r.z)}}computeWorldFaceNormals(e){const h=this.faceNormals.length;for(;this.worldFaceNormals.length<h;)this.worldFaceNormals.push(new B);const k=this.faceNormals,p=this.worldFaceNormals;for(let r=0;r!==h;r++)e.vmult(k[r],p[r]);this.worldFaceNormalsNeedsUpdate=!1}updateBoundingSphereRadius(){let e=0;const h=this.vertices;for(let k=0;k!==h.length;k++){const p=h[k].lengthSquared();p>e&&(e=p)}this.boundingSphereRadius=Math.sqrt(e)}calculateWorldAABB(e,
h,k,p){const r=this.vertices;let x,z,w,C,K,R,M=new B;for(let V=0;V<r.length;V++){M.copy(r[V]);h.vmult(M,M);e.vadd(M,M);const T=M;if(void 0===x||T.x<x)x=T.x;if(void 0===C||T.x>C)C=T.x;if(void 0===z||T.y<z)z=T.y;if(void 0===K||T.y>K)K=T.y;if(void 0===w||T.z<w)w=T.z;if(void 0===R||T.z>R)R=T.z}k.set(x,z,w);p.set(C,K,R)}volume(){return 4*Math.PI*this.boundingSphereRadius/3}getAveragePointLocal(e){void 0===e&&(e=new B);const h=this.vertices;for(let k=0;k<h.length;k++)e.vadd(h[k],e);e.scale(1/h.length,e);
return e}transformAllPoints(e,h){const k=this.vertices.length,p=this.vertices;if(h){for(var r=0;r<k;r++){var x=p[r];h.vmult(x,x)}for(r=0;r<this.faceNormals.length;r++)x=this.faceNormals[r],h.vmult(x,x)}if(e)for(h=0;h<k;h++)r=p[h],r.vadd(e,r)}pointIsInside(e){const h=this.vertices,k=this.faces,p=this.faceNormals,r=new B;this.getAveragePointLocal(r);for(let w=0;w<this.faces.length;w++){var x=p[w];const C=h[k[w][0]];var z=new B;e.vsub(C,z);z=x.dot(z);const K=new B;r.vsub(C,K);x=x.dot(K);if(0>z&&0<x||
0<z&&0>x)return!1}return-1}static project(e,h,k,p,r){var x=e.vertices.length;bi;const z=ci;var w=di;e=e.vertices;w.setZero();$a.vectorToLocalFrame(k,p,h,z);$a.pointToLocalFrame(k,p,w,w);p=w.dot(z);k=h=e[0].dot(z);for(w=1;w<x;w++){const C=e[w].dot(z);C>h&&(h=C);C<k&&(k=C)}k-=p;h-=p;k>h&&(x=k,k=h,h=x);r[0]=h;r[1]=k}}q.ConvexPolyhedron=Mc;const Se=[],Lf=[],bi=new B,ci=new B,di=new B;class Te extends Ca{constructor(e){super({type:Ca.types.BOX});this.halfExtents=e;this.convexPolyhedronRepresentation=null;
this.updateConvexPolyhedronRepresentation();this.updateBoundingSphereRadius()}updateConvexPolyhedronRepresentation(){var e=this.halfExtents.x;const h=this.halfExtents.y,k=this.halfExtents.z;var p=B;e=[new p(-e,-h,-k),new p(e,-h,-k),new p(e,h,-k),new p(-e,h,-k),new p(-e,-h,k),new p(e,-h,k),new p(e,h,k),new p(-e,h,k)];p=[new p(0,0,1),new p(0,1,0),new p(1,0,0)];this.convexPolyhedronRepresentation=p=new Mc({vertices:e,faces:[[3,2,1,0],[4,5,6,7],[5,4,0,1],[2,3,7,6],[0,4,7,3],[1,2,6,5]],axes:p});p.material=
this.material}calculateLocalInertia(e,h){void 0===h&&(h=new B);Te.calculateInertia(this.halfExtents,e,h);return h}static calculateInertia(e,h,k){k.x=1/12*h*(4*e.y*e.y+4*e.z*e.z);k.y=1/12*h*(4*e.x*e.x+4*e.z*e.z);k.z=1/12*h*(4*e.y*e.y+4*e.x*e.x)}getSideNormals(e,h){var k=this.halfExtents;e[0].set(k.x,0,0);e[1].set(0,k.y,0);e[2].set(0,0,k.z);e[3].set(-k.x,0,0);e[4].set(0,-k.y,0);e[5].set(0,0,-k.z);if(void 0!==h)for(k=0;k!==e.length;k++)h.vmult(e[k],e[k]);return e}volume(){return 8*this.halfExtents.x*
this.halfExtents.y*this.halfExtents.z}updateBoundingSphereRadius(){this.boundingSphereRadius=this.halfExtents.length()}forEachWorldCorner(e,h,k){var p=this.halfExtents;p=[[p.x,p.y,p.z],[-p.x,p.y,p.z],[-p.x,-p.y,p.z],[-p.x,-p.y,-p.z],[p.x,-p.y,-p.z],[p.x,p.y,-p.z],[-p.x,p.y,-p.z],[p.x,-p.y,p.z]];for(let r=0;r<p.length;r++)ad.set(p[r][0],p[r][1],p[r][2]),h.vmult(ad,ad),e.vadd(ad,ad),k(ad.x,ad.y,ad.z)}calculateWorldAABB(e,h,k,p){var r=this.halfExtents;Fc[0].set(r.x,r.y,r.z);Fc[1].set(-r.x,r.y,r.z);Fc[2].set(-r.x,
-r.y,r.z);Fc[3].set(-r.x,-r.y,-r.z);Fc[4].set(r.x,-r.y,-r.z);Fc[5].set(r.x,r.y,-r.z);Fc[6].set(-r.x,r.y,-r.z);Fc[7].set(r.x,-r.y,r.z);r=Fc[0];h.vmult(r,r);e.vadd(r,r);p.copy(r);k.copy(r);for(r=1;8>r;r++){var x=Fc[r];h.vmult(x,x);e.vadd(x,x);const z=x.x,w=x.y;x=x.z;z>p.x&&(p.x=z);w>p.y&&(p.y=w);x>p.z&&(p.z=x);z<k.x&&(k.x=z);w<k.y&&(k.y=w);x<k.z&&(k.z=x)}}}q.Box=Te;const ad=new B,Fc=[new B,new B,new B,new B,new B,new B,new B,new B],oe={DYNAMIC:1,STATIC:2,KINEMATIC:4};q.BODY_TYPES=oe;const qd={AWAKE:0,
SLEEPY:1,SLEEPING:2};q.BODY_SLEEP_STATES=qd;class Ka extends ne{constructor(e){void 0===e&&(e={});super();this.id=Ka.idCounter++;this.index=-1;this.world=null;this.vlambda=new B;this.collisionFilterGroup="number"===typeof e.collisionFilterGroup?e.collisionFilterGroup:1;this.collisionFilterMask="number"===typeof e.collisionFilterMask?e.collisionFilterMask:-1;this.collisionResponse="boolean"===typeof e.collisionResponse?e.collisionResponse:!0;this.position=new B;this.previousPosition=new B;this.interpolatedPosition=
new B;this.initPosition=new B;e.position&&(this.position.copy(e.position),this.previousPosition.copy(e.position),this.interpolatedPosition.copy(e.position),this.initPosition.copy(e.position));this.velocity=new B;e.velocity&&this.velocity.copy(e.velocity);this.initVelocity=new B;this.force=new B;const h="number"===typeof e.mass?e.mass:0;this.mass=h;this.invMass=0<h?1/h:0;this.material=e.material||null;this.linearDamping="number"===typeof e.linearDamping?e.linearDamping:.01;this.type=0>=h?Ka.STATIC:
Ka.DYNAMIC;typeof e.type===typeof Ka.STATIC&&(this.type=e.type);this.allowSleep="undefined"!==typeof e.allowSleep?e.allowSleep:!0;this.sleepState=Ka.AWAKE;this.sleepSpeedLimit="undefined"!==typeof e.sleepSpeedLimit?e.sleepSpeedLimit:.1;this.sleepTimeLimit="undefined"!==typeof e.sleepTimeLimit?e.sleepTimeLimit:1;this.timeLastSleepy=0;this.wakeUpAfterNarrowphase=!1;this.torque=new B;this.quaternion=new xb;this.initQuaternion=new xb;this.previousQuaternion=new xb;this.interpolatedQuaternion=new xb;e.quaternion&&
(this.quaternion.copy(e.quaternion),this.initQuaternion.copy(e.quaternion),this.previousQuaternion.copy(e.quaternion),this.interpolatedQuaternion.copy(e.quaternion));this.angularVelocity=new B;e.angularVelocity&&this.angularVelocity.copy(e.angularVelocity);this.initAngularVelocity=new B;this.shapes=[];this.shapeOffsets=[];this.shapeOrientations=[];this.inertia=new B;this.invInertia=new B;this.invInertiaWorld=new lc;this.invMassSolve=0;this.invInertiaSolve=new B;this.invInertiaWorldSolve=new lc;this.fixedRotation=
"undefined"!==typeof e.fixedRotation?e.fixedRotation:!1;this.angularDamping="undefined"!==typeof e.angularDamping?e.angularDamping:.01;this.linearFactor=new B(1,1,1);e.linearFactor&&this.linearFactor.copy(e.linearFactor);this.angularFactor=new B(1,1,1);e.angularFactor&&this.angularFactor.copy(e.angularFactor);this.aabb=new tb;this.aabbNeedsUpdate=!0;this.boundingRadius=0;this.wlambda=new B;this.isTrigger=!!e.isTrigger;e.shape&&this.addShape(e.shape);this.updateMassProperties()}wakeUp(){const e=this.sleepState;
this.sleepState=Ka.AWAKE;this.wakeUpAfterNarrowphase=!1;e===Ka.SLEEPING&&this.dispatchEvent(Ka.wakeupEvent)}sleep(){this.sleepState=Ka.SLEEPING;this.velocity.set(0,0,0);this.angularVelocity.set(0,0,0);this.wakeUpAfterNarrowphase=!1}sleepTick(e){if(this.allowSleep){const h=this.sleepState,k=this.velocity.lengthSquared()+this.angularVelocity.lengthSquared(),p=this.sleepSpeedLimit**2;h===Ka.AWAKE&&k<p?(this.sleepState=Ka.SLEEPY,this.timeLastSleepy=e,this.dispatchEvent(Ka.sleepyEvent)):h===Ka.SLEEPY&&
k>p?this.wakeUp():h===Ka.SLEEPY&&e-this.timeLastSleepy>this.sleepTimeLimit&&(this.sleep(),this.dispatchEvent(Ka.sleepEvent))}}updateSolveMassProperties(){this.sleepState===Ka.SLEEPING||this.type===Ka.KINEMATIC?(this.invMassSolve=0,this.invInertiaSolve.setZero(),this.invInertiaWorldSolve.setZero()):(this.invMassSolve=this.invMass,this.invInertiaSolve.copy(this.invInertia),this.invInertiaWorldSolve.copy(this.invInertiaWorld))}pointToLocalFrame(e,h){void 0===h&&(h=new B);e.vsub(this.position,h);this.quaternion.conjugate().vmult(h,
h);return h}vectorToLocalFrame(e,h){void 0===h&&(h=new B);this.quaternion.conjugate().vmult(e,h);return h}pointToWorldFrame(e,h){void 0===h&&(h=new B);this.quaternion.vmult(e,h);h.vadd(this.position,h);return h}vectorToWorldFrame(e,h){void 0===h&&(h=new B);this.quaternion.vmult(e,h);return h}addShape(e,h,k){const p=new B,r=new xb;h&&p.copy(h);k&&r.copy(k);this.shapes.push(e);this.shapeOffsets.push(p);this.shapeOrientations.push(r);this.updateMassProperties();this.updateBoundingRadius();this.aabbNeedsUpdate=
!0;e.body=this;return this}removeShape(e){const h=this.shapes.indexOf(e);if(-1===h)return console.warn("Shape does not belong to the body"),this;this.shapes.splice(h,1);this.shapeOffsets.splice(h,1);this.shapeOrientations.splice(h,1);this.updateMassProperties();this.updateBoundingRadius();this.aabbNeedsUpdate=!0;e.body=null;return this}updateBoundingRadius(){const e=this.shapes,h=this.shapeOffsets,k=e.length;let p=0;for(let x=0;x!==k;x++){var r=e[x];r.updateBoundingSphereRadius();const z=h[x].length();
r=r.boundingSphereRadius;z+r>p&&(p=z+r)}this.boundingRadius=p}updateAABB(){const e=this.shapes,h=this.shapeOffsets,k=this.shapeOrientations,p=e.length,r=Hg,x=Mf,z=this.quaternion,w=this.aabb,C=ei;for(let K=0;K!==p;K++){const R=e[K];z.vmult(h[K],r);r.vadd(this.position,r);z.mult(k[K],x);R.calculateWorldAABB(r,x,C.lowerBound,C.upperBound);0===K?w.copy(C):w.extend(C)}this.aabbNeedsUpdate=!1}updateInertiaWorld(e){const h=this.invInertia;if(h.x!==h.y||h.y!==h.z||e){e=fi;const k=gi;hi;e.setRotationFromQuaternion(this.quaternion);
e.transpose(k);e.scale(h,e);e.mmult(k,this.invInertiaWorld)}}applyForce(e,h){void 0===h&&(h=new B);if(this.type===Ka.DYNAMIC){this.sleepState===Ka.SLEEPING&&this.wakeUp();var k=ii;h.cross(e,k);this.force.vadd(e,this.force);this.torque.vadd(k,this.torque)}}applyLocalForce(e,h){void 0===h&&(h=new B);if(this.type===Ka.DYNAMIC){var k=ji,p=ki;this.vectorToWorldFrame(e,k);this.vectorToWorldFrame(h,p);this.applyForce(k,p)}}applyTorque(e){this.type===Ka.DYNAMIC&&(this.sleepState===Ka.SLEEPING&&this.wakeUp(),
this.torque.vadd(e,this.torque))}applyImpulse(e,h){void 0===h&&(h=new B);if(this.type===Ka.DYNAMIC){this.sleepState===Ka.SLEEPING&&this.wakeUp();var k=li;k.copy(e);k.scale(this.invMass,k);this.velocity.vadd(k,this.velocity);k=mi;h.cross(e,k);this.invInertiaWorld.vmult(k,k);this.angularVelocity.vadd(k,this.angularVelocity)}}applyLocalImpulse(e,h){void 0===h&&(h=new B);if(this.type===Ka.DYNAMIC){var k=Md,p=Kb;this.vectorToWorldFrame(e,k);this.vectorToWorldFrame(h,p);this.applyImpulse(k,p)}}updateMassProperties(){const e=
Lb;this.invMass=0<this.mass?1/this.mass:0;const h=this.inertia,k=this.fixedRotation;this.updateAABB();e.set((this.aabb.upperBound.x-this.aabb.lowerBound.x)/2,(this.aabb.upperBound.y-this.aabb.lowerBound.y)/2,(this.aabb.upperBound.z-this.aabb.lowerBound.z)/2);Te.calculateInertia(e,this.mass,h);this.invInertia.set(0<h.x&&!k?1/h.x:0,0<h.y&&!k?1/h.y:0,0<h.z&&!k?1/h.z:0);this.updateInertiaWorld(!0)}getVelocityAtWorldPoint(e,h){const k=new B;e.vsub(this.position,k);this.angularVelocity.cross(k,h);this.velocity.vadd(h,
h);return h}integrate(e,h,k){this.previousPosition.copy(this.position);this.previousQuaternion.copy(this.quaternion);if((this.type===Ka.DYNAMIC||this.type===Ka.KINEMATIC)&&this.sleepState!==Ka.SLEEPING){var p=this.velocity,r=this.angularVelocity,x=this.position,z=this.force,w=this.torque,C=this.quaternion,K=this.invInertiaWorld,R=this.linearFactor,M=this.invMass*e;p.x+=z.x*M*R.x;p.y+=z.y*M*R.y;p.z+=z.z*M*R.z;z=K.elements;M=this.angularFactor;K=w.x*M.x;R=w.y*M.y;w=w.z*M.z;r.x+=e*(z[0]*K+z[1]*R+z[2]*
w);r.y+=e*(z[3]*K+z[4]*R+z[5]*w);r.z+=e*(z[6]*K+z[7]*R+z[8]*w);x.x+=p.x*e;x.y+=p.y*e;x.z+=p.z*e;C.integrate(this.angularVelocity,e,this.angularFactor,C);h&&(k?C.normalizeFast():C.normalize());this.aabbNeedsUpdate=!0;this.updateInertiaWorld()}}}q.Body=Ka;Ka.idCounter=0;Ka.COLLIDE_EVENT_NAME="collide";Ka.DYNAMIC=oe.DYNAMIC;Ka.STATIC=oe.STATIC;Ka.KINEMATIC=oe.KINEMATIC;Ka.AWAKE=qd.AWAKE;Ka.SLEEPY=qd.SLEEPY;Ka.SLEEPING=qd.SLEEPING;Ka.wakeupEvent={type:"wakeup"};Ka.sleepyEvent={type:"sleepy"};Ka.sleepEvent=
{type:"sleep"};const Hg=new B,Mf=new xb,ei=new tb,fi=new lc,gi=new lc,hi=new lc,ii=new B,ji=new B,ki=new B,li=new B,mi=new B,Md=new B,Kb=new B,Lb=new B;class rd{constructor(){this.world=null;this.useBoundingBoxes=!1;this.dirty=!0}collisionPairs(e,h,k){throw Error("collisionPairs not implemented for this BroadPhase class!");}needBroadphaseCollision(e,h){return 0!==(e.collisionFilterGroup&h.collisionFilterMask)&&0!==(h.collisionFilterGroup&e.collisionFilterMask)&&(0===(e.type&Ka.STATIC)&&e.sleepState!==
Ka.SLEEPING||0===(h.type&Ka.STATIC)&&h.sleepState!==Ka.SLEEPING)?!0:!1}intersectionTest(e,h,k,p){this.useBoundingBoxes?this.doBoundingBoxBroadphase(e,h,k,p):this.doBoundingSphereBroadphase(e,h,k,p)}doBoundingSphereBroadphase(e,h,k,p){const r=ni;h.position.vsub(e.position,r);const x=(e.boundingRadius+h.boundingRadius)**2;r.lengthSquared()<x&&(k.push(e),p.push(h))}doBoundingBoxBroadphase(e,h,k,p){e.aabbNeedsUpdate&&e.updateAABB();h.aabbNeedsUpdate&&h.updateAABB();e.aabb.overlaps(h.aabb)&&(k.push(e),
p.push(h))}makePairsUnique(e,h){const k=oi,p=pi,r=qi;var x=e.length;for(var z=0;z!==x;z++)p[z]=e[z],r[z]=h[z];e.length=0;h.length=0;for(z=0;z!==x;z++){var w=p[z].id;const C=r[z].id;w=w<C?`${w},${C}`:`${C},${w}`;k[w]=z;k.keys.push(w)}for(x=0;x!==k.keys.length;x++)z=k.keys.pop(),w=k[z],e.push(p[w]),h.push(r[w]),delete k[z]}setWorld(e){}static boundingSphereCheck(e,h){const k=new B;e.position.vsub(h.position,k);return Math.pow(e.shapes[0].boundingSphereRadius+h.shapes[0].boundingSphereRadius,2)>k.lengthSquared()}aabbQuery(e,
h,k){console.warn(".aabbQuery is not implemented in this Broadphase subclass.");return[]}}q.Broadphase=rd;const ni=new B;new B;new xb;new B;const oi={keys:[]},pi=[],qi=[];new B;class ri extends rd{constructor(e,h,k,p,r){void 0===e&&(e=new B(100,100,100));void 0===h&&(h=new B(-100,-100,-100));void 0===k&&(k=10);void 0===p&&(p=10);void 0===r&&(r=10);super();this.nx=k;this.ny=p;this.nz=r;this.aabbMin=e;this.aabbMax=h;e=this.nx*this.ny*this.nz;if(0>=e)throw"GridBroadphase: Each dimension's n must be \x3e0";
this.bins=[];this.binLengths=[];this.bins.length=e;this.binLengths.length=e;for(h=0;h<e;h++)this.bins[h]=[],this.binLengths[h]=0}collisionPairs(e,h,k){function p(bb,vc,fc,uc,nc,Dc,Ze){bb=(bb-W)*ha|0;vc=(vc-S)*ya|0;fc=(fc-ea)*za|0;uc=mc((uc-W)*ha);nc=mc((nc-S)*ya);Dc=mc((Dc-ea)*za);0>bb?bb=0:bb>=C&&(bb=C-1);0>vc?vc=0:vc>=K&&(vc=K-1);0>fc?fc=0:fc>=R&&(fc=R-1);0>uc?uc=0:uc>=C&&(uc=C-1);0>nc?nc=0:nc>=K&&(nc=K-1);0>Dc?Dc=0:Dc>=R&&(Dc=R-1);bb*=M;vc*=V;fc*=1;uc*=M;nc*=V;for(Dc*=1;bb<=uc;bb+=M)for(let he=
vc;he<=nc;he+=V)for(let Sf=fc;Sf<=Dc;Sf+=1){const $e=bb+he+Sf;db[$e][qb[$e]++]=Ze}}var r=e.bodies.length,x=e.bodies,z=this.aabbMax,w=this.aabbMin;const C=this.nx,K=this.ny,R=this.nz,M=K*R,V=R;var T=z.x;e=z.y;z=z.z;const W=w.x,S=w.y,ea=w.z,ha=C/(T-W),ya=K/(e-S),za=R/(z-ea);w=(T-W)/C;T=(e-S)/K;z=(z-ea)/R;var Ua=.5*Math.sqrt(w*w+T*T+z*z);e=Ca.types;var Pa=e.SPHERE;const pb=e.PLANE;e.BOX;e.COMPOUND;e.CONVEXPOLYHEDRON;const db=this.bins,qb=this.binLengths;e=this.bins.length;for(var Cb=0;Cb!==e;Cb++)qb[Cb]=
0;const mc=Math.ceil;for(Cb=0;Cb!==r;Cb++){const bb=x[Cb];var gb=bb.shapes[0];switch(gb.type){case Pa:var ic=bb.position.x,sb=bb.position.y,Nb=bb.position.z;gb=gb.radius;p(ic-gb,sb-gb,Nb-gb,ic+gb,sb+gb,Nb+gb,bb);break;case pb:ic=gb;ic.worldNormalNeedsUpdate&&ic.computeWorldNormal(bb.quaternion);ic=ic.worldNormal;sb=S+.5*T-bb.position.y;Nb=ea+.5*z-bb.position.z;gb=si;gb.set(W+.5*w-bb.position.x,sb,Nb);for(let vc=0,fc=0;vc!==C;vc++,fc+=M,gb.y=sb,gb.x+=w)for(let uc=0,nc=0;uc!==K;uc++,nc+=V,gb.z=Nb,gb.y+=
T)for(let Dc=0,Ze=0;Dc!==R;Dc++,Ze+=1,gb.z+=z)if(gb.dot(ic)<Ua){const he=fc+nc+Ze;db[he][qb[he]++]=bb}break;default:bb.aabbNeedsUpdate&&bb.updateAABB(),p(bb.aabb.lowerBound.x,bb.aabb.lowerBound.y,bb.aabb.lowerBound.z,bb.aabb.upperBound.x,bb.aabb.upperBound.y,bb.aabb.upperBound.z,bb)}}for(r=0;r!==e;r++)if(x=qb[r],1<x)for(w=db[r],T=0;T!==x;T++)for(z=w[T],Ua=0;Ua!==T;Ua++)Pa=w[Ua],this.needBroadphaseCollision(z,Pa)&&this.intersectionTest(z,Pa,h,k);this.makePairsUnique(h,k)}}q.GridBroadphase=ri;const si=
new B;new B;class Ig extends rd{constructor(){super()}collisionPairs(e,h,k){e=e.bodies;const p=e.length;let r,x;for(let z=0;z!==p;z++)for(let w=0;w!==z;w++)r=e[z],x=e[w],this.needBroadphaseCollision(r,x)&&this.intersectionTest(r,x,h,k)}aabbQuery(e,h,k){void 0===k&&(k=[]);for(let p=0;p<e.bodies.length;p++){const r=e.bodies[p];r.aabbNeedsUpdate&&r.updateAABB();r.aabb.overlaps(h)&&k.push(r)}return k}}q.NaiveBroadphase=Ig;class Nd{constructor(){this.rayFromWorld=new B;this.rayToWorld=new B;this.hitNormalWorld=
new B;this.hitPointWorld=new B;this.hasHit=!1;this.body=this.shape=null;this.distance=this.hitFaceIndex=-1;this.shouldStop=!1}reset(){this.rayFromWorld.setZero();this.rayToWorld.setZero();this.hitNormalWorld.setZero();this.hitPointWorld.setZero();this.hasHit=!1;this.body=this.shape=null;this.distance=this.hitFaceIndex=-1;this.shouldStop=!1}abort(){this.shouldStop=!0}set(e,h,k,p,r,x,z){this.rayFromWorld.copy(e);this.rayToWorld.copy(h);this.hitNormalWorld.copy(k);this.hitPointWorld.copy(p);this.shape=
r;this.body=x;this.distance=z}}q.RaycastResult=Nd;let Jg,Kg,Lg,Mg,Ng,Og,Pg;const Ve={CLOSEST:1,ANY:2,ALL:4};q.RAY_MODES=Ve;Jg=Ca.types.SPHERE;Kg=Ca.types.PLANE;Lg=Ca.types.BOX;Mg=Ca.types.CYLINDER;Ng=Ca.types.CONVEXPOLYHEDRON;Og=Ca.types.HEIGHTFIELD;Pg=Ca.types.TRIMESH;class Fb{get [Jg](){return this._intersectSphere}get [Kg](){return this._intersectPlane}get [Lg](){return this._intersectBox}get [Mg](){return this._intersectConvex}get [Ng](){return this._intersectConvex}get [Og](){return this._intersectHeightfield}get [Pg](){return this._intersectTrimesh}constructor(e,
h){void 0===e&&(e=new B);void 0===h&&(h=new B);this.from=e.clone();this.to=h.clone();this.direction=new B;this.precision=1E-4;this.checkCollisionResponse=!0;this.skipBackfaces=!1;this.collisionFilterGroup=this.collisionFilterMask=-1;this.mode=Fb.ANY;this.result=new Nd;this.hasHit=!1;this.callback=k=>{}}intersectWorld(e,h){this.mode=h.mode||Fb.ANY;this.result=h.result||new Nd;this.skipBackfaces=!!h.skipBackfaces;this.collisionFilterMask="undefined"!==typeof h.collisionFilterMask?h.collisionFilterMask:
-1;this.collisionFilterGroup="undefined"!==typeof h.collisionFilterGroup?h.collisionFilterGroup:-1;this.checkCollisionResponse="undefined"!==typeof h.checkCollisionResponse?h.checkCollisionResponse:!0;h.from&&this.from.copy(h.from);h.to&&this.to.copy(h.to);this.callback=h.callback||(()=>{});this.hasHit=!1;this.result.reset();this.updateDirection();this.getAABB(Qg);Pf.length=0;e.broadphase.aabbQuery(e,Qg,Pf);this.intersectBodies(Pf);return this.hasHit}intersectBody(e,h){h&&(this.result=h,this.updateDirection());
h=this.checkCollisionResponse;if((!h||e.collisionResponse)&&0!==(this.collisionFilterGroup&e.collisionFilterMask)&&0!==(e.collisionFilterGroup&this.collisionFilterMask)){var k=ti,p=ui;for(let r=0,x=e.shapes.length;r<x;r++){const z=e.shapes[r];if(!h||z.collisionResponse)if(e.quaternion.mult(e.shapeOrientations[r],p),e.quaternion.vmult(e.shapeOffsets[r],k),k.vadd(e.position,k),this.intersectShape(z,p,k,e),this.result.shouldStop)break}}}intersectBodies(e,h){h&&(this.result=h,this.updateDirection());
for(let k=0,p=e.length;!this.result.shouldStop&&k<p;k++)this.intersectBody(e[k])}updateDirection(){this.to.vsub(this.from,this.direction);this.direction.normalize()}intersectShape(e,h,k,p){var r=this.from,x=this.direction;k.vsub(r,tc);const z=tc.dot(x);x.scale(z,qe);qe.vadd(r,qe);k.distanceTo(qe)>e.boundingSphereRadius||(r=this[e.type])&&r.call(this,e,h,k,p,e)}_intersectBox(e,h,k,p,r){return this._intersectConvex(e.convexPolyhedronRepresentation,h,k,p,r)}_intersectPlane(e,h,k,p,r){e=this.from;var x=
this.to;const z=this.direction,w=new B(0,0,1);h.vmult(w,w);var C=new B;e.vsub(k,C);h=C.dot(w);x.vsub(k,C);C=C.dot(w);if(!(0<h*C||e.distanceTo(x)<h||(C=w.dot(z),Math.abs(C)<this.precision))){var K=new B;x=new B;h=new B;e.vsub(k,K);k=-w.dot(K)/C;z.scale(k,x);e.vadd(x,h);this.reportIntersection(w,h,r,p,-1)}}getAABB(e){const {lowerBound:h,upperBound:k}=e;e=this.to;const p=this.from;h.x=Math.min(e.x,p.x);h.y=Math.min(e.y,p.y);h.z=Math.min(e.z,p.z);k.x=Math.max(e.x,p.x);k.y=Math.max(e.y,p.y);k.z=Math.max(e.z,
p.z)}_intersectHeightfield(e,h,k,p,r){e.data;e.elementSize;const x=vi;x.from.copy(this.from);x.to.copy(this.to);$a.pointToLocalFrame(k,h,x.from,x.from);$a.pointToLocalFrame(k,h,x.to,x.to);x.updateDirection();var z=wi;let w,C,K;var R=w=0;C=K=e.data.length-1;const M=new tb;x.getAABB(M);e.getIndexOfPosition(M.lowerBound.x,M.lowerBound.y,z,!0);R=Math.max(R,z[0]);w=Math.max(w,z[1]);e.getIndexOfPosition(M.upperBound.x,M.upperBound.y,z,!0);C=Math.min(C,z[0]+1);K=Math.min(K,z[1]+1);for(z=R;z<C;z++)for(R=
w;R<K;R++){if(this.result.shouldStop)return;e.getAabbAtIndex(z,R,M);if(M.overlapsRay(x)){e.getConvexTrianglePillar(z,R,!1);$a.pointToWorldFrame(k,h,e.pillarOffset,We);this._intersectConvex(e.pillarConvex,h,We,p,r,Rg);if(this.result.shouldStop)return;e.getConvexTrianglePillar(z,R,!0);$a.pointToWorldFrame(k,h,e.pillarOffset,We);this._intersectConvex(e.pillarConvex,h,We,p,r,Rg)}}}_intersectSphere(e,h,k,p,r){h=this.from;const x=this.to;var z=(x.x-h.x)**2+(x.y-h.y)**2+(x.z-h.z)**2;const w=2*((x.x-h.x)*
(h.x-k.x)+(x.y-h.y)*(h.y-k.y)+(x.z-h.z)*(h.z-k.z)),C=w**2-4*z*((h.x-k.x)**2+(h.y-k.y)**2+(h.z-k.z)**2-e.radius**2);e=xi;const K=yi;if(!(0>C))if(0===C)h.lerp(x,C,e),e.vsub(k,K),K.normalize(),this.reportIntersection(K,e,r,p,-1);else{const R=(-w-Math.sqrt(C))/(2*z);z=(-w+Math.sqrt(C))/(2*z);0<=R&&1>=R&&(h.lerp(x,R,e),e.vsub(k,K),K.normalize(),this.reportIntersection(K,e,r,p,-1));!this.result.shouldStop&&0<=z&&1>=z&&(h.lerp(x,z,e),e.vsub(k,K),K.normalize(),this.reportIntersection(K,e,r,p,-1))}}_intersectConvex(e,
h,k,p,r,x){Ai;const z=zi,w=Sg;Bi;x=x&&x.faceList||null;const C=e.faces,K=e.vertices;e=e.faceNormals;const R=this.direction,M=this.from,V=M.distanceTo(this.to),T=x?x.length:C.length,W=this.result;for(let ea=0;!W.shouldStop&&ea<T;ea++){const ha=x?x[ea]:ea,ya=C[ha];var S=e[ha];const za=h,Ua=k;w.copy(K[ya[0]]);za.vmult(w,w);w.vadd(Ua,w);w.vsub(M,w);za.vmult(S,z);S=R.dot(z);if(!(Math.abs(S)<this.precision||(S=z.dot(w)/S,0>S)))for(R.scale(S,cc),cc.vadd(M,cc),sc.copy(K[ya[0]]),za.vmult(sc,sc),Ua.vadd(sc,
sc),S=1;!W.shouldStop&&S<ya.length-1;S++){Hc.copy(K[ya[S]]);Ic.copy(K[ya[S+1]]);za.vmult(Hc,Hc);za.vmult(Ic,Ic);Ua.vadd(Hc,Hc);Ua.vadd(Ic,Ic);const Pa=cc.distanceTo(M);!Fb.pointInTriangle(cc,sc,Hc,Ic)&&!Fb.pointInTriangle(cc,Hc,sc,Ic)||Pa>V||this.reportIntersection(z,cc,r,p,ha)}}}_intersectTrimesh(e,h,k,p,r,x){x=Ci;const z=Gi;var w=Hi;const C=Sg,K=Di,R=Ei;var M=Tg;const V=Fi,T=Ug,W=e.indices;e.vertices;var S=this.from;const ea=this.to,ha=this.direction;w.position.copy(k);w.quaternion.copy(h);$a.vectorToLocalFrame(k,
h,ha,K);$a.pointToLocalFrame(k,h,S,R);$a.pointToLocalFrame(k,h,ea,M);M.x*=e.scale.x;M.y*=e.scale.y;M.z*=e.scale.z;R.x*=e.scale.x;R.y*=e.scale.y;R.z*=e.scale.z;M.vsub(R,K);K.normalize();M=R.distanceSquared(M);e.tree.rayQuery(this,w,z);for(let ya=0,za=z.length;!this.result.shouldStop&&ya!==za;ya++)w=z[ya],e.getNormal(w,x),e.getVertex(W[3*w],sc),sc.vsub(R,C),S=K.dot(x),S=x.dot(C)/S,0>S||(K.scale(S,cc),cc.vadd(R,cc),e.getVertex(W[3*w+1],Hc),e.getVertex(W[3*w+2],Ic),S=cc.distanceSquared(R),!Fb.pointInTriangle(cc,
Hc,sc,Ic)&&!Fb.pointInTriangle(cc,sc,Hc,Ic)||S>M||($a.vectorToWorldFrame(h,x,T),$a.pointToWorldFrame(k,h,cc,V),this.reportIntersection(T,V,r,p,w)));z.length=0}reportIntersection(e,h,k,p,r){const x=this.from,z=this.to,w=x.distanceTo(h),C=this.result;if(!(this.skipBackfaces&&0<e.dot(this.direction)))switch(C.hitFaceIndex="undefined"!==typeof r?r:-1,this.mode){case Fb.ALL:this.hasHit=!0;C.set(x,z,e,h,k,p,w);C.hasHit=!0;this.callback(C);break;case Fb.CLOSEST:if(w<C.distance||!C.hasHit)this.hasHit=!0,
C.hasHit=!0,C.set(x,z,e,h,k,p,w);break;case Fb.ANY:this.hasHit=!0,C.hasHit=!0,C.set(x,z,e,h,k,p,w),C.shouldStop=!0}}static pointInTriangle(e,h,k,p){p.vsub(h,tc);k.vsub(h,pe);e.vsub(h,Qf);e=tc.dot(tc);h=tc.dot(pe);k=tc.dot(Qf);p=pe.dot(pe);const r=pe.dot(Qf);let x,z;return 0<=(x=p*k-h*r)&&0<=(z=e*r-h*k)&&x+z<e*p-h*h}}q.Ray=Fb;Fb.CLOSEST=Ve.CLOSEST;Fb.ANY=Ve.ANY;Fb.ALL=Ve.ALL;const Qg=new tb,Pf=[],pe=new B,Qf=new B,ti=new B,ui=new xb,cc=new B,sc=new B,Hc=new B,Ic=new B;new B;new Nd;const Rg={faceList:[0]},
We=new B,vi=new Fb,wi=[],xi=new B,yi=new B,zi=new B,Ai=new B,Bi=new B,Sg=new B,Ci=new B,Di=new B,Ei=new B,Tg=new B,Ug=new B,Fi=new B;new tb;const Gi=[],Hi=new $a,tc=new B,qe=new B;class Od extends rd{static checkBounds(e,h,k){let p,r;0===k?(p=e.position.x,r=h.position.x):1===k?(p=e.position.y,r=h.position.y):2===k&&(p=e.position.z,r=h.position.z);return r-h.boundingRadius<p+e.boundingRadius}static insertionSortX(e){for(let h=1,k=e.length;h<k;h++){const p=e[h];let r;for(r=h-1;0<=r&&!(e[r].aabb.lowerBound.x<=
p.aabb.lowerBound.x);r--)e[r+1]=e[r];e[r+1]=p}return e}static insertionSortY(e){for(let h=1,k=e.length;h<k;h++){const p=e[h];let r;for(r=h-1;0<=r&&!(e[r].aabb.lowerBound.y<=p.aabb.lowerBound.y);r--)e[r+1]=e[r];e[r+1]=p}return e}static insertionSortZ(e){for(let h=1,k=e.length;h<k;h++){const p=e[h];let r;for(r=h-1;0<=r&&!(e[r].aabb.lowerBound.z<=p.aabb.lowerBound.z);r--)e[r+1]=e[r];e[r+1]=p}return e}constructor(e){super();this.axisList=[];this.world=null;this.axisIndex=0;const h=this.axisList;this._addBodyHandler=
k=>{h.push(k.body)};this._removeBodyHandler=k=>{k=h.indexOf(k.body);-1!==k&&h.splice(k,1)};e&&this.setWorld(e)}setWorld(e){this.axisList.length=0;for(let h=0;h<e.bodies.length;h++)this.axisList.push(e.bodies[h]);e.removeEventListener("addBody",this._addBodyHandler);e.removeEventListener("removeBody",this._removeBodyHandler);e.addEventListener("addBody",this._addBodyHandler);e.addEventListener("removeBody",this._removeBodyHandler);this.world=e;this.dirty=!0}collisionPairs(e,h,k){e=this.axisList;const p=
e.length,r=this.axisIndex;let x,z;this.dirty&&(this.sortList(),this.dirty=!1);for(x=0;x!==p;x++){const w=e[x];for(z=x+1;z<p;z++){const C=e[z];if(this.needBroadphaseCollision(w,C)){if(!Od.checkBounds(w,C,r))break;this.intersectionTest(w,C,h,k)}}}}sortList(){const e=this.axisList,h=this.axisIndex,k=e.length;for(let p=0;p!==k;p++){const r=e[p];r.aabbNeedsUpdate&&r.updateAABB()}0===h?Od.insertionSortX(e):1===h?Od.insertionSortY(e):2===h&&Od.insertionSortZ(e)}autoDetectAxis(){var e=0;let h=0;var k=0;let p=
0;var r=0;let x=0;const z=this.axisList,w=z.length,C=1/w;for(let M=0;M!==w;M++){var K=z[M],R=K.position.x;e+=R;h+=R*R;R=K.position.y;k+=R;p+=R*R;K=K.position.z;r+=K;x+=K*K}e=h-e*e*C;k=p-k*k*C;r=x-r*r*C;this.axisIndex=e>k?e>r?0:2:k>r?1:2}aabbQuery(e,h,k){void 0===k&&(k=[]);this.dirty&&(this.sortList(),this.dirty=!1);e=this.axisIndex;var p="x";1===e&&(p="y");2===e&&(p="z");e=this.axisList;h.lowerBound[p];h.upperBound[p];for(p=0;p<e.length;p++){const r=e[p];r.aabbNeedsUpdate&&r.updateAABB();r.aabb.overlaps(h)&&
k.push(r)}return k}}q.SAPBroadphase=Od;class Pd{static defaults(e,h){void 0===e&&(e={});for(let k in h)k in e||(e[k]=h[k]);return e}}class Qd{constructor(e,h,k){void 0===k&&(k={});k=Pd.defaults(k,{collideConnected:!0,wakeUpBodies:!0});this.equations=[];this.bodyA=e;this.bodyB=h;this.id=Qd.idCounter++;this.collideConnected=k.collideConnected;k.wakeUpBodies&&(e&&e.wakeUp(),h&&h.wakeUp())}update(){throw Error("method update() not implmemented in this Constraint subclass!");}enable(){const e=this.equations;
for(let h=0;h<e.length;h++)e[h].enabled=!0}disable(){const e=this.equations;for(let h=0;h<e.length;h++)e[h].enabled=!1}}q.Constraint=Qd;Qd.idCounter=0;class Xe{constructor(){this.spatial=new B;this.rotational=new B}multiplyElement(e){return e.spatial.dot(this.spatial)+e.rotational.dot(this.rotational)}multiplyVectors(e,h){return e.dot(this.spatial)+h.dot(this.rotational)}}q.JacobianElement=Xe;class bd{constructor(e,h,k,p){void 0===k&&(k=-1E6);void 0===p&&(p=1E6);this.id=bd.idCounter++;this.minForce=
k;this.maxForce=p;this.bi=e;this.bj=h;this.eps=this.b=this.a=0;this.jacobianElementA=new Xe;this.jacobianElementB=new Xe;this.enabled=!0;this.multiplier=0;this.setSpookParams(1E7,4,1/60)}setSpookParams(e,h,k){this.a=4/(k*(1+4*h));this.b=4*h/(1+4*h);this.eps=4/(k*k*e*(1+4*h))}computeB(e,h,k){const p=this.computeGW(),r=this.computeGq(),x=this.computeGiMf();return-r*e-p*h-x*k}computeGq(){const e=this.jacobianElementB,h=this.bj.position;return this.jacobianElementA.spatial.dot(this.bi.position)+e.spatial.dot(h)}computeGW(){const e=
this.jacobianElementB,h=this.bi;var k=this.bj;const p=k.velocity;k=k.angularVelocity;return this.jacobianElementA.multiplyVectors(h.velocity,h.angularVelocity)+e.multiplyVectors(p,k)}computeGWlambda(){const e=this.jacobianElementB,h=this.bi;var k=this.bj;const p=k.vlambda;k=k.wlambda;return this.jacobianElementA.multiplyVectors(h.vlambda,h.wlambda)+e.multiplyVectors(p,k)}computeGiMf(){const e=this.jacobianElementA,h=this.jacobianElementB,k=this.bi,p=this.bj,r=k.torque,x=p.force,z=p.torque,w=p.invMassSolve;
k.force.scale(k.invMassSolve,Vg);x.scale(w,Wg);k.invInertiaWorldSolve.vmult(r,Xg);p.invInertiaWorldSolve.vmult(z,Yg);return e.multiplyVectors(Vg,Xg)+h.multiplyVectors(Wg,Yg)}computeGiMGt(){const e=this.jacobianElementA,h=this.jacobianElementB,k=this.bi;var p=this.bj;const r=p.invInertiaWorldSolve;p=k.invMassSolve+p.invMassSolve;k.invInertiaWorldSolve.vmult(e.rotational,Ye);p+=Ye.dot(e.rotational);r.vmult(h.rotational,Ye);return p+=Ye.dot(h.rotational)}addToWlambda(e){const h=this.jacobianElementA,
k=this.jacobianElementB,p=this.bi,r=this.bj,x=Ii;p.vlambda.addScaledVector(p.invMassSolve*e,h.spatial,p.vlambda);r.vlambda.addScaledVector(r.invMassSolve*e,k.spatial,r.vlambda);p.invInertiaWorldSolve.vmult(h.rotational,x);p.wlambda.addScaledVector(e,x,p.wlambda);r.invInertiaWorldSolve.vmult(k.rotational,x);r.wlambda.addScaledVector(e,x,r.wlambda)}computeC(){return this.computeGiMGt()+this.eps}}q.Equation=bd;bd.idCounter=0;const Vg=new B,Wg=new B,Xg=new B,Yg=new B,Ye=new B,Ii=new B;class Sd extends bd{constructor(e,
h,k){void 0===k&&(k=1E6);super(e,h,0,k);this.restitution=0;this.ri=new B;this.rj=new B;this.ni=new B}computeB(e){const h=this.a,k=this.b;var p=this.bi,r=this.bj;const x=this.ri,z=this.rj;var w=Ji,C=$g;const K=p.velocity,R=p.angularVelocity;p.force;p.torque;const M=r.velocity,V=r.angularVelocity;r.force;r.torque;const T=ah,W=this.jacobianElementA,S=this.jacobianElementB,ea=this.ni;x.cross(ea,w);z.cross(ea,C);ea.negate(W.spatial);w.negate(W.rotational);S.spatial.copy(ea);S.rotational.copy(C);T.copy(r.position);
T.vadd(z,T);T.vsub(p.position,T);T.vsub(x,T);p=ea.dot(T);r=this.restitution+1;w=r*M.dot(ea)-r*K.dot(ea)+V.dot(C)-R.dot(w);C=this.computeGiMf();return-p*h-w*k-e*C}getImpactVelocityAlongNormal(){const e=Ki,h=Li,k=Mi,p=Ni,r=Oi;this.bi.position.vadd(this.ri,k);this.bj.position.vadd(this.rj,p);this.bi.getVelocityAtWorldPoint(k,e);this.bj.getVelocityAtWorldPoint(p,h);e.vsub(h,r);return this.ni.dot(r)}}q.ContactEquation=Sd;const Ji=new B,$g=new B,ah=new B,Ki=new B,Li=new B,Mi=new B,Ni=new B,Oi=new B;class se extends Qd{constructor(e,
h,k,p,r){void 0===h&&(h=new B);void 0===p&&(p=new B);void 0===r&&(r=1E6);super(e,k);this.pivotA=h.clone();this.pivotB=p.clone();h=this.equationX=new Sd(e,k);p=this.equationY=new Sd(e,k);e=this.equationZ=new Sd(e,k);this.equations.push(h,p,e);h.minForce=p.minForce=e.minForce=-r;h.maxForce=p.maxForce=e.maxForce=r;h.ni.set(1,0,0);p.ni.set(0,1,0);e.ni.set(0,0,1)}update(){const e=this.bodyB,h=this.equationX,k=this.equationY,p=this.equationZ;this.bodyA.quaternion.vmult(this.pivotA,h.ri);e.quaternion.vmult(this.pivotB,
h.rj);k.ri.copy(h.ri);k.rj.copy(h.rj);p.ri.copy(h.ri);p.rj.copy(h.rj)}}q.PointToPointConstraint=se;class Pi extends bd{constructor(e,h,k){void 0===k&&(k={});const p="undefined"!==typeof k.maxForce?k.maxForce:1E6;super(e,h,-p,p);this.axisA=k.axisA?k.axisA.clone():new B(1,0,0);this.axisB=k.axisB?k.axisB.clone():new B(0,1,0);this.angle="undefined"!==typeof k.angle?k.angle:0}computeB(e){const h=this.a,k=this.b;var p=this.axisA,r=this.axisB,x=Qi;const z=Si,w=this.jacobianElementA,C=this.jacobianElementB;
p.cross(r,x);r.cross(p,z);w.rotational.copy(z);C.rotational.copy(x);p=Math.cos(this.angle)-p.dot(r);r=this.computeGW();x=this.computeGiMf();return-p*h-r*k-e*x}}const Qi=new B,Si=new B;class td extends bd{constructor(e,h,k){void 0===k&&(k={});const p="undefined"!==typeof k.maxForce?k.maxForce:1E6;super(e,h,-p,p);this.axisA=k.axisA?k.axisA.clone():new B(1,0,0);this.axisB=k.axisB?k.axisB.clone():new B(0,1,0);this.maxAngle=Math.PI/2}computeB(e){const h=this.a,k=this.b;var p=this.axisA,r=this.axisB,x=
bh;const z=Ti,w=this.jacobianElementA,C=this.jacobianElementB;p.cross(r,x);r.cross(p,z);w.rotational.copy(z);C.rotational.copy(x);p=Math.cos(this.maxAngle)-p.dot(r);r=this.computeGW();x=this.computeGiMf();return-p*h-r*k-e*x}}q.RotationalEquation=td;const bh=new B,Ti=new B;class Ui extends se{constructor(e,h,k){void 0===k&&(k={});const p="undefined"!==typeof k.maxForce?k.maxForce:1E6;var r=k.pivotA?k.pivotA.clone():new B;const x=k.pivotB?k.pivotB.clone():new B;super(e,r,h,x,p);this.axisA=k.axisA?k.axisA.clone():
new B;this.axisB=k.axisB?k.axisB.clone():new B;this.collideConnected=!!k.collideConnected;this.angle="undefined"!==typeof k.angle?k.angle:0;r=this.coneEquation=new Pi(e,h,k);e=this.twistEquation=new td(e,h,k);this.twistAngle="undefined"!==typeof k.twistAngle?k.twistAngle:0;r.maxForce=0;r.minForce=-p;e.maxForce=0;e.minForce=-p;this.equations.push(r,e)}update(){const e=this.bodyA,h=this.bodyB,k=this.coneEquation,p=this.twistEquation;super.update();e.vectorToWorldFrame(this.axisA,k.axisA);h.vectorToWorldFrame(this.axisB,
k.axisB);this.axisA.tangents(p.axisA,p.axisA);e.vectorToWorldFrame(p.axisA,p.axisA);this.axisB.tangents(p.axisB,p.axisB);h.vectorToWorldFrame(p.axisB,p.axisB);k.angle=this.angle;p.maxAngle=this.twistAngle}}q.ConeTwistConstraint=Ui;new B;new B;class af extends Qd{constructor(e,h,k,p){void 0===p&&(p=1E6);super(e,h);"undefined"===typeof k&&(k=e.position.distanceTo(h.position));this.distance=k;e=this.distanceEquation=new Sd(e,h);this.equations.push(e);e.minForce=-p;e.maxForce=p}update(){const e=this.distanceEquation,
h=.5*this.distance,k=e.ni;this.bodyB.position.vsub(this.bodyA.position,k);k.normalize();k.scale(h,e.ri);k.scale(-h,e.rj)}}q.DistanceConstraint=af;class ch extends se{constructor(e,h,k){void 0===k&&(k={});var p="undefined"!==typeof k.maxForce?k.maxForce:1E6,r=new B;const x=new B,z=new B;e.position.vadd(h.position,z);z.scale(.5,z);h.pointToLocalFrame(z,x);e.pointToLocalFrame(z,r);super(e,r,h,x,p);this.xA=e.vectorToLocalFrame(B.UNIT_X);this.xB=h.vectorToLocalFrame(B.UNIT_X);this.yA=e.vectorToLocalFrame(B.UNIT_Y);
this.yB=h.vectorToLocalFrame(B.UNIT_Y);this.zA=e.vectorToLocalFrame(B.UNIT_Z);this.zB=h.vectorToLocalFrame(B.UNIT_Z);p=this.rotationalEquation1=new td(e,h,k);r=this.rotationalEquation2=new td(e,h,k);e=this.rotationalEquation3=new td(e,h,k);this.equations.push(p,r,e)}update(){const e=this.bodyA,h=this.bodyB;this.motorEquation;const k=this.rotationalEquation1,p=this.rotationalEquation2,r=this.rotationalEquation3;Uf;dh;super.update();e.vectorToWorldFrame(this.xA,k.axisA);h.vectorToWorldFrame(this.yB,
k.axisB);e.vectorToWorldFrame(this.yA,p.axisA);h.vectorToWorldFrame(this.zB,p.axisB);e.vectorToWorldFrame(this.zA,r.axisA);h.vectorToWorldFrame(this.xB,r.axisB)}}q.LockConstraint=ch;const Uf=new B,dh=new B;class Td extends bd{constructor(e,h,k){void 0===k&&(k=1E6);super(e,h,-k,k);this.axisA=new B;this.axisB=new B;this.targetVelocity=0}computeB(e){this.a;const h=this.b;this.bi;this.bj;var k=this.axisB,p=this.jacobianElementB;this.jacobianElementA.rotational.copy(this.axisA);k.negate(p.rotational);
k=this.computeGW()-this.targetVelocity;p=this.computeGiMf();return-k*h-e*p}}q.RotationalMotorEquation=Td;class Ud extends se{constructor(e,h,k){void 0===k&&(k={});const p="undefined"!==typeof k.maxForce?k.maxForce:1E6;var r=k.pivotA?k.pivotA.clone():new B;const x=k.pivotB?k.pivotB.clone():new B;super(e,r,h,x,p);(this.axisA=k.axisA?k.axisA.clone():new B(1,0,0)).normalize();(this.axisB=k.axisB?k.axisB.clone():new B(1,0,0)).normalize();this.collideConnected=!!k.collideConnected;r=this.rotationalEquation1=
new td(e,h,k);k=this.rotationalEquation2=new td(e,h,k);e=this.motorEquation=new Td(e,h,p);e.enabled=!1;this.equations.push(r,k,e)}enableMotor(){this.motorEquation.enabled=!0}disableMotor(){this.motorEquation.enabled=!1}setMotorSpeed(e){this.motorEquation.targetVelocity=e}setMotorMaxForce(e){this.motorEquation.maxForce=e;this.motorEquation.minForce=-e}update(){const e=this.bodyA,h=this.bodyB,k=this.motorEquation,p=this.rotationalEquation1,r=this.rotationalEquation2,x=eh,z=ud,w=this.axisA,C=this.axisB;
super.update();e.quaternion.vmult(w,x);h.quaternion.vmult(C,z);x.tangents(p.axisA,r.axisA);p.axisB.copy(z);r.axisB.copy(z);this.motorEquation.enabled&&(e.quaternion.vmult(this.axisA,k.axisA),h.quaternion.vmult(this.axisB,k.axisB))}}q.HingeConstraint=Ud;const eh=new B,ud=new B;class vd extends bd{constructor(e,h,k){super(e,h,-k,k);this.ri=new B;this.rj=new B;this.t=new B}computeB(e){this.a;const h=this.b;this.bi;this.bj;var k=this.rj,p=Wi,r=Xi;const x=this.t;this.ri.cross(x,p);k.cross(x,r);k=this.jacobianElementA;
const z=this.jacobianElementB;x.negate(k.spatial);p.negate(k.rotational);z.spatial.copy(x);z.rotational.copy(r);p=this.computeGW();r=this.computeGiMf();return-p*h-e*r}}q.FrictionEquation=vd;const Wi=new B,Xi=new B;class Vd{constructor(e,h,k){k=Pd.defaults(k,{friction:.3,restitution:.3,contactEquationStiffness:1E7,contactEquationRelaxation:3,frictionEquationStiffness:1E7,frictionEquationRelaxation:3});this.id=Vd.idCounter++;this.materials=[e,h];this.friction=k.friction;this.restitution=k.restitution;
this.contactEquationStiffness=k.contactEquationStiffness;this.contactEquationRelaxation=k.contactEquationRelaxation;this.frictionEquationStiffness=k.frictionEquationStiffness;this.frictionEquationRelaxation=k.frictionEquationRelaxation}}q.ContactMaterial=Vd;Vd.idCounter=0;class Oc{constructor(e){void 0===e&&(e={});let h="";"string"===typeof e&&(h=e,e={});this.name=h;this.id=Oc.idCounter++;this.friction="undefined"!==typeof e.friction?e.friction:-1;this.restitution="undefined"!==typeof e.restitution?
e.restitution:-1}}q.Material=Oc;Oc.idCounter=0;class Ab{constructor(e,h,k){void 0===k&&(k={});this.restLength="number"===typeof k.restLength?k.restLength:1;this.stiffness=k.stiffness||100;this.damping=k.damping||1;this.bodyA=e;this.bodyB=h;this.localAnchorA=new B;this.localAnchorB=new B;k.localAnchorA&&this.localAnchorA.copy(k.localAnchorA);k.localAnchorB&&this.localAnchorB.copy(k.localAnchorB);k.worldAnchorA&&this.setWorldAnchorA(k.worldAnchorA);k.worldAnchorB&&this.setWorldAnchorB(k.worldAnchorB)}setWorldAnchorA(e){this.bodyA.pointToLocalFrame(e,
this.localAnchorA)}setWorldAnchorB(e){this.bodyB.pointToLocalFrame(e,this.localAnchorB)}getWorldAnchorA(e){this.bodyA.pointToWorldFrame(this.localAnchorA,e)}getWorldAnchorB(e){this.bodyB.pointToWorldFrame(this.localAnchorB,e)}applyForce(){const e=this.stiffness,h=this.damping,k=this.restLength,p=this.bodyA,r=this.bodyB,x=cf,z=gh,w=ef,C=df,K=jh;var R=ue;const M=hh,V=fh,T=te,W=Vf,S=ih;this.getWorldAnchorA(R);this.getWorldAnchorB(M);R.vsub(p.position,V);M.vsub(r.position,T);M.vsub(R,x);R=x.length();
z.copy(x);z.normalize();r.velocity.vsub(p.velocity,w);r.angularVelocity.cross(T,K);w.vadd(K,w);p.angularVelocity.cross(V,K);w.vsub(K,w);z.scale(-e*(R-k)-h*w.dot(z),C);p.force.vsub(C,p.force);r.force.vadd(C,r.force);V.cross(C,W);T.cross(C,S);p.torque.vsub(W,p.torque);r.torque.vadd(S,r.torque)}}q.Spring=Ab;const cf=new B,gh=new B,ef=new B,df=new B,ue=new B,hh=new B,fh=new B,te=new B,Vf=new B,ih=new B,jh=new B;class Wf{constructor(e){void 0===e&&(e={});e=Pd.defaults(e,{chassisConnectionPointLocal:new B,
chassisConnectionPointWorld:new B,directionLocal:new B,directionWorld:new B,axleLocal:new B,axleWorld:new B,suspensionRestLength:1,suspensionMaxLength:2,radius:1,suspensionStiffness:100,dampingCompression:10,dampingRelaxation:10,frictionSlip:10.5,forwardAcceleration:1,sideAcceleration:1,steering:0,rotation:0,deltaRotation:0,rollInfluence:.01,maxSuspensionForce:Number.MAX_VALUE,isFrontWheel:!0,clippedInvContactDotSuspension:1,suspensionRelativeVelocity:0,suspensionForce:0,slipInfo:0,skidInfo:0,suspensionLength:0,
maxSuspensionTravel:1,useCustomSlidingRotationalSpeed:!1,customSlidingRotationalSpeed:-.1});this.maxSuspensionTravel=e.maxSuspensionTravel;this.customSlidingRotationalSpeed=e.customSlidingRotationalSpeed;this.useCustomSlidingRotationalSpeed=e.useCustomSlidingRotationalSpeed;this.sliding=!1;this.chassisConnectionPointLocal=e.chassisConnectionPointLocal.clone();this.chassisConnectionPointWorld=e.chassisConnectionPointWorld.clone();this.directionLocal=e.directionLocal.clone();this.directionWorld=e.directionWorld.clone();
this.axleLocal=e.axleLocal.clone();this.axleWorld=e.axleWorld.clone();this.suspensionRestLength=e.suspensionRestLength;this.suspensionMaxLength=e.suspensionMaxLength;this.radius=e.radius;this.suspensionStiffness=e.suspensionStiffness;this.dampingCompression=e.dampingCompression;this.dampingRelaxation=e.dampingRelaxation;this.frictionSlip=e.frictionSlip;this.forwardAcceleration=e.forwardAcceleration;this.sideAcceleration=e.sideAcceleration;this.deltaRotation=this.rotation=this.steering=0;this.rollInfluence=
e.rollInfluence;this.maxSuspensionForce=e.maxSuspensionForce;this.brake=this.engineForce=0;this.isFrontWheel=e.isFrontWheel;this.clippedInvContactDotSuspension=1;this.forwardImpulse=this.sideImpulse=this.suspensionLength=this.skidInfo=this.slipInfo=this.suspensionForce=this.suspensionRelativeVelocity=0;this.raycastResult=new Nd;this.worldTransform=new $a;this.isInContact=!1}updateWheel(e){const h=this.raycastResult;if(this.isInContact){var k=h.hitNormalWorld.dot(h.directionWorld);h.hitPointWorld.vsub(e.position,
Xf);e.getVelocityAtWorldPoint(Xf,cd);e=h.hitNormalWorld.dot(cd);-.1<=k?(this.suspensionRelativeVelocity=0,this.clippedInvContactDotSuspension=10):(k=-1/k,this.suspensionRelativeVelocity=e*k,this.clippedInvContactDotSuspension=k)}else h.suspensionLength=this.suspensionRestLength,this.suspensionRelativeVelocity=0,h.directionWorld.scale(-1,h.hitNormalWorld),this.clippedInvContactDotSuspension=1}}q.WheelInfo=Wf;const cd=new B,Xf=new B;class kh{constructor(e){this.chassisBody=e.chassisBody;this.wheelInfos=
[];this.sliding=!1;this.world=null;this.indexRightAxis="undefined"!==typeof e.indexRightAxis?e.indexRightAxis:2;this.indexForwardAxis="undefined"!==typeof e.indexForwardAxis?e.indexForwardAxis:0;this.indexUpAxis="undefined"!==typeof e.indexUpAxis?e.indexUpAxis:1;this.constraints=[];this.preStepCallback=()=>{};this.numWheelsOnGround=this.currentVehicleSpeedKmHour=0}addWheel(e){void 0===e&&(e={});e=new Wf(e);const h=this.wheelInfos.length;this.wheelInfos.push(e);return h}setSteeringValue(e,h){this.wheelInfos[h].steering=
e}applyEngineForce(e,h){this.wheelInfos[h].engineForce=e}setBrake(e,h){this.wheelInfos[h].brake=e}addToWorld(e){e.addBody(this.chassisBody);const h=this;this.preStepCallback=()=>{h.updateVehicle(e.dt)};e.addEventListener("preStep",this.preStepCallback);this.world=e}getVehicleAxisWorld(e,h){h.set(0===e?1:0,1===e?1:0,2===e?1:0);this.chassisBody.vectorToWorldFrame(h,h)}updateVehicle(e){const h=this.wheelInfos,k=h.length,p=this.chassisBody;for(var r=0;r<k;r++)this.updateWheelTransform(r);this.currentVehicleSpeedKmHour=
3.6*p.velocity.length();r=new B;this.getVehicleAxisWorld(this.indexForwardAxis,r);0>r.dot(p.velocity)&&(this.currentVehicleSpeedKmHour*=-1);for(r=0;r<k;r++)this.castRay(h[r]);this.updateSuspension(e);r=new B;var x=new B;for(var z=0;z<k;z++){var w=h[z],C=w.suspensionForce;C>w.maxSuspensionForce&&(C=w.maxSuspensionForce);w.raycastResult.hitNormalWorld.scale(C*e,r);w.raycastResult.hitPointWorld.vsub(p.position,x);p.applyImpulse(r,x)}this.updateFriction(e);r=new B;x=new B;z=new B;for(w=0;w<k;w++){C=h[w];
p.getVelocityAtWorldPoint(C.chassisConnectionPointWorld,z);let R=1;switch(this.indexUpAxis){case 1:R=-1}if(C.isInContact){this.getVehicleAxisWorld(this.indexForwardAxis,x);var K=x.dot(C.raycastResult.hitNormalWorld);C.raycastResult.hitNormalWorld.scale(K,r);x.vsub(r,x);K=x.dot(z);C.deltaRotation=R*K*e/C.radius}!C.sliding&&C.isInContact||0===C.engineForce||!C.useCustomSlidingRotationalSpeed||(C.deltaRotation=(0<C.engineForce?1:-1)*C.customSlidingRotationalSpeed*e);Math.abs(C.brake)>Math.abs(C.engineForce)&&
(C.deltaRotation=0);C.rotation+=C.deltaRotation;C.deltaRotation*=.99}}updateSuspension(e){e=this.chassisBody.mass;const h=this.wheelInfos,k=h.length;for(let p=0;p<k;p++){const r=h[p];if(r.isInContact){let x;x=r.suspensionStiffness*(r.suspensionRestLength-r.suspensionLength)*r.clippedInvContactDotSuspension;const z=r.suspensionRelativeVelocity;x-=(0>z?r.dampingCompression:r.dampingRelaxation)*z;r.suspensionForce=x*e;0>r.suspensionForce&&(r.suspensionForce=0)}else r.suspensionForce=0}}removeFromWorld(e){this.constraints;
e.removeBody(this.chassisBody);e.removeEventListener("preStep",this.preStepCallback);this.world=null}castRay(e){var h=lh,k=mh;this.updateWheelTransformWorld(e);var p=this.chassisBody;let r=-1;e.directionWorld.scale(e.suspensionRestLength+e.radius,h);var x=e.chassisConnectionPointWorld;x.vadd(h,k);h=e.raycastResult;h.reset();const z=p.collisionResponse;p.collisionResponse=!1;this.world.rayTest(x,k,h);p.collisionResponse=z;k=h.body;e.raycastResult.groundObject=0;k?(r=h.distance,e.raycastResult.hitNormalWorld=
h.hitNormalWorld,e.isInContact=!0,e.suspensionLength=h.distance-e.radius,k=e.suspensionRestLength-e.maxSuspensionTravel,x=e.suspensionRestLength+e.maxSuspensionTravel,e.suspensionLength<k&&(e.suspensionLength=k),e.suspensionLength>x&&(e.suspensionLength=x,e.raycastResult.reset()),k=e.raycastResult.hitNormalWorld.dot(e.directionWorld),x=new B,p.getVelocityAtWorldPoint(e.raycastResult.hitPointWorld,x),p=e.raycastResult.hitNormalWorld.dot(x),-.1<=k?(e.suspensionRelativeVelocity=0,e.clippedInvContactDotSuspension=
10):(k=-1/k,e.suspensionRelativeVelocity=p*k,e.clippedInvContactDotSuspension=k)):(e.suspensionLength=e.suspensionRestLength+0*e.maxSuspensionTravel,e.suspensionRelativeVelocity=0,e.directionWorld.scale(-1,e.raycastResult.hitNormalWorld),e.clippedInvContactDotSuspension=1);return r}updateWheelTransformWorld(e){e.isInContact=!1;const h=this.chassisBody;h.pointToWorldFrame(e.chassisConnectionPointLocal,e.chassisConnectionPointWorld);h.vectorToWorldFrame(e.directionLocal,e.directionWorld);h.vectorToWorldFrame(e.axleLocal,
e.axleWorld)}updateWheelTransform(e){var h=Yf,k=Zf,p=Yi;e=this.wheelInfos[e];this.updateWheelTransformWorld(e);e.directionLocal.scale(-1,h);k.copy(e.axleLocal);h.cross(k,p);p.normalize();k.normalize();const r=e.steering;p=new xb;p.setFromAxisAngle(h,r);h=new xb;h.setFromAxisAngle(k,e.rotation);k=e.worldTransform.quaternion;this.chassisBody.quaternion.mult(p,k);k.mult(h,k);k.normalize();k=e.worldTransform.position;k.copy(e.directionWorld);k.scale(e.suspensionLength,k);k.vadd(e.chassisConnectionPointWorld,
k)}getWheelTransformWorld(e){return this.wheelInfos[e].worldTransform}updateFriction(e){var h=nh;const k=this.wheelInfos,p=k.length,r=this.chassisBody,x=Pc,z=Eb;this.numWheelsOnGround=0;for(var w=0;w<p;w++){var C=k[w];C.raycastResult.body&&this.numWheelsOnGround++;C.sideImpulse=0;C.forwardImpulse=0;x[w]||(x[w]=new B);z[w]||(z[w]=new B)}for(w=0;w<p;w++){C=k[w];var K=C.raycastResult.body;if(K){var R=z[w];this.getWheelTransformWorld(w).vectorToWorldFrame(bg[this.indexRightAxis],R);var M=C.raycastResult.hitNormalWorld,
V=R.dot(M);M.scale(V,h);R.vsub(h,R);R.normalize();M.cross(R,x[w]);x[w].normalize();M=r;var T=V=C.raycastResult.hitPointWorld;if(1.1<R.lengthSquared())M=0;else{var W=Xd,S=Eg,ea=qh;M.getVelocityAtWorldPoint(V,W);K.getVelocityAtWorldPoint(T,S);W.vsub(S,ea);M=-.2*R.dot(ea)*(1/(M.invMass+K.invMass))}C.sideImpulse=M;C.sideImpulse*=1}}this.sliding=!1;for(h=0;h<p;h++){w=k[h];C=w.raycastResult.body;V=0;w.slipInfo=1;if(C){M=w.brake?w.brake:0;W=r;K=C;T=w.raycastResult.hitPointWorld;R=x[h];V=M;S=T;ea=Sb;const ha=
ph,ya=wd;W.getVelocityAtWorldPoint(S,ea);K.getVelocityAtWorldPoint(S,ha);ea.vsub(ha,ya);S=R.dot(ya);W=$b(W,T,R);K=$b(K,T,R);K=1/(W+K)*-S;V<K&&(K=V);K<-V&&(K=-V);V=K;V+=w.engineForce*e;w.slipInfo*=M/V}w.forwardImpulse=0;w.skidInfo=1;C&&(w.skidInfo=1,C=w.suspensionForce*e*w.frictionSlip,M=C*C,w.forwardImpulse=V,V=.5*w.forwardImpulse/w.forwardAcceleration,K=1*w.sideImpulse/w.sideAcceleration,V=V*V+K*K,w.sliding=!1,V>M&&(this.sliding=!0,w.sliding=!0,w.skidInfo*=C/Math.sqrt(V)))}if(this.sliding)for(e=
0;e<p;e++)h=k[e],0!==h.sideImpulse&&1>h.skidInfo&&(h.forwardImpulse*=h.skidInfo,h.sideImpulse*=h.skidInfo);for(e=0;e<p;e++)h=k[e],w=new B,h.raycastResult.hitPointWorld.vsub(r.position,w),0!==h.forwardImpulse&&(C=new B,x[e].scale(h.forwardImpulse,C),r.applyImpulse(C,w)),0!==h.sideImpulse&&(C=h.raycastResult.body,M=new B,h.raycastResult.hitPointWorld.vsub(C.position,M),V=new B,z[e].scale(h.sideImpulse,V),r.vectorToLocalFrame(w,w),w["xyz"[this.indexUpAxis]]*=h.rollInfluence,r.vectorToWorldFrame(w,w),
r.applyImpulse(V,w),V.scale(-1,V),C.applyImpulse(V,M))}}q.RaycastVehicle=kh;new B;new B;new B;const Yf=new B,Zf=new B,Yi=new B;new Fb;new B;const lh=new B,mh=new B,bg=[new B(1,0,0),new B(0,1,0),new B(0,0,1)],nh=new B,Eb=[],Pc=[],Sb=new B,ph=new B,wd=new B,Wd=new B,sa=new B,Za=new B,cg=new B,Xd=new B,Eg=new B,qh=new B;class dg extends Ca{constructor(e){super({type:Ca.types.SPHERE});this.radius=void 0!==e?e:1;if(0>this.radius)throw Error("The sphere radius cannot be negative.");this.updateBoundingSphereRadius()}calculateLocalInertia(e,
h){void 0===h&&(h=new B);e=2*e*this.radius*this.radius/5;h.x=e;h.y=e;h.z=e;return h}volume(){return 4*Math.PI*Math.pow(this.radius,3)/3}updateBoundingSphereRadius(){this.boundingSphereRadius=this.radius}calculateWorldAABB(e,h,k,p){h=this.radius;const r=["x","y","z"];for(let x=0;x<r.length;x++){const z=r[x];k[z]=e[z]-h;p[z]=e[z]+h}}}q.Sphere=dg;class gf{constructor(e){void 0===e&&(e={});this.wheelBodies=[];this.coordinateSystem="undefined"!==typeof e.coordinateSystem?e.coordinateSystem.clone():new B(1,
2,3);this.chassisBody=e.chassisBody?e.chassisBody:new Ka({mass:1,shape:new Te(new B(5,.5,2))});this.constraints=[];this.wheelAxes=[];this.wheelForces=[]}addWheel(e){void 0===e&&(e={});var h=e.body?e.body:new Ka({mass:1,shape:new dg(1.2)});this.wheelBodies.push(h);this.wheelForces.push(0);const k="undefined"!==typeof e.position?e.position.clone():new B,p=new B;this.chassisBody.pointToWorldFrame(k,p);h.position.set(p.x,p.y,p.z);e="undefined"!==typeof e.axis?e.axis.clone():new B(0,0,1);this.wheelAxes.push(e);
h=new Ud(this.chassisBody,h,{pivotA:k,axisA:e,pivotB:B.ZERO,axisB:e,collideConnected:!1});this.constraints.push(h);return this.wheelBodies.length-1}setSteeringValue(e,h){var k=this.wheelAxes[h];const p=Math.cos(e);e=Math.sin(e);const r=k.x;k=k.z;this.constraints[h].axisA.set(-p*r+e*k,0,e*r+p*k)}setMotorSpeed(e,h){h=this.constraints[h];h.enableMotor();h.motorTargetVelocity=e}disableMotor(e){this.constraints[e].disableMotor()}setWheelForce(e,h){this.wheelForces[h]=e}applyWheelForce(e,h){const k=this.wheelBodies[h],
p=k.torque;this.wheelAxes[h].scale(e,hf);k.vectorToWorldFrame(hf,hf);p.vadd(hf,p)}addToWorld(e){const h=this.constraints;var k=this.wheelBodies.concat([this.chassisBody]);for(let p=0;p<k.length;p++)e.addBody(k[p]);for(k=0;k<h.length;k++)e.addConstraint(h[k]);e.addEventListener("preStep",this._update.bind(this))}_update(){const e=this.wheelForces;for(let h=0;h<e.length;h++)this.applyWheelForce(e[h],h)}removeFromWorld(e){const h=this.constraints;var k=this.wheelBodies.concat([this.chassisBody]);for(let p=
0;p<k.length;p++)e.removeBody(k[p]);for(k=0;k<h.length;k++)e.removeConstraint(h[k])}getWheelSpeed(e){const h=this.wheelBodies[e].angularVelocity;this.chassisBody.vectorToWorldFrame(this.wheelAxes[e],jb);return h.dot(jb)}}q.RigidVehicle=gf;const hf=new B,jb=new B;class Yd{constructor(){this.particles=[];this.speedOfSound=this.smoothingRadius=this.density=1;this.viscosity=.01;this.eps=1E-6;this.pressures=[];this.densities=[];this.neighbors=[]}add(e){this.particles.push(e);this.neighbors.length<this.particles.length&&
this.neighbors.push([])}remove(e){e=this.particles.indexOf(e);-1!==e&&(this.particles.splice(e,1),this.neighbors.length>this.particles.length&&this.neighbors.pop())}getNeighbors(e,h){const k=this.particles.length,p=e.id,r=this.smoothingRadius*this.smoothingRadius,x=If;for(let z=0;z!==k;z++){const w=this.particles[z];w.position.vsub(e.position,x);p!==w.id&&x.lengthSquared()<r&&h.push(w)}}update(){const e=this.particles.length;var h=$i,k=this.speedOfSound;const p=this.eps;for(var r=0;r!==e;r++){var x=
this.particles[r],z=this.neighbors[r];z.length=0;this.getNeighbors(x,z);z.push(this.particles[r]);var w=z.length,C=0;for(var K=0;K!==w;K++){x.position.vsub(z[K].position,h);var R=h.length();R=this.w(R);C+=z[K].mass*R}this.densities[r]=C;this.pressures[r]=k*k*(this.densities[r]-this.density)}h=xd;k=aj;r=Gb;x=mb;z=rh;for(w=0;w!==e;w++){C=this.particles[w];h.set(0,0,0);k.set(0,0,0);var M=void 0;K=this.neighbors[w];R=K.length;for(let V=0;V!==R;V++){const T=K[V];C.position.vsub(T.position,x);const W=x.length();
M=-T.mass*(this.pressures[w]/(this.densities[w]*this.densities[w]+p)+this.pressures[V]/(this.densities[V]*this.densities[V]+p));this.gradw(x,r);r.scale(M,r);h.vadd(r,h);T.velocity.vsub(C.velocity,z);z.scale(1/(1E-4+this.densities[w]*this.densities[V])*this.viscosity*T.mass,z);M=this.nablaw(W);z.scale(M,z);k.vadd(z,k)}k.scale(C.mass,k);h.scale(C.mass,h);C.force.vadd(k,C.force);C.force.vadd(h,C.force)}}w(e){const h=this.smoothingRadius;return 315/(64*Math.PI*h**9)*(h*h-e*e)**3}gradw(e,h){const k=e.length(),
p=this.smoothingRadius;e.scale(945/(32*Math.PI*p**9)*(p*p-k*k)**2,h)}nablaw(e){const h=this.smoothingRadius;return 945/(32*Math.PI*h**9)*(h*h-e*e)*(7*e*e-3*h*h)}}q.SPHSystem=Yd;const If=new B,$i=new B,xd=new B,aj=new B,Gb=new B,mb=new B,rh=new B;class rc extends Mc{constructor(e,h,k,p){void 0===e&&(e=1);void 0===h&&(h=1);void 0===k&&(k=1);void 0===p&&(p=8);if(0>e)throw Error("The cylinder radiusTop cannot be negative.");if(0>h)throw Error("The cylinder radiusBottom cannot be negative.");var r=p;const x=
[],z=[],w=[];var C=[];const K=[],R=Math.cos,M=Math.sin;x.push(new B(-h*M(0),.5*-k,h*R(0)));C.push(0);x.push(new B(-e*M(0),.5*k,e*R(0)));K.push(1);for(let V=0;V<r;V++){const T=2*Math.PI/r*(V+1),W=2*Math.PI/r*(V+.5);V<r-1?(x.push(new B(-h*M(T),.5*-k,h*R(T))),C.push(2*V+2),x.push(new B(-e*M(T),.5*k,e*R(T))),K.push(2*V+3),w.push([2*V,2*V+1,2*V+3,2*V+2])):w.push([2*V,2*V+1,1,0]);(1===r%2||V<r/2)&&z.push(new B(-M(W),0,R(W)))}w.push(C);z.push(new B(0,1,0));r=[];for(C=0;C<K.length;C++)r.push(K[K.length-C-
1]);w.push(r);super({vertices:x,faces:w,axes:z});this.type=Ca.types.CYLINDER;this.radiusTop=e;this.radiusBottom=h;this.height=k;this.numSegments=p}}q.Cylinder=rc;class Ue extends Ca{constructor(){super({type:Ca.types.PARTICLE})}calculateLocalInertia(e,h){void 0===h&&(h=new B);h.set(0,0,0);return h}volume(){return 0}updateBoundingSphereRadius(){this.boundingSphereRadius=0}calculateWorldAABB(e,h,k,p){k.copy(e);p.copy(e)}}q.Particle=Ue;class bj extends Ca{constructor(){super({type:Ca.types.PLANE});this.worldNormal=
new B;this.worldNormalNeedsUpdate=!0;this.boundingSphereRadius=Number.MAX_VALUE}computeWorldNormal(e){const h=this.worldNormal;h.set(0,0,1);e.vmult(h,h);this.worldNormalNeedsUpdate=!1}calculateLocalInertia(e,h){void 0===h&&(h=new B);return h}volume(){return Number.MAX_VALUE}calculateWorldAABB(e,h,k,p){xc.set(0,0,1);h.vmult(xc,xc);h=Number.MAX_VALUE;k.set(-h,-h,-h);p.set(h,h,h);1===xc.x?p.x=e.x:-1===xc.x&&(k.x=e.x);1===xc.y?p.y=e.y:-1===xc.y&&(k.y=e.y);1===xc.z?p.z=e.z:-1===xc.z&&(k.z=e.z)}updateBoundingSphereRadius(){this.boundingSphereRadius=
Number.MAX_VALUE}}q.Plane=bj;const xc=new B;class cj extends Ca{constructor(e,h){void 0===h&&(h={});h=Pd.defaults(h,{maxValue:null,minValue:null,elementSize:1});super({type:Ca.types.HEIGHTFIELD});this.data=e;this.maxValue=h.maxValue;this.minValue=h.minValue;this.elementSize=h.elementSize;null===h.minValue&&this.updateMinValue();null===h.maxValue&&this.updateMaxValue();this.cacheEnabled=!0;this.pillarConvex=new Mc;this.pillarOffset=new B;this.updateBoundingSphereRadius();this._cachedPillars={}}update(){this._cachedPillars=
{}}updateMinValue(){const e=this.data;let h=e[0][0];for(let k=0;k!==e.length;k++)for(let p=0;p!==e[k].length;p++){const r=e[k][p];r<h&&(h=r)}this.minValue=h}updateMaxValue(){const e=this.data;let h=e[0][0];for(let k=0;k!==e.length;k++)for(let p=0;p!==e[k].length;p++){const r=e[k][p];r>h&&(h=r)}this.maxValue=h}setHeightValueAtIndex(e,h,k){this.data[e][h]=k;this.clearCachedConvexTrianglePillar(e,h,!1);0<e&&(this.clearCachedConvexTrianglePillar(e-1,h,!0),this.clearCachedConvexTrianglePillar(e-1,h,!1));
0<h&&(this.clearCachedConvexTrianglePillar(e,h-1,!0),this.clearCachedConvexTrianglePillar(e,h-1,!1));0<h&&0<e&&this.clearCachedConvexTrianglePillar(e-1,h-1,!0)}getRectMinMax(e,h,k,p,r){void 0===r&&(r=[]);const x=this.data;let z=this.minValue;for(;e<=k;e++)for(let w=h;w<=p;w++){const C=x[e][w];C>z&&(z=C)}r[0]=this.minValue;r[1]=z}getIndexOfPosition(e,h,k,p){const r=this.elementSize,x=this.data;e=Math.floor(e/r);h=Math.floor(h/r);k[0]=e;k[1]=h;p&&(0>e&&(e=0),0>h&&(h=0),e>=x.length-1&&(e=x.length-1),
h>=x[0].length-1&&(h=x[0].length-1));return 0>e||0>h||e>=x.length-1||h>=x[0].length-1?!1:!0}getTriangleAt(e,h,k,p,r,x){var z=sh;this.getIndexOfPosition(e,h,z,k);let w=z[0];z=z[1];const C=this.data;k&&(w=Math.min(C.length-2,Math.max(0,w)),z=Math.min(C[0].length-2,Math.max(0,z)));k=this.elementSize;e=(e/k-w)**2+(h/k-z)**2>(e/k-(w+1))**2+(h/k-(z+1))**2;this.getTriangle(w,z,e,p,r,x);return e}getNormalAt(e,h,k,p){const r=Jc,x=Rc,z=yc,w=jf,C=Zd;this.getTriangleAt(e,h,k,r,x,z);x.vsub(r,w);z.vsub(r,C);w.cross(C,
p);p.normalize()}getAabbAtIndex(e,h,k){let {lowerBound:p,upperBound:r}=k;k=this.data;const x=this.elementSize;p.set(e*x,h*x,k[e][h]);r.set((e+1)*x,(h+1)*x,k[e+1][h+1])}getHeightAt(e,h,k){const p=this.data;var r=O,x=eg,z=th,w=sh;this.getIndexOfPosition(e,h,w,k);let C=w[0];w=w[1];k&&(C=Math.min(p.length-2,Math.max(0,C)),w=Math.min(p[0].length-2,Math.max(0,w)));k=this.getTriangleAt(e,h,k,r,x,z);var K=r.x;r=r.y;var R=x.x;x=x.y;var M=z.x;z=z.y;var V=Xb;V.x=((x-z)*(e-M)+(M-R)*(h-z))/((x-z)*(K-M)+(M-R)*
(r-z));V.y=((z-r)*(e-M)+(K-M)*(h-z))/((x-z)*(K-M)+(M-R)*(r-z));V.z=1-V.x-V.y;e=Xb;return k?p[C+1][w+1]*e.x+p[C][w+1]*e.y+p[C+1][w]*e.z:p[C][w]*e.x+p[C+1][w]*e.y+p[C][w+1]*e.z}getCacheConvexTrianglePillarKey(e,h,k){return`${e}_${h}_${k?1:0}`}getCachedConvexTrianglePillar(e,h,k){return this._cachedPillars[this.getCacheConvexTrianglePillarKey(e,h,k)]}setCachedConvexTrianglePillar(e,h,k,p,r){this._cachedPillars[this.getCacheConvexTrianglePillarKey(e,h,k)]={convex:p,offset:r}}clearCachedConvexTrianglePillar(e,
h,k){delete this._cachedPillars[this.getCacheConvexTrianglePillarKey(e,h,k)]}getTriangle(e,h,k,p,r,x){const z=this.data,w=this.elementSize;k?(p.set((e+1)*w,(h+1)*w,z[e+1][h+1]),r.set(e*w,(h+1)*w,z[e][h+1]),x.set((e+1)*w,h*w,z[e+1][h])):(p.set(e*w,h*w,z[e][h]),r.set((e+1)*w,h*w,z[e+1][h]),x.set(e*w,(h+1)*w,z[e][h+1]))}getConvexTrianglePillar(e,h,k){var p=this.pillarConvex;let r=this.pillarOffset;if(this.cacheEnabled){if(p=this.getCachedConvexTrianglePillar(e,h,k)){this.pillarConvex=p.convex;this.pillarOffset=
p.offset;return}p=new Mc;r=new B;this.pillarConvex=p;this.pillarOffset=r}const x=this.data,z=this.elementSize,w=p.faces;p.vertices.length=6;for(var C=0;6>C;C++)p.vertices[C]||(p.vertices[C]=new B);w.length=5;for(C=0;5>C;C++)w[C]||(w[C]=[]);C=p.vertices;const K=(Math.min(x[e][h],x[e+1][h],x[e][h+1],x[e+1][h+1])-this.minValue)/2+this.minValue;k?(r.set((e+.75)*z,(h+.75)*z,K),C[0].set(.25*z,.25*z,x[e+1][h+1]-K),C[1].set(-.75*z,.25*z,x[e][h+1]-K),C[2].set(.25*z,-.75*z,x[e+1][h]-K),C[3].set(.25*z,.25*z,
-Math.abs(K)-1),C[4].set(-.75*z,.25*z,-Math.abs(K)-1),C[5].set(.25*z,-.75*z,-Math.abs(K)-1),w[0][0]=0,w[0][1]=1,w[0][2]=2,w[1][0]=5,w[1][1]=4,w[1][2]=3,w[2][0]=2,w[2][1]=5,w[2][2]=3,w[2][3]=0,w[3][0]=3,w[3][1]=4,w[3][2]=1,w[3][3]=0,w[4][0]=1,w[4][1]=4,w[4][2]=5,w[4][3]=2):(r.set((e+.25)*z,(h+.25)*z,K),C[0].set(-.25*z,-.25*z,x[e][h]-K),C[1].set(.75*z,-.25*z,x[e+1][h]-K),C[2].set(-.25*z,.75*z,x[e][h+1]-K),C[3].set(-.25*z,-.25*z,-Math.abs(K)-1),C[4].set(.75*z,-.25*z,-Math.abs(K)-1),C[5].set(-.25*z,.75*
z,-Math.abs(K)-1),w[0][0]=0,w[0][1]=1,w[0][2]=2,w[1][0]=5,w[1][1]=4,w[1][2]=3,w[2][0]=0,w[2][1]=2,w[2][2]=5,w[2][3]=3,w[3][0]=1,w[3][1]=0,w[3][2]=3,w[3][3]=4,w[4][0]=4,w[4][1]=5,w[4][2]=2,w[4][3]=1);p.computeNormals();p.computeEdges();p.updateBoundingSphereRadius();this.setCachedConvexTrianglePillar(e,h,k,p,r)}calculateLocalInertia(e,h){void 0===h&&(h=new B);h.set(0,0,0);return h}volume(){return Number.MAX_VALUE}calculateWorldAABB(e,h,k,p){k.set(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE);
p.set(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE)}updateBoundingSphereRadius(){const e=this.data,h=this.elementSize;this.boundingSphereRadius=(new B(e.length*h,e[0].length*h,Math.max(Math.abs(this.maxValue),Math.abs(this.minValue)))).length()}setHeightsFromImage(e,h){const {x:k,z:p,y:r}=h;h=document.createElement("canvas");h.width=e.width;h.height=e.height;h=h.getContext("2d");h.drawImage(e,0,0);e=h.getImageData(0,0,e.width,e.height);h=this.data;h.length=0;this.elementSize=Math.abs(k)/e.width;
for(let x=0;x<e.height;x++){const z=[];for(let w=0;w<e.width;w++){const C=(e.data[4*(x*e.height+w)]+e.data[4*(x*e.height+w)+1]+e.data[4*(x*e.height+w)+2])/4/255*p;0>k?z.push(C):z.unshift(C)}0>r?h.unshift(z):h.push(z)}this.updateMaxValue();this.updateMinValue();this.update()}}q.Heightfield=cj;const sh=[],Xb=new B,O=new B,eg=new B,th=new B,Jc=new B,Rc=new B,yc=new B,jf=new B,Zd=new B;class dc{constructor(e){void 0===e&&(e={});this.root=e.root||null;this.aabb=e.aabb?e.aabb.clone():new tb;this.data=[];
this.children=[]}reset(){this.children.length=this.data.length=0}insert(e,h,k){void 0===k&&(k=0);const p=this.data;if(!this.aabb.contains(e))return!1;const r=this.children;if(k<(this.maxDepth||this.root.maxDepth)){let x=!1;r.length||(this.subdivide(),x=!0);for(let z=0;8!==z;z++)if(r[z].insert(e,h,k+1))return!0;x&&(r.length=0)}p.push(h);return!0}subdivide(){var e=this.aabb;const h=e.lowerBound;var k=e.upperBound;e=this.children;e.push(new dc({aabb:new tb({lowerBound:new B(0,0,0)})}),new dc({aabb:new tb({lowerBound:new B(1,
0,0)})}),new dc({aabb:new tb({lowerBound:new B(1,1,0)})}),new dc({aabb:new tb({lowerBound:new B(1,1,1)})}),new dc({aabb:new tb({lowerBound:new B(0,1,1)})}),new dc({aabb:new tb({lowerBound:new B(0,0,1)})}),new dc({aabb:new tb({lowerBound:new B(1,0,1)})}),new dc({aabb:new tb({lowerBound:new B(0,1,0)})}));k.vsub(h,ec);ec.scale(.5,ec);k=this.root||this;for(let p=0;8!==p;p++){const r=e[p];r.root=k;const x=r.aabb.lowerBound;x.x*=ec.x;x.y*=ec.y;x.z*=ec.z;x.vadd(h,x);x.vadd(ec,r.aabb.upperBound)}}aabbQuery(e,
h){this.data;this.children;const k=[this];for(;k.length;){const p=k.pop();p.aabb.overlaps(e)&&Array.prototype.push.apply(h,p.data);Array.prototype.push.apply(k,p.children)}return h}rayQuery(e,h,k){e.getAABB(zc);zc.toLocalFrame(h,zc);this.aabbQuery(zc,k);return k}removeEmptyNodes(){for(let e=this.children.length-1;0<=e;e--)this.children[e].removeEmptyNodes(),this.children[e].children.length||this.children[e].data.length||this.children.splice(e,1)}}class $d extends dc{constructor(e,h){void 0===h&&(h=
{});super({root:null,aabb:e});this.maxDepth="undefined"!==typeof h.maxDepth?h.maxDepth:8}}const ec=new B,zc=new tb;class Qc extends Ca{constructor(e,h){super({type:Ca.types.TRIMESH});this.vertices=new Float32Array(e);this.indices=new Int16Array(h);this.normals=new Float32Array(h.length);this.aabb=new tb;this.edges=null;this.scale=new B(1,1,1);this.tree=new $d;this.updateEdges();this.updateNormals();this.updateAABB();this.updateBoundingSphereRadius();this.updateTree()}updateTree(){const e=this.tree;
e.reset();e.aabb.copy(this.aabb);var h=this.scale;e.aabb.lowerBound.x*=1/h.x;e.aabb.lowerBound.y*=1/h.y;e.aabb.lowerBound.z*=1/h.z;e.aabb.upperBound.x*=1/h.x;e.aabb.upperBound.y*=1/h.y;e.aabb.upperBound.z*=1/h.z;h=new tb;const k=new B,p=new B,r=new B,x=[k,p,r];for(let z=0;z<this.indices.length/3;z++){const w=3*z;this._getUnscaledVertex(this.indices[w],k);this._getUnscaledVertex(this.indices[w+1],p);this._getUnscaledVertex(this.indices[w+2],r);h.setFromPoints(x);e.insert(h,z)}e.removeEmptyNodes()}getTrianglesInAABB(e,
h){yd.copy(e);var k=this.scale;e=k.x;const p=k.y;k=k.z;const r=yd.lowerBound,x=yd.upperBound;r.x/=e;r.y/=p;r.z/=k;x.x/=e;x.y/=p;x.z/=k;return this.tree.aabbQuery(yd,h)}setScale(e){const h=e.x===e.y&&e.y===e.z;this.scale.x===this.scale.y&&this.scale.y===this.scale.z&&h||this.updateNormals();this.scale.copy(e);this.updateAABB();this.updateBoundingSphereRadius()}updateNormals(){const e=xe,h=this.normals;for(let k=0;k<this.indices.length/3;k++){const p=3*k,r=this.indices[p+1],x=this.indices[p+2];this.getVertex(this.indices[p],
lf);this.getVertex(r,oc);this.getVertex(x,Kc);Qc.computeNormal(oc,lf,Kc,e);h[p]=e.x;h[p+1]=e.y;h[p+2]=e.z}}updateEdges(){const e={};var h=(x,z)=>{e[x<z?`${x}_${z}`:`${z}_${x}`]=!0};for(var k=0;k<this.indices.length/3;k++){var p=3*k,r=this.indices[p];const x=this.indices[p+1];p=this.indices[p+2];h(r,x);h(x,p);h(p,r)}h=Object.keys(e);this.edges=new Int16Array(2*h.length);for(k=0;k<h.length;k++)r=h[k].split("_"),this.edges[2*k]=parseInt(r[0],10),this.edges[2*k+1]=parseInt(r[1],10)}getEdgeVertex(e,h,
k){this.getVertex(this.edges[2*e+(h?1:0)],k)}getEdgeVector(e,h){const k=kf,p=od;this.getEdgeVertex(e,0,k);this.getEdgeVertex(e,1,p);p.vsub(k,h)}static computeNormal(e,h,k,p){h.vsub(e,ae);k.vsub(h,uh);uh.cross(ae,p);p.isZero()||p.normalize()}getVertex(e,h){const k=this.scale;this._getUnscaledVertex(e,h);h.x*=k.x;h.y*=k.y;h.z*=k.z;return h}_getUnscaledVertex(e,h){e*=3;const k=this.vertices;return h.set(k[e],k[e+1],k[e+2])}getWorldVertex(e,h,k,p){this.getVertex(e,p);$a.pointToWorldFrame(h,k,p,p);return p}getTriangleVertices(e,
h,k,p){e*=3;this.getVertex(this.indices[e],h);this.getVertex(this.indices[e+1],k);this.getVertex(this.indices[e+2],p)}getNormal(e,h){e*=3;return h.set(this.normals[e],this.normals[e+1],this.normals[e+2])}calculateLocalInertia(e,h){this.computeLocalAABB(Sc);const k=Sc.upperBound.x-Sc.lowerBound.x,p=Sc.upperBound.y-Sc.lowerBound.y,r=Sc.upperBound.z-Sc.lowerBound.z;return h.set(1/12*e*(4*p*p+4*r*r),1/12*e*(4*k*k+4*r*r),1/12*e*(4*p*p+4*k*k))}computeLocalAABB(e){const h=e.lowerBound;e=e.upperBound;const k=
this.vertices.length;this.vertices;const p=mf;this.getVertex(0,p);h.copy(p);e.copy(p);for(let r=0;r!==k;r++)this.getVertex(r,p),p.x<h.x?h.x=p.x:p.x>e.x&&(e.x=p.x),p.y<h.y?h.y=p.y:p.y>e.y&&(e.y=p.y),p.z<h.z?h.z=p.z:p.z>e.z&&(e.z=p.z)}updateAABB(){this.computeLocalAABB(this.aabb)}updateBoundingSphereRadius(){let e=0;var h=this.vertices;const k=new B;for(let p=0,r=h.length/3;p!==r;p++)this.getVertex(p,k),h=k.lengthSquared(),h>e&&(e=h);this.boundingSphereRadius=Math.sqrt(e)}calculateWorldAABB(e,h,k,p){const r=
dd,x=fg;r.position=e;r.quaternion=h;this.aabb.toWorldFrame(r,x);k.copy(x.lowerBound);p.copy(x.upperBound)}volume(){return 4*Math.PI*this.boundingSphereRadius/3}static createTorus(e,h,k,p,r){void 0===e&&(e=1);void 0===h&&(h=.5);void 0===k&&(k=8);void 0===p&&(p=6);void 0===r&&(r=2*Math.PI);const x=[],z=[];for(var w=0;w<=k;w++)for(var C=0;C<=p;C++){const K=C/p*r,R=w/k*Math.PI*2;x.push((e+h*Math.cos(R))*Math.cos(K),(e+h*Math.cos(R))*Math.sin(K),h*Math.sin(R))}for(e=1;e<=k;e++)for(h=1;h<=p;h++)r=(p+1)*
(e-1)+h-1,w=(p+1)*(e-1)+h,C=(p+1)*e+h,z.push((p+1)*e+h-1,r,C),z.push(r,w,C);return new Qc(x,z)}}q.Trimesh=Qc;const xe=new B,yd=new tb,kf=new B,od=new B,uh=new B,ae=new B,lf=new B,oc=new B,Kc=new B,Sc=new tb,mf=new B,dd=new $a,fg=new tb;class be{constructor(){this.equations=[]}solve(e,h){return 0}addEquation(e){!e.enabled||e.bi.isTrigger||e.bj.isTrigger||this.equations.push(e)}removeEquation(e){const h=this.equations;e=h.indexOf(e);-1!==e&&h.splice(e,1)}removeAllEquations(){this.equations.length=0}}
q.Solver=be;class nf extends be{constructor(){super();this.iterations=10;this.tolerance=1E-7}solve(e,h){var k=0,p=this.iterations,r=this.tolerance*this.tolerance;const x=this.equations;var z=x.length,w=h.bodies;const C=w.length;let K;var R;let M;if(0!==z)for(h=0;h!==C;h++)w[h].updateSolveMassProperties();var V=Wa;const T=de;h=ce;V.length=z;T.length=z;h.length=z;for(R=0;R!==z;R++){var W=x[R];h[R]=0;T[R]=W.computeB(e);V[R]=1/W.computeC()}if(0!==z){for(k=0;k!==C;k++)R=w[k],W=R.wlambda,R.vlambda.set(0,
0,0),W.set(0,0,0);for(k=0;k!==p;k++){R=0;for(let ea=0;ea!==z;ea++){const ha=x[ea];var S=T[ea];K=V[ea];W=h[ea];M=ha.computeGWlambda();S=K*(S-M-ha.eps*W);W+S<ha.minForce?S=ha.minForce-W:W+S>ha.maxForce&&(S=ha.maxForce-W);h[ea]+=S;R+=0<S?S:-S;ha.addToWlambda(S)}if(R*R<r)break}for(p=0;p!==C;p++)r=w[p],z=r.velocity,V=r.angularVelocity,r.vlambda.vmul(r.linearFactor,r.vlambda),z.vadd(r.vlambda,z),r.wlambda.vmul(r.angularFactor,r.wlambda),V.vadd(r.wlambda,V);w=x.length;for(e=1/e;w--;)x[w].multiplier=h[w]*
e}return k}}q.GSSolver=nf;const ce=[],Wa=[],de=[];class Hb extends be{constructor(e){super();this.iterations=10;this.tolerance=1E-7;this.subsolver=e;this.nodes=[];for(this.nodePool=[];128>this.nodePool.length;)this.nodePool.push(this.createNode())}createNode(){return{body:null,children:[],eqs:[],visited:!1}}solve(e,h){const k=dj;var p=this.nodePool,r=h.bodies,x=this.equations,z=x.length,w=r.length;for(h=this.subsolver;p.length<w;)p.push(this.createNode());k.length=w;for(var C=0;C<w;C++)k[C]=p[C];
for(p=0;p!==w;p++)C=k[p],C.body=r[p],C.children.length=0,C.eqs.length=0,C.visited=!1;for(w=0;w!==z;w++){p=x[w];var K=r.indexOf(p.bi);C=r.indexOf(p.bj);K=k[K];C=k[C];K.children.push(C);K.eqs.push(p);C.children.push(K);C.eqs.push(p)}r=0;x=ej;h.tolerance=this.tolerance;h.iterations=this.iterations;for(z=ed;w=yb(k);){x.length=0;z.bodies.length=0;K=w;w=Gf;p=z.bodies;C=x;Ob.push(K);K.visited=!0;for(w(K,p,C);Ob.length;){K=Ob.pop();let R;for(;R=yb(K.children);)R.visited=!0,w(R,p,C),Ob.push(R)}w=x.length;
x=x.sort(le);for(p=0;p!==w;p++)h.addEquation(x[p]);h.solve(e,z);h.removeAllEquations();r++}return r}}q.SplitSolver=Hb;const dj=[],ej=[],ed={bodies:[]},of=Ka.STATIC,Ob=[];class gg{constructor(){this.objects=[];this.type=Object}release(){const e=arguments.length;for(let h=0;h!==e;h++)this.objects.push(0>h||arguments.length<=h?void 0:arguments[h]);return this}get(){return 0===this.objects.length?this.constructObject():this.objects.pop()}constructObject(){throw Error("constructObject() not implemented in this Pool subclass yet!");
}resize(e){const h=this.objects;for(;h.length>e;)h.pop();for(;h.length<e;)h.push(this.constructObject());return this}}q.Pool=gg;class hg extends gg{constructor(){super(...arguments);this.type=B}constructObject(){return new B}}q.Vec3Pool=hg;const lb={sphereSphere:Ca.types.SPHERE,spherePlane:Ca.types.SPHERE|Ca.types.PLANE,boxBox:Ca.types.BOX|Ca.types.BOX,sphereBox:Ca.types.SPHERE|Ca.types.BOX,planeBox:Ca.types.PLANE|Ca.types.BOX,convexConvex:Ca.types.CONVEXPOLYHEDRON,sphereConvex:Ca.types.SPHERE|Ca.types.CONVEXPOLYHEDRON,
planeConvex:Ca.types.PLANE|Ca.types.CONVEXPOLYHEDRON,boxConvex:Ca.types.BOX|Ca.types.CONVEXPOLYHEDRON,sphereHeightfield:Ca.types.SPHERE|Ca.types.HEIGHTFIELD,boxHeightfield:Ca.types.BOX|Ca.types.HEIGHTFIELD,convexHeightfield:Ca.types.CONVEXPOLYHEDRON|Ca.types.HEIGHTFIELD,sphereParticle:Ca.types.PARTICLE|Ca.types.SPHERE,planeParticle:Ca.types.PLANE|Ca.types.PARTICLE,boxParticle:Ca.types.BOX|Ca.types.PARTICLE,convexParticle:Ca.types.PARTICLE|Ca.types.CONVEXPOLYHEDRON,cylinderCylinder:Ca.types.CYLINDER,
sphereCylinder:Ca.types.SPHERE|Ca.types.CYLINDER,planeCylinder:Ca.types.PLANE|Ca.types.CYLINDER,boxCylinder:Ca.types.BOX|Ca.types.CYLINDER,convexCylinder:Ca.types.CONVEXPOLYHEDRON|Ca.types.CYLINDER,heightfieldCylinder:Ca.types.HEIGHTFIELD|Ca.types.CYLINDER,particleCylinder:Ca.types.PARTICLE|Ca.types.CYLINDER,sphereTrimesh:Ca.types.SPHERE|Ca.types.TRIMESH,planeTrimesh:Ca.types.PLANE|Ca.types.TRIMESH};q.COLLISION_TYPES=lb;class re{get [lb.sphereSphere](){return this.sphereSphere}get [lb.spherePlane](){return this.spherePlane}get [lb.boxBox](){return this.boxBox}get [lb.sphereBox](){return this.sphereBox}get [lb.planeBox](){return this.planeBox}get [lb.convexConvex](){return this.convexConvex}get [lb.sphereConvex](){return this.sphereConvex}get [lb.planeConvex](){return this.planeConvex}get [lb.boxConvex](){return this.boxConvex}get [lb.sphereHeightfield](){return this.sphereHeightfield}get [lb.boxHeightfield](){return this.boxHeightfield}get [lb.convexHeightfield](){return this.convexHeightfield}get [lb.sphereParticle](){return this.sphereParticle}get [lb.planeParticle](){return this.planeParticle}get [lb.boxParticle](){return this.boxParticle}get [lb.convexParticle](){return this.convexParticle}get [lb.cylinderCylinder](){return this.convexConvex}get [lb.sphereCylinder](){return this.sphereConvex}get [lb.planeCylinder](){return this.planeConvex}get [lb.boxCylinder](){return this.boxConvex}get [lb.convexCylinder](){return this.convexConvex}get [lb.heightfieldCylinder](){return this.heightfieldCylinder}get [lb.particleCylinder](){return this.particleCylinder}get [lb.sphereTrimesh](){return this.sphereTrimesh}get [lb.planeTrimesh](){return this.planeTrimesh}constructor(e){this.contactPointPool=
[];this.frictionEquationPool=[];this.result=[];this.frictionResult=[];this.v3pool=new hg;this.world=e;this.currentContactMaterial=e.defaultContactMaterial;this.enableFrictionReduction=!1}createContactEquation(e,h,k,p,r,x){let z;this.contactPointPool.length?(z=this.contactPointPool.pop(),z.bi=e,z.bj=h):z=new Sd(e,h);z.enabled=e.collisionResponse&&h.collisionResponse&&k.collisionResponse&&p.collisionResponse;const w=this.currentContactMaterial;z.restitution=w.restitution;z.setSpookParams(w.contactEquationStiffness,
w.contactEquationRelaxation,this.world.dt);e=k.material||e.material;h=p.material||h.material;e&&h&&0<=e.restitution&&0<=h.restitution&&(z.restitution=e.restitution*h.restitution);z.si=r||k;z.sj=x||p;return z}createFrictionEquationsFromContact(e,h){const k=e.bi,p=e.bj,r=this.world,x=this.currentContactMaterial;var z=x.friction,w=e.si.material||k.material,C=e.sj.material||p.material;w&&C&&0<=w.friction&&0<=C.friction&&(z=w.friction*C.friction);if(0<z){z*=(r.frictionGravity||r.gravity).length();w=k.invMass+
p.invMass;0<w&&(w=1/w);var K=this.frictionEquationPool;C=K.length?K.pop():new vd(k,p,z*w);K=K.length?K.pop():new vd(k,p,z*w);C.bi=K.bi=k;C.bj=K.bj=p;C.minForce=K.minForce=-z*w;C.maxForce=K.maxForce=z*w;C.ri.copy(e.ri);C.rj.copy(e.rj);K.ri.copy(e.ri);K.rj.copy(e.rj);e.ni.tangents(C.t,K.t);C.setSpookParams(x.frictionEquationStiffness,x.frictionEquationRelaxation,r.dt);K.setSpookParams(x.frictionEquationStiffness,x.frictionEquationRelaxation,r.dt);C.enabled=K.enabled=e.enabled;h.push(C,K);return!0}return!1}createFrictionFromAverage(e){let h=
this.result[this.result.length-1];if(this.createFrictionEquationsFromContact(h,this.frictionResult)&&1!==e){var k=this.frictionResult[this.frictionResult.length-2],p=this.frictionResult[this.frictionResult.length-1];zd.setZero();Ad.setZero();Ac.setZero();var r=h.bi;h.bj;for(let x=0;x!==e;x++)h=this.result[this.result.length-1-x],h.bi!==r?(zd.vadd(h.ni,zd),Ad.vadd(h.ri,Ad),Ac.vadd(h.rj,Ac)):(zd.vsub(h.ni,zd),Ad.vadd(h.rj,Ad),Ac.vadd(h.ri,Ac));e=1/e;Ad.scale(e,k.ri);Ac.scale(e,k.rj);p.ri.copy(k.ri);
p.rj.copy(k.rj);zd.normalize();zd.tangents(k.t,p.t)}}getContacts(e,h,k,p,r,x,z){this.contactPointPool=r;this.frictionEquationPool=z;this.result=p;this.frictionResult=x;p=ye;r=fj;x=Tc;z=pf;for(let C=0,K=e.length;C!==K;C++){const R=e[C],M=h[C];let V=null;R.material&&M.material&&(V=k.getContactMaterial(R.material,M.material)||null);const T=R.type&Ka.KINEMATIC&&M.type&Ka.STATIC||R.type&Ka.STATIC&&M.type&Ka.KINEMATIC||R.type&Ka.KINEMATIC&&M.type&Ka.KINEMATIC;for(let W=0;W<R.shapes.length;W++){R.quaternion.mult(R.shapeOrientations[W],
p);R.quaternion.vmult(R.shapeOffsets[W],x);x.vadd(R.position,x);const S=R.shapes[W];for(let ea=0;ea<M.shapes.length;ea++){M.quaternion.mult(M.shapeOrientations[ea],r);M.quaternion.vmult(M.shapeOffsets[ea],z);z.vadd(M.position,z);const ha=M.shapes[ea];if(S.collisionFilterMask&ha.collisionFilterGroup&&ha.collisionFilterMask&S.collisionFilterGroup&&!(x.distanceTo(z)>S.boundingSphereRadius+ha.boundingSphereRadius)){var w=null;S.material&&ha.material&&(w=k.getContactMaterial(S.material,ha.material)||null);
this.currentContactMaterial=w||V||k.defaultContactMaterial;(w=this[S.type|ha.type])&&(S.type<ha.type?w.call(this,S,ha,x,z,p,r,R,M,S,ha,T):w.call(this,ha,S,z,x,r,p,M,R,S,ha,T))&&T&&(k.shapeOverlapKeeper.set(S.id,ha.id),k.bodyOverlapKeeper.set(R.id,M.id))}}}}}sphereSphere(e,h,k,p,r,x,z,w,C,K,R){if(R)return k.distanceSquared(p)<(e.radius+h.radius)**2;r=this.createContactEquation(z,w,e,h,C,K);p.vsub(k,r.ni);r.ni.normalize();r.ri.copy(r.ni);r.rj.copy(r.ni);r.ri.scale(e.radius,r.ri);r.rj.scale(-h.radius,
r.rj);r.ri.vadd(k,r.ri);r.ri.vsub(z.position,r.ri);r.rj.vadd(p,r.rj);r.rj.vsub(w.position,r.rj);this.result.push(r);this.createFrictionEquationsFromContact(r,this.frictionResult)}spherePlane(e,h,k,p,r,x,z,w,C,K,R){h=this.createContactEquation(z,w,e,h,C,K);h.ni.set(0,0,1);x.vmult(h.ni,h.ni);h.ni.negate(h.ni);h.ni.normalize();h.ni.scale(e.radius,h.ri);k.vsub(p,Tb);h.ni.scale(h.ni.dot(Tb),mg);Tb.vsub(mg,h.rj);if(-Tb.dot(h.ni)<=e.radius){if(R)return!0;e=h.ri;x=h.rj;e.vadd(k,e);e.vsub(z.position,e);x.vadd(p,
x);x.vsub(w.position,x);this.result.push(h);this.createFrictionEquationsFromContact(h,this.frictionResult)}}boxBox(e,h,k,p,r,x,z,w,C,K,R){e.convexPolyhedronRepresentation.material=e.material;h.convexPolyhedronRepresentation.material=h.material;e.convexPolyhedronRepresentation.collisionResponse=e.collisionResponse;h.convexPolyhedronRepresentation.collisionResponse=h.collisionResponse;return this.convexConvex(e.convexPolyhedronRepresentation,h.convexPolyhedronRepresentation,k,p,r,x,z,w,e,h,R)}sphereBox(e,
h,k,p,r,x,z,w,C,K,R){r=this.v3pool;const M=Lc;k.vsub(p,Mb);h.getSideNormals(M,x);x=e.radius;let V=!1;var T=sf,W=rb,S=kj,ea=null,ha=0,ya=0,za=0,Ua=null;for(let Cb=0,mc=M.length;Cb!==mc&&!1===V;Cb++){var Pa=jj;Pa.copy(M[Cb]);var pb=Pa.length();Pa.normalize();var db=Mb.dot(Pa);if(db<pb+x&&0<db){var qb=Wb;const gb=gd;qb.copy(M[(Cb+1)%3]);gb.copy(M[(Cb+2)%3]);const ic=qb.length(),sb=gb.length();qb.normalize();gb.normalize();const Nb=Mb.dot(qb),bb=Mb.dot(gb);if(Nb<ic&&Nb>-ic&&bb<sb&&bb>-sb&&(db=Math.abs(db-
pb-x),null===Ua||db<Ua)&&(Ua=db,ya=Nb,za=bb,ea=pb,T.copy(Pa),W.copy(qb),S.copy(gb),ha++,R))return!0}}ha&&(V=!0,ha=this.createContactEquation(z,w,e,h,C,K),T.scale(-x,ha.ri),ha.ni.copy(T),ha.ni.negate(ha.ni),T.scale(ea,T),W.scale(ya,W),T.vadd(W,T),S.scale(za,S),T.vadd(S,ha.rj),ha.ri.vadd(k,ha.ri),ha.ri.vsub(z.position,ha.ri),ha.rj.vadd(p,ha.rj),ha.rj.vsub(w.position,ha.rj),this.result.push(ha),this.createFrictionEquationsFromContact(ha,this.frictionResult));T=r.get();W=Ib;for(S=0;2!==S&&!V;S++)for(ea=
0;2!==ea&&!V;ea++)for(ya=0;2!==ya&&!V;ya++)if(T.set(0,0,0),S?T.vadd(M[0],T):T.vsub(M[0],T),ea?T.vadd(M[1],T):T.vsub(M[1],T),ya?T.vadd(M[2],T):T.vsub(M[2],T),p.vadd(T,W),W.vsub(k,W),W.lengthSquared()<x*x){if(R)return!0;V=!0;za=this.createContactEquation(z,w,e,h,C,K);za.ri.copy(W);za.ri.normalize();za.ni.copy(za.ri);za.ri.scale(x,za.ri);za.rj.copy(T);za.ri.vadd(k,za.ri);za.ri.vsub(z.position,za.ri);za.rj.vadd(p,za.rj);za.rj.vsub(w.position,za.rj);this.result.push(za);this.createFrictionEquationsFromContact(za,
this.frictionResult)}r.release(T);T=r.get();W=r.get();S=r.get();ea=r.get();ya=r.get();za=M.length;for(ha=0;ha!==za&&!V;ha++)for(Ua=0;Ua!==za&&!V;Ua++)if(ha%3!==Ua%3){M[Ua].cross(M[ha],T);T.normalize();M[ha].vadd(M[Ua],W);S.copy(k);S.vsub(W,S);S.vsub(p,S);pb=S.dot(T);T.scale(pb,ea);for(Pa=0;Pa===ha%3||Pa===Ua%3;)Pa++;ya.copy(k);ya.vsub(ea,ya);ya.vsub(W,ya);ya.vsub(p,ya);pb=Math.abs(pb);qb=ya.length();if(pb<M[Pa].length()&&qb<x){if(R)return!0;V=!0;Pa=this.createContactEquation(z,w,e,h,C,K);W.vadd(ea,
Pa.rj);Pa.rj.copy(Pa.rj);ya.negate(Pa.ni);Pa.ni.normalize();Pa.ri.copy(Pa.rj);Pa.ri.vadd(p,Pa.ri);Pa.ri.vsub(k,Pa.ri);Pa.ri.normalize();Pa.ri.scale(x,Pa.ri);Pa.ri.vadd(k,Pa.ri);Pa.ri.vsub(z.position,Pa.ri);Pa.rj.vadd(p,Pa.rj);Pa.rj.vsub(w.position,Pa.rj);this.result.push(Pa);this.createFrictionEquationsFromContact(Pa,this.frictionResult)}}r.release(T,W,S,ea,ya)}planeBox(e,h,k,p,r,x,z,w,C,K,R){h.convexPolyhedronRepresentation.material=h.material;h.convexPolyhedronRepresentation.collisionResponse=h.collisionResponse;
h.convexPolyhedronRepresentation.id=h.id;return this.planeConvex(e,h.convexPolyhedronRepresentation,k,p,r,x,z,w,e,h,R)}convexConvex(e,h,k,p,r,x,z,w,C,K,R,M,V){const T=ze;if(!(k.distanceTo(p)>e.boundingSphereRadius+h.boundingSphereRadius)&&e.findSeparatingAxis(h,k,r,p,x,T,M,V)){M=[];V=Pb;e.clipAgainstHull(k,r,h,p,x,T,-100,100,M);r=0;for(x=0;x!==M.length;x++){if(R)return!0;const W=this.createContactEquation(z,w,e,h,C,K),S=W.ri,ea=W.rj;T.negate(W.ni);M[x].normal.negate(V);V.scale(M[x].depth,V);M[x].point.vadd(V,
S);ea.copy(M[x].point);S.vsub(k,S);ea.vsub(p,ea);S.vadd(k,S);S.vsub(z.position,S);ea.vadd(p,ea);ea.vsub(w.position,ea);this.result.push(W);r++;this.enableFrictionReduction||this.createFrictionEquationsFromContact(W,this.frictionResult)}this.enableFrictionReduction&&r&&this.createFrictionFromAverage(r)}}sphereConvex(e,h,k,p,r,x,z,w,C,K,R){var M=this.v3pool;k.vsub(p,lj);const V=h.faceNormals,T=h.faces,W=h.vertices;r=e.radius;for(var S=0;S!==W.length;S++){var ea=oj;x.vmult(W[S],ea);p.vadd(ea,ea);var ha=
Of;ea.vsub(k,ha);if(ha.lengthSquared()<r*r){if(R)return!0;M=this.createContactEquation(z,w,e,h,C,K);M.ri.copy(ha);M.ri.normalize();M.ni.copy(M.ri);M.ri.scale(r,M.ri);ea.vsub(p,M.rj);M.ri.vadd(k,M.ri);M.ri.vsub(z.position,M.ri);M.rj.vadd(p,M.rj);M.rj.vsub(w.position,M.rj);this.result.push(M);this.createFrictionEquationsFromContact(M,this.frictionResult);return}}for(let gb=0,ic=T.length;gb!==ic;gb++){ea=T[gb];S=Nf;x.vmult(V[gb],S);ha=pj;x.vmult(W[ea[0]],ha);ha.vadd(p,ha);var ya=Oa;S.scale(-r,ya);k.vadd(ya,
ya);var za=qj;ya.vsub(ha,za);ya=za.dot(S);za=rj;k.vsub(ha,za);if(0>ya&&0<za.dot(S)){ha=[];for(let sb=0,Nb=ea.length;sb!==Nb;sb++)za=M.get(),x.vmult(W[ea[sb]],za),p.vadd(za,za),ha.push(za);a:{za=ha;var Ua=S,Pa=k,pb=null,db=za.length;for(var qb=0;qb!==db;qb++){var Cb=za[qb],mc=fd;za[(qb+1)%db].vsub(Cb,mc);const sb=rf;mc.cross(Ua,sb);mc=Ia;Pa.vsub(Cb,mc);Cb=sb.dot(mc);if(null===pb||0<Cb&&!0===pb||0>=Cb&&!1===pb)null===pb&&(pb=0<Cb);else{za=!1;break a}}za=!0}if(za){if(R)return!0;e=this.createContactEquation(z,
w,e,h,C,K);S.scale(-r,e.ri);S.negate(e.ni);h=M.get();S.scale(-ya,h);x=M.get();S.scale(-r,x);k.vsub(p,e.rj);e.rj.vadd(x,e.rj);e.rj.vadd(h,e.rj);e.rj.vadd(p,e.rj);e.rj.vsub(w.position,e.rj);e.ri.vadd(k,e.ri);e.ri.vsub(z.position,e.ri);M.release(h);M.release(x);this.result.push(e);this.createFrictionEquationsFromContact(e,this.frictionResult);for(let sb=0,Nb=ha.length;sb!==Nb;sb++)M.release(ha[sb]);break}else for(Pa=0;Pa!==ea.length;Pa++){S=M.get();ya=M.get();x.vmult(W[ea[(Pa+1)%ea.length]],S);x.vmult(W[ea[(Pa+
2)%ea.length]],ya);p.vadd(S,S);p.vadd(ya,ya);pb=mj;ya.vsub(S,pb);qb=nj;pb.unit(qb);za=M.get();Ua=M.get();k.vsub(S,Ua);db=Ua.dot(qb);qb.scale(db,za);za.vadd(S,za);qb=M.get();za.vsub(k,qb);if(0<db&&db*db<pb.lengthSquared()&&qb.lengthSquared()<r*r){if(R)return!0;e=this.createContactEquation(z,w,e,h,C,K);za.vsub(p,e.rj);za.vsub(k,e.ni);e.ni.normalize();e.ni.scale(r,e.ri);e.rj.vadd(p,e.rj);e.rj.vsub(w.position,e.rj);e.ri.vadd(k,e.ri);e.ri.vsub(z.position,e.ri);this.result.push(e);this.createFrictionEquationsFromContact(e,
this.frictionResult);for(let sb=0,Nb=ha.length;sb!==Nb;sb++)M.release(ha[sb]);M.release(S);M.release(ya);M.release(za);M.release(qb);M.release(Ua);return}M.release(S);M.release(ya);M.release(za);M.release(qb);M.release(Ua)}for(let sb=0,Nb=ha.length;sb!==Nb;sb++)M.release(ha[sb])}}}planeConvex(e,h,k,p,r,x,z,w,C,K,R){const M=pc,V=ng;V.set(0,0,1);r.vmult(V,V);r=0;const T=ge;for(let W=0;W!==h.vertices.length;W++)if(M.copy(h.vertices[W]),x.vmult(M,M),p.vadd(M,M),M.vsub(k,T),0>=V.dot(T)){if(R)return!0;
const S=this.createContactEquation(z,w,e,h,C,K),ea=hc;V.scale(V.dot(T),ea);M.vsub(ea,ea);ea.vsub(k,S.ri);S.ni.copy(V);M.vsub(p,S.rj);S.ri.vadd(k,S.ri);S.ri.vsub(z.position,S.ri);S.rj.vadd(p,S.rj);S.rj.vsub(w.position,S.rj);this.result.push(S);r++;this.enableFrictionReduction||this.createFrictionEquationsFromContact(S,this.frictionResult)}this.enableFrictionReduction&&r&&this.createFrictionFromAverage(r)}boxConvex(e,h,k,p,r,x,z,w,C,K,R){e.convexPolyhedronRepresentation.material=e.material;e.convexPolyhedronRepresentation.collisionResponse=
e.collisionResponse;return this.convexConvex(e.convexPolyhedronRepresentation,h,k,p,r,x,z,w,e,h,R)}sphereHeightfield(e,h,k,p,r,x,z,w,C,K,R){var M=h.data,V=e.radius,T=h.elementSize;C=Fg;var W=Re;$a.pointToLocalFrame(p,x,k,W);var S=Math.floor((W.x-V)/T)-1;K=Math.ceil((W.x+V)/T)+1;let ea=Math.floor((W.y-V)/T)-1;T=Math.ceil((W.y+V)/T)+1;if(!(0>K||0>T||S>M.length||ea>M[0].length)){0>S&&(S=0);0>K&&(K=0);0>ea&&(ea=0);0>T&&(T=0);S>=M.length&&(S=M.length-1);K>=M.length&&(K=M.length-1);T>=M[0].length&&(T=M[0].length-
1);ea>=M[0].length&&(ea=M[0].length-1);M=[];h.getRectMinMax(S,ea,K,T,M);var ha=M[0];if(!(W.z-V>M[1]||W.z+V<ha))for(V=this.result;S<K;S++)for(W=ea;W<T;W++){M=V.length;ha=!1;h.getConvexTrianglePillar(S,W,!1);$a.pointToWorldFrame(p,x,h.pillarOffset,C);k.distanceTo(C)<h.pillarConvex.boundingSphereRadius+e.boundingSphereRadius&&(ha=this.sphereConvex(e,h.pillarConvex,k,C,r,x,z,w,e,h,R));if(R&&ha)return!0;h.getConvexTrianglePillar(S,W,!0);$a.pointToWorldFrame(p,x,h.pillarOffset,C);k.distanceTo(C)<h.pillarConvex.boundingSphereRadius+
e.boundingSphereRadius&&(ha=this.sphereConvex(e,h.pillarConvex,k,C,r,x,z,w,e,h,R));if(R&&ha)return!0;if(2<V.length-M)return}}}boxHeightfield(e,h,k,p,r,x,z,w,C,K,R){e.convexPolyhedronRepresentation.material=e.material;e.convexPolyhedronRepresentation.collisionResponse=e.collisionResponse;return this.convexHeightfield(e.convexPolyhedronRepresentation,h,k,p,r,x,z,w,e,h,R)}convexHeightfield(e,h,k,p,r,x,z,w,C,K,R){var M=h.data,V=h.elementSize,T=e.boundingSphereRadius;C=Pe;K=Qe;var W=uf;$a.pointToLocalFrame(p,
x,k,W);var S=Math.floor((W.x-T)/V)-1;let ea=Math.ceil((W.x+T)/V)+1,ha=Math.floor((W.y-T)/V)-1;V=Math.ceil((W.y+T)/V)+1;if(!(0>ea||0>V||S>M.length||ha>M[0].length)){0>S&&(S=0);0>ea&&(ea=0);0>ha&&(ha=0);0>V&&(V=0);S>=M.length&&(S=M.length-1);ea>=M.length&&(ea=M.length-1);V>=M[0].length&&(V=M[0].length-1);ha>=M[0].length&&(ha=M[0].length-1);M=[];h.getRectMinMax(S,ha,ea,V,M);var ya=M[0];if(!(W.z-T>M[1]||W.z+T<ya))for(T=S;T<ea;T++)for(W=ha;W<V;W++){S=!1;h.getConvexTrianglePillar(T,W,!1);$a.pointToWorldFrame(p,
x,h.pillarOffset,C);k.distanceTo(C)<h.pillarConvex.boundingSphereRadius+e.boundingSphereRadius&&(S=this.convexConvex(e,h.pillarConvex,k,C,r,x,z,w,null,null,R,K,null));if(R&&S)return!0;h.getConvexTrianglePillar(T,W,!0);$a.pointToWorldFrame(p,x,h.pillarOffset,C);k.distanceTo(C)<h.pillarConvex.boundingSphereRadius+e.boundingSphereRadius&&(S=this.convexConvex(e,h.pillarConvex,k,C,r,x,z,w,null,null,R,K,null));if(R&&S)return!0}}}sphereParticle(e,h,k,p,r,x,z,w,C,K,R){r=tf;r.set(0,0,1);p.vsub(k,r);if(r.lengthSquared()<=
e.radius*e.radius){if(R)return!0;h=this.createContactEquation(w,z,h,e,C,K);r.normalize();h.rj.copy(r);h.rj.scale(e.radius,h.rj);h.ni.copy(r);h.ni.negate(h.ni);h.ri.set(0,0,0);this.result.push(h);this.createFrictionEquationsFromContact(h,this.frictionResult)}}planeParticle(e,h,k,p,r,x,z,w,C,K,R){k=ab;k.set(0,0,1);z.quaternion.vmult(k,k);r=zh;p.vsub(z.position,r);if(0>=k.dot(r)){if(R)return!0;e=this.createContactEquation(w,z,h,e,C,K);e.ni.copy(k);e.ni.negate(e.ni);e.ri.set(0,0,0);h=Bd;k.scale(k.dot(p),
h);p.vsub(h,h);e.rj.copy(h);this.result.push(e);this.createFrictionEquationsFromContact(e,this.frictionResult)}}boxParticle(e,h,k,p,r,x,z,w,C,K,R){e.convexPolyhedronRepresentation.material=e.material;e.convexPolyhedronRepresentation.collisionResponse=e.collisionResponse;return this.convexParticle(e.convexPolyhedronRepresentation,h,k,p,r,x,z,w,e,h,R)}convexParticle(e,h,k,p,r,x,z,w,C,K,R){let M=-1;x=Jd;const V=pg;let T=null;var W=Id;W.copy(p);W.vsub(k,W);r.conjugate(og);og.vmult(W,W);if(e.pointIsInside(W)){e.worldVerticesNeedsUpdate&&
e.computeWorldVertices(k,r);e.worldFaceNormalsNeedsUpdate&&e.computeWorldFaceNormals(r);for(let S=0,ea=e.faces.length;S!==ea;S++)if(r=e.worldFaceNormals[S],p.vsub(e.worldVertices[e.faces[S][0]],pd),W=-r.dot(pd),null===T||Math.abs(W)<Math.abs(T)){if(R)return!0;T=W;M=S;x.copy(r)}-1!==M?(e=this.createContactEquation(w,z,h,e,C,K),x.scale(T,V),V.vadd(p,V),V.vsub(k,V),e.rj.copy(V),x.negate(e.ni),e.ri.set(0,0,0),h=e.ri,C=e.rj,h.vadd(p,h),h.vsub(w.position,h),C.vadd(k,C),C.vsub(z.position,C),this.result.push(e),
this.createFrictionEquationsFromContact(e,this.frictionResult)):console.warn("Point found inside convex, but did not find penetrating face!")}}heightfieldCylinder(e,h,k,p,r,x,z,w,C,K,R){return this.convexHeightfield(h,e,p,k,x,r,w,z,C,K,R)}particleCylinder(e,h,k,p,r,x,z,w,C,K,R){return this.convexParticle(h,e,p,k,x,r,w,z,C,K,R)}sphereTrimesh(e,h,k,p,r,x,z,w,C,K,R){var M=Bc,V=Uc,T=ig,W=Vc;r=ee;const S=fe;var ea=lg,ha=hb,ya=hj;const za=qf;$a.pointToLocalFrame(p,x,k,r);var Ua=e.radius;ea.lowerBound.set(r.x-
Ua,r.y-Ua,r.z-Ua);ea.upperBound.set(r.x+Ua,r.y+Ua,r.z+Ua);h.getTrianglesInAABB(ea,za);ea=ij;Ua=e.radius*e.radius;for(let Pa=0;Pa<za.length;Pa++)for(let pb=0;3>pb;pb++)if(h.getVertex(h.indices[3*za[Pa]+pb],ea),ea.vsub(r,ya),ya.lengthSquared()<=Ua){ha.copy(ea);$a.pointToWorldFrame(p,x,ha,ea);ea.vsub(k,ya);if(R)return!0;let db=this.createContactEquation(z,w,e,h,C,K);db.ni.copy(ya);db.ni.normalize();db.ri.copy(db.ni);db.ri.scale(e.radius,db.ri);db.ri.vadd(k,db.ri);db.ri.vsub(z.position,db.ri);db.rj.copy(ea);
db.rj.vsub(w.position,db.rj);this.result.push(db);this.createFrictionEquationsFromContact(db,this.frictionResult)}for(ha=0;ha<za.length;ha++)for(ya=0;3>ya;ya++)if(h.getVertex(h.indices[3*za[ha]+ya],M),h.getVertex(h.indices[3*za[ha]+(ya+1)%3],V),V.vsub(M,T),r.vsub(V,S),ea=S.dot(T),r.vsub(M,S),Ua=S.dot(T),0<Ua&&0>ea&&(r.vsub(M,S),W.copy(T),W.normalize(),Ua=S.dot(W),W.scale(Ua,S),S.vadd(M,S),S.distanceTo(r)<e.radius)){if(R)return!0;ea=this.createContactEquation(z,w,e,h,C,K);S.vsub(r,ea.ni);ea.ni.normalize();
ea.ni.scale(e.radius,ea.ri);ea.ri.vadd(k,ea.ri);ea.ri.vsub(z.position,ea.ri);$a.pointToWorldFrame(p,x,S,S);S.vsub(w.position,ea.rj);$a.vectorToWorldFrame(x,ea.ni,ea.ni);$a.vectorToWorldFrame(x,ea.ri,ea.ri);this.result.push(ea);this.createFrictionEquationsFromContact(ea,this.frictionResult)}M=yh;V=jg;T=kg;W=xh;for(let Pa=0,pb=za.length;Pa!==pb;Pa++)if(h.getTriangleVertices(za[Pa],M,V,T),h.getNormal(za[Pa],W),r.vsub(M,S),ha=S.dot(W),W.scale(ha,S),r.vsub(S,S),ha=S.distanceTo(r),Fb.pointInTriangle(S,
M,V,T)&&ha<e.radius){if(R)return!0;ha=this.createContactEquation(z,w,e,h,C,K);S.vsub(r,ha.ni);ha.ni.normalize();ha.ni.scale(e.radius,ha.ri);ha.ri.vadd(k,ha.ri);ha.ri.vsub(z.position,ha.ri);$a.pointToWorldFrame(p,x,S,S);S.vsub(w.position,ha.rj);$a.vectorToWorldFrame(x,ha.ni,ha.ni);$a.vectorToWorldFrame(x,ha.ri,ha.ri);this.result.push(ha);this.createFrictionEquationsFromContact(ha,this.frictionResult)}za.length=0}planeTrimesh(e,h,k,p,r,x,z,w,C,K,R){const M=new B,V=gj;V.set(0,0,1);r.vmult(V,V);for(r=
0;r<h.vertices.length/3;r++){h.getVertex(r,M);var T=new B;T.copy(M);$a.pointToWorldFrame(p,x,T,M);T=vh;M.vsub(k,T);if(0>=V.dot(T)){if(R)return!0;const W=this.createContactEquation(z,w,e,h,C,K);W.ni.copy(V);const S=wh;V.scale(T.dot(V),S);M.vsub(S,S);W.ri.copy(S);W.ri.vsub(z.position,W.ri);W.rj.copy(M);W.rj.vsub(w.position,W.rj);this.result.push(W);this.createFrictionEquationsFromContact(W,this.frictionResult)}}}}q.Narrowphase=re;const zd=new B,Ad=new B,Ac=new B,Tc=new B,pf=new B,ye=new xb,fj=new xb,
gj=new B,vh=new B,wh=new B,xh=new B,hj=new B;new B;const ij=new B,hb=new B,Bc=new B,Uc=new B,ig=new B,Vc=new B,ee=new B,fe=new B,yh=new B,jg=new B,kg=new B,lg=new tb,qf=[],Tb=new B,mg=new B,fd=new B,rf=new B,Ia=new B,Mb=new B,jj=new B,Wb=new B,gd=new B,Lc=[new B,new B,new B,new B,new B,new B],Ib=new B,sf=new B,rb=new B,kj=new B,lj=new B,mj=new B,nj=new B,Of=new B,oj=new B,Nf=new B,pj=new B,Oa=new B,qj=new B,rj=new B;new B;new B;const pc=new B,ng=new B,ge=new B,hc=new B,ze=new B,Pb=new B,ab=new B,
zh=new B,Bd=new B,tf=new B,og=new xb,Id=new B;new B;const Jd=new B,pd=new B,pg=new B,uf=new B,Pe=new B,Qe=[0],Re=new B,Fg=new B;class Kf{constructor(){this.current=[];this.previous=[]}getKey(e,h){if(h<e){const k=h;h=e;e=k}return e<<16|h}set(e,h){e=this.getKey(e,h);h=this.current;let k=0;for(;e>h[k];)k++;if(e!==h[k]){for(let p=h.length-1;p>=k;p--)h[p+1]=h[p];h[k]=e}}tick(){const e=this.current;this.current=this.previous;this.previous=e;this.current.length=0}getDiff(e,h){const k=this.current,p=this.previous;
var r=k.length;const x=p.length;let z=0;for(let w=0;w<r;w++){const C=k[w];for(;C>p[z];)z++;C===p[z]||e.push((C&4294901760)>>16,C&65535)}z=0;for(e=0;e<x;e++){for(r=p[e];r>k[z];)z++;k[z]===r||h.push((r&4294901760)>>16,r&65535)}}}class Gg{constructor(){this.data={keys:[]}}get(e,h){return this.data[e<h?`${e}-${h}`:`${h}-${e}`]}set(e,h,k){const p=e<h?`${e}-${h}`:`${h}-${e}`;this.get(e,h)||this.data.keys.push(p);this.data[p]=k}delete(e,h){e=e<h?`${e}-${h}`:`${h}-${e}`;h=this.data.keys.indexOf(e);-1!==h&&
this.data.keys.splice(h,1);delete this.data[e]}reset(){const e=this.data,h=e.keys;for(;0<h.length;){const k=h.pop();delete e[k]}}}class Oe extends ne{constructor(e){void 0===e&&(e={});super();this.dt=-1;this.allowSleep=!!e.allowSleep;this.contacts=[];this.frictionEquations=[];this.quatNormalizeSkip=void 0!==e.quatNormalizeSkip?e.quatNormalizeSkip:0;this.quatNormalizeFast=void 0!==e.quatNormalizeFast?e.quatNormalizeFast:!1;this.stepnumber=this.time=0;this.default_dt=1/60;this.nextId=0;this.gravity=
new B;e.gravity&&this.gravity.copy(e.gravity);e.frictionGravity&&(this.frictionGravity=new B,this.frictionGravity.copy(e.frictionGravity));this.broadphase=void 0!==e.broadphase?e.broadphase:new Ig;this.bodies=[];this.hasActiveBodies=!1;this.solver=void 0!==e.solver?e.solver:new nf;this.constraints=[];this.narrowphase=new re(this);this.collisionMatrix=new me;this.collisionMatrixPrevious=new me;this.bodyOverlapKeeper=new Kf;this.shapeOverlapKeeper=new Kf;this.contactmaterials=[];this.contactMaterialTable=
new Gg;this.defaultMaterial=new Oc("default");this.defaultContactMaterial=new Vd(this.defaultMaterial,this.defaultMaterial,{friction:.3,restitution:0});this.doProfiling=!1;this.profile={solve:0,makeContactConstraints:0,broadphase:0,integrate:0,narrowphase:0};this.accumulator=0;this.subsystems=[];this.addBodyEvent={type:"addBody",body:null};this.removeBodyEvent={type:"removeBody",body:null};this.idToBodyMap={};this.broadphase.setWorld(this)}getContactMaterial(e,h){return this.contactMaterialTable.get(e.id,
h.id)}collisionMatrixTick(){const e=this.collisionMatrixPrevious;this.collisionMatrixPrevious=this.collisionMatrix;this.collisionMatrix=e;this.collisionMatrix.reset();this.bodyOverlapKeeper.tick();this.shapeOverlapKeeper.tick()}addConstraint(e){this.constraints.push(e)}removeConstraint(e){e=this.constraints.indexOf(e);-1!==e&&this.constraints.splice(e,1)}rayTest(e,h,k){k instanceof Nd?this.raycastClosest(e,h,{skipBackfaces:!0},k):this.raycastAll(e,h,{skipBackfaces:!0},k)}raycastAll(e,h,k,p){void 0===
k&&(k={});k.mode=Fb.ALL;k.from=e;k.to=h;k.callback=p;return Kd.intersectWorld(this,k)}raycastAny(e,h,k,p){void 0===k&&(k={});k.mode=Fb.ANY;k.from=e;k.to=h;k.result=p;return Kd.intersectWorld(this,k)}raycastClosest(e,h,k,p){void 0===k&&(k={});k.mode=Fb.CLOSEST;k.from=e;k.to=h;k.result=p;return Kd.intersectWorld(this,k)}addBody(e){this.bodies.includes(e)||(e.index=this.bodies.length,this.bodies.push(e),e.world=this,e.initPosition.copy(e.position),e.initVelocity.copy(e.velocity),e.timeLastSleepy=this.time,
e instanceof Ka&&(e.initAngularVelocity.copy(e.angularVelocity),e.initQuaternion.copy(e.quaternion)),this.collisionMatrix.setNumObjects(this.bodies.length),this.addBodyEvent.body=e,this.idToBodyMap[e.id]=e,this.dispatchEvent(this.addBodyEvent))}removeBody(e){e.world=null;const h=this.bodies.length-1,k=this.bodies;var p=k.indexOf(e);if(-1!==p){k.splice(p,1);for(p=0;p!==k.length;p++)k[p].index=p;this.collisionMatrix.setNumObjects(h);this.removeBodyEvent.body=e;delete this.idToBodyMap[e.id];this.dispatchEvent(this.removeBodyEvent)}}getBodyById(e){return this.idToBodyMap[e]}getShapeById(e){const h=
this.bodies;for(let k=0;k<h.length;k++){const p=h[k].shapes;for(let r=0;r<p.length;r++){const x=p[r];if(x.id===e)return x}}return null}addContactMaterial(e){this.contactmaterials.push(e);this.contactMaterialTable.set(e.materials[0].id,e.materials[1].id,e)}removeContactMaterial(e){const h=this.contactmaterials.indexOf(e);-1!==h&&(this.contactmaterials.splice(h,1),this.contactMaterialTable.delete(e.materials[0].id,e.materials[1].id))}fixedStep(e,h){void 0===e&&(e=1/60);void 0===h&&(h=10);const k=cb.now()/
1E3;this.lastCallTime?this.step(e,k-this.lastCallTime,h):this.step(e,void 0,h);this.lastCallTime=k}step(e,h,k){void 0===k&&(k=10);if(void 0===h)this.internalStep(e),this.time+=e;else{this.accumulator+=h;var p=cb.now();let r=0;for(;this.accumulator>=e&&r<k&&!(this.internalStep(e),this.accumulator-=e,r++,cb.now()-p>1E3*e););this.accumulator%=e;e=this.accumulator/e;for(k=0;k!==this.bodies.length;k++)p=this.bodies[k],p.previousPosition.lerp(p.position,e,p.interpolatedPosition),p.previousQuaternion.slerp(p.quaternion,
e,p.interpolatedQuaternion),p.previousQuaternion.normalize();this.time+=h}}internalStep(e){this.dt=e;var h=this.contacts,k=Ah,p=Ae;const r=this.bodies.length,x=this.bodies;var z=this.solver,w=this.gravity,C=this.doProfiling;const K=this.profile;var R=Ka.DYNAMIC;let M=-Infinity;var V=this.constraints,T=Rb;w.length();var W=w.x,S=w.y,ea=w.z;C&&(M=cb.now());for(w=0;w!==r;w++){var ha=x[w];if(ha.type===R){var ya=ha.force;ha=ha.mass;ya.x+=ha*W;ya.y+=ha*S;ya.z+=ha*ea}}for(let za=0,Ua=this.subsystems.length;za!==
Ua;za++)this.subsystems[za].update();C&&(M=cb.now());k.length=0;p.length=0;this.broadphase.collisionPairs(this,k,p);C&&(K.broadphase=cb.now()-M);W=V.length;for(w=0;w!==W;w++)if(S=V[w],!S.collideConnected)for(ea=k.length-1;0<=ea;--ea)if(S.bodyA===k[ea]&&S.bodyB===p[ea]||S.bodyB===k[ea]&&S.bodyA===p[ea])k.splice(ea,1),p.splice(ea,1);this.collisionMatrixTick();C&&(M=cb.now());W=vf;S=h.length;for(w=0;w!==S;w++)W.push(h[w]);h.length=0;S=this.frictionEquations.length;for(w=0;w!==S;w++)T.push(this.frictionEquations[w]);
this.frictionEquations.length=0;this.narrowphase.getContacts(k,p,this,h,W,this.frictionEquations,T);C&&(K.narrowphase=cb.now()-M);C&&(M=cb.now());for(w=0;w<this.frictionEquations.length;w++)z.addEquation(this.frictionEquations[w]);w=h.length;for(k=0;k!==w;k++)p=h[k],T=p.bi,W=p.bj,S=p.si,ea=p.sj,ya=T.material&&W.material?this.getContactMaterial(T.material,W.material)||this.defaultContactMaterial:this.defaultContactMaterial,ya.friction,T.material&&W.material&&(0<=T.material.friction&&0<=W.material.friction&&
T.material.friction*W.material.friction,0<=T.material.restitution&&0<=W.material.restitution&&(p.restitution=T.material.restitution*W.material.restitution)),z.addEquation(p),T.allowSleep&&T.type===Ka.DYNAMIC&&T.sleepState===Ka.SLEEPING&&W.sleepState===Ka.AWAKE&&W.type!==Ka.STATIC&&W.velocity.lengthSquared()+W.angularVelocity.lengthSquared()>=2*W.sleepSpeedLimit**2&&(T.wakeUpAfterNarrowphase=!0),W.allowSleep&&W.type===Ka.DYNAMIC&&W.sleepState===Ka.SLEEPING&&T.sleepState===Ka.AWAKE&&T.type!==Ka.STATIC&&
T.velocity.lengthSquared()+T.angularVelocity.lengthSquared()>=2*T.sleepSpeedLimit**2&&(W.wakeUpAfterNarrowphase=!0),this.collisionMatrix.set(T,W,!0),this.collisionMatrixPrevious.get(T,W)||(bc.body=W,bc.contact=p,T.dispatchEvent(bc),bc.body=T,W.dispatchEvent(bc)),this.bodyOverlapKeeper.set(T.id,W.id),this.shapeOverlapKeeper.set(S.id,ea.id);this.emitContactEvents();C&&(K.makeContactConstraints=cb.now()-M,M=cb.now());for(w=0;w!==r;w++)h=x[w],h.wakeUpAfterNarrowphase&&(h.wakeUp(),h.wakeUpAfterNarrowphase=
!1);W=V.length;for(w=0;w!==W;w++){h=V[w];h.update();for(let za=0,Ua=h.equations.length;za!==Ua;za++)z.addEquation(h.equations[za])}z.solve(e,this);C&&(K.solve=cb.now()-M);z.removeAllEquations();z=Math.pow;for(w=0;w!==r;w++)if(V=x[w],V.type&R&&(h=z(1-V.linearDamping,e),k=V.velocity,k.scale(h,k),h=V.angularVelocity))V=z(1-V.angularDamping,e),h.scale(V,h);this.dispatchEvent(Zg);C&&(M=cb.now());R=0===this.stepnumber%(this.quatNormalizeSkip+1);z=this.quatNormalizeFast;for(w=0;w!==r;w++)x[w].integrate(e,
R,z);this.clearForces();this.broadphase.dirty=!0;C&&(K.integrate=cb.now()-M);this.stepnumber+=1;this.dispatchEvent(Ld);e=!0;if(this.allowSleep)for(e=!1,w=0;w!==r;w++)C=x[w],C.sleepTick(this.time),C.sleepState!==Ka.SLEEPING&&(e=!0);this.hasActiveBodies=e}emitContactEvents(){var e=this.hasAnyEventListener("beginContact"),h=this.hasAnyEventListener("endContact");(e||h)&&this.bodyOverlapKeeper.getDiff(Gc,Cc);if(e){for(let k=0,p=Gc.length;k<p;k+=2)Be.bodyA=this.getBodyById(Gc[k]),Be.bodyB=this.getBodyById(Gc[k+
1]),this.dispatchEvent(Be);Be.bodyA=Be.bodyB=null}if(h){for(let k=0,p=Cc.length;k<p;k+=2)Ce.bodyA=this.getBodyById(Cc[k]),Ce.bodyB=this.getBodyById(Cc[k+1]),this.dispatchEvent(Ce);Ce.bodyA=Ce.bodyB=null}Gc.length=Cc.length=0;h=this.hasAnyEventListener("beginShapeContact");e=this.hasAnyEventListener("endShapeContact");(h||e)&&this.shapeOverlapKeeper.getDiff(Gc,Cc);if(h){for(let k=0,p=Gc.length;k<p;k+=2){h=this.getShapeById(Gc[k]);const r=this.getShapeById(Gc[k+1]);Vb.shapeA=h;Vb.shapeB=r;h&&(Vb.bodyA=
h.body);r&&(Vb.bodyB=r.body);this.dispatchEvent(Vb)}Vb.bodyA=Vb.bodyB=Vb.shapeA=Vb.shapeB=null}if(e){for(let k=0,p=Cc.length;k<p;k+=2)e=this.getShapeById(Cc[k]),h=this.getShapeById(Cc[k+1]),Yb.shapeA=e,Yb.shapeB=h,e&&(Yb.bodyA=e.body),h&&(Yb.bodyB=h.body),this.dispatchEvent(Yb);Yb.bodyA=Yb.bodyB=Yb.shapeA=Yb.shapeB=null}}clearForces(){const e=this.bodies,h=e.length;for(let k=0;k!==h;k++){const p=e[k];p.force;p.torque;p.force.set(0,0,0);p.torque.set(0,0,0)}}}q.World=Oe;new tb;const Kd=new Fb,cb=globalThis.performance||
{};if(!cb.now){let e=Date.now();cb.timing&&cb.timing.navigationStart&&(e=cb.timing.navigationStart);cb.now=()=>Date.now()-e}new B;const Ld={type:"postStep"},Zg={type:"preStep"},bc={type:Ka.COLLIDE_EVENT_NAME,body:null,contact:null},vf=[],Rb=[],Ah=[],Ae=[],Gc=[],Cc=[],Be={type:"beginContact",bodyA:null,bodyB:null},Ce={type:"endContact",bodyA:null,bodyB:null},Vb={type:"beginShapeContact",bodyA:null,bodyB:null,shapeA:null,shapeB:null},Yb={type:"endShapeContact",bodyA:null,bodyB:null,shapeA:null,shapeB:null}};
/*

 Copyright The Closure Library Authors.
 SPDX-License-Identifier: Apache-2.0
*/
'use strict';var g,aa=this||self;function r(a){var b=typeof a;return"object"!=b?b:a?Array.isArray(a)?"array":b:"null"}var ba="closure_uid_"+(1E9*Math.random()>>>0),ca=0;function da(a){const b=[];let c=0;for(const d in a)b[c++]=d;return b};function fa(a,b){null!=a&&this.append.apply(this,arguments)}g=fa.prototype;g.Da="";g.set=function(a){this.Da=""+a};g.append=function(a,b,c){this.Da+=String(a);if(null!=b)for(let d=1;d<arguments.length;d++)this.Da+=arguments[d];return this};g.clear=function(){this.Da=""};g.toString=function(){return this.Da};var ha={},ia={},ja,u={},ka=null;function la(){return new ma(null,5,[oa,!0,pa,!0,qa,!1,ra,!1,sa,null],null)}function v(a){return null!=a&&!1!==a}function ta(a){return a instanceof Array}function w(a,b){return a[r(null==b?null:b)]?!0:a._?!0:!1}function x(a,b){var c=null==b?null:b.constructor;return Error(["No protocol method ",a," defined for type ",v(v(c)?c.xb:c)?c.lb:r(b),": ",b].join(""))}function ua(a){var b=a.lb;return v(b)?b:z.j(a)}
var va="undefined"!==typeof Symbol&&"function"===r(Symbol)?Symbol.iterator:"@@iterator";function B(a){for(var b=a.length,c=Array(b),d=0;;)if(d<b)c[d]=a[d],d+=1;else break;return c}function wa(){}function xa(a){if(null!=a&&null!=a.Y)a=a.Y(a);else{var b=xa[r(null==a?null:a)];if(null!=b)a=b.j?b.j(a):b.call(null,a);else if(b=xa._,null!=b)a=b.j?b.j(a):b.call(null,a);else throw x("ICounted.-count",a);}return a}function ya(){}
function za(a){if(null!=a&&null!=a.Z)a=a.Z(a);else{var b=za[r(null==a?null:a)];if(null!=b)a=b.j?b.j(a):b.call(null,a);else if(b=za._,null!=b)a=b.j?b.j(a):b.call(null,a);else throw x("IEmptyableCollection.-empty",a);}return a}function Aa(){}function Ba(a,b){if(null!=a&&null!=a.X)a=a.X(a,b);else{var c=Ba[r(null==a?null:a)];if(null!=c)a=c.m?c.m(a,b):c.call(null,a,b);else if(c=Ba._,null!=c)a=c.m?c.m(a,b):c.call(null,a,b);else throw x("ICollection.-conj",a);}return a}function Ca(){}
var Da=function(){function a(d,e,f){var h=D[r(null==d?null:d)];if(null!=h)return h.v?h.v(d,e,f):h.call(null,d,e,f);h=D._;if(null!=h)return h.v?h.v(d,e,f):h.call(null,d,e,f);throw x("IIndexed.-nth",d);}function b(d,e){var f=D[r(null==d?null:d)];if(null!=f)return f.m?f.m(d,e):f.call(null,d,e);f=D._;if(null!=f)return f.m?f.m(d,e):f.call(null,d,e);throw x("IIndexed.-nth",d);}var c=null;c=function(d,e,f){switch(arguments.length){case 2:return b.call(this,d,e);case 3:return a.call(this,d,e,f)}throw Error("Invalid arity: "+
arguments.length);};c.m=b;c.v=a;return c}(),D=function D(a){switch(arguments.length){case 2:return D.m(arguments[0],arguments[1]);case 3:return D.v(arguments[0],arguments[1],arguments[2]);default:throw Error(["Invalid arity: ",z.j(arguments.length)].join(""));}};D.m=function(a,b){return null!=a&&null!=a.W?a.W(a,b):Da(a,b)};D.v=function(a,b,c){return null!=a&&null!=a.oa?a.oa(a,b,c):Da(a,b,c)};D.aa=3;
function E(a){if(null!=a&&null!=a.fa)a=a.fa(a);else{var b=E[r(null==a?null:a)];if(null!=b)a=b.j?b.j(a):b.call(null,a);else if(b=E._,null!=b)a=b.j?b.j(a):b.call(null,a);else throw x("ISeq.-first",a);}return a}function G(a){if(null!=a&&null!=a.ja)a=a.ja(a);else{var b=G[r(null==a?null:a)];if(null!=b)a=b.j?b.j(a):b.call(null,a);else if(b=G._,null!=b)a=b.j?b.j(a):b.call(null,a);else throw x("ISeq.-rest",a);}return a}function Ea(){}function Fa(){}
var Ha=function(){function a(d,e,f){var h=Ga[r(null==d?null:d)];if(null!=h)return h.v?h.v(d,e,f):h.call(null,d,e,f);h=Ga._;if(null!=h)return h.v?h.v(d,e,f):h.call(null,d,e,f);throw x("ILookup.-lookup",d);}function b(d,e){var f=Ga[r(null==d?null:d)];if(null!=f)return f.m?f.m(d,e):f.call(null,d,e);f=Ga._;if(null!=f)return f.m?f.m(d,e):f.call(null,d,e);throw x("ILookup.-lookup",d);}var c=null;c=function(d,e,f){switch(arguments.length){case 2:return b.call(this,d,e);case 3:return a.call(this,d,e,f)}throw Error("Invalid arity: "+
arguments.length);};c.m=b;c.v=a;return c}(),Ga=function Ga(a){switch(arguments.length){case 2:return Ga.m(arguments[0],arguments[1]);case 3:return Ga.v(arguments[0],arguments[1],arguments[2]);default:throw Error(["Invalid arity: ",z.j(arguments.length)].join(""));}};Ga.m=function(a,b){return null!=a&&null!=a.na?a.na(a,b):Ha(a,b)};Ga.v=function(a,b,c){return null!=a&&null!=a.K?a.K(a,b,c):Ha(a,b,c)};Ga.aa=3;function Ia(){}
function Ja(a,b){if(null!=a&&null!=a.Wa)a=a.Wa(a,b);else{var c=Ja[r(null==a?null:a)];if(null!=c)a=c.m?c.m(a,b):c.call(null,a,b);else if(c=Ja._,null!=c)a=c.m?c.m(a,b):c.call(null,a,b);else throw x("IAssociative.-contains-key?",a);}return a}function Ka(a,b,c){if(null!=a&&null!=a.za)a=a.za(a,b,c);else{var d=Ka[r(null==a?null:a)];if(null!=d)a=d.v?d.v(a,b,c):d.call(null,a,b,c);else if(d=Ka._,null!=d)a=d.v?d.v(a,b,c):d.call(null,a,b,c);else throw x("IAssociative.-assoc",a);}return a}function La(){}
function Ma(a){if(null!=a&&null!=a.Ib)a=a.key;else{var b=Ma[r(null==a?null:a)];if(null!=b)a=b.j?b.j(a):b.call(null,a);else if(b=Ma._,null!=b)a=b.j?b.j(a):b.call(null,a);else throw x("IMapEntry.-key",a);}return a}function Na(a){if(null!=a&&null!=a.Jb)a=a.J;else{var b=Na[r(null==a?null:a)];if(null!=b)a=b.j?b.j(a):b.call(null,a);else if(b=Na._,null!=b)a=b.j?b.j(a):b.call(null,a);else throw x("IMapEntry.-val",a);}return a}function Oa(){}
function Pa(a){if(null!=a&&null!=a.Cb)a=a.J;else{var b=Pa[r(null==a?null:a)];if(null!=b)a=b.j?b.j(a):b.call(null,a);else if(b=Pa._,null!=b)a=b.j?b.j(a):b.call(null,a);else throw x("IDeref.-deref",a);}return a}function Qa(){}function Ra(a){if(null!=a&&null!=a.T)a=a.T(a);else{var b=Ra[r(null==a?null:a)];if(null!=b)a=b.j?b.j(a):b.call(null,a);else if(b=Ra._,null!=b)a=b.j?b.j(a):b.call(null,a);else throw x("IMeta.-meta",a);}return a}
function Sa(a,b){if(null!=a&&null!=a.U)a=a.U(a,b);else{var c=Sa[r(null==a?null:a)];if(null!=c)a=c.m?c.m(a,b):c.call(null,a,b);else if(c=Sa._,null!=c)a=c.m?c.m(a,b):c.call(null,a,b);else throw x("IWithMeta.-with-meta",a);}return a}function Ta(){}
var Va=function(){function a(d,e,f){var h=Ua[r(null==d?null:d)];if(null!=h)return h.v?h.v(d,e,f):h.call(null,d,e,f);h=Ua._;if(null!=h)return h.v?h.v(d,e,f):h.call(null,d,e,f);throw x("IReduce.-reduce",d);}function b(d,e){var f=Ua[r(null==d?null:d)];if(null!=f)return f.m?f.m(d,e):f.call(null,d,e);f=Ua._;if(null!=f)return f.m?f.m(d,e):f.call(null,d,e);throw x("IReduce.-reduce",d);}var c=null;c=function(d,e,f){switch(arguments.length){case 2:return b.call(this,d,e);case 3:return a.call(this,d,e,f)}throw Error("Invalid arity: "+
arguments.length);};c.m=b;c.v=a;return c}(),Ua=function Ua(a){switch(arguments.length){case 2:return Ua.m(arguments[0],arguments[1]);case 3:return Ua.v(arguments[0],arguments[1],arguments[2]);default:throw Error(["Invalid arity: ",z.j(arguments.length)].join(""));}};Ua.m=function(a,b){return null!=a&&null!=a.da?a.da(a,b):Va(a,b)};Ua.v=function(a,b,c){return null!=a&&null!=a.ea?a.ea(a,b,c):Va(a,b,c)};Ua.aa=3;function Wa(){}
function Xa(a,b){if(null!=a&&null!=a.jb)a=a.jb(a,b,!0);else{var c=Xa[r(null==a?null:a)];if(null!=c)a=c.v?c.v(a,b,!0):c.call(null,a,b,!0);else if(c=Xa._,null!=c)a=c.v?c.v(a,b,!0):c.call(null,a,b,!0);else throw x("IKVReduce.-kv-reduce",a);}return a}function Ya(a,b){if(null!=a&&null!=a.O)a=a.O(a,b);else{var c=Ya[r(null==a?null:a)];if(null!=c)a=c.m?c.m(a,b):c.call(null,a,b);else if(c=Ya._,null!=c)a=c.m?c.m(a,b):c.call(null,a,b);else throw x("IEquiv.-equiv",a);}return a}
function Za(a){if(null!=a&&null!=a.S)a=a.S(a);else{var b=Za[r(null==a?null:a)];if(null!=b)a=b.j?b.j(a):b.call(null,a);else if(b=Za._,null!=b)a=b.j?b.j(a):b.call(null,a);else throw x("IHash.-hash",a);}return a}function $a(){}function ab(a){if(null!=a&&null!=a.M)a=a.M(a);else{var b=ab[r(null==a?null:a)];if(null!=b)a=b.j?b.j(a):b.call(null,a);else if(b=ab._,null!=b)a=b.j?b.j(a):b.call(null,a);else throw x("ISeqable.-seq",a);}return a}function bb(){}function cb(){}function db(){}
function H(a,b){if(null!=a&&null!=a.wb)a=a.wb(a,b);else{var c=H[r(null==a?null:a)];if(null!=c)a=c.m?c.m(a,b):c.call(null,a,b);else if(c=H._,null!=c)a=c.m?c.m(a,b):c.call(null,a,b);else throw x("IWriter.-write",a);}return a}function eb(){}function fb(a,b,c){if(null!=a&&null!=a.P)a=a.P(a,b,c);else{var d=fb[r(null==a?null:a)];if(null!=d)a=d.v?d.v(a,b,c):d.call(null,a,b,c);else if(d=fb._,null!=d)a=d.v?d.v(a,b,c):d.call(null,a,b,c);else throw x("IPrintWithWriter.-pr-writer",a);}return a}
function gb(a){if(null!=a&&null!=a.Za)a=a.Za(a);else{var b=gb[r(null==a?null:a)];if(null!=b)a=b.j?b.j(a):b.call(null,a);else if(b=gb._,null!=b)a=b.j?b.j(a):b.call(null,a);else throw x("IEditableCollection.-as-transient",a);}return a}function hb(a,b){if(null!=a&&null!=a.bb)a=a.bb(a,b);else{var c=hb[r(null==a?null:a)];if(null!=c)a=c.m?c.m(a,b):c.call(null,a,b);else if(c=hb._,null!=c)a=c.m?c.m(a,b):c.call(null,a,b);else throw x("ITransientCollection.-conj!",a);}return a}
function ib(a){if(null!=a&&null!=a.kb)a=a.kb(a);else{var b=ib[r(null==a?null:a)];if(null!=b)a=b.j?b.j(a):b.call(null,a);else if(b=ib._,null!=b)a=b.j?b.j(a):b.call(null,a);else throw x("ITransientCollection.-persistent!",a);}return a}function jb(a,b,c){if(null!=a&&null!=a.Xa)a=a.Xa(a,b,c);else{var d=jb[r(null==a?null:a)];if(null!=d)a=d.v?d.v(a,b,c):d.call(null,a,b,c);else if(d=jb._,null!=d)a=d.v?d.v(a,b,c):d.call(null,a,b,c);else throw x("ITransientAssociative.-assoc!",a);}return a}
function kb(a){if(null!=a&&null!=a.sb)a=a.sb(a);else{var b=kb[r(null==a?null:a)];if(null!=b)a=b.j?b.j(a):b.call(null,a);else if(b=kb._,null!=b)a=b.j?b.j(a):b.call(null,a);else throw x("IChunk.-drop-first",a);}return a}function lb(a){if(null!=a&&null!=a.pb)a=a.pb(a);else{var b=lb[r(null==a?null:a)];if(null!=b)a=b.j?b.j(a):b.call(null,a);else if(b=lb._,null!=b)a=b.j?b.j(a):b.call(null,a);else throw x("IChunkedSeq.-chunked-first",a);}return a}
function mb(a){if(null!=a&&null!=a.ib)a=a.ib(a);else{var b=mb[r(null==a?null:a)];if(null!=b)a=b.j?b.j(a):b.call(null,a);else if(b=mb._,null!=b)a=b.j?b.j(a):b.call(null,a);else throw x("IChunkedSeq.-chunked-rest",a);}return a}function nb(){}function ob(a){if(null!=a&&null!=a.ua)a=a.ua(a);else{var b=ob[r(null==a?null:a)];if(null!=b)a=b.j?b.j(a):b.call(null,a);else if(b=ob._,null!=b)a=b.j?b.j(a):b.call(null,a);else throw x("IIterable.-iterator",a);}return a}
function pb(a){this.Rb=a;this.u=1073741824;this.F=0}pb.prototype.wb=function(a,b){return this.Rb.append(b)};function qb(a){var b=new fa;a.P(null,new pb(b),la());return z.j(b)}var rb="undefined"!==typeof Math&&"undefined"!==typeof Math.imul?function(a,b){return Math.imul(a,b)}:function(a,b){var c=a&65535,d=b&65535;return c*d+((a>>>16&65535)*d+c*(b>>>16&65535)<<16>>>0)|0};function sb(a){a=rb(a|0,-862048943);return rb(a<<15|a>>>-15,461845907)}
function tb(a,b){a=(a|0)^(b|0);return rb(a<<13|a>>>-13,5)+-430675100|0}function ub(a,b){a=(a|0)^b;a=rb(a^a>>>16,-2048144789);a=rb(a^a>>>13,-1028477387);return a^a>>>16}function vb(a){a:{var b=1;for(var c=0;;)if(b<a.length)c=tb(c,sb(a.charCodeAt(b-1)|a.charCodeAt(b)<<16)),b+=2;else{b=c;break a}}return ub(1===(a.length&1)?b^sb(a.charCodeAt(a.length-1)):b,rb(2,a.length))}var wb={},xb=0;
function yb(a){255<xb&&(wb={},xb=0);if(null==a)return 0;var b=wb[a];if("number"===typeof b)a=b;else{a:if(null!=a)if(b=a.length,0<b)for(var c=0,d=0;;)if(c<b)d=rb(31,d)+a.charCodeAt(c),c+=1;else{b=d;break a}else b=0;else b=0;wb[a]=b;xb+=1;a=b}return a}
function zb(a){if(null!=a&&(a.u&4194304||u===a.Wb))return a.S(null)^0;if("number"===typeof a){if(isFinite(a))return Math.floor(a)%2147483647;switch(a){case Infinity:return 2146435072;case -Infinity:return-1048576;default:return 2146959360}}else return!0===a?a=1231:!1===a?a=1237:"string"===typeof a?(a=yb(a),a=0===a?a:ub(tb(0,sb(a)),4)):a=a instanceof Date?a.valueOf()^0:null==a?0:Za(a)^0,a}function Ab(a,b){return a^b+2654435769+(a<<6)+(a>>2)}
function Bb(a,b,c,d,e){this.hb=a;this.name=b;this.Ca=c;this.Va=d;this.ta=e;this.u=2154168321;this.F=4096}g=Bb.prototype;g.toString=function(){return this.Ca};g.O=function(a,b){return b instanceof Bb?this.Ca===b.Ca:!1};g.call=function(a){switch(arguments.length-1){case 1:return this.j(arguments[1]);case 2:return this.m(arguments[1],arguments[2]);default:throw Error(["Invalid arity: ",z.j(arguments.length-1)].join(""));}};g.apply=function(a,b){return this.call.apply(this,[this].concat(B(b)))};
g.j=function(a){return Cb.m?Cb.m(a,this):Cb.call(null,a,this)};g.m=function(a,b){return Cb.v?Cb.v(a,this,b):Cb.call(null,a,this,b)};g.T=function(){return this.ta};g.U=function(a,b){return new Bb(this.hb,this.name,this.Ca,this.Va,b)};g.S=function(){var a=this.Va;return null!=a?a:this.Va=a=Ab(vb(this.name),yb(this.hb))};g.P=function(a,b){return H(b,this.Ca)};
var Db=function Db(a){switch(arguments.length){case 1:return Db.j(arguments[0]);case 2:return Db.m(arguments[0],arguments[1]);default:throw Error(["Invalid arity: ",z.j(arguments.length)].join(""));}};Db.j=function(a){for(;;){if(a instanceof Bb)return a;if("string"===typeof a){var b=a.indexOf("/");return 1>b?Db.m(null,a):Db.m(a.substring(0,b),a.substring(b+1,a.length))}if(a instanceof I)a=a.xa;else throw Error("no conversion to symbol");}};
Db.m=function(a,b){var c=null!=a?[z.j(a),"/",z.j(b)].join(""):b;return new Bb(a,b,c,null,null)};Db.aa=2;function Eb(a){return null!=a?a.F&131072||u===a.Xb?!0:a.F?!1:w(nb,a):w(nb,a)}
function K(a){if(null==a)return null;if(null!=a&&(a.u&8388608||u===a.Nb))return a.M(null);if(ta(a)||"string"===typeof a)return 0===a.length?null:new M(a,0,null);if(null!=a&&null!=a[va])return a=(null!==a&&va in a?a[va]:void 0).call(a),Fb.j?Fb.j(a):Fb.call(null,a);if(w($a,a))return ab(a);throw Error([z.j(a)," is not ISeqable"].join(""));}function N(a){if(null==a)return null;if(null!=a&&(a.u&64||u===a.ab))return a.fa(null);a=K(a);return null==a?null:E(a)}
function Gb(a){return null!=a?null!=a&&(a.u&64||u===a.ab)?a.ja(null):(a=K(a))?a.ja(null):O:O}function P(a){return null==a?null:null!=a&&(a.u&128||u===a.$a)?a.ba():K(Gb(a))}var R=function R(a){switch(arguments.length){case 1:return R.j(arguments[0]);case 2:return R.m(arguments[0],arguments[1]);default:for(var c=[],d=arguments.length,e=0;;)if(e<d)c.push(arguments[e]),e+=1;else break;return R.N(arguments[0],arguments[1],new M(c.slice(2),0,null))}};R.j=function(){return!0};
R.m=function(a,b){return null==a?null==b:a===b||Ya(a,b)};R.N=function(a,b,c){for(;;)if(R.m(a,b))if(P(c))a=b,b=N(c),c=P(c);else return R.m(b,N(c));else return!1};R.$=function(a){var b=N(a),c=P(a);a=N(c);c=P(c);return this.N(b,a,c)};R.aa=2;function Hb(a){this.s=a}Hb.prototype.next=function(){if(null!=this.s){var a=N(this.s);this.s=P(this.s);return{value:a,done:!1}}return{value:null,done:!0}};function Ib(a){return new Hb(K(a))}
function Jb(a,b){this.value=a;this.yb=b;this.mb=null;this.u=8388672;this.F=0}Jb.prototype.M=function(){return this};Jb.prototype.fa=function(){return this.value};Jb.prototype.ja=function(){null==this.mb&&(this.mb=Fb.j?Fb.j(this.yb):Fb.call(null,this.yb));return this.mb};function Fb(a){var b=a.next();return v(b.done)?null:new Jb(b.value,a)}function Kb(a){var b=0,c=1;for(a=K(a);;)if(null!=a)b+=1,c=rb(31,c)+zb(N(a))|0,a=P(a);else return ub(tb(0,sb(c)),b)}var Lb=ub(tb(0,sb(1)),0);
function Mb(a){var b=0,c=0;for(a=K(a);;)if(null!=a)b+=1,c=c+zb(N(a))|0,a=P(a);else return ub(tb(0,sb(c)),b)}var Nb=ub(tb(0,sb(0)),0);wa["null"]=!0;xa["null"]=function(){return 0};Date.prototype.O=function(a,b){return b instanceof Date&&this.valueOf()===b.valueOf()};Ya.number=function(a,b){return a===b};Qa["function"]=!0;Ra["function"]=function(){return null};Za._=function(a){return Object.prototype.hasOwnProperty.call(a,ba)&&a[ba]||(a[ba]=++ca)};function Ob(){this.J=!1;this.u=32768;this.F=0}
Ob.prototype.Cb=function(){return this.J};function Pb(a){return a instanceof Ob}function Qb(a){return Pa(a)}function Rb(a,b){var c=a.length;if(0===a.length)return b.I?b.I():b.call(null);for(var d=a[0],e=1;;)if(e<c){var f=a[e];d=b.m?b.m(d,f):b.call(null,d,f);if(Pb(d))return Pa(d);e+=1}else return d}function Sb(a,b,c){var d=a.length,e=c;for(c=0;;)if(c<d){var f=a[c];e=b.m?b.m(e,f):b.call(null,e,f);if(Pb(e))return Pa(e);c+=1}else return e}
function Tb(a,b,c,d){for(var e=a.length;;)if(d<e){var f=a[d];c=b.m?b.m(c,f):b.call(null,c,f);if(Pb(c))return Pa(c);d+=1}else return c}function Ub(a){return null!=a?a.u&2||u===a.Bb?!0:a.u?!1:w(wa,a):w(wa,a)}function Vb(a){return null!=a?a.u&16||u===a.ub?!0:a.u?!1:w(Ca,a):w(Ca,a)}function S(a,b,c){var d=T.j?T.j(a):T.call(null,a);if(c>=d)return-1;!(0<c)&&0>c&&(c+=d,c=0>c?0:c);for(;;)if(c<d){if(R.m(Wb?Wb(a,c):Xb.call(null,a,c),b))return c;c+=1}else return-1}
function U(a,b,c){var d=T.j?T.j(a):T.call(null,a);if(0===d)return-1;0<c?(--d,c=d<c?d:c):c=0>c?d+c:c;for(;;)if(0<=c){if(R.m(Wb?Wb(a,c):Xb.call(null,a,c),b))return c;--c}else return-1}function Yb(a,b){this.o=a;this.i=b}Yb.prototype.la=function(){return this.i<this.o.length};Yb.prototype.next=function(){var a=this.o[this.i];this.i+=1;return a};function M(a,b,c){this.o=a;this.i=b;this.C=c;this.u=166592766;this.F=139264}g=M.prototype;g.toString=function(){return qb(this)};
g.indexOf=function(){var a=null;a=function(b,c){switch(arguments.length){case 1:return S(this,b,0);case 2:return S(this,b,c)}throw Error("Invalid arity: "+arguments.length);};a.j=function(b){return S(this,b,0)};a.m=function(b,c){return S(this,b,c)};return a}();
g.lastIndexOf=function(){function a(c){return U(this,c,T.j?T.j(this):T.call(null,this))}var b=null;b=function(c,d){switch(arguments.length){case 1:return a.call(this,c);case 2:return U(this,c,d)}throw Error("Invalid arity: "+arguments.length);};b.j=a;b.m=function(c,d){return U(this,c,d)};return b}();g.W=function(a,b){a=b+this.i;if(0<=a&&a<this.o.length)return this.o[a];throw Error("Index out of bounds");};g.oa=function(a,b,c){a=b+this.i;return 0<=a&&a<this.o.length?this.o[a]:c};
g.ua=function(){return new Yb(this.o,this.i)};g.T=function(){return this.C};g.ba=function(){return this.i+1<this.o.length?new M(this.o,this.i+1,null):null};g.Y=function(){var a=this.o.length-this.i;return 0>a?0:a};g.S=function(){return Kb(this)};g.O=function(a,b){return Zb.m?Zb.m(this,b):Zb.call(null,this,b)};g.Z=function(){return O};g.da=function(a,b){return Tb(this.o,b,this.o[this.i],this.i+1)};g.ea=function(a,b,c){return Tb(this.o,b,c,this.i)};g.fa=function(){return this.o[this.i]};
g.ja=function(){return this.i+1<this.o.length?new M(this.o,this.i+1,null):O};g.M=function(){return this.i<this.o.length?this:null};g.U=function(a,b){return b===this.C?this:new M(this.o,this.i,b)};g.X=function(a,b){return V.m?V.m(b,this):V.call(null,b,this)};M.prototype[va]=function(){return Ib(this)};function $b(a){return 0<a.length?new M(a,0,null):null}Ya._=function(a,b){return a===b};
var ac=function ac(a){switch(arguments.length){case 0:return ac.I();case 1:return ac.j(arguments[0]);case 2:return ac.m(arguments[0],arguments[1]);default:for(var c=[],d=arguments.length,e=0;;)if(e<d)c.push(arguments[e]),e+=1;else break;return ac.N(arguments[0],arguments[1],new M(c.slice(2),0,null))}};ac.I=function(){return bc};ac.j=function(a){return a};ac.m=function(a,b){return null!=a?Ba(a,b):new cc(null,b,null,1,null)};
ac.N=function(a,b,c){for(;;)if(v(c))a=ac.m(a,b),b=N(c),c=P(c);else return ac.m(a,b)};ac.$=function(a){var b=N(a),c=P(a);a=N(c);c=P(c);return this.N(b,a,c)};ac.aa=2;function T(a){if(null!=a)if(null!=a&&(a.u&2||u===a.Bb))a=a.Y(null);else if(ta(a))a=a.length;else if("string"===typeof a)a=a.length;else if(null!=a&&(a.u&8388608||u===a.Nb))a:{a=K(a);for(var b=0;;){if(Ub(a)){a=b+xa(a);break a}a=P(a);b+=1}}else a=xa(a);else a=0;return a}
function dc(a,b,c){for(;;){if(null==a)return c;if(0===b)return K(a)?N(a):c;if(Vb(a))return D(a,b,c);if(K(a))a=P(a),--b;else return c}}function Xb(a){switch(arguments.length){case 2:return Wb(arguments[0],arguments[1]);case 3:return W(arguments[0],arguments[1],arguments[2]);default:throw Error(["Invalid arity: ",z.j(arguments.length)].join(""));}}
function Wb(a,b){if("number"!==typeof b)throw Error("Index argument to nth must be a number");if(null==a)return a;if(null!=a&&(a.u&16||u===a.ub))return a.W(null,b);if(ta(a)){if(-1<b&&b<a.length)return a[b|0];throw Error("Index out of bounds");}if("string"===typeof a){if(-1<b&&b<a.length)return a.charAt(b|0);throw Error("Index out of bounds");}if(null!=a&&(a.u&64||u===a.ab)||null!=a&&(a.u&16777216||u===a.vb)){if(0>b)throw Error("Index out of bounds");a:for(;;){if(null==a)throw Error("Index out of bounds");
if(0===b){if(K(a)){a=N(a);break a}throw Error("Index out of bounds");}if(Vb(a)){a=D(a,b);break a}if(K(a))a=P(a),--b;else throw Error("Index out of bounds");}return a}if(w(Ca,a))return D(a,b);throw Error(["nth not supported on this type ",z.j(ua(null==a?null:a.constructor))].join(""));}
function W(a,b,c){if("number"!==typeof b)throw Error("Index argument to nth must be a number.");if(null==a)return c;if(null!=a&&(a.u&16||u===a.ub))return a.oa(null,b,c);if(ta(a))return-1<b&&b<a.length?a[b|0]:c;if("string"===typeof a)return-1<b&&b<a.length?a.charAt(b|0):c;if(null!=a&&(a.u&64||u===a.ab)||null!=a&&(a.u&16777216||u===a.vb))return 0>b?c:dc(a,b,c);if(w(Ca,a))return D(a,b,c);throw Error(["nth not supported on this type ",z.j(ua(null==a?null:a.constructor))].join(""));}
var Cb=function Cb(a){switch(arguments.length){case 2:return Cb.m(arguments[0],arguments[1]);case 3:return Cb.v(arguments[0],arguments[1],arguments[2]);default:throw Error(["Invalid arity: ",z.j(arguments.length)].join(""));}};Cb.m=function(a,b){return null==a?null:null!=a&&(a.u&256||u===a.Hb)?a.na(null,b):ta(a)?null!=b&&b<a.length?a[b|0]:null:"string"===typeof a?null!=b&&-1<b&&b<a.length?a.charAt(b|0):null:w(Fa,a)?Ga(a,b):null};
Cb.v=function(a,b,c){return null!=a?null!=a&&(a.u&256||u===a.Hb)?a.K(null,b,c):ta(a)?null!=b&&-1<b&&b<a.length?a[b|0]:c:"string"===typeof a?null!=b&&-1<b&&b<a.length?a.charAt(b|0):c:w(Fa,a)?Ga(a,b,c):c:c};Cb.aa=3;var ec=function ec(a){switch(arguments.length){case 3:return ec.v(arguments[0],arguments[1],arguments[2]);default:for(var c=[],d=arguments.length,e=0;;)if(e<d)c.push(arguments[e]),e+=1;else break;return ec.N(arguments[0],arguments[1],arguments[2],new M(c.slice(3),0,null))}};
ec.v=function(a,b,c){return null!=a&&(a.u&512||u===a.Ab)?a.za(null,b,c):null!=a?Ka(a,b,c):fc([b,c])};ec.N=function(a,b,c,d){for(;;)if(a=ec.v(a,b,c),v(d))b=N(d),c=N(P(d)),d=P(P(d));else return a};ec.$=function(a){var b=N(a),c=P(a);a=N(c);var d=P(c);c=N(d);d=P(d);return this.N(b,a,c,d)};ec.aa=3;function gc(a,b){this.B=a;this.C=b;this.u=393217;this.F=0}g=gc.prototype;g.T=function(){return this.C};g.U=function(a,b){return new gc(this.B,b)};
g.call=function(a){switch(arguments.length-1){case 0:return this.I();case 1:return this.j(arguments[1]);case 2:return this.m(arguments[1],arguments[2]);case 3:return this.v(arguments[1],arguments[2],arguments[3]);case 4:return this.ia(arguments[1],arguments[2],arguments[3],arguments[4]);case 5:return this.wa(arguments[1],arguments[2],arguments[3],arguments[4],arguments[5]);case 6:return this.Pa(arguments[1],arguments[2],arguments[3],arguments[4],arguments[5],arguments[6]);case 7:return this.Qa(arguments[1],
arguments[2],arguments[3],arguments[4],arguments[5],arguments[6],arguments[7]);case 8:return this.Ra(arguments[1],arguments[2],arguments[3],arguments[4],arguments[5],arguments[6],arguments[7],arguments[8]);case 9:return this.Sa(arguments[1],arguments[2],arguments[3],arguments[4],arguments[5],arguments[6],arguments[7],arguments[8],arguments[9]);case 10:return this.Ea(arguments[1],arguments[2],arguments[3],arguments[4],arguments[5],arguments[6],arguments[7],arguments[8],arguments[9],arguments[10]);
case 11:return this.Fa(arguments[1],arguments[2],arguments[3],arguments[4],arguments[5],arguments[6],arguments[7],arguments[8],arguments[9],arguments[10],arguments[11]);case 12:return this.Ga(arguments[1],arguments[2],arguments[3],arguments[4],arguments[5],arguments[6],arguments[7],arguments[8],arguments[9],arguments[10],arguments[11],arguments[12]);case 13:return this.Ha(arguments[1],arguments[2],arguments[3],arguments[4],arguments[5],arguments[6],arguments[7],arguments[8],arguments[9],arguments[10],
arguments[11],arguments[12],arguments[13]);case 14:return this.Ia(arguments[1],arguments[2],arguments[3],arguments[4],arguments[5],arguments[6],arguments[7],arguments[8],arguments[9],arguments[10],arguments[11],arguments[12],arguments[13],arguments[14]);case 15:return this.Ja(arguments[1],arguments[2],arguments[3],arguments[4],arguments[5],arguments[6],arguments[7],arguments[8],arguments[9],arguments[10],arguments[11],arguments[12],arguments[13],arguments[14],arguments[15]);case 16:return this.Ka(arguments[1],
arguments[2],arguments[3],arguments[4],arguments[5],arguments[6],arguments[7],arguments[8],arguments[9],arguments[10],arguments[11],arguments[12],arguments[13],arguments[14],arguments[15],arguments[16]);case 17:return this.La(arguments[1],arguments[2],arguments[3],arguments[4],arguments[5],arguments[6],arguments[7],arguments[8],arguments[9],arguments[10],arguments[11],arguments[12],arguments[13],arguments[14],arguments[15],arguments[16],arguments[17]);case 18:return this.Ma(arguments[1],arguments[2],
arguments[3],arguments[4],arguments[5],arguments[6],arguments[7],arguments[8],arguments[9],arguments[10],arguments[11],arguments[12],arguments[13],arguments[14],arguments[15],arguments[16],arguments[17],arguments[18]);case 19:return this.Na(arguments[1],arguments[2],arguments[3],arguments[4],arguments[5],arguments[6],arguments[7],arguments[8],arguments[9],arguments[10],arguments[11],arguments[12],arguments[13],arguments[14],arguments[15],arguments[16],arguments[17],arguments[18],arguments[19]);case 20:return this.Oa(arguments[1],
arguments[2],arguments[3],arguments[4],arguments[5],arguments[6],arguments[7],arguments[8],arguments[9],arguments[10],arguments[11],arguments[12],arguments[13],arguments[14],arguments[15],arguments[16],arguments[17],arguments[18],arguments[19],arguments[20]);case 21:var b=arguments[1],c=arguments[2],d=arguments[3],e=arguments[4],f=arguments[5],h=arguments[6],k=arguments[7],l=arguments[8],m=arguments[9],n=arguments[10],p=arguments[11],q=arguments[12],t=arguments[13],y=arguments[14],A=arguments[15],
C=arguments[16],F=arguments[17],J=arguments[18],Q=arguments[19],ea=arguments[20],na=arguments[21];return hc.Gb?hc.Gb(this.B,b,c,d,e,f,h,k,l,m,n,p,q,t,y,A,C,F,J,Q,ea,na):hc.call(null,this.B,b,c,d,e,f,h,k,l,m,n,p,q,t,y,A,C,F,J,Q,ea,na);default:throw Error(["Invalid arity: ",z.j(arguments.length-1)].join(""));}};g.apply=function(a,b){return this.call.apply(this,[this].concat(B(b)))};g.I=function(){return this.B.I?this.B.I():this.B.call(null)};
g.j=function(a){return this.B.j?this.B.j(a):this.B.call(null,a)};g.m=function(a,b){return this.B.m?this.B.m(a,b):this.B.call(null,a,b)};g.v=function(a,b,c){return this.B.v?this.B.v(a,b,c):this.B.call(null,a,b,c)};g.ia=function(a,b,c,d){return this.B.ia?this.B.ia(a,b,c,d):this.B.call(null,a,b,c,d)};g.wa=function(a,b,c,d,e){return this.B.wa?this.B.wa(a,b,c,d,e):this.B.call(null,a,b,c,d,e)};g.Pa=function(a,b,c,d,e,f){return this.B.Pa?this.B.Pa(a,b,c,d,e,f):this.B.call(null,a,b,c,d,e,f)};
g.Qa=function(a,b,c,d,e,f,h){return this.B.Qa?this.B.Qa(a,b,c,d,e,f,h):this.B.call(null,a,b,c,d,e,f,h)};g.Ra=function(a,b,c,d,e,f,h,k){return this.B.Ra?this.B.Ra(a,b,c,d,e,f,h,k):this.B.call(null,a,b,c,d,e,f,h,k)};g.Sa=function(a,b,c,d,e,f,h,k,l){return this.B.Sa?this.B.Sa(a,b,c,d,e,f,h,k,l):this.B.call(null,a,b,c,d,e,f,h,k,l)};g.Ea=function(a,b,c,d,e,f,h,k,l,m){return this.B.Ea?this.B.Ea(a,b,c,d,e,f,h,k,l,m):this.B.call(null,a,b,c,d,e,f,h,k,l,m)};
g.Fa=function(a,b,c,d,e,f,h,k,l,m,n){return this.B.Fa?this.B.Fa(a,b,c,d,e,f,h,k,l,m,n):this.B.call(null,a,b,c,d,e,f,h,k,l,m,n)};g.Ga=function(a,b,c,d,e,f,h,k,l,m,n,p){return this.B.Ga?this.B.Ga(a,b,c,d,e,f,h,k,l,m,n,p):this.B.call(null,a,b,c,d,e,f,h,k,l,m,n,p)};g.Ha=function(a,b,c,d,e,f,h,k,l,m,n,p,q){return this.B.Ha?this.B.Ha(a,b,c,d,e,f,h,k,l,m,n,p,q):this.B.call(null,a,b,c,d,e,f,h,k,l,m,n,p,q)};
g.Ia=function(a,b,c,d,e,f,h,k,l,m,n,p,q,t){return this.B.Ia?this.B.Ia(a,b,c,d,e,f,h,k,l,m,n,p,q,t):this.B.call(null,a,b,c,d,e,f,h,k,l,m,n,p,q,t)};g.Ja=function(a,b,c,d,e,f,h,k,l,m,n,p,q,t,y){return this.B.Ja?this.B.Ja(a,b,c,d,e,f,h,k,l,m,n,p,q,t,y):this.B.call(null,a,b,c,d,e,f,h,k,l,m,n,p,q,t,y)};g.Ka=function(a,b,c,d,e,f,h,k,l,m,n,p,q,t,y,A){return this.B.Ka?this.B.Ka(a,b,c,d,e,f,h,k,l,m,n,p,q,t,y,A):this.B.call(null,a,b,c,d,e,f,h,k,l,m,n,p,q,t,y,A)};
g.La=function(a,b,c,d,e,f,h,k,l,m,n,p,q,t,y,A,C){return this.B.La?this.B.La(a,b,c,d,e,f,h,k,l,m,n,p,q,t,y,A,C):this.B.call(null,a,b,c,d,e,f,h,k,l,m,n,p,q,t,y,A,C)};g.Ma=function(a,b,c,d,e,f,h,k,l,m,n,p,q,t,y,A,C,F){return this.B.Ma?this.B.Ma(a,b,c,d,e,f,h,k,l,m,n,p,q,t,y,A,C,F):this.B.call(null,a,b,c,d,e,f,h,k,l,m,n,p,q,t,y,A,C,F)};
g.Na=function(a,b,c,d,e,f,h,k,l,m,n,p,q,t,y,A,C,F,J){return this.B.Na?this.B.Na(a,b,c,d,e,f,h,k,l,m,n,p,q,t,y,A,C,F,J):this.B.call(null,a,b,c,d,e,f,h,k,l,m,n,p,q,t,y,A,C,F,J)};g.Oa=function(a,b,c,d,e,f,h,k,l,m,n,p,q,t,y,A,C,F,J,Q){return this.B.Oa?this.B.Oa(a,b,c,d,e,f,h,k,l,m,n,p,q,t,y,A,C,F,J,Q):this.B.call(null,a,b,c,d,e,f,h,k,l,m,n,p,q,t,y,A,C,F,J,Q)};function ic(a,b){return"function"===typeof a?new gc(a,b):null==a?null:Sa(a,b)}
function jc(a){var b=null!=a;return(b?null!=a?a.u&131072||u===a.Kb||(a.u?0:w(Qa,a)):w(Qa,a):b)?Ra(a):null}function kc(a){return null!=a?a.u&16777216||u===a.vb?!0:a.u?!1:w(bb,a):w(bb,a)}function lc(a){return null==a?!1:null!=a?a.u&1024||u===a.$b?!0:a.u?!1:w(La,a):w(La,a)}function mc(a){return null!=a?a.u&67108864||u===a.bc?!0:a.u?!1:w(db,a):w(db,a)}function nc(a){return null!=a?a.u&16384||u===a.cc?!0:a.u?!1:w(Oa,a):w(Oa,a)}function oc(a){return null!=a?a.F&512||u===a.Tb?!0:!1:!1}
function pc(a,b,c,d,e){for(;;){if(0===e)return c;c[d]=a[b];d+=1;--e;b+=1}}var qc={};function rc(a){return null==a?!1:!1===a?!1:!0}function sc(a,b){return null!=a&&(a.u&512||u===a.Ab)?a.Wa(null,b):w(Ia,a)?Ja(a,b):Cb.v(a,b,qc)===qc?!1:!0}function tc(a,b){var c=K(b);return c?(b=N(c),c=P(c),uc?uc(a,b,c):vc.call(null,a,b,c)):a.I?a.I():a.call(null)}function wc(a,b,c){for(c=K(c);;)if(c){var d=N(c);b=a.m?a.m(b,d):a.call(null,b,d);if(Pb(b))return Pa(b);c=P(c)}else return b}
function xc(a,b){a=ob(a);if(v(a.la()))for(var c=a.next();;)if(a.la()){var d=a.next();c=b.m?b.m(c,d):b.call(null,c,d);if(Pb(c))return Pa(c)}else return c;else return b.I?b.I():b.call(null)}function yc(a,b,c){for(a=ob(a);;)if(a.la()){var d=a.next();c=b.m?b.m(c,d):b.call(null,c,d);if(Pb(c))return Pa(c)}else return c}
function vc(a){switch(arguments.length){case 2:var b=arguments[0],c=arguments[1];return null!=c&&(c.u&524288||u===c.Mb)?c.da(null,b):ta(c)?Rb(c,b):"string"===typeof c?Rb(c,b):w(Ta,c)?Ua(c,b):Eb(c)?xc(c,b):tc(b,c);case 3:return uc(arguments[0],arguments[1],arguments[2]);default:throw Error(["Invalid arity: ",z.j(arguments.length)].join(""));}}
function uc(a,b,c){return null!=c&&(c.u&524288||u===c.Mb)?c.ea(null,a,b):ta(c)?Sb(c,a,b):"string"===typeof c?Sb(c,a,b):w(Ta,c)?Ua(c,a,b):Eb(c)?yc(c,a,b):wc(a,b,c)}function zc(a,b){return null!=b?Xa(b,a):!0}function Ac(a){return a}function Bc(a){a=(a-a%2)/2;return 0<=a?Math.floor(a):Math.ceil(a)}function Cc(a){a-=a>>1&1431655765;a=(a&858993459)+(a>>2&858993459);return 16843009*(a+(a>>4)&252645135)>>24}
var z=function z(a){switch(arguments.length){case 0:return z.I();case 1:return z.j(arguments[0]);default:for(var c=[],d=arguments.length,e=0;;)if(e<d)c.push(arguments[e]),e+=1;else break;return z.N(arguments[0],new M(c.slice(1),0,null))}};z.I=function(){return""};z.j=function(a){return null==a?"":[a].join("")};z.N=function(a,b){for(a=new fa(z.j(a));;)if(v(b))a=a.append(z.j(N(b))),b=P(b);else return a.toString()};z.$=function(a){var b=N(a);a=P(a);return this.N(b,a)};z.aa=1;
function Zb(a,b){if(kc(b))if(Ub(a)&&Ub(b)&&T(a)!==T(b))a=!1;else a:for(a=K(a),b=K(b);;){if(null==a){a=null==b;break a}if(null!=b&&R.m(N(a),N(b)))a=P(a),b=P(b);else{a=!1;break a}}else a=null;return rc(a)}function cc(a,b,c,d,e){this.C=a;this.first=b;this.ya=c;this.count=d;this.D=e;this.u=65937646;this.F=8192}g=cc.prototype;g.toString=function(){return qb(this)};
g.indexOf=function(){var a=null;a=function(b,c){switch(arguments.length){case 1:return S(this,b,0);case 2:return S(this,b,c)}throw Error("Invalid arity: "+arguments.length);};a.j=function(b){return S(this,b,0)};a.m=function(b,c){return S(this,b,c)};return a}();
g.lastIndexOf=function(){function a(c){return U(this,c,this.count)}var b=null;b=function(c,d){switch(arguments.length){case 1:return a.call(this,c);case 2:return U(this,c,d)}throw Error("Invalid arity: "+arguments.length);};b.j=a;b.m=function(c,d){return U(this,c,d)};return b}();g.T=function(){return this.C};g.ba=function(){return 1===this.count?null:this.ya};g.Y=function(){return this.count};g.S=function(){var a=this.D;return null!=a?a:this.D=a=Kb(this)};g.O=function(a,b){return Zb(this,b)};
g.Z=function(){return Sa(O,this.C)};g.da=function(a,b){return tc(b,this)};g.ea=function(a,b,c){return wc(b,c,this)};g.fa=function(){return this.first};g.ja=function(){return 1===this.count?O:this.ya};g.M=function(){return this};g.U=function(a,b){return b===this.C?this:new cc(b,this.first,this.ya,this.count,this.D)};g.X=function(a,b){return new cc(this.C,b,this,this.count+1,null)};cc.prototype[va]=function(){return Ib(this)};function Dc(a){this.C=a;this.u=65937614;this.F=8192}g=Dc.prototype;
g.toString=function(){return qb(this)};g.indexOf=function(){var a=null;a=function(b,c){switch(arguments.length){case 1:return S(this,b,0);case 2:return S(this,b,c)}throw Error("Invalid arity: "+arguments.length);};a.j=function(b){return S(this,b,0)};a.m=function(b,c){return S(this,b,c)};return a}();
g.lastIndexOf=function(){function a(c){return U(this,c,T(this))}var b=null;b=function(c,d){switch(arguments.length){case 1:return a.call(this,c);case 2:return U(this,c,d)}throw Error("Invalid arity: "+arguments.length);};b.j=a;b.m=function(c,d){return U(this,c,d)};return b}();g.T=function(){return this.C};g.ba=function(){return null};g.Y=function(){return 0};g.S=function(){return Lb};g.O=function(a,b){return(null!=b?b.u&33554432||u===b.Zb||(b.u?0:w(cb,b)):w(cb,b))||kc(b)?null==K(b):!1};g.Z=function(){return this};
g.da=function(a,b){return tc(b,this)};g.ea=function(a,b,c){return wc(b,c,this)};g.fa=function(){return null};g.ja=function(){return O};g.M=function(){return null};g.U=function(a,b){return b===this.C?this:new Dc(b)};g.X=function(a,b){return new cc(this.C,b,null,1,null)};var O=new Dc(null);Dc.prototype[va]=function(){return Ib(this)};function Ec(a,b,c,d){this.C=a;this.first=b;this.ya=c;this.D=d;this.u=65929452;this.F=8192}g=Ec.prototype;g.toString=function(){return qb(this)};
g.indexOf=function(){var a=null;a=function(b,c){switch(arguments.length){case 1:return S(this,b,0);case 2:return S(this,b,c)}throw Error("Invalid arity: "+arguments.length);};a.j=function(b){return S(this,b,0)};a.m=function(b,c){return S(this,b,c)};return a}();
g.lastIndexOf=function(){function a(c){return U(this,c,T(this))}var b=null;b=function(c,d){switch(arguments.length){case 1:return a.call(this,c);case 2:return U(this,c,d)}throw Error("Invalid arity: "+arguments.length);};b.j=a;b.m=function(c,d){return U(this,c,d)};return b}();g.T=function(){return this.C};g.ba=function(){return null==this.ya?null:K(this.ya)};g.S=function(){var a=this.D;return null!=a?a:this.D=a=Kb(this)};g.O=function(a,b){return Zb(this,b)};g.Z=function(){return O};
g.da=function(a,b){return tc(b,this)};g.ea=function(a,b,c){return wc(b,c,this)};g.fa=function(){return this.first};g.ja=function(){return null==this.ya?O:this.ya};g.M=function(){return this};g.U=function(a,b){return b===this.C?this:new Ec(b,this.first,this.ya,this.D)};g.X=function(a,b){return new Ec(null,b,this,null)};Ec.prototype[va]=function(){return Ib(this)};function V(a,b){return null==b?new cc(null,a,null,1,null):null!=b&&(b.u&64||u===b.ab)?new Ec(null,a,b,null):new Ec(null,a,K(b),null)}
function I(a,b,c,d){this.hb=a;this.name=b;this.xa=c;this.Va=d;this.u=2153775105;this.F=4096}g=I.prototype;g.toString=function(){return[":",z.j(this.xa)].join("")};g.O=function(a,b){return b instanceof I?this.xa===b.xa:!1};g.call=function(a){switch(arguments.length-1){case 1:return this.j(arguments[1]);case 2:return this.m(arguments[1],arguments[2]);default:throw Error(["Invalid arity: ",z.j(arguments.length-1)].join(""));}};g.apply=function(a,b){return this.call.apply(this,[this].concat(B(b)))};
g.j=function(a){return Cb.m(a,this)};g.m=function(a,b){return Cb.v(a,this,b)};g.S=function(){var a=this.Va;return null!=a?a:this.Va=a=Ab(vb(this.name),yb(this.hb))+2654435769|0};g.P=function(a,b){return H(b,[":",z.j(this.xa)].join(""))};function Fc(a){if(null!=a&&(a.F&4096||u===a.Lb))return a.hb;throw Error(["Doesn't support namespace: ",z.j(a)].join(""));}
var Gc=function Gc(a){switch(arguments.length){case 1:return Gc.j(arguments[0]);case 2:return Gc.m(arguments[0],arguments[1]);default:throw Error(["Invalid arity: ",z.j(arguments.length)].join(""));}};Gc.j=function(a){if(a instanceof I)return a;if(a instanceof Bb)return new I(Fc(a),Hc.j?Hc.j(a):Hc.call(null,a),a.Ca,null);if(R.m("/",a))return new I(null,a,a,null);if("string"===typeof a){var b=a.split("/");return 2===b.length?new I(b[0],b[1],a,null):new I(null,b[0],a,null)}return null};
Gc.m=function(a,b){a=a instanceof I?Hc.j?Hc.j(a):Hc.call(null,a):a instanceof Bb?Hc.j?Hc.j(a):Hc.call(null,a):a;b=b instanceof I?Hc.j?Hc.j(b):Hc.call(null,b):b instanceof Bb?Hc.j?Hc.j(b):Hc.call(null,b):b;return new I(a,b,[v(a)?[z.j(a),"/"].join(""):null,z.j(b)].join(""),null)};Gc.aa=2;function Ic(a,b,c){this.C=a;this.cb=b;this.s=null;this.D=c;this.u=32374988;this.F=1}g=Ic.prototype;g.toString=function(){return qb(this)};
function Jc(a){null!=a.cb&&(a.s=a.cb.I?a.cb.I():a.cb.call(null),a.cb=null);return a.s}g.indexOf=function(){var a=null;a=function(b,c){switch(arguments.length){case 1:return S(this,b,0);case 2:return S(this,b,c)}throw Error("Invalid arity: "+arguments.length);};a.j=function(b){return S(this,b,0)};a.m=function(b,c){return S(this,b,c)};return a}();
g.lastIndexOf=function(){function a(c){return U(this,c,T(this))}var b=null;b=function(c,d){switch(arguments.length){case 1:return a.call(this,c);case 2:return U(this,c,d)}throw Error("Invalid arity: "+arguments.length);};b.j=a;b.m=function(c,d){return U(this,c,d)};return b}();g.T=function(){return this.C};g.ba=function(){this.M(null);return null==this.s?null:P(this.s)};g.S=function(){var a=this.D;return null!=a?a:this.D=a=Kb(this)};g.O=function(a,b){return Zb(this,b)};g.Z=function(){return Sa(O,this.C)};
g.da=function(a,b){return tc(b,this)};g.ea=function(a,b,c){return wc(b,c,this)};g.fa=function(){this.M(null);return null==this.s?null:N(this.s)};g.ja=function(){this.M(null);return null!=this.s?Gb(this.s):O};g.M=function(){Jc(this);if(null==this.s)return null;for(var a=this.s;;)if(a instanceof Ic)a=Jc(a);else return this.s=a,K(this.s)};g.U=function(a,b){var c=this;return b===this.C?c:new Ic(b,function(){return c.M(null)},this.D)};g.X=function(a,b){return V(b,this)};Ic.prototype[va]=function(){return Ib(this)};
function Kc(a){this.ob=a;this.end=0;this.u=2;this.F=0}Kc.prototype.add=function(a){this.ob[this.end]=a;return this.end+=1};Kc.prototype.va=function(){var a=new Lc(this.ob,0,this.end);this.ob=null;return a};Kc.prototype.Y=function(){return this.end};function Lc(a,b,c){this.o=a;this.V=b;this.end=c;this.u=524306;this.F=0}g=Lc.prototype;g.Y=function(){return this.end-this.V};g.W=function(a,b){return this.o[this.V+b]};g.oa=function(a,b,c){return 0<=b&&b<this.end-this.V?this.o[this.V+b]:c};
g.sb=function(){if(this.V===this.end)throw Error("-drop-first of empty chunk");return new Lc(this.o,this.V+1,this.end)};g.da=function(a,b){return Tb(this.o,b,this.o[this.V],this.V+1)};g.ea=function(a,b,c){return Tb(this.o,b,c,this.V)};function Mc(a,b,c,d){this.va=a;this.ra=b;this.C=c;this.D=d;this.u=31850732;this.F=1536}g=Mc.prototype;g.toString=function(){return qb(this)};
g.indexOf=function(){var a=null;a=function(b,c){switch(arguments.length){case 1:return S(this,b,0);case 2:return S(this,b,c)}throw Error("Invalid arity: "+arguments.length);};a.j=function(b){return S(this,b,0)};a.m=function(b,c){return S(this,b,c)};return a}();
g.lastIndexOf=function(){function a(c){return U(this,c,T(this))}var b=null;b=function(c,d){switch(arguments.length){case 1:return a.call(this,c);case 2:return U(this,c,d)}throw Error("Invalid arity: "+arguments.length);};b.j=a;b.m=function(c,d){return U(this,c,d)};return b}();g.T=function(){return this.C};g.ba=function(){return 1<xa(this.va)?new Mc(kb(this.va),this.ra,null,null):null==this.ra?null:ab(this.ra)};g.S=function(){var a=this.D;return null!=a?a:this.D=a=Kb(this)};
g.O=function(a,b){return Zb(this,b)};g.Z=function(){return O};g.fa=function(){return D(this.va,0)};g.ja=function(){return 1<xa(this.va)?new Mc(kb(this.va),this.ra,null,null):null==this.ra?O:this.ra};g.M=function(){return this};g.pb=function(){return this.va};g.ib=function(){return null==this.ra?O:this.ra};g.U=function(a,b){return b===this.C?this:new Mc(this.va,this.ra,b,this.D)};g.X=function(a,b){return V(b,this)};g.tb=function(){return null==this.ra?null:this.ra};Mc.prototype[va]=function(){return Ib(this)};
function Nc(a,b){return 0===xa(a)?b:new Mc(a,b,null,null)}function Oc(a,b){a.add(b)}function Pc(a,b){if(Ub(b))return T(b);var c=0;for(b=K(b);;)if(null!=b&&c<a)c+=1,b=P(b);else return c}var Qc=function Qc(a){if(null==a)return null;var c=P(a);return null==c?K(N(a)):V(N(a),Qc.j?Qc.j(c):Qc.call(null,c))};
function Rc(a,b,c){var d=K(c);if(0===b)return a.I?a.I():a.call(null);c=E(d);var e=G(d);if(1===b)return a.j?a.j(c):a.call(null,c);d=E(e);var f=G(e);if(2===b)return a.m?a.m(c,d):a.call(null,c,d);e=E(f);var h=G(f);if(3===b)return a.v?a.v(c,d,e):a.call(null,c,d,e);f=E(h);var k=G(h);if(4===b)return a.ia?a.ia(c,d,e,f):a.call(null,c,d,e,f);h=E(k);var l=G(k);if(5===b)return a.wa?a.wa(c,d,e,f,h):a.call(null,c,d,e,f,h);k=E(l);var m=G(l);if(6===b)return a.Pa?a.Pa(c,d,e,f,h,k):a.call(null,c,d,e,f,h,k);l=E(m);
var n=G(m);if(7===b)return a.Qa?a.Qa(c,d,e,f,h,k,l):a.call(null,c,d,e,f,h,k,l);m=E(n);var p=G(n);if(8===b)return a.Ra?a.Ra(c,d,e,f,h,k,l,m):a.call(null,c,d,e,f,h,k,l,m);n=E(p);var q=G(p);if(9===b)return a.Sa?a.Sa(c,d,e,f,h,k,l,m,n):a.call(null,c,d,e,f,h,k,l,m,n);p=E(q);var t=G(q);if(10===b)return a.Ea?a.Ea(c,d,e,f,h,k,l,m,n,p):a.call(null,c,d,e,f,h,k,l,m,n,p);q=E(t);var y=G(t);if(11===b)return a.Fa?a.Fa(c,d,e,f,h,k,l,m,n,p,q):a.call(null,c,d,e,f,h,k,l,m,n,p,q);t=E(y);var A=G(y);if(12===b)return a.Ga?
a.Ga(c,d,e,f,h,k,l,m,n,p,q,t):a.call(null,c,d,e,f,h,k,l,m,n,p,q,t);y=E(A);var C=G(A);if(13===b)return a.Ha?a.Ha(c,d,e,f,h,k,l,m,n,p,q,t,y):a.call(null,c,d,e,f,h,k,l,m,n,p,q,t,y);A=E(C);var F=G(C);if(14===b)return a.Ia?a.Ia(c,d,e,f,h,k,l,m,n,p,q,t,y,A):a.call(null,c,d,e,f,h,k,l,m,n,p,q,t,y,A);C=E(F);var J=G(F);if(15===b)return a.Ja?a.Ja(c,d,e,f,h,k,l,m,n,p,q,t,y,A,C):a.call(null,c,d,e,f,h,k,l,m,n,p,q,t,y,A,C);F=E(J);var Q=G(J);if(16===b)return a.Ka?a.Ka(c,d,e,f,h,k,l,m,n,p,q,t,y,A,C,F):a.call(null,
c,d,e,f,h,k,l,m,n,p,q,t,y,A,C,F);J=E(Q);var ea=G(Q);if(17===b)return a.La?a.La(c,d,e,f,h,k,l,m,n,p,q,t,y,A,C,F,J):a.call(null,c,d,e,f,h,k,l,m,n,p,q,t,y,A,C,F,J);Q=E(ea);var na=G(ea);if(18===b)return a.Ma?a.Ma(c,d,e,f,h,k,l,m,n,p,q,t,y,A,C,F,J,Q):a.call(null,c,d,e,f,h,k,l,m,n,p,q,t,y,A,C,F,J,Q);ea=E(na);na=G(na);if(19===b)return a.Na?a.Na(c,d,e,f,h,k,l,m,n,p,q,t,y,A,C,F,J,Q,ea):a.call(null,c,d,e,f,h,k,l,m,n,p,q,t,y,A,C,F,J,Q,ea);var Td=E(na);G(na);if(20===b)return a.Oa?a.Oa(c,d,e,f,h,k,l,m,n,p,q,t,
y,A,C,F,J,Q,ea,Td):a.call(null,c,d,e,f,h,k,l,m,n,p,q,t,y,A,C,F,J,Q,ea,Td);throw Error("Only up to 20 arguments supported on functions");}function Sc(a){return null!=a&&(a.u&128||u===a.$a)?a.ba():K(Gb(a))}function Tc(a,b,c){return null==c?a.j?a.j(b):a.call(a,b):Uc(a,b,E(c),Sc(c))}function Uc(a,b,c,d){return null==d?a.m?a.m(b,c):a.call(a,b,c):Vc(a,b,c,E(d),Sc(d))}function Vc(a,b,c,d,e){return null==e?a.v?a.v(b,c,d):a.call(a,b,c,d):Wc(a,b,c,d,E(e),Sc(e))}
function Wc(a,b,c,d,e,f){if(null==f)return a.ia?a.ia(b,c,d,e):a.call(a,b,c,d,e);var h=E(f),k=P(f);if(null==k)return a.wa?a.wa(b,c,d,e,h):a.call(a,b,c,d,e,h);f=E(k);var l=P(k);if(null==l)return a.Pa?a.Pa(b,c,d,e,h,f):a.call(a,b,c,d,e,h,f);k=E(l);var m=P(l);if(null==m)return a.Qa?a.Qa(b,c,d,e,h,f,k):a.call(a,b,c,d,e,h,f,k);l=E(m);var n=P(m);if(null==n)return a.Ra?a.Ra(b,c,d,e,h,f,k,l):a.call(a,b,c,d,e,h,f,k,l);m=E(n);var p=P(n);if(null==p)return a.Sa?a.Sa(b,c,d,e,h,f,k,l,m):a.call(a,b,c,d,e,h,f,k,l,
m);n=E(p);var q=P(p);if(null==q)return a.Ea?a.Ea(b,c,d,e,h,f,k,l,m,n):a.call(a,b,c,d,e,h,f,k,l,m,n);p=E(q);var t=P(q);if(null==t)return a.Fa?a.Fa(b,c,d,e,h,f,k,l,m,n,p):a.call(a,b,c,d,e,h,f,k,l,m,n,p);q=E(t);var y=P(t);if(null==y)return a.Ga?a.Ga(b,c,d,e,h,f,k,l,m,n,p,q):a.call(a,b,c,d,e,h,f,k,l,m,n,p,q);t=E(y);var A=P(y);if(null==A)return a.Ha?a.Ha(b,c,d,e,h,f,k,l,m,n,p,q,t):a.call(a,b,c,d,e,h,f,k,l,m,n,p,q,t);y=E(A);var C=P(A);if(null==C)return a.Ia?a.Ia(b,c,d,e,h,f,k,l,m,n,p,q,t,y):a.call(a,b,
c,d,e,h,f,k,l,m,n,p,q,t,y);A=E(C);var F=P(C);if(null==F)return a.Ja?a.Ja(b,c,d,e,h,f,k,l,m,n,p,q,t,y,A):a.call(a,b,c,d,e,h,f,k,l,m,n,p,q,t,y,A);C=E(F);var J=P(F);if(null==J)return a.Ka?a.Ka(b,c,d,e,h,f,k,l,m,n,p,q,t,y,A,C):a.call(a,b,c,d,e,h,f,k,l,m,n,p,q,t,y,A,C);F=E(J);var Q=P(J);if(null==Q)return a.La?a.La(b,c,d,e,h,f,k,l,m,n,p,q,t,y,A,C,F):a.call(a,b,c,d,e,h,f,k,l,m,n,p,q,t,y,A,C,F);J=E(Q);var ea=P(Q);if(null==ea)return a.Ma?a.Ma(b,c,d,e,h,f,k,l,m,n,p,q,t,y,A,C,F,J):a.call(a,b,c,d,e,h,f,k,l,m,
n,p,q,t,y,A,C,F,J);Q=E(ea);var na=P(ea);if(null==na)return a.Na?a.Na(b,c,d,e,h,f,k,l,m,n,p,q,t,y,A,C,F,J,Q):a.call(a,b,c,d,e,h,f,k,l,m,n,p,q,t,y,A,C,F,J,Q);ea=E(na);na=P(na);if(null==na)return a.Oa?a.Oa(b,c,d,e,h,f,k,l,m,n,p,q,t,y,A,C,F,J,Q,ea):a.call(a,b,c,d,e,h,f,k,l,m,n,p,q,t,y,A,C,F,J,Q,ea);b=[b,c,d,e,h,f,k,l,m,n,p,q,t,y,A,C,F,J,Q,ea];for(c=na;;)if(c)b.push(E(c)),c=P(c);else break;return a.apply(a,b)}
function hc(a){switch(arguments.length){case 2:return Xc(arguments[0],arguments[1]);case 3:return Yc(arguments[0],arguments[1],arguments[2]);case 4:var b=arguments[0];var c=arguments[1],d=arguments[2],e=arguments[3];b.$?(c=V(c,V(d,e)),d=b.aa,e=2+Pc(d-1,e),b=e<=d?Rc(b,e,c):b.$(c)):b=Uc(b,c,d,K(e));return b;case 5:b=arguments[0];c=arguments[1];d=arguments[2];var f=arguments[3];e=arguments[4];b.$?(c=V(c,V(d,V(f,e))),d=b.aa,e=3+Pc(d-2,e),b=e<=d?Rc(b,e,c):b.$(c)):b=Vc(b,c,d,f,K(e));return b;default:e=
[];b=arguments.length;for(c=0;;)if(c<b)e.push(arguments[c]),c+=1;else break;b=arguments[0];c=arguments[1];d=arguments[2];f=arguments[3];var h=arguments[4];e=new M(e.slice(5),0,null);b.$?(e=Qc(e),c=V(c,V(d,V(f,V(h,e)))),d=b.aa,e=4+Pc(d-3,e),b=e<=d?Rc(b,e,c):b.$(c)):b=Wc(b,c,d,f,h,Qc(e));return b}}function Xc(a,b){if(a.$){var c=a.aa,d=Pc(c+1,b);return d<=c?Rc(a,d,b):a.$(b)}b=K(b);return null==b?a.I?a.I():a.call(a):Tc(a,E(b),Sc(b))}
function Yc(a,b,c){if(a.$){b=V(b,c);var d=a.aa;c=Pc(d,c)+1;return c<=d?Rc(a,c,b):a.$(b)}return Tc(a,b,K(c))}function Zc(a){if(null!=a&&(a.u&64||u===a.ab))if(P(a)){a:{var b=[];for(a=K(a);;)if(null!=a)b.push(N(a)),a=P(a);else break a}b=fc(b)}else b=K(a)?N(a):$c;else b=a;return b}
function ad(){if("undefined"===typeof ha||"undefined"===typeof ia||"undefined"===typeof ja)ja=function(a){this.Qb=a;this.u=393216;this.F=0},ja.prototype.U=function(a,b){return new ja(b)},ja.prototype.T=function(){return this.Qb},ja.prototype.la=function(){return!1},ja.prototype.next=function(){return Error("No such element")},ja.prototype.remove=function(){return Error("Unsupported operation")},ja.xb=!0,ja.lb="cljs.core/t_cljs$core19794",ja.Ob=function(a){return H(a,"cljs.core/t_cljs$core19794")};
return new ja($c)}function bd(a,b){for(;;){if(null==K(b))return!0;var c=N(b);c=a.j?a.j(c):a.call(null,c);if(v(c))b=P(b);else return!1}}
var X=function X(a){switch(arguments.length){case 1:return X.j(arguments[0]);case 2:return X.m(arguments[0],arguments[1]);case 3:return X.v(arguments[0],arguments[1],arguments[2]);case 4:return X.ia(arguments[0],arguments[1],arguments[2],arguments[3]);default:for(var c=[],d=arguments.length,e=0;;)if(e<d)c.push(arguments[e]),e+=1;else break;return X.N(arguments[0],arguments[1],arguments[2],arguments[3],new M(c.slice(4),0,null))}};
X.j=function(a){return function(b){return function(){function c(k,l){l=a.j?a.j(l):a.call(null,l);return b.m?b.m(k,l):b.call(null,k,l)}function d(k){return b.j?b.j(k):b.call(null,k)}function e(){return b.I?b.I():b.call(null)}var f=null,h=function(){function k(m,n,p){var q=null;if(2<arguments.length){q=0;for(var t=Array(arguments.length-2);q<t.length;)t[q]=arguments[q+2],++q;q=new M(t,0,null)}return l.call(this,m,n,q)}function l(m,n,p){n=Yc(a,n,p);return b.m?b.m(m,n):b.call(null,m,n)}k.aa=2;k.$=function(m){var n=
N(m);m=P(m);var p=N(m);m=Gb(m);return l(n,p,m)};k.N=l;return k}();f=function(k,l,m){switch(arguments.length){case 0:return e.call(this);case 1:return d.call(this,k);case 2:return c.call(this,k,l);default:var n=null;if(2<arguments.length){n=0;for(var p=Array(arguments.length-2);n<p.length;)p[n]=arguments[n+2],++n;n=new M(p,0,null)}return h.N(k,l,n)}throw Error("Invalid arity: "+arguments.length);};f.aa=2;f.$=h.$;f.I=e;f.j=d;f.m=c;f.N=h.N;return f}()}};
X.m=function(a,b){return new Ic(null,function(){var c=K(b);if(c){if(oc(c)){for(var d=lb(c),e=T(d),f=new Kc(Array(e)),h=0;;)if(h<e)Oc(f,function(){var k=D(d,h);return a.j?a.j(k):a.call(null,k)}()),h+=1;else break;return Nc(f.va(),X.m(a,mb(c)))}return V(function(){var k=N(c);return a.j?a.j(k):a.call(null,k)}(),X.m(a,Gb(c)))}return null},null)};
X.v=function(a,b,c){return new Ic(null,function(){var d=K(b),e=K(c);if(d&&e){var f=N(d);var h=N(e);f=a.m?a.m(f,h):a.call(null,f,h);d=V(f,X.v(a,Gb(d),Gb(e)))}else d=null;return d},null)};X.ia=function(a,b,c,d){return new Ic(null,function(){var e=K(b),f=K(c),h=K(d);if(e&&f&&h){var k=N(e);var l=N(f),m=N(h);k=a.v?a.v(k,l,m):a.call(null,k,l,m);e=V(k,X.ia(a,Gb(e),Gb(f),Gb(h)))}else e=null;return e},null)};
X.N=function(a,b,c,d,e){return X.m(function(f){return Xc(a,f)},function k(h){return new Ic(null,function(){var l=X.m(K,h);return bd(Ac,l)?V(X.m(N,l),k(X.m(Gb,l))):null},null)}(ac.N(e,d,$b([c,b]))))};X.$=function(a){var b=N(a),c=P(a);a=N(c);var d=P(c);c=N(d);var e=P(d);d=N(e);e=P(e);return this.N(b,a,c,d,e)};X.aa=4;function cd(a,b){return null!=a?null!=a&&(a.F&4||u===a.Vb)?Sa(ib(uc(hb,gb(a),b)),jc(a)):uc(Ba,a,b):uc(ac,a,b)}function dd(a,b){this.H=a;this.o=b}
function ed(a){return new dd(a,[null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null])}function fd(a){a=a.A;return 32>a?0:a-1>>>5<<5}function gd(a,b,c){for(;;){if(0===b)return c;var d=ed(a);d.o[0]=c;c=d;b-=5}}var hd=function hd(a,b,c,d){var f=new dd(c.H,B(c.o)),h=a.A-1>>>b&31;5===b?f.o[h]=d:(c=c.o[h],null!=c?(b-=5,a=hd.ia?hd.ia(a,b,c,d):hd.call(null,a,b,c,d)):a=gd(null,b-5,d),f.o[h]=a);return f};
function id(a,b){if(b>=fd(a))return a.ha;var c=a.root;for(a=a.shift;;)if(0<a){var d=a-5;c=c.o[b>>>a&31];a=d}else return c.o}function jd(a,b){if(0<=b&&b<a.A)b=id(a,b);else throw a=a.A,Error(["No item ",z.j(b)," in vector of length ",z.j(a)].join(""));return b}var kd=function kd(a,b,c,d,e){var h=new dd(c.H,B(c.o));if(0===b)h.o[d&31]=e;else{var k=d>>>b&31;b-=5;c=c.o[k];a=kd.wa?kd.wa(a,b,c,d,e):kd.call(null,a,b,c,d,e);h.o[k]=a}return h};
function ld(a,b,c){this.nb=this.i=0;this.o=a;this.Sb=b;this.start=0;this.end=c}ld.prototype.la=function(){return this.i<this.end};ld.prototype.next=function(){32===this.i-this.nb&&(this.o=id(this.Sb,this.i),this.nb+=32);var a=this.o[this.i&31];this.i+=1;return a};function md(a,b,c,d){return c<d?nd(a,b,Wb(a,c),c+1,d):b.I?b.I():b.call(null)}
function nd(a,b,c,d,e){var f=c;c=d;for(d=id(a,d);;)if(c<e){var h=c&31;d=0===h?id(a,c):d;h=d[h];f=b.m?b.m(f,h):b.call(null,f,h);if(Pb(f))return Pa(f);c+=1}else return f}function Y(a,b,c,d,e,f){this.C=a;this.A=b;this.shift=c;this.root=d;this.ha=e;this.D=f;this.u=167666463;this.F=139268}g=Y.prototype;g.toString=function(){return qb(this)};
g.indexOf=function(){var a=null;a=function(b,c){switch(arguments.length){case 1:return S(this,b,0);case 2:return S(this,b,c)}throw Error("Invalid arity: "+arguments.length);};a.j=function(b){return S(this,b,0)};a.m=function(b,c){return S(this,b,c)};return a}();
g.lastIndexOf=function(){function a(c){return U(this,c,T(this))}var b=null;b=function(c,d){switch(arguments.length){case 1:return a.call(this,c);case 2:return U(this,c,d)}throw Error("Invalid arity: "+arguments.length);};b.j=a;b.m=function(c,d){return U(this,c,d)};return b}();g.na=function(a,b){return this.K(null,b,null)};g.K=function(a,b,c){return"number"===typeof b?this.oa(null,b,c):c};
g.jb=function(a,b,c){a=0;for(var d=c;;)if(a<this.A){var e=id(this,a);c=e.length;a:for(var f=0;;)if(f<c){var h=f+a,k=e[f];d=b.v?b.v(d,h,k):b.call(null,d,h,k);if(Pb(d)){e=d;break a}f+=1}else{e=d;break a}if(Pb(e))return Pa(e);a+=c;d=e}else return d};g.W=function(a,b){return jd(this,b)[b&31]};g.oa=function(a,b,c){return 0<=b&&b<this.A?id(this,b)[b&31]:c};
g.qb=function(a,b){if(0<=a&&a<this.A){if(fd(this)<=a){var c=B(this.ha);c[a&31]=b;return new Y(this.C,this.A,this.shift,this.root,c,null)}return new Y(this.C,this.A,this.shift,kd(this,this.shift,this.root,a,b),this.ha,null)}if(a===this.A)return this.X(null,b);throw Error(["Index ",z.j(a)," out of bounds  [0,",z.j(this.A),"]"].join(""));};g.ua=function(){var a=this.A;return new ld(0<T(this)?id(this,0):null,this,a)};g.T=function(){return this.C};g.Y=function(){return this.A};
g.S=function(){var a=this.D;return null!=a?a:this.D=a=Kb(this)};g.O=function(a,b){if(b instanceof Y)if(this.A===T(b))for(a=this.ua(null),b=b.ua(null);;)if(a.la()){var c=a.next(),d=b.next();if(!R.m(c,d))return!1}else return!0;else return!1;else return Zb(this,b)};g.Za=function(){return new od(this.A,this.shift,pd.j?pd.j(this.root):pd.call(null,this.root),qd.j?qd.j(this.ha):qd.call(null,this.ha))};g.Z=function(){return Sa(bc,this.C)};g.da=function(a,b){return md(this,b,0,this.A)};
g.ea=function(a,b,c){a=0;for(var d=c;;)if(a<this.A){var e=id(this,a);c=e.length;a:for(var f=0;;)if(f<c){var h=e[f];d=b.m?b.m(d,h):b.call(null,d,h);if(Pb(d)){e=d;break a}f+=1}else{e=d;break a}if(Pb(e))return Pa(e);a+=c;d=e}else return d};g.za=function(a,b,c){if("number"===typeof b)return this.qb(b,c);throw Error("Vector's key for assoc must be a number.");};g.Wa=function(a,b){return"number"!==typeof b||isNaN(b)||Infinity===b||parseFloat(b)!==parseInt(b,10)?!1:0<=b&&b<this.A};
g.M=function(){if(0===this.A)return null;if(32>=this.A)return new M(this.ha,0,null);a:{var a=this.root;for(var b=this.shift;;)if(0<b)b-=5,a=a.o[0];else{a=a.o;break a}}return rd?rd(this,a,0,0):sd.call(null,this,a,0,0)};g.U=function(a,b){return b===this.C?this:new Y(b,this.A,this.shift,this.root,this.ha,this.D)};
g.X=function(a,b){if(32>this.A-fd(this)){a=this.ha.length;for(var c=Array(a+1),d=0;;)if(d<a)c[d]=this.ha[d],d+=1;else break;c[a]=b;return new Y(this.C,this.A+1,this.shift,this.root,c,null)}a=(c=this.A>>>5>1<<this.shift)?this.shift+5:this.shift;c?(c=ed(null),c.o[0]=this.root,d=gd(null,this.shift,new dd(null,this.ha)),c.o[1]=d):c=hd(this,this.shift,this.root,new dd(null,this.ha));return new Y(this.C,this.A+1,a,c,[b],null)};
g.call=function(a){switch(arguments.length-1){case 1:return this.j(arguments[1]);default:throw Error(["Invalid arity: ",z.j(arguments.length-1)].join(""));}};g.apply=function(a,b){return this.call.apply(this,[this].concat(B(b)))};g.j=function(a){if("number"===typeof a)return this.W(null,a);throw Error("Key must be integer");};
var td=new dd(null,[null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null]),bc=new Y(null,0,5,td,[],Lb);Y.prototype[va]=function(){return Ib(this)};function ud(a,b,c,d,e){this.ma=a;this.node=b;this.i=c;this.V=d;this.C=e;this.D=null;this.u=32375020;this.F=1536}g=ud.prototype;g.toString=function(){return qb(this)};
g.indexOf=function(){var a=null;a=function(b,c){switch(arguments.length){case 1:return S(this,b,0);case 2:return S(this,b,c)}throw Error("Invalid arity: "+arguments.length);};a.j=function(b){return S(this,b,0)};a.m=function(b,c){return S(this,b,c)};return a}();
g.lastIndexOf=function(){function a(c){return U(this,c,T(this))}var b=null;b=function(c,d){switch(arguments.length){case 1:return a.call(this,c);case 2:return U(this,c,d)}throw Error("Invalid arity: "+arguments.length);};b.j=a;b.m=function(c,d){return U(this,c,d)};return b}();g.T=function(){return this.C};g.ba=function(){if(this.V+1<this.node.length){var a=this.ma;var b=this.node,c=this.i,d=this.V+1;a=rd?rd(a,b,c,d):sd.call(null,a,b,c,d);return null==a?null:a}return this.tb()};
g.S=function(){var a=this.D;return null!=a?a:this.D=a=Kb(this)};g.O=function(a,b){return Zb(this,b)};g.Z=function(){return O};g.da=function(a,b){return md(this.ma,b,this.i+this.V,T(this.ma))};g.ea=function(a,b,c){return nd(this.ma,b,c,this.i+this.V,T(this.ma))};g.fa=function(){return this.node[this.V]};g.ja=function(){if(this.V+1<this.node.length){var a=this.ma;var b=this.node,c=this.i,d=this.V+1;a=rd?rd(a,b,c,d):sd.call(null,a,b,c,d);return null==a?O:a}return this.ib(null)};g.M=function(){return this};
g.pb=function(){var a=this.node;return new Lc(a,this.V,a.length)};g.ib=function(){var a=this.i+this.node.length;if(a<xa(this.ma)){var b=this.ma,c=id(this.ma,a);return rd?rd(b,c,a,0):sd.call(null,b,c,a,0)}return O};g.U=function(a,b){return b===this.C?this:vd?vd(this.ma,this.node,this.i,this.V,b):sd.call(null,this.ma,this.node,this.i,this.V,b)};g.X=function(a,b){return V(b,this)};
g.tb=function(){var a=this.i+this.node.length;if(a<xa(this.ma)){var b=this.ma,c=id(this.ma,a);return rd?rd(b,c,a,0):sd.call(null,b,c,a,0)}return null};ud.prototype[va]=function(){return Ib(this)};
function sd(a){switch(arguments.length){case 3:var b=arguments[0],c=arguments[1],d=arguments[2];return new ud(b,jd(b,c),c,d,null);case 4:return rd(arguments[0],arguments[1],arguments[2],arguments[3]);case 5:return vd(arguments[0],arguments[1],arguments[2],arguments[3],arguments[4]);default:throw Error(["Invalid arity: ",z.j(arguments.length)].join(""));}}function rd(a,b,c,d){return new ud(a,b,c,d,null)}function vd(a,b,c,d,e){return new ud(a,b,c,d,e)}
function wd(a,b){return a===b.H?b:new dd(a,B(b.o))}function pd(a){return new dd({},B(a.o))}function qd(a){var b=[null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null];pc(a,0,b,0,a.length);return b}var xd=function xd(a,b,c,d){c=wd(a.root.H,c);var f=a.A-1>>>b&31;if(5===b)a=d;else{var h=c.o[f];null!=h?(b-=5,a=xd.ia?xd.ia(a,b,h,d):xd.call(null,a,b,h,d)):a=gd(a.root.H,b-5,d)}c.o[f]=a;return c};
function od(a,b,c,d){this.A=a;this.shift=b;this.root=c;this.ha=d;this.F=88;this.u=275}g=od.prototype;
g.bb=function(a,b){if(this.root.H){if(32>this.A-fd(this))this.ha[this.A&31]=b;else{a=new dd(this.root.H,this.ha);var c=[null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null];c[0]=b;this.ha=c;this.A>>>5>1<<this.shift?(b=[null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null],c=this.shift+
5,b[0]=this.root,b[1]=gd(this.root.H,this.shift,a),this.root=new dd(this.root.H,b),this.shift=c):this.root=xd(this,this.shift,this.root,a)}this.A+=1;return this}throw Error("conj! after persistent!");};g.kb=function(){if(this.root.H){this.root.H=null;var a=this.A-fd(this),b=Array(a);pc(this.ha,0,b,0,a);return new Y(null,this.A,this.shift,this.root,b,null)}throw Error("persistent! called twice");};
g.Xa=function(a,b,c){if("number"===typeof b)return yd(this,b,c);throw Error("TransientVector's key for assoc! must be a number.");};
function yd(a,b,c){if(a.root.H){if(0<=b&&b<a.A){if(fd(a)<=b)a.ha[b&31]=c;else{var d=function k(f,h){h=wd(a.root.H,h);if(0===f)h.o[b&31]=c;else{var l=b>>>f&31;f=k(f-5,h.o[l]);h.o[l]=f}return h}(a.shift,a.root);a.root=d}return a}if(b===a.A)return a.bb(null,c);throw Error(["Index ",z.j(b)," out of bounds for TransientVector of length",z.j(a.A)].join(""));}throw Error("assoc! after persistent!");}g.Y=function(){if(this.root.H)return this.A;throw Error("count after persistent!");};
g.W=function(a,b){if(this.root.H)return jd(this,b)[b&31];throw Error("nth after persistent!");};g.oa=function(a,b,c){return 0<=b&&b<this.A?this.W(null,b):c};g.na=function(a,b){return this.K(null,b,null)};g.K=function(a,b,c){if(this.root.H)return"number"===typeof b?this.oa(null,b,c):c;throw Error("lookup after persistent!");};
g.call=function(a){switch(arguments.length-1){case 1:return this.j(arguments[1]);case 2:return this.m(arguments[1],arguments[2]);default:throw Error(["Invalid arity: ",z.j(arguments.length-1)].join(""));}};g.apply=function(a,b){return this.call.apply(this,[this].concat(B(b)))};g.j=function(a){return this.na(null,a)};g.m=function(a,b){return this.K(null,a,b)};function zd(){this.u=2097152;this.F=0}zd.prototype.O=function(){return!1};var Ad=new zd;
function Bd(a,b){return rc(lc(b)&&!mc(b)?T(a)===T(b)?(null!=a?a.u&1048576||u===a.Yb||(a.u?0:w(Wa,a)):w(Wa,a))?zc(function(c,d,e){return R.m(Cb.v(b,d,Ad),e)?!0:new Ob},a):bd(function(c){return R.m(Cb.v(b,N(c),Ad),N(P(c)))},a):null:null)}function Cd(a){this.s=a}Cd.prototype.next=function(){if(null!=this.s){var a=N(this.s),b=W(a,0,null);a=W(a,1,null);this.s=P(this.s);return{value:[b,a],done:!1}}return{value:null,done:!0}};
function Dd(a,b){if(b instanceof I)a:{var c=a.length;b=b.xa;for(var d=0;;){if(c<=d){a=-1;break a}if(a[d]instanceof I&&b===a[d].xa){a=d;break a}d+=2}}else if("string"===typeof b||"number"===typeof b)a:for(c=a.length,d=0;;){if(c<=d){a=-1;break a}if(b===a[d]){a=d;break a}d+=2}else if(b instanceof Bb)a:for(c=a.length,b=b.Ca,d=0;;){if(c<=d){a=-1;break a}if(a[d]instanceof Bb&&b===a[d].Ca){a=d;break a}d+=2}else if(null==b)a:for(b=a.length,c=0;;){if(b<=c){a=-1;break a}if(null==a[c]){a=c;break a}c+=2}else a:for(c=
a.length,d=0;;){if(c<=d){a=-1;break a}if(R.m(b,a[d])){a=d;break a}d+=2}return a}function Ed(a,b){this.key=a;this.J=b;this.D=null;this.u=166619935;this.F=0}g=Ed.prototype;g.indexOf=function(){var a=null;a=function(b,c){switch(arguments.length){case 1:return S(this,b,0);case 2:return S(this,b,c)}throw Error("Invalid arity: "+arguments.length);};a.j=function(b){return S(this,b,0)};a.m=function(b,c){return S(this,b,c)};return a}();
g.lastIndexOf=function(){function a(c){return U(this,c,T(this))}var b=null;b=function(c,d){switch(arguments.length){case 1:return a.call(this,c);case 2:return U(this,c,d)}throw Error("Invalid arity: "+arguments.length);};b.j=a;b.m=function(c,d){return U(this,c,d)};return b}();g.na=function(a,b){return this.oa(null,b,null)};g.K=function(a,b,c){return this.oa(null,b,c)};g.W=function(a,b){if(0===b)return this.key;if(1===b)return this.J;throw Error("Index out of bounds");};
g.oa=function(a,b,c){return 0===b?this.key:1===b?this.J:c};g.qb=function(a,b){return(new Y(null,2,5,td,[this.key,this.J],null)).qb(a,b)};g.T=function(){return null};g.Y=function(){return 2};g.Ib=function(){return this.key};g.Jb=function(){return this.J};g.S=function(){var a=this.D;return null!=a?a:this.D=a=Kb(this)};g.O=function(a,b){return Zb(this,b)};g.Z=function(){return null};
g.da=function(a,b){a:if(a=this.Y(null),0===a)b=b.I?b.I():b.call(null);else for(var c=this.W(null,0),d=1;;)if(d<a){var e=this.W(null,d);c=b.m?b.m(c,e):b.call(null,c,e);if(Pb(c)){b=Pa(c);break a}d+=1}else{b=c;break a}return b};g.ea=function(a,b,c){a:{a=this.Y(null);var d=c;for(c=0;;)if(c<a){var e=this.W(null,c);d=b.m?b.m(d,e):b.call(null,d,e);if(Pb(d)){b=Pa(d);break a}c+=1}else{b=d;break a}}return b};g.za=function(a,b,c){return ec.v(new Y(null,2,5,td,[this.key,this.J],null),b,c)};
g.Wa=function(a,b){return 0===b||1===b};g.M=function(){return new M([this.key,this.J],0,null)};g.U=function(a,b){return ic(new Y(null,2,5,td,[this.key,this.J],null),b)};g.X=function(a,b){return new Y(null,3,5,td,[this.key,this.J,b],null)};g.call=function(a){switch(arguments.length-1){case 1:return this.j(arguments[1]);case 2:return this.m(arguments[1],arguments[2]);default:throw Error(["Invalid arity: ",z.j(arguments.length-1)].join(""));}};g.apply=function(a,b){return this.call.apply(this,[this].concat(B(b)))};
g.j=function(a){return this.W(null,a)};g.m=function(a,b){return this.oa(null,a,b)};function Fd(a){return null!=a?a.u&2048||u===a.ac?!0:!1:!1}function Gd(a,b,c){this.o=a;this.i=b;this.ta=c;this.u=32374990;this.F=0}g=Gd.prototype;g.toString=function(){return qb(this)};
g.indexOf=function(){var a=null;a=function(b,c){switch(arguments.length){case 1:return S(this,b,0);case 2:return S(this,b,c)}throw Error("Invalid arity: "+arguments.length);};a.j=function(b){return S(this,b,0)};a.m=function(b,c){return S(this,b,c)};return a}();
g.lastIndexOf=function(){function a(c){return U(this,c,T(this))}var b=null;b=function(c,d){switch(arguments.length){case 1:return a.call(this,c);case 2:return U(this,c,d)}throw Error("Invalid arity: "+arguments.length);};b.j=a;b.m=function(c,d){return U(this,c,d)};return b}();g.T=function(){return this.ta};g.ba=function(){return this.i<this.o.length-2?new Gd(this.o,this.i+2,null):null};g.Y=function(){return(this.o.length-this.i)/2};g.S=function(){return Kb(this)};
g.O=function(a,b){return Zb(this,b)};g.Z=function(){return O};g.da=function(a,b){return tc(b,this)};g.ea=function(a,b,c){return wc(b,c,this)};g.fa=function(){return new Ed(this.o[this.i],this.o[this.i+1])};g.ja=function(){return this.i<this.o.length-2?new Gd(this.o,this.i+2,null):O};g.M=function(){return this};g.U=function(a,b){return b===this.ta?this:new Gd(this.o,this.i,b)};g.X=function(a,b){return V(b,this)};Gd.prototype[va]=function(){return Ib(this)};
function Hd(a,b){this.o=a;this.i=0;this.A=b}Hd.prototype.la=function(){return this.i<this.A};Hd.prototype.next=function(){var a=new Ed(this.o[this.i],this.o[this.i+1]);this.i+=2;return a};function ma(a,b,c,d){this.C=a;this.A=b;this.o=c;this.D=d;this.u=16647951;this.F=139268}g=ma.prototype;g.toString=function(){return qb(this)};g.keys=function(){return Ib(Id.j?Id.j(this):Id.call(null,this))};g.entries=function(){return new Cd(K(K(this)))};
g.values=function(){return Ib(Jd.j?Jd.j(this):Jd.call(null,this))};g.has=function(a){return sc(this,a)};g.get=function(a,b){return this.K(null,a,b)};g.forEach=function(a){for(var b=K(this),c=null,d=0,e=0;;)if(e<d){var f=c.W(null,e),h=W(f,0,null);f=W(f,1,null);a.m?a.m(f,h):a.call(null,f,h);e+=1}else if(b=K(b))oc(b)?(c=lb(b),b=mb(b),h=c,d=T(c),c=h):(c=N(b),h=W(c,0,null),f=W(c,1,null),a.m?a.m(f,h):a.call(null,f,h),b=P(b),c=null,d=0),e=0;else return null};g.na=function(a,b){return this.K(null,b,null)};
g.K=function(a,b,c){a=Dd(this.o,b);return-1===a?c:this.o[a+1]};g.jb=function(a,b,c){a=this.o.length;for(var d=0;;)if(d<a){var e=this.o[d],f=this.o[d+1];c=b.v?b.v(c,e,f):b.call(null,c,e,f);if(Pb(c))return Pa(c);d+=2}else return c};g.ua=function(){return new Hd(this.o,2*this.A)};g.T=function(){return this.C};g.Y=function(){return this.A};g.S=function(){var a=this.D;return null!=a?a:this.D=a=Mb(this)};
g.O=function(a,b){if(lc(b)&&!mc(b))if(a=this.o.length,this.A===b.Y(null))for(var c=0;;)if(c<a){var d=b.K(null,this.o[c],qc);if(d!==qc)if(R.m(this.o[c+1],d))c+=2;else return!1;else return!1}else return!0;else return!1;else return!1};g.Za=function(){return new Kd(this.o.length,B(this.o))};g.Z=function(){return Sa($c,this.C)};g.da=function(a,b){return xc(this,b)};g.ea=function(a,b,c){return yc(this,b,c)};
g.za=function(a,b,c){a=Dd(this.o,b);if(-1===a){if(this.A<Ld){a=this.o;for(var d=a.length,e=Array(d+2),f=0;;)if(f<d)e[f]=a[f],f+=1;else break;e[d]=b;e[d+1]=c;return new ma(this.C,this.A+1,e,null)}return Sa(Ka(cd(Md,this),b,c),this.C)}if(c===this.o[a+1])return this;b=B(this.o);b[a+1]=c;return new ma(this.C,this.A,b,null)};g.Wa=function(a,b){return-1!==Dd(this.o,b)};g.M=function(){var a=this.o;return 0<=a.length-2?new Gd(a,0,null):null};
g.U=function(a,b){return b===this.C?this:new ma(b,this.A,this.o,this.D)};g.X=function(a,b){if(nc(b))return this.za(null,D(b,0),D(b,1));a=this;for(b=K(b);;){if(null==b)return a;var c=N(b);if(nc(c))a=Ka(a,D(c,0),D(c,1)),b=P(b);else throw Error("conj on a map takes map entries or seqables of map entries");}};
g.call=function(a){switch(arguments.length-1){case 1:return this.j(arguments[1]);case 2:return this.m(arguments[1],arguments[2]);default:throw Error(["Invalid arity: ",z.j(arguments.length-1)].join(""));}};g.apply=function(a,b){return this.call.apply(this,[this].concat(B(b)))};g.j=function(a){return this.na(null,a)};g.m=function(a,b){return this.K(null,a,b)};var $c=new ma(null,0,[],Nb),Ld=8;function Nd(a,b){return a===b?!0:a===b||a instanceof I&&b instanceof I&&a.xa===b.xa?!0:R.m(a,b)}
function Od(a){for(var b=0,c=0;;)if(b<a.length){var d;a:for(d=0;;)if(d<b){var e=Nd(a[b],a[d]);if(e){d=e;break a}d=2+d}else{d=!1;break a}c=d?c:c+2;b=2+b}else return c}function Pd(a,b){var c=a.length-1,d=K(b);b=Array(c+2*T(d));a=pc(a,0,b,0,c);for(b=c;;)if(d){var e=N(d);a[b]=Ma(e);a[b+1]=Na(e);b=2+c;d=P(d)}else return a}
function fc(a){var b=a.length,c=1===(b&1),d;if(!(d=c))a:for(d=0;;)if(d<a.length){var e;b:for(e=0;;)if(e<d){var f=Nd(a[d],a[e]);if(f){e=f;break b}e=2+e}else{e=!1;break b}if(e){d=e;break a}d=2+d}else{d=!1;break a}return d?Qd(a,c):new ma(null,b/2,a,null)}
function Qd(a,b){var c=b?Pd(a,cd($c,a[a.length-1])):a;a=Od(c);var d=c.length;if(a<d){a=Array(a);for(var e=0,f=0;;)if(e<d)(function(){for(var h=0;;)if(h<f){var k=Nd(c[e],c[h]);if(k)return k;h=2+h}else return!1})()?(b=f,e=2+e,f=b):(b=function(){for(var h=d-2;;)if(h>=e){if(Nd(c[e],c[h]))return h;h-=2}else return h}(),a[f]=c[e],a[f+1]=c[b+1],b=2+f,e=2+e,f=b);else break;return new ma(null,a.length/2,a,null)}return new ma(null,c.length/2,c,null)}ma.prototype[va]=function(){return Ib(this)};
function Kd(a,b){this.Ya={};this.Ua=a;this.o=b;this.u=259;this.F=56}g=Kd.prototype;g.Y=function(){if(this.Ya)return Bc(this.Ua);throw Error("count after persistent!");};g.na=function(a,b){return this.K(null,b,null)};g.K=function(a,b,c){if(this.Ya)return a=Dd(this.o,b),-1===a?c:this.o[a+1];throw Error("lookup after persistent!");};
g.bb=function(a,b){if(this.Ya){if(Fd(b))return this.Xa(null,Rd.j?Rd.j(b):Rd.call(null,b),Sd.j?Sd.j(b):Sd.call(null,b));if(nc(b))return this.Xa(null,b.j?b.j(0):b.call(null,0),b.j?b.j(1):b.call(null,1));a=K(b);for(b=this;;){var c=N(a);if(v(c))a=P(a),b=jb(b,Rd.j?Rd.j(c):Rd.call(null,c),Sd.j?Sd.j(c):Sd.call(null,c));else return b}}else throw Error("conj! after persistent!");};g.kb=function(){if(this.Ya)return this.Ya=!1,new ma(null,Bc(this.Ua),this.o,null);throw Error("persistent! called twice");};
g.Xa=function(a,b,c){if(this.Ya){a=Dd(this.o,b);if(-1===a){if(this.Ua+2<=2*Ld)return this.Ua+=2,this.o.push(b),this.o.push(c),this;a=Ud.m?Ud.m(this.Ua,this.o):Ud.call(null,this.Ua,this.o);return jb(a,b,c)}c!==this.o[a+1]&&(this.o[a+1]=c);return this}throw Error("assoc! after persistent!");};g.call=function(a){switch(arguments.length-1){case 1:return this.j(arguments[1]);case 2:return this.m(arguments[1],arguments[2]);default:throw Error(["Invalid arity: ",z.j(arguments.length-1)].join(""));}};
g.apply=function(a,b){return this.call.apply(this,[this].concat(B(b)))};g.j=function(a){return this.K(null,a,null)};g.m=function(a,b){return this.K(null,a,b)};function Ud(a,b){for(var c=gb(Md),d=0;;)if(d<a)c=jb(c,b[d],b[d+1]),d+=2;else return c}function Vd(){this.J=!1}function Wd(a,b,c){a=B(a);a[b]=c;return a}function Xd(a,b,c,d){a=a.Ta(b);a.o[c]=d;return a}
function Yd(a,b,c){for(var d=a.length,e=0,f=c;;)if(e<d){c=a[e];if(null!=c){var h=a[e+1];c=b.v?b.v(f,c,h):b.call(null,f,c,h)}else c=a[e+1],c=null!=c?c.fb(b,f):f;if(Pb(c))return c;e+=2;f=c}else return f}function Zd(a){this.o=a;this.i=0;this.sa=this.gb=null}Zd.prototype.advance=function(){for(var a=this.o.length;;)if(this.i<a){var b=this.o[this.i],c=this.o[this.i+1];null!=b?b=this.gb=new Ed(b,c):null!=c?(b=ob(c),b=b.la()?this.sa=b:!1):b=!1;this.i+=2;if(b)return!0}else return!1};
Zd.prototype.la=function(){var a=null!=this.gb;return a?a:(a=null!=this.sa)?a:this.advance()};Zd.prototype.next=function(){if(null!=this.gb){var a=this.gb;this.gb=null;return a}if(null!=this.sa)return a=this.sa.next(),this.sa.la()||(this.sa=null),a;if(this.advance())return this.next();throw Error("No such element");};Zd.prototype.remove=function(){return Error("Unsupported operation")};function $d(a,b,c){this.H=a;this.R=b;this.o=c;this.F=131072;this.u=0}g=$d.prototype;
g.Ta=function(a){if(a===this.H)return this;var b=Cc(this.R),c=Array(0>b?4:2*(b+1));pc(this.o,0,c,0,2*b);return new $d(a,this.R,c)};g.eb=function(){return ae?ae(this.o):be.call(null,this.o)};g.fb=function(a,b){return Yd(this.o,a,b)};g.Ba=function(a,b,c,d){var e=1<<(b>>>a&31);if(0===(this.R&e))return d;var f=Cc(this.R&e-1);e=this.o[2*f];f=this.o[2*f+1];return null==e?f.Ba(a+5,b,c,d):Nd(c,e)?f:d};
g.qa=function(a,b,c,d,e,f){var h=1<<(c>>>b&31),k=Cc(this.R&h-1);if(0===(this.R&h)){var l=Cc(this.R);if(2*l<this.o.length){a=this.Ta(a);b=a.o;f.J=!0;c=2*(l-k);f=2*k+(c-1);for(l=2*(k+1)+(c-1);0!==c;)b[l]=b[f],--l,--c,--f;b[2*k]=d;b[2*k+1]=e;a.R|=h;return a}if(16<=l){k=[null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null];k[c>>>b&31]=ce.qa(a,b+5,c,d,e,f);for(e=d=0;;)if(32>d)0===(this.R>>>d&1)?
d+=1:(k[d]=null!=this.o[e]?ce.qa(a,b+5,zb(this.o[e]),this.o[e],this.o[e+1],f):this.o[e+1],e+=2,d+=1);else break;return new de(a,l+1,k)}b=Array(2*(l+4));pc(this.o,0,b,0,2*k);b[2*k]=d;b[2*k+1]=e;pc(this.o,2*k,b,2*(k+1),2*(l-k));f.J=!0;a=this.Ta(a);a.o=b;a.R|=h;return a}l=this.o[2*k];h=this.o[2*k+1];if(null==l)return l=h.qa(a,b+5,c,d,e,f),l===h?this:Xd(this,a,2*k+1,l);if(Nd(d,l))return e===h?this:Xd(this,a,2*k+1,e);f.J=!0;f=b+5;d=ee?ee(a,f,l,h,c,d,e):fe.call(null,a,f,l,h,c,d,e);e=2*k;k=2*k+1;a=this.Ta(a);
a.o[e]=null;a.o[k]=d;return a};
g.pa=function(a,b,c,d,e){var f=1<<(b>>>a&31),h=Cc(this.R&f-1);if(0===(this.R&f)){var k=Cc(this.R);if(16<=k){h=[null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null];h[b>>>a&31]=ce.pa(a+5,b,c,d,e);for(d=c=0;;)if(32>c)0===(this.R>>>c&1)?c+=1:(h[c]=null!=this.o[d]?ce.pa(a+5,zb(this.o[d]),this.o[d],this.o[d+1],e):this.o[d+1],d+=2,c+=1);else break;return new de(null,k+1,h)}a=Array(2*(k+1));pc(this.o,
0,a,0,2*h);a[2*h]=c;a[2*h+1]=d;pc(this.o,2*h,a,2*(h+1),2*(k-h));e.J=!0;return new $d(null,this.R|f,a)}var l=this.o[2*h];f=this.o[2*h+1];if(null==l)return k=f.pa(a+5,b,c,d,e),k===f?this:new $d(null,this.R,Wd(this.o,2*h+1,k));if(Nd(c,l))return d===f?this:new $d(null,this.R,Wd(this.o,2*h+1,d));e.J=!0;e=this.R;k=this.o;a+=5;a=ge?ge(a,l,f,b,c,d):fe.call(null,a,l,f,b,c,d);c=2*h;h=2*h+1;d=B(k);d[c]=null;d[h]=a;return new $d(null,e,d)};g.ua=function(){return new Zd(this.o)};var ce=new $d(null,0,[]);
function he(a){this.o=a;this.i=0;this.sa=null}he.prototype.la=function(){for(var a=this.o.length;;){if(null!=this.sa&&this.sa.la())return!0;if(this.i<a){var b=this.o[this.i];this.i+=1;null!=b&&(this.sa=ob(b))}else return!1}};he.prototype.next=function(){if(this.la())return this.sa.next();throw Error("No such element");};he.prototype.remove=function(){return Error("Unsupported operation")};function de(a,b,c){this.H=a;this.A=b;this.o=c;this.F=131072;this.u=0}g=de.prototype;
g.Ta=function(a){return a===this.H?this:new de(a,this.A,B(this.o))};g.eb=function(){return ie?ie(this.o):je.call(null,this.o)};g.fb=function(a,b){for(var c=this.o.length,d=0;;)if(d<c){var e=this.o[d];if(null!=e){b=e.fb(a,b);if(Pb(b))return b;d+=1}else d+=1}else return b};g.Ba=function(a,b,c,d){var e=this.o[b>>>a&31];return null!=e?e.Ba(a+5,b,c,d):d};
g.qa=function(a,b,c,d,e,f){var h=c>>>b&31,k=this.o[h];if(null==k)return a=Xd(this,a,h,ce.qa(a,b+5,c,d,e,f)),a.A+=1,a;b=k.qa(a,b+5,c,d,e,f);return b===k?this:Xd(this,a,h,b)};g.pa=function(a,b,c,d,e){var f=b>>>a&31,h=this.o[f];if(null==h)return new de(null,this.A+1,Wd(this.o,f,ce.pa(a+5,b,c,d,e)));a=h.pa(a+5,b,c,d,e);return a===h?this:new de(null,this.A,Wd(this.o,f,a))};g.ua=function(){return new he(this.o)};function ke(a,b,c){b*=2;for(var d=0;;)if(d<b){if(Nd(c,a[d]))return d;d+=2}else return-1}
function le(a,b,c,d){this.H=a;this.Aa=b;this.A=c;this.o=d;this.F=131072;this.u=0}g=le.prototype;g.Ta=function(a){if(a===this.H)return this;var b=Array(2*(this.A+1));pc(this.o,0,b,0,2*this.A);return new le(a,this.Aa,this.A,b)};g.eb=function(){return ae?ae(this.o):be.call(null,this.o)};g.fb=function(a,b){return Yd(this.o,a,b)};g.Ba=function(a,b,c,d){a=ke(this.o,this.A,c);return 0>a?d:Nd(c,this.o[a])?this.o[a+1]:d};
g.qa=function(a,b,c,d,e,f){if(c===this.Aa){b=ke(this.o,this.A,d);if(-1===b){if(this.o.length>2*this.A)return b=2*this.A,c=2*this.A+1,a=this.Ta(a),a.o[b]=d,a.o[c]=e,f.J=!0,a.A+=1,a;c=this.o.length;b=Array(c+2);pc(this.o,0,b,0,c);b[c]=d;b[c+1]=e;f.J=!0;d=this.A+1;a===this.H?(this.o=b,this.A=d,a=this):a=new le(this.H,this.Aa,d,b);return a}return this.o[b+1]===e?this:Xd(this,a,b+1,e)}return(new $d(a,1<<(this.Aa>>>b&31),[null,this,null,null])).qa(a,b,c,d,e,f)};
g.pa=function(a,b,c,d,e){return b===this.Aa?(a=ke(this.o,this.A,c),-1===a?(a=2*this.A,b=Array(a+2),pc(this.o,0,b,0,a),b[a]=c,b[a+1]=d,e.J=!0,new le(null,this.Aa,this.A+1,b)):R.m(this.o[a+1],d)?this:new le(null,this.Aa,this.A,Wd(this.o,a+1,d))):(new $d(null,1<<(this.Aa>>>a&31),[null,this])).pa(a,b,c,d,e)};g.ua=function(){return new Zd(this.o)};
function fe(a){switch(arguments.length){case 6:return ge(arguments[0],arguments[1],arguments[2],arguments[3],arguments[4],arguments[5]);case 7:return ee(arguments[0],arguments[1],arguments[2],arguments[3],arguments[4],arguments[5],arguments[6]);default:throw Error(["Invalid arity: ",z.j(arguments.length)].join(""));}}function ge(a,b,c,d,e,f){var h=zb(b);if(h===d)return new le(null,h,2,[b,c,e,f]);var k=new Vd;return ce.pa(a,h,b,c,k).pa(a,d,e,f,k)}
function ee(a,b,c,d,e,f,h){var k=zb(c);if(k===e)return new le(null,k,2,[c,d,f,h]);var l=new Vd;return ce.qa(a,b,k,c,d,l).qa(a,b,e,f,h,l)}function me(a,b,c,d,e){this.C=a;this.nodes=b;this.i=c;this.s=d;this.D=e;this.u=32374988;this.F=0}g=me.prototype;g.toString=function(){return qb(this)};
g.indexOf=function(){var a=null;a=function(b,c){switch(arguments.length){case 1:return S(this,b,0);case 2:return S(this,b,c)}throw Error("Invalid arity: "+arguments.length);};a.j=function(b){return S(this,b,0)};a.m=function(b,c){return S(this,b,c)};return a}();
g.lastIndexOf=function(){function a(c){return U(this,c,T(this))}var b=null;b=function(c,d){switch(arguments.length){case 1:return a.call(this,c);case 2:return U(this,c,d)}throw Error("Invalid arity: "+arguments.length);};b.j=a;b.m=function(c,d){return U(this,c,d)};return b}();g.T=function(){return this.C};g.ba=function(){if(null==this.s){var a=this.nodes,b=this.i+2;return ne?ne(a,b,null):be.call(null,a,b,null)}a=this.nodes;b=this.i;var c=P(this.s);return ne?ne(a,b,c):be.call(null,a,b,c)};
g.S=function(){var a=this.D;return null!=a?a:this.D=a=Kb(this)};g.O=function(a,b){return Zb(this,b)};g.Z=function(){return O};g.da=function(a,b){return tc(b,this)};g.ea=function(a,b,c){return wc(b,c,this)};g.fa=function(){return null==this.s?new Ed(this.nodes[this.i],this.nodes[this.i+1]):N(this.s)};
g.ja=function(){var a=this,b=null==a.s?function(){var c=a.nodes,d=a.i+2;return ne?ne(c,d,null):be.call(null,c,d,null)}():function(){var c=a.nodes,d=a.i,e=P(a.s);return ne?ne(c,d,e):be.call(null,c,d,e)}();return null!=b?b:O};g.M=function(){return this};g.U=function(a,b){return b===this.C?this:new me(b,this.nodes,this.i,this.s,this.D)};g.X=function(a,b){return V(b,this)};me.prototype[va]=function(){return Ib(this)};
function be(a){switch(arguments.length){case 1:return ae(arguments[0]);case 3:return ne(arguments[0],arguments[1],arguments[2]);default:throw Error(["Invalid arity: ",z.j(arguments.length)].join(""));}}function ae(a){return ne(a,0,null)}function ne(a,b,c){if(null==c)for(c=a.length;;)if(b<c){if(null!=a[b])return new me(null,a,b,null,null);var d=a[b+1];if(v(d)&&(d=d.eb(),v(d)))return new me(null,a,b+2,d,null);b+=2}else return null;else return new me(null,a,b,c,null)}
function oe(a,b,c,d,e){this.C=a;this.nodes=b;this.i=c;this.s=d;this.D=e;this.u=32374988;this.F=0}g=oe.prototype;g.toString=function(){return qb(this)};g.indexOf=function(){var a=null;a=function(b,c){switch(arguments.length){case 1:return S(this,b,0);case 2:return S(this,b,c)}throw Error("Invalid arity: "+arguments.length);};a.j=function(b){return S(this,b,0)};a.m=function(b,c){return S(this,b,c)};return a}();
g.lastIndexOf=function(){function a(c){return U(this,c,T(this))}var b=null;b=function(c,d){switch(arguments.length){case 1:return a.call(this,c);case 2:return U(this,c,d)}throw Error("Invalid arity: "+arguments.length);};b.j=a;b.m=function(c,d){return U(this,c,d)};return b}();g.T=function(){return this.C};g.ba=function(){var a=this.nodes,b=this.i,c=P(this.s);return pe?pe(a,b,c):je.call(null,a,b,c)};g.S=function(){var a=this.D;return null!=a?a:this.D=a=Kb(this)};g.O=function(a,b){return Zb(this,b)};
g.Z=function(){return O};g.da=function(a,b){return tc(b,this)};g.ea=function(a,b,c){return wc(b,c,this)};g.fa=function(){return N(this.s)};g.ja=function(){var a=this.nodes;var b=this.i,c=P(this.s);a=pe?pe(a,b,c):je.call(null,a,b,c);return null!=a?a:O};g.M=function(){return this};g.U=function(a,b){return b===this.C?this:new oe(b,this.nodes,this.i,this.s,this.D)};g.X=function(a,b){return V(b,this)};oe.prototype[va]=function(){return Ib(this)};
function je(a){switch(arguments.length){case 1:return ie(arguments[0]);case 3:return pe(arguments[0],arguments[1],arguments[2]);default:throw Error(["Invalid arity: ",z.j(arguments.length)].join(""));}}function ie(a){return pe(a,0,null)}function pe(a,b,c){if(null==c)for(c=a.length;;)if(b<c){var d=a[b];if(v(d)&&(d=d.eb(),v(d)))return new oe(null,a,b+1,d,null);b+=1}else return null;else return new oe(null,a,b,c,null)}function qe(a,b){this.ga=a;this.zb=b;this.rb=!1}
qe.prototype.la=function(){return!this.rb||this.zb.la()};qe.prototype.next=function(){if(this.rb)return this.zb.next();this.rb=!0;return new Ed(null,this.ga)};qe.prototype.remove=function(){return Error("Unsupported operation")};function re(a,b,c,d,e,f){this.C=a;this.A=b;this.root=c;this.ka=d;this.ga=e;this.D=f;this.u=16123663;this.F=139268}g=re.prototype;g.toString=function(){return qb(this)};g.keys=function(){return Ib(Id.j?Id.j(this):Id.call(null,this))};g.entries=function(){return new Cd(K(K(this)))};
g.values=function(){return Ib(Jd.j?Jd.j(this):Jd.call(null,this))};g.has=function(a){return sc(this,a)};g.get=function(a,b){return this.K(null,a,b)};g.forEach=function(a){for(var b=K(this),c=null,d=0,e=0;;)if(e<d){var f=c.W(null,e),h=W(f,0,null);f=W(f,1,null);a.m?a.m(f,h):a.call(null,f,h);e+=1}else if(b=K(b))oc(b)?(c=lb(b),b=mb(b),h=c,d=T(c),c=h):(c=N(b),h=W(c,0,null),f=W(c,1,null),a.m?a.m(f,h):a.call(null,f,h),b=P(b),c=null,d=0),e=0;else return null};g.na=function(a,b){return this.K(null,b,null)};
g.K=function(a,b,c){return null==b?this.ka?this.ga:c:null==this.root?c:this.root.Ba(0,zb(b),b,c)};g.jb=function(a,b,c){a=this.ka?b.v?b.v(c,null,this.ga):b.call(null,c,null,this.ga):c;Pb(a)?b=Pa(a):null!=this.root?(b=this.root.fb(b,a),b=Pb(b)?Qb.j?Qb.j(b):Qb.call(null,b):b):b=a;return b};g.ua=function(){var a=this.root?ob(this.root):ad();return this.ka?new qe(this.ga,a):a};g.T=function(){return this.C};g.Y=function(){return this.A};g.S=function(){var a=this.D;return null!=a?a:this.D=a=Mb(this)};
g.O=function(a,b){return Bd(this,b)};g.Za=function(){return new se(this.root,this.A,this.ka,this.ga)};g.Z=function(){return Sa(Md,this.C)};g.za=function(a,b,c){if(null==b)return this.ka&&c===this.ga?this:new re(this.C,this.ka?this.A:this.A+1,this.root,!0,c,null);a=new Vd;b=(null==this.root?ce:this.root).pa(0,zb(b),b,c,a);return b===this.root?this:new re(this.C,a.J?this.A+1:this.A,b,this.ka,this.ga,null)};g.Wa=function(a,b){return null==b?this.ka:null==this.root?!1:this.root.Ba(0,zb(b),b,qc)!==qc};
g.M=function(){if(0<this.A){var a=null!=this.root?this.root.eb():null;return this.ka?V(new Ed(null,this.ga),a):a}return null};g.U=function(a,b){return b===this.C?this:new re(b,this.A,this.root,this.ka,this.ga,this.D)};g.X=function(a,b){if(nc(b))return this.za(null,D(b,0),D(b,1));a=this;for(b=K(b);;){if(null==b)return a;var c=N(b);if(nc(c))a=Ka(a,D(c,0),D(c,1)),b=P(b);else throw Error("conj on a map takes map entries or seqables of map entries");}};
g.call=function(a){switch(arguments.length-1){case 1:return this.j(arguments[1]);case 2:return this.m(arguments[1],arguments[2]);default:throw Error(["Invalid arity: ",z.j(arguments.length-1)].join(""));}};g.apply=function(a,b){return this.call.apply(this,[this].concat(B(b)))};g.j=function(a){return this.na(null,a)};g.m=function(a,b){return this.K(null,a,b)};var Md=new re(null,0,null,!1,null,Nb);re.prototype[va]=function(){return Ib(this)};
function se(a,b,c,d){this.H={};this.root=a;this.count=b;this.ka=c;this.ga=d;this.u=259;this.F=56}function te(a,b,c){if(a.H){if(null==b)a.ga!==c&&(a.ga=c),a.ka||(a.count+=1,a.ka=!0);else{var d=new Vd;b=(null==a.root?ce:a.root).qa(a.H,0,zb(b),b,c,d);b!==a.root&&(a.root=b);d.J&&(a.count+=1)}return a}throw Error("assoc! after persistent!");}g=se.prototype;g.Y=function(){if(this.H)return this.count;throw Error("count after persistent!");};
g.na=function(a,b){return null==b?this.ka?this.ga:null:null==this.root?null:this.root.Ba(0,zb(b),b)};g.K=function(a,b,c){return null==b?this.ka?this.ga:c:null==this.root?c:this.root.Ba(0,zb(b),b,c)};
g.bb=function(a,b){a:if(this.H)if(Fd(b))a=te(this,Rd.j?Rd.j(b):Rd.call(null,b),Sd.j?Sd.j(b):Sd.call(null,b));else if(nc(b))a=te(this,b.j?b.j(0):b.call(null,0),b.j?b.j(1):b.call(null,1));else for(a=K(b),b=this;;){var c=N(a);if(v(c))a=P(a),b=te(b,Rd.j?Rd.j(c):Rd.call(null,c),Sd.j?Sd.j(c):Sd.call(null,c));else{a=b;break a}}else throw Error("conj! after persistent");return a};
g.kb=function(){if(this.H){this.H=null;var a=new re(null,this.count,this.root,this.ka,this.ga,null)}else throw Error("persistent! called twice");return a};g.Xa=function(a,b,c){return te(this,b,c)};g.call=function(a){switch(arguments.length-1){case 1:return this.j(arguments[1]);case 2:return this.m(arguments[1],arguments[2]);default:throw Error(["Invalid arity: ",z.j(arguments.length-1)].join(""));}};g.apply=function(a,b){return this.call.apply(this,[this].concat(B(b)))};
g.j=function(a){return this.na(null,a)};g.m=function(a,b){return this.K(null,a,b)};function ue(a,b){this.G=a;this.ta=b;this.u=32374988;this.F=0}g=ue.prototype;g.toString=function(){return qb(this)};g.indexOf=function(){var a=null;a=function(b,c){switch(arguments.length){case 1:return S(this,b,0);case 2:return S(this,b,c)}throw Error("Invalid arity: "+arguments.length);};a.j=function(b){return S(this,b,0)};a.m=function(b,c){return S(this,b,c)};return a}();
g.lastIndexOf=function(){function a(c){return U(this,c,T(this))}var b=null;b=function(c,d){switch(arguments.length){case 1:return a.call(this,c);case 2:return U(this,c,d)}throw Error("Invalid arity: "+arguments.length);};b.j=a;b.m=function(c,d){return U(this,c,d)};return b}();g.T=function(){return this.ta};g.ba=function(){var a=(null!=this.G?this.G.u&128||u===this.G.$a||(this.G.u?0:w(Ea,this.G)):w(Ea,this.G))?this.G.ba():P(this.G);return null==a?null:new ue(a,null)};g.S=function(){return Kb(this)};
g.O=function(a,b){return Zb(this,b)};g.Z=function(){return O};g.da=function(a,b){return tc(b,this)};g.ea=function(a,b,c){return wc(b,c,this)};g.fa=function(){return this.G.fa(null).key};g.ja=function(){var a=(null!=this.G?this.G.u&128||u===this.G.$a||(this.G.u?0:w(Ea,this.G)):w(Ea,this.G))?this.G.ba():P(this.G);return null!=a?new ue(a,null):O};g.M=function(){return this};g.U=function(a,b){return b===this.ta?this:new ue(this.G,b)};g.X=function(a,b){return V(b,this)};ue.prototype[va]=function(){return Ib(this)};
function Id(a){return(a=K(a))?new ue(a,null):null}function Rd(a){return Ma(a)}function ve(a,b){this.G=a;this.ta=b;this.u=32374988;this.F=0}g=ve.prototype;g.toString=function(){return qb(this)};g.indexOf=function(){var a=null;a=function(b,c){switch(arguments.length){case 1:return S(this,b,0);case 2:return S(this,b,c)}throw Error("Invalid arity: "+arguments.length);};a.j=function(b){return S(this,b,0)};a.m=function(b,c){return S(this,b,c)};return a}();
g.lastIndexOf=function(){function a(c){return U(this,c,T(this))}var b=null;b=function(c,d){switch(arguments.length){case 1:return a.call(this,c);case 2:return U(this,c,d)}throw Error("Invalid arity: "+arguments.length);};b.j=a;b.m=function(c,d){return U(this,c,d)};return b}();g.T=function(){return this.ta};g.ba=function(){var a=(null!=this.G?this.G.u&128||u===this.G.$a||(this.G.u?0:w(Ea,this.G)):w(Ea,this.G))?this.G.ba():P(this.G);return null==a?null:new ve(a,null)};g.S=function(){return Kb(this)};
g.O=function(a,b){return Zb(this,b)};g.Z=function(){return O};g.da=function(a,b){return tc(b,this)};g.ea=function(a,b,c){return wc(b,c,this)};g.fa=function(){return this.G.fa(null).J};g.ja=function(){var a=(null!=this.G?this.G.u&128||u===this.G.$a||(this.G.u?0:w(Ea,this.G)):w(Ea,this.G))?this.G.ba():P(this.G);return null!=a?new ve(a,null):O};g.M=function(){return this};g.U=function(a,b){return b===this.ta?this:new ve(this.G,b)};g.X=function(a,b){return V(b,this)};ve.prototype[va]=function(){return Ib(this)};
function Jd(a){return(a=K(a))?new ve(a,null):null}function Sd(a){return Na(a)}function Hc(a){if(null!=a&&(a.F&4096||u===a.Lb))return a.name;if("string"===typeof a)return a;throw Error(["Doesn't support name: ",z.j(a)].join(""));}
function we(a,b,c,d,e,f,h){var k=ka;ka=null==ka?null:ka-1;try{if(null!=ka&&0>ka)return H(a,"#");H(a,c);if(0===sa.j(f))K(h)&&H(a,function(){var t=xe.j(f);return v(t)?t:"..."}());else{if(K(h)){var l=N(h);b.v?b.v(l,a,f):b.call(null,l,a,f)}for(var m=P(h),n=sa.j(f)-1;;)if(!m||null!=n&&0===n){K(m)&&0===n&&(H(a,d),H(a,function(){var t=xe.j(f);return v(t)?t:"..."}()));break}else{H(a,d);var p=N(m);c=a;h=f;b.v?b.v(p,c,h):b.call(null,p,c,h);var q=P(m);c=n-1;m=q;n=c}}return H(a,e)}finally{ka=k}}
function ye(a,b){b=K(b);for(var c=null,d=0,e=0;;)if(e<d){var f=c.W(null,e);H(a,f);e+=1}else if(b=K(b))c=b,oc(c)?(b=lb(c),d=mb(c),c=b,f=T(b),b=d,d=f):(f=N(c),H(a,f),b=P(c),c=null,d=0),e=0;else return null}var ze={'"':'\\"',"\\":"\\\\","\b":"\\b","\f":"\\f","\n":"\\n","\r":"\\r","\t":"\\t"};function Ae(a){return['"',z.j(a.replace(RegExp('[\\\\"\b\f\n\r\t]',"g"),function(b){return ze[b]})),'"'].join("")}
function Be(a,b){return(a=rc(Cb.m(a,qa)))?(a=null!=b?b.u&131072||u===b.Kb?!0:!1:!1)?null!=jc(b):a:a}
function Ce(a,b,c){if(null==a)return H(b,"nil");if(Be(c,a)){H(b,"^");var d=jc(a);Z.v?Z.v(d,b,c):Z.call(null,d,b,c);H(b," ")}if(a.xb)return a.Ob(b);if(null!=a?a.u&2147483648||u===a.ca||(a.u?0:w(eb,a)):w(eb,a))return fb(a,b,c);if(!0===a||!1===a)return H(b,z.j(a));if("number"===typeof a)return H(b,isNaN(a)?"##NaN":a===Number.POSITIVE_INFINITY?"##Inf":a===Number.NEGATIVE_INFINITY?"##-Inf":z.j(a));if(null!=a&&a.constructor===Object)return H(b,"#js "),d=X.m(function(f){var h=/[A-Za-z_\*\+\?!\-'][\w\*\+\?!\-']*/;
if("string"===typeof f)if(h=h.exec(f),null!=h&&R.m(h[0],f))if(1===h.length)h=h[0];else if(v(Fd.j?Fd.j(h):Fd.call(null,h)))h=new Y(null,2,5,td,[Rd.j?Rd.j(h):Rd.call(null,h),Sd.j?Sd.j(h):Sd.call(null,h)],null);else if(nc(h))h=ic(h,null);else if(ta(h))b:{var k=h.length;if(32>k)h=new Y(null,k,5,td,h,null);else for(var l=32,m=(new Y(null,32,5,td,h.slice(0,32),null)).Za(null);;)if(l<k){var n=l+1;m=hb(m,h[l]);l=n}else{h=ib(m);break b}}else h=ib(uc(hb,gb(bc),h));else h=null;else throw new TypeError("re-matches must match against a string.");
return new Ed(null!=h?Gc.j(f):f,a[f])},da(a)),De.ia?De.ia(d,Z,b,c):De.call(null,d,Z,b,c);if(ta(a))return we(b,Z,"#js ["," ","]",c,a);if("string"===typeof a)return v(pa.j(c))?H(b,Ae(a)):H(b,a);if("function"===typeof a){var e=a.name;c=v(function(){var f=null==e;return f?f:/^[\s\xa0]*$/.test(e)}())?"Function":e;return ye(b,$b(["#object[",c,v(!1)?[' "',z.j(a),'"'].join(""):"","]"]))}if(a instanceof Date)return c=function(f,h){for(f=z.j(f);;)if(f.length<h)f=["0",f].join("");else return f},ye(b,$b(['#inst "',
c(a.getUTCFullYear(),4),"-",c(a.getUTCMonth()+1,2),"-",c(a.getUTCDate(),2),"T",c(a.getUTCHours(),2),":",c(a.getUTCMinutes(),2),":",c(a.getUTCSeconds(),2),".",c(a.getUTCMilliseconds(),3),"-",'00:00"']));if(a instanceof RegExp)return ye(b,$b(['#"',a.source,'"']));if("symbol"===r(a)||"undefined"!==typeof Symbol&&a instanceof Symbol)return ye(b,$b(["#object[",a.toString(),"]"]));if(v(function(){var f=null==a?null:a.constructor;return null==f?null:f.lb}()))return ye(b,$b(["#object[",a.constructor.lb.replace(RegExp("/",
"g"),"."),"]"]));e=function(){var f=null==a?null:a.constructor;return null==f?null:f.name}();c=v(function(){var f=null==e;return f?f:/^[\s\xa0]*$/.test(e)}())?"Object":e;return null==a.constructor?ye(b,$b(["#object[",c,"]"])):ye(b,$b(["#object[",c," ",z.j(a),"]"]))}function Z(a,b,c){var d=Ee.j(c);return v(d)?(c=ec.v(c,Fe,Ce),d.v?d.v(a,b,c):d.call(null,a,b,c)):Ce(a,b,c)}function Ge(a){return a instanceof Bb?Db.m(null,Hc(a)):Gc.m(null,Hc(a))}
function He(a){if(v(!1)){var b=K(a),c=K(b),d=N(c);P(c);W(d,0,null);W(d,1,null);c=null==a?null:null!=a&&(a.u&4||u===a.Db)?a.Z(null):(null!=a?a.u&4||u===a.Db||(a.u?0:w(ya,a)):w(ya,a))?za(a):null;for(a=null;;){d=a;b=K(b);a=N(b);var e=P(b),f=a;a=W(f,0,null);b=W(f,1,null);if(v(f))if(a instanceof I||a instanceof Bb)if(v(d))if(R.m(d,Fc(a)))c=ec.v(c,Ge(a),b),a=d,b=e;else return null;else if(d=Fc(a),v(d))c=ec.v(c,Ge(a),b),a=d,b=e;else return null;else return null;else return new Y(null,2,5,td,[d,c],null)}}else return null}
function Ie(a,b,c,d,e){return we(d,function(f,h,k){var l=Ma(f);c.v?c.v(l,h,k):c.call(null,l,h,k);H(h," ");f=Na(f);return c.v?c.v(f,h,k):c.call(null,f,h,k)},[z.j(a),"{"].join(""),", ","}",e,K(b))}function De(a,b,c,d){var e=lc(a)?He(a):null,f=W(e,0,null);e=W(e,1,null);return v(f)?Ie(["#:",z.j(f)].join(""),e,b,c,d):Ie(null,a,b,c,d)}M.prototype.ca=u;M.prototype.P=function(a,b,c){return we(b,Z,"("," ",")",c,this)};Ic.prototype.ca=u;Ic.prototype.P=function(a,b,c){return we(b,Z,"("," ",")",c,this)};
Ed.prototype.ca=u;Ed.prototype.P=function(a,b,c){return we(b,Z,"["," ","]",c,this)};me.prototype.ca=u;me.prototype.P=function(a,b,c){return we(b,Z,"("," ",")",c,this)};Gd.prototype.ca=u;Gd.prototype.P=function(a,b,c){return we(b,Z,"("," ",")",c,this)};Jb.prototype.ca=u;Jb.prototype.P=function(a,b,c){return we(b,Z,"("," ",")",c,this)};ud.prototype.ca=u;ud.prototype.P=function(a,b,c){return we(b,Z,"("," ",")",c,this)};Ec.prototype.ca=u;Ec.prototype.P=function(a,b,c){return we(b,Z,"("," ",")",c,this)};
re.prototype.ca=u;re.prototype.P=function(a,b,c){return De(this,Z,b,c)};oe.prototype.ca=u;oe.prototype.P=function(a,b,c){return we(b,Z,"("," ",")",c,this)};Mc.prototype.ca=u;Mc.prototype.P=function(a,b,c){return we(b,Z,"("," ",")",c,this)};ve.prototype.ca=u;ve.prototype.P=function(a,b,c){return we(b,Z,"("," ",")",c,this)};Y.prototype.ca=u;Y.prototype.P=function(a,b,c){return we(b,Z,"["," ","]",c,this)};Dc.prototype.ca=u;Dc.prototype.P=function(a,b){return H(b,"()")};ma.prototype.ca=u;
ma.prototype.P=function(a,b,c){return De(this,Z,b,c)};ue.prototype.ca=u;ue.prototype.P=function(a,b,c){return we(b,Z,"("," ",")",c,this)};cc.prototype.ca=u;cc.prototype.P=function(a,b,c){return we(b,Z,"("," ",")",c,this)};function Je(){}function Ke(a){if(null!=a&&null!=a.Fb)a=a.Fb(a);else{var b=Ke[r(null==a?null:a)];if(null!=b)a=b.j?b.j(a):b.call(null,a);else if(b=Ke._,null!=b)a=b.j?b.j(a):b.call(null,a);else throw x("IEncodeJS.-clj-\x3ejs",a);}return a}
function Le(a,b){if(null!=a?u===a.Eb||(a.Pb?0:w(Je,a)):w(Je,a))a=Ke(a);else if("string"===typeof a||"number"===typeof a||a instanceof I||a instanceof Bb)a=b.j?b.j(a):b.call(null,a);else{var c=$b([a]);a=la();(b=null==c)||(b=K(c),b=null==b?!0:!1===b?!0:!1);if(b)a="";else{b=z;var d=b.j,e=new fa,f=new pb(e);Z(N(c),f,a);c=K(P(c));for(var h=null,k=0,l=0;;)if(l<k){var m=h.W(null,l);H(f," ");Z(m,f,a);l+=1}else if(c=K(c))h=c,oc(h)?(c=lb(h),k=mb(h),h=c,m=T(c),c=k,k=m):(m=N(h),H(f," "),Z(m,f,a),c=P(h),h=null,
k=0),l=0;else break;a=d.call(b,e)}}return a}var Me=function Me(a){for(var c=[],d=arguments.length,e=0;;)if(e<d)c.push(arguments[e]),e+=1;else break;return Me.N(arguments[0],1<c.length?new M(c.slice(1),0,null):null)};
Me.N=function(a,b){b=Zc(b);var c=Cb.v(b,Ne,Hc),d=function h(f){if(null==f)return null;if(null!=f?u===f.Eb||(f.Pb?0:w(Je,f)):w(Je,f))return Ke(f);if(f instanceof I)return c.j?c.j(f):c.call(null,f);if(f instanceof Bb)return z.j(f);if(lc(f)){var k={};f=K(f);for(var l=null,m=0,n=0;;)if(n<m){var p=l.W(null,n),q=W(p,0,null);p=W(p,1,null);q=Le(q,d);p=h(p);k[q]=p;n+=1}else if(f=K(f))oc(f)?(m=lb(f),f=mb(f),l=m,m=T(m)):(m=N(f),l=W(m,0,null),m=W(m,1,null),l=Le(l,d),m=h(m),k[l]=m,f=P(f),l=null,m=0),n=0;else break;
return k}if(null==f?0:null!=f?f.u&8||u===f.Ub||(f.u?0:w(Aa,f)):w(Aa,f)){k=[];f=K(X.m(h,f));l=null;for(n=m=0;;)if(n<m)q=l.W(null,n),k.push(q),n+=1;else if(f=K(f))l=f,oc(l)?(f=lb(l),n=mb(l),l=f,m=T(f),f=n):(f=N(l),k.push(f),f=P(l),l=null,m=0),n=0;else break;return k}return f};return d(a)};Me.aa=1;Me.$=function(a){var b=N(a);a=P(a);return this.N(b,a)};var sa=new I(null,"print-length","print-length",1931866356),oa=new I(null,"flush-on-newline","flush-on-newline",-151457939),Oe=new I(null,"mass","mass",-2138950046),qa=new I(null,"meta","meta",1499536964),Fe=new I(null,"fallback-impl","fallback-impl",-1501286995),pa=new I(null,"readably","readably",1129599760),Pe=new I(null,"color","color",1011675173),Ne=new I(null,"keyword-fn","keyword-fn",-64566675),Ee=new I(null,"alt-impl","alt-impl",670969595),ra=new I(null,"dup","dup",556298533),xe=new I(null,
"more-marker","more-marker",-14717935);var Qe={},Re={},Se=[];function Te(a,b){var c=Re[a];if(void 0!==c)return c;try{Se.push(a);var d=Qe[a],e=shadow$provide[a];if(void 0===d){if(void 0===e)throw"Module not provided: "+a;d={exports:{}};Qe[a]=d}if(e){delete shadow$provide[a];try{e.call(d,aa,Te,d,d.exports)}catch(h){throw console.warn("shadow-cljs - failed to load",a),h;}if(b){var f=b.globals;if(f)for(a=0;a<f.length;a++)window[f[a]]=d.exports}}}finally{Se.pop()}return d.exports}Te.cache={};Te.resolve=function(a){return a};var Ue=Te(0,{});var Ve=Te(1,{});var ff=document.getElementById("dragonfly"),We=new Ue.PerspectiveCamera(75,ff.clientWidth/ff.clientHeight,1,100);We.position.z=5;var Xe=new Ue.Scene,Ye=new Ue.WebGLRenderer;Ye.setSize(ff.clientWidth,ff.clientHeight);ff.appendChild(Ye.domElement);var Ze=new Ue.BoxGeometry(2,2,2),$e=new Ue.MeshBasicMaterial(Me(new ma(null,1,[Pe,65280],null))),af=new Ue.Mesh(Ze,$e);Xe.add(af);var bf=new Ve.World,cf=new Ve.Box(new Ve.Vec3(1,1,1)),df=new Ve.Body(Me(new ma(null,1,[Oe,1],null)));df.addShape(cf);
df.angularVelocity.set(0,10,0);df.angularDamping=.5;bf.addBody(df);(new ResizeObserver(function(){We.aspect=ff.clientWidth/ff.clientHeight;We.updateProjectionMatrix();return Ye.setSize(ff.clientWidth,ff.clientHeight)})).observe(ff);(function ef(){requestAnimationFrame(ef);bf.fixedStep();af.position.copy(df.position);af.quaternion.copy(df.quaternion);return Ye.render(Xe,We)})();
}).call(this);